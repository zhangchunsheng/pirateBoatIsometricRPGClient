var loading=function(){};
(function(a){"function"!=typeof document.querySelector&&(document.querySelector=function(a){return document.getElementById(a.replace("#",""))});a.bg=document.querySelector("#loadingbg");a.dom=document.querySelector("#loading");a.info=document.querySelector("#loadingInfo");a.tips=document.querySelector("#tips");a.reconnect=document.querySelector("#reconnect");a.show=function(){a.dom.style.display="block"};a.hide=function(){a.bg.style.display="none";a.dom.style.display="none"};a.showTips=function(){a.tips.style.display=
"block"};a.hideTips=function(){a.tips.style.display="none"};a.reconnect.show=function(){a.reconnect.style.display="block"};a.reconnect.hide=function(){a.reconnect.style.display="none"};a.bg.style.width=window.innerWidth+"px";a.bg.style.height=window.innerHeight+"px";a.bg.style.display="block";a.dom.style.left=(window.innerWidth-400)/2+"px";a.dom.style.top=(window.innerHeight-60)/2+"px";a.dom.style.display="block";a.info.style.left=(window.innerWidth-400)/2+140+"px";a.info.style.top=(window.innerHeight-
60)/2+"px";a.tips.style.height=window.innerHeight+"px";a.tips.style.lineHeight=window.innerHeight+"px";a.tips.style.left="0px";a.tips.style.top="0px";a.tips.children[0].style.left=(window.innerWidth-320)/2+"px";a.tips.children[0].style.top=(window.innerHeight-320)/2+"px";a.reconnect.style.height=window.innerHeight+"px";a.reconnect.style.lineHeight=window.innerHeight+"px";a.reconnect.style.left="0px";a.reconnect.style.top="0px";a.reconnect.children[0].style.left=window.innerWidth/2-30+"px";a.reconnect.children[0].style.top=
"16px";a.reconnect.children[0].onclick=function(){btg.initSocket()};a.reconnect.hide()})(loading);/*
 MinPubSub
 a micro publish/subscribe messaging framework
 @see https://github.com/daniellmb/MinPubSub 
 @author Daniel Lamb <daniellmb.com>

 Released under the MIT License
 MelonJS Game Engine
 Copyright (C) 2011 - 2013, Olivier BIOT
 http://www.melonjs.org

 melonJS is licensed under the MIT License.
 http://www.opensource.org/licenses/mit-license.php

 Tween JS
 https://github.com/sole/Tween.js
*/
var me=me||{};
(function(a){function c(){if(!f){if(!b.body)return setTimeout(c,13);b.removeEventListener?b.removeEventListener("DOMContentLoaded",c,!1):a.removeEventListener("load",c,!1);f=!0;for(var d=0;d<g.length;d++)g[d].call(a,[]);g.length=0}}var b=a.document;me={mod:"melonJS",version:"0.9.7",nocache:"",audio:null,video:null,timer:null,input:null,state:null,game:null,entityPool:null,levelDirector:null,TMXParser:null,loadingScreen:null,TMXTileMap:null};me.sys={ua:navigator.userAgent.toLowerCase(),sound:!1,localStorage:"object"==
typeof a.localStorage,gyro:void 0!==a.DeviceMotionEvent,nativeBase64:"function"==typeof a.atob,touch:!1,fps:60,interpolation:!1,scale:null,gravity:void 0,useNativeAnimFrame:!1,cacheImage:!1,dirtyRegion:!1,stopOnAudioError:!0,pauseOnBlur:!0,preRender:!1,checkVersion:function(a,d){for(var d=d||me.version,b=a.split("."),c=d.split("."),e=Math.min(b.length,c.length),f=0,g=0;g<e&&!(f=+b[g]-+c[g]);g++);return f?f:b.length-c.length}};var d=!1,e=!1,f=!1,g=[];a.onReady=function(d){e||(e=!0,"complete"===b.readyState?
c():(b.addEventListener&&b.addEventListener("DOMContentLoaded",c,!1),a.addEventListener("load",c,!1)));f?d.call(a,[]):g.push(function(){return d.call(a,[])});return this};a.onReady(function(){d||(me.utils.setNocache(b.location.href.match(/\?nocache/)||!1),me.audio.detectCapabilities(),me.sys.touch="createTouch"in b||"ontouchstart"in a||navigator.isCocoonJS,me.timer.init(),me.mapReader=new me.TMXMapReader,me.loadingScreen=new me.DefaultLoadingScreen,me.state.init(),me.entityPool.init(),me.levelDirector.reset(),
d=!0)});var h=!1,i=/xyz/.test(function(){})?/\bparent\b/:/.*/;Object.extend=function(a){function d(){!h&&this.init&&this.init.apply(this,arguments)}var b=this.prototype;h=!0;var c=new this;h=!1;for(var e in a)c[e]="function"==typeof a[e]&&"function"==typeof b[e]&&i.test(a[e])?function(a,d){return function(){var c=this.parent;this.parent=b[a];var e=d.apply(this,arguments);this.parent=c;return e}}(e,a[e]):a[e];d.prototype=c;d.constructor=d;d.extend=Object.extend;return d};"function"!==typeof Object.create&&
(Object.create=function(a){function d(){}d.prototype=a;return new d});if(!Function.prototype.bind){var j=function(){};Function.prototype.bind=function(a){var d=this;if("function"!=typeof d)throw new TypeError("Function.prototype.bind called on incompatible "+d);var b=Array.prototype.slice.call(arguments,1),c=function(){if(this instanceof c){var e=d.apply(this,b.concat(Array.prototype.slice.call(arguments)));return Object(e)===e?e:this}return d.apply(a,b.concat(Array.prototype.slice.call(arguments)))};
d.prototype&&(j.prototype=d.prototype,c.prototype=new j,j.prototype=null);return c}}"undefined"===typeof Date.now&&(Date.now=function(){return(new Date).getTime()});"undefined"===typeof console&&(console={log:function(){},info:function(){},error:function(){alert(Array.prototype.slice.call(arguments).join(", "))}});Function.prototype.defer=function(){var a=this,d=Array.prototype.slice.call(arguments);return window.setTimeout(function(){return a.apply(a,d)},0.01)};Object.defineProperty||(Object.defineProperty=
function(a,d,b){if(a.__defineGetter__)b.get&&a.__defineGetter__(d,b.get),b.set&&a.__defineSetter__(d,b.set);else throw"melonJS: Object.defineProperty not supported";});String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});String.prototype.isNumeric=function(){return null!=this&&!isNaN(this)&&""!=this.trim()};String.prototype.isBoolean=function(){return null!=this&&("true"==this.trim()||"false"==this.trim())};String.prototype.contains=function(a){return-1<
this.indexOf(a)};String.prototype.toHex=function(){for(var a="",d=0;d<this.length;)a+=this.charCodeAt(d++).toString(16);return a};Number.prototype.clamp=function(a,d){return this<a?a:this>d?d:+this};Number.prototype.random=function(a,d){return~~(Math.random()*(d-a+1))+a};Number.prototype.round=function(){var a=2>arguments.length?this:arguments[0],d=Math.pow(10,arguments[1]||arguments[0]||0);return Math.round(a*d)/d};Number.prototype.toHex=function(){return"0123456789ABCDEF".charAt(this-this%16>>4)+
"0123456789ABCDEF".charAt(this%16)};Number.prototype.sign=function(){return 0>this?-1:0<this?1:0};Number.prototype.degToRad=function(a){return(a||this)/180*Math.PI};Number.prototype.radToDeg=function(a){return(a||this)*(180/Math.PI)};Array.prototype.remove=function(a){a=Array.prototype.indexOf.call(this,a);-1!==a&&Array.prototype.splice.call(this,a,1);return this};Array.prototype.forEach||(Array.prototype.forEach=function(a,d){for(var b=0,c=this.length;c--;b++)a.call(d||this,this[b],b,this)});Object.defineProperty(me,
"initialized",{get:function(){return d}});var k={},n=[],u,m=[],r=0;k.isDirty=!1;k.reset=function(){n.length=0;m.length=0;u=me.game.viewport.getRect();k.makeAllDirty()};k.makeDirty=function(a,d,b){d&&(k.isDirty=!0,me.sys.dirtyRegion&&(b?n.push(b.union(a)):a.getRect&&n.push(a.getRect())));a.inViewport&&m.unshift(a)};k.makeAllDirty=function(){n.length=0;n.push(u);k.isDirty=!0};k.remove=function(a){var d=m.indexOf(a);-1!=d&&(m.splice(d,1),a.inViewport=!1,k.makeDirty(a,!0))};k.getDrawCount=function(){return r};
k.draw=function(a){var d=me.game.viewport.pos.x,b=me.game.viewport.pos.y;a.save();a.translate(-d,-b);for(var d=d-me.game.currentLevel.pos.x,b=b-me.game.currentLevel.pos.y,c=n.length,e;c--,e=n[c];){for(var f=m.length,g;f--,g=m[f];)if(!me.sys.dirtyRegion||!g.isSprite||g.overlaps(e))!0===g.floating&&(a.save(),a.translate(d,b)),g.draw(a,e),!0===g.floating&&a.restore(),r++;me.debug.renderDirty&&e.draw(a,"white")}a.restore()};k.flush=function(){me.sys.dirtyRegion&&(n.length=0);m.length=0;k.isDirty=!1;r=
0};var v=me,l={},w=null,s=[],D=!1,t=null,z=null,E=function(a,d){return d.z-a.z};l.viewport=null;l.HUD=null;l.collisionMap=null;l.currentLevel=null;l.renderer=null;l.NO_OBJECT=0;l.ENEMY_OBJECT=1;l.COLLECTABLE_OBJECT=2;l.ACTION_OBJECT=3;l.onLevelLoaded=null;l.init=function(a,d){D||(a=a||me.video.getWidth(),d=d||me.video.getHeight(),l.viewport=new me.Viewport(0,0,a,d),w=me.video.getSystemContext(),me.event.publish(me.event.GAME_INIT),D=!0)};l.reset=function(){D||l.init();l.removeAll();l.viewport&&l.viewport.reset();
k.reset();w.setTransform(1,0,0,1,0,0);l.currentLevel={pos:{x:0,y:0}}};l.loadTMXLevel=function(a){l.currentLevel=a;l.collisionMap=l.currentLevel.getLayerByName("collision");(!l.collisionMap||!l.collisionMap.isCollisionMap)&&console.error("WARNING : no collision map detected");for(var d=l.currentLevel.getLayers(),b=d.length;b--;)d[b].visible&&l.add(d[b]);l.viewport.setBounds(Math.max(l.currentLevel.realwidth,l.viewport.width),Math.max(l.currentLevel.realheight,l.viewport.height));d=l.currentLevel.getObjectGroups();
for(b=0;b<d.length;b++)if(d[b].visible)for(var c=0;c<d[b].objects.length;c++)l.addEntity(d[b].objects[c],d[b].z);l.currentLevel.pos.x!=l.currentLevel.pos.y&&w.translate(l.currentLevel.pos.x,l.currentLevel.pos.y);l.sort();l.onLevelLoaded&&l.onLevelLoaded.call(l.onLevelLoaded,a.name);me.event.publish(me.event.LEVEL_LOADED,[a.name])};l.add=function(a,d){a.z=d?d:a.z;s.push(a)};l.addEntity=function(a,d){var b=me.entityPool.newInstanceOf(a.name,a.x,a.y,a);b&&l.add(b,d)};l.getEntityByName=function(a){for(var d=
[],a=a.toLowerCase(),b=s.length,c;b--,c=s[b];)c.name&&c.name.toLowerCase()===a&&d.push(c);return d};l.getObjectCount=function(){return s.length};l.getDrawCount=function(){return k.getDrawCount()};l.getEntityByGUID=function(a){for(var d=s.length,b;d--,b=s[d];)if(b.isEntity&&b.GUID==a)return b;return null};l.addHUD=function(a,d,b,c,e){null==l.HUD&&(l.HUD=new me.HUD_Object(a,d,b,c,e),l.add(l.HUD))};l.disableHUD=function(){null!=l.HUD&&(l.remove(l.HUD),l.HUD=null)};l.update=function(){for(var a=null,
d=s.length,b;d--,b=s[d];){var a=me.sys.dirtyRegion&&b.isSprite?b.getRect():null,c=b.update();b.inViewport=b.visible?!b.isSprite||b.floating?!0:l.viewport.isVisible(b):!1;k.makeDirty(b,c,c?a:null)}l.viewport.update(k.isDirty)&&k.makeAllDirty()};l.remove=function(a,d){a.destroy&&a.destroy();k.remove(a);!0===d?(s.remove(a),me.entityPool.freeInstance(a)):(a.visible=!1,t=function(a){s.remove(a);me.entityPool.freeInstance(a);t=null}.defer(a))};l.removeAll=function(){t&&(clearTimeout(t),t=null);z&&(clearTimeout(z),
z=null);for(var a=s.length;a--;)s[a].isPersistent||l.remove(s[a],!0);k.flush()};l.sort=function(a){null===z&&("function"!==typeof a&&(a=E),z=function(a){s.sort(a);z=null;me.game.repaint()}.defer(a))};l.collide=function(a,d){var b,d=!0===d?!0:!1;if(!0===d)var c=[],e=0;for(var f=s.length,g;f--,g=s[f];)if(g.inViewport&&(g.visible&&g.collidable&&g!=a)&&(b=g.collisionBox.collideVsAABB.call(g.collisionBox,a.collisionBox),0!=b.x||0!=b.y)){g.onCollision.call(g,b,a);b.type=g.type;b.obj=g;if(!d)return b;c[e++]=
b}return d?c:null};l.collideType=function(a,d,b){var c,b=!0===b?!0:!1;if(!0===b)var e=[],f=0;for(var g=s.length,h;g--,h=s[g];)if(h.inViewport&&(h.visible&&h.collidable&&h.type===d&&h!=a)&&(c=h.collisionBox.collideVsAABB.call(h.collisionBox,a.collisionBox),0!=c.x||0!=c.y)){h.onCollision.call(h,c,a);c.type=h.type;c.obj=h;if(!b)return c;e[f++]=c}return b?e:null};l.repaint=function(){k.makeAllDirty()};l.draw=function(){k.isDirty&&(k.draw(w),l.viewport.draw(w));k.flush()};v.game=l;me.ScreenObject=Object.extend({inViewport:!1,
visible:!1,addAsObject:!1,isPersistent:!1,z:999,rect:null,init:function(a,d){this.isPersistent=(this.addAsObject=this.visible=!0===a||!1)&&!0===d||!1;this.rect=new me.Rect(new me.Vector2d(0,0),0,0)},reset:function(){me.game.reset();this.onResetEvent.apply(this,arguments);this.addAsObject&&(this.visible=!0,this.rect=me.game.viewport.getRect(),me.game.add(this,this.z));me.game.sort()},getRect:function(){return this.rect},destroy:function(){this.onDestroyEvent.apply(this,arguments)},update:function(){return!1},
onUpdateFrame:function(){me.timer.update();me.game.update();me.game.draw();me.video.blitSurface()},draw:function(){},onResetEvent:function(){},onDestroyEvent:function(){}});for(var v=me,L=function(){if(-1==G&&-1==B){me.timer.reset();if(me.sys.useNativeAnimFrame){B=window.requestAnimationFrame(K);if(-1!=B)return;me.sys.useNativeAnimFrame=!1}G=setInterval(O,~~(1E3/me.sys.fps))}},K=function(){O();-1!=B&&(B=window.requestAnimationFrame(K))},I=function(){-1!=G&&(clearInterval(G),G=-1);-1!=B&&(window.cancelAnimationFrame(B),
B=-1)},J=function(a){I();A[C]&&(A[C].screen.visible&&me.game.remove.call(me.game,A[C].screen,!0),A[C].screen.destroy());A[a]&&(C=a,A[C].screen.reset.apply(A[C].screen,P),O=A[C].screen.onUpdateFrame.bind(A[C].screen),L(),Q&&Q(),me.game.repaint())},F=["ms","moz","webkit","o"],H=0;H<F.length&&!window.requestAnimationFrame;++H)window.requestAnimationFrame=window[F[H]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[F[H]+"CancelAnimationFrame"]||window[F[H]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||
(window.requestAnimationFrame=function(){return-1});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(){return-1});var q={},C=-1,G=-1,B=-1,A={},M="",N=0,Q=null,P=null,O=null;q.LOADING=0;q.MENU=1;q.READY=2;q.PLAY=3;q.GAMEOVER=4;q.GAME_END=5;q.SCORE=6;q.CREDITS=7;q.SETTINGS=8;q.USER=100;q.onPause=null;q.onResume=null;q.init=function(){q.set(q.LOADING,me.loadingScreen);a.addEventListener("blur",function(){me.sys.pauseOnBlur&&C!=q.LOADING&&q.pause(!0);if(q.onPause)q.onPause();me.event.publish(me.event.STATE_PAUSE)},
!1);a.addEventListener("focus",function(){me.sys.pauseOnBlur&&C!=q.LOADING&&(q.resume(!0),me.game.repaint());if(q.onResume)q.onResume();me.event.publish(me.event.STATE_RESUME)},!1)};q.pause=function(a){I();a&&me.audio.pauseTrack()};q.resume=function(a){L();a&&me.audio.resumeTrack()};q.isRunning=function(){return-1!=G||-1!=B};q.set=function(a,d){A[a]={};A[a].screen=d;A[a].transition=!0};q.current=function(){return A[C].screen};q.transition=function(a,d,b){"fade"==a&&(M=d,N=b)};q.setTransition=function(a,
d){A[a].transition=d};q.change=function(a){P=null;1<arguments.length&&(P=Array.prototype.slice.call(arguments,1));N&&A[a].transition?(Q=function(){me.game.viewport.fadeOut(M,N)},me.game.viewport.fadeIn(M,N,function(){J.defer(a)})):J.defer(a)};q.isCurrent=function(a){return C==a};v.state=q})(window);
(function(){me.DefaultLoadingScreen=me.ScreenObject.extend({init:function(){this.parent(!0);this.logo1=new me.Font("century gothic",32,"white","middle");this.logo2=new me.Font("century gothic",32,"#89b002","middle");this.logo2.bold();this.invalidate=!1;this.handle=null;this.loadPercent=0},onResetEvent:function(){this.handle=me.event.subscribe(me.event.LOADER_PROGRESS,this.onProgressUpdate.bind(this))},onDestroyEvent:function(){this.logo1=this.logo2=null;this.handle&&(me.event.unsubscribe(this.handle),
this.handle=null)},onProgressUpdate:function(a){this.loadPercent=a;this.invalidate=!0},update:function(){return!0===this.invalidate?(this.invalidate=!1,!0):!1},draw:function(a){var d=this.logo1.measureText(a,"melon").width,b=(me.video.getWidth()-d-this.logo2.measureText(a,"JS").width)/2,c=me.video.getHeight()/2;me.video.clearSurface(a,"black");this.logo1.draw(a,"melon",b,c);this.logo2.draw(a,"JS",b+d,c);c+=this.logo1.measureText(a,"melon").height/2;d=Math.floor(this.loadPercent*me.video.getWidth());
a.strokeStyle="silver";a.strokeRect(0,c,me.video.getWidth(),6);a.fillStyle="#89b002";a.fillRect(2,c+2,d-4,2)}});var a=me,c=function(){h==g?b.onload?(clearTimeout(i),setTimeout(function(){b.onload();me.event.publish(me.event.LOADER_COMPLETE)},300)):console.error("no load callback defined"):i=setTimeout(c,100)},b={},d={},e={},f={},g=0,h=0,i=0;b.onload=void 0;b.onProgress=void 0;b.onResourceLoaded=function(){h++;var a=b.getLoadProgress();if(b.onProgress)b.onProgress(a);me.event.publish(me.event.LOADER_PROGRESS,
[a])};b.onLoadingError=function(a){throw"melonJS: Failed loading resource "+a.src;};b.preload=function(a){g+=a.length;a=[].concat(a);b.loadNext(a,function(){console.log("resource has loaded")});c()};b.loadNext=function(a,d){var c=a.shift();if(c){var e=b.onResourceLoaded.bind(b),f=b.onLoadingError.bind(b,c);b.load(c,function(){e();b.loadNext(a,d)},f)}else d()};b.load=function(a,b,c){a.name=a.name.toLowerCase();switch(a.type){case "binary":var g=new XMLHttpRequest;g.open("GET",a.src+me.nocache,!1);
g.responseType="arraybuffer";g.onerror=c;g.onload=function(){var d=g.response;if(d){var d=new Uint8Array(d),c=[];f[a.name]=new dataType;for(var e=0;e<d.byteLength;e++)c[e]=String.fromCharCode(d[e]);f[a.name].data=c.join("");b()}};g.send();return 1;case "image":return d[a.name]=new Image,d[a.name].onload=function(){b();delete d[a.name];d[a.name]={src:this.src,width:this.width,height:this.height}},d[a.name].onerror=c,d[a.name].src=a.src+me.nocache,1;case "tmx":case "tsx":var h=new XMLHttpRequest,i=
me.utils.getFileExtension(a.src).toLowerCase();h.overrideMimeType&&("json"===i?h.overrideMimeType("application/json"):h.overrideMimeType("text/xml"));h.open("GET",a.src+me.nocache,!0);h.ontimeout=c;h.onreadystatechange=function(){if(4==h.readyState)if(200==h.status||0==h.status&&h.responseText){var d=null;switch(i){case "xml":case "tmx":d=me.sys.ua.contains("msie")||!h.responseXML?(new DOMParser).parseFromString(h.responseText,"text/xml"):h.responseXML;i="xml";break;case "json":d=JSON.parse(h.responseText);
break;default:throw"melonJS: TMX file format "+i+"not supported !";}e[a.name]={data:d,isTMX:"tmx"===a.type,format:i};"tmx"===a.type&&me.levelDirector.addTMXLevel(a.name);b()}else c()};h.send(null);return 1;case "audio":if(me.audio.isAudioEnable())return me.audio.load(a,b,c),1;break;default:throw"melonJS: me.loader.load : unknown or invalid resource type : "+a.type;}return 0};b.unload=function(a){a.name=a.name.toLowerCase();switch(a.type){case "binary":if(!(a.name in f))return!1;delete f[a.name];return!0;
case "image":if(!(a.name in d))return!1;delete d[a.name];return!0;case "tmx":case "tsx":if(!(a.name in e))return!1;delete e[a.name];return!0;case "audio":return me.audio.unload(a.name);default:throw"melonJS: me.loader.unload : unknown or invalid resource type : "+a.type;}};b.unloadAll=function(){for(var a in f)b.unload(a);for(a in d)b.unload(a);for(a in e)b.unload(a);me.audio.unloadAll()};b.getTMXFormat=function(a){a=a.toLowerCase();return a in e?e[a].format:null};b.getTMX=function(a){a=a.toLowerCase();
return a in e?e[a].data:null};b.getBinary=function(a){a=a.toLowerCase();return a in f?f[a]:null};b.getImage=function(a){a=a.toLowerCase();if(a in d){if(!0===me.sys.cacheImage){var b=me.video.createCanvasSurface(d[a].width,d[a].height);b.drawImage(d[a],0,0);return b.canvas}b=new Image;a=d[a];b.src=a.src;b.width=a.width;b.height=a.height;return b}return null};b.getLoadProgress=function(){return h/g};a.loader=b})(window);
(function(){me.Vector2d=Object.extend({x:0,y:0,init:function(a,c){this.x=a||0;this.y=c||0},set:function(a,c){this.x=a;this.y=c},setZero:function(){this.set(0,0)},setV:function(a){this.x=a.x;this.y=a.y},add:function(a){this.x+=a.x;this.y+=a.y},sub:function(a){this.x-=a.x;this.y-=a.y},scale:function(a){this.x*=a.x;this.y*=a.y},div:function(a){this.x/=a;this.y/=a},abs:function(){0>this.x&&(this.x=-this.x);0>this.y&&(this.y=-this.y)},clamp:function(a,c){return new me.Vector2d(this.x.clamp(a,c),this.y.clamp(a,
c))},clampSelf:function(a,c){this.x=this.x.clamp(a,c);this.y=this.y.clamp(a,c);return this},minV:function(a){this.x=this.x<a.x?this.x:a.x;this.y=this.y<a.y?this.y:a.y},maxV:function(a){this.x=this.x>a.x?this.x:a.x;this.y=this.y>a.y?this.y:a.y},floor:function(){return new me.Vector2d(~~this.x,~~this.y)},floorSelf:function(){this.x=~~this.x;this.y=~~this.y;return this},ceil:function(){return new me.Vector2d(Math.ceil(this.x),Math.ceil(this.y))},ceilSelf:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);
return this},negate:function(){return new me.Vector2d(-this.x,-this.y)},negateSelf:function(){this.x=-this.x;this.y=-this.y;return this},copy:function(a){this.x=a.x;this.y=a.y},equals:function(a){return this.x===a.x&&this.y===a.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){var a=this.length();if(a<Number.MIN_VALUE)return 0;var c=1/a;this.x*=c;this.y*=c;return a},dotProduct:function(a){return this.x*a.x+this.y*a.y},distance:function(a){return Math.sqrt((this.x-
a.x)*(this.x-a.x)+(this.y-a.y)*(this.y-a.y))},angle:function(a){return Math.atan2(a.y-this.y,a.x-this.x)},clone:function(){return new me.Vector2d(this.x,this.y)},toString:function(){return"x:"+this.x+"y:"+this.y}});me.Rect=Object.extend({pos:null,colPos:null,width:0,height:0,hWidth:0,hHeight:0,init:function(a,c,b){this.pos=a;this.colPos=new me.Vector2d;this.width=c;this.height=b;this.hWidth=~~(c/2);this.hHeight=~~(b/2);Object.defineProperty(this,"left",{get:function(){return this.pos.x},configurable:!0});
Object.defineProperty(this,"right",{get:function(){return this.pos.x+this.width},configurable:!0});Object.defineProperty(this,"top",{get:function(){return this.pos.y},configurable:!0});Object.defineProperty(this,"bottom",{get:function(){return this.pos.y+this.height},configurable:!0})},set:function(a,c,b){this.pos=a;this.width=c;this.height=b;this.hWidth=~~(c/2);this.hHeight=~~(b/2)},getRect:function(){return new me.Rect(this.pos.clone(),this.width,this.height)},translate:function(a,c){this.pos.x+=
a;this.pos.y+=c;return this},translateV:function(a){this.pos.add(a);return this},union:function(a){var c=Math.min(this.pos.x,a.pos.x),b=Math.min(this.pos.y,a.pos.y);this.width=Math.ceil(Math.max(this.pos.x+this.width,a.pos.x+a.width)-c);this.height=Math.ceil(Math.max(this.pos.y+this.height,a.pos.y+a.height)-b);this.pos.x=~~c;this.pos.y=~~b;return this},adjustSize:function(a,c,b,d){-1!=a&&(this.colPos.x=a,this.width=c,this.hWidth=~~(this.width/2),this.left!==this.pos.x+this.colPos.x&&Object.defineProperty(this,
"left",{get:function(){return this.pos.x+this.colPos.x},configurable:!0}),this.right!==this.pos.x+this.colPos.x+this.width&&Object.defineProperty(this,"right",{get:function(){return this.pos.x+this.colPos.x+this.width},configurable:!0}));-1!=b&&(this.colPos.y=b,this.height=d,this.hHeight=~~(this.height/2),this.top!==this.pos.y+this.colPos.y&&Object.defineProperty(this,"top",{get:function(){return this.pos.y+this.colPos.y},configurable:!0}),this.bottom!==this.pos.y+this.colPos.y+this.height&&Object.defineProperty(this,
"bottom",{get:function(){return this.pos.y+this.colPos.y+this.height},configurable:!0}))},flipX:function(a){this.colPos.x=a-this.width-this.colPos.x;this.hWidth=~~(this.width/2)},flipY:function(a){this.colPos.y=a-this.height-this.colPos.y;this.hHeight=~~(this.height/2)},equals:function(a){return this.left===a.left&&this.right===a.right&&this.top===a.top&&this.bottom===a.bottom},overlaps:function(a){return this.left<a.right&&a.left<this.right&&this.top<a.bottom&&a.top<this.bottom},within:function(a){return a.left<=
this.left&&a.right>=this.right&&a.top<=this.top&&a.bottom>=this.bottom},contains:function(a){return a.left>=this.left&&a.right<=this.right&&a.top>=this.top&&a.bottom<=this.bottom},containsPoint:function(a){return a.x>=this.left&&a.x<=this.right&&a.y>=this.top&&a.y<=this.bottom},collideVsAABB:function(a){var c=new me.Vector2d(0,0);if(this.overlaps(a)){var b=this.left+this.hWidth-a.left-a.hWidth,d=this.top+this.hHeight-a.top-a.hHeight;c.x=a.hWidth+this.hWidth-(0>b?-b:b);c.y=a.hHeight+this.hHeight-(0>
d?-d:d);c.x<c.y?(c.y=0,c.x=0>b?-c.x:c.x):(c.x=0,c.y=0>d?-c.y:c.y)}return c},draw:function(a,c){a.strokeStyle=c||"red";a.strokeRect(this.left,this.top,this.width,this.height)}})})(window);(function(){me.debug={displayFPS:!1,renderHitBox:!1,renderCollisionMap:!1,renderDirty:!1,renderVelocity:!1}})(window);
(function(){var a=Math.min,c=Math.max;me.Viewport=me.Rect.extend({AXIS:{NONE:0,HORIZONTAL:1,VERTICAL:2,BOTH:3},limits:null,target:null,follow_axis:0,_shake:null,_fadeIn:null,_fadeOut:null,_deadwidth:0,_deadheight:0,_limitwidth:0,_limitheight:0,init:function(a,d,c,f,g,h){this.parent(new me.Vector2d(a,d),c-a,f-d);this.limits=new me.Vector2d(g||this.width,h||this.height);this.target=null;this.follow_axis=this.AXIS.NONE;this._shake={intensity:0,duration:0,axis:this.AXIS.BOTH,onComplete:null};this._fadeOut=
{color:0,alpha:0,duration:0,tween:null};this._fadeIn={color:0,alpha:1,duration:0,tween:null};this.setDeadzone(this.width/6,this.height/6)},_followH:function(b){return b.x-this.pos.x>this._deadwidth?(this.pos.x=~~a(b.x-this._deadwidth,this._limitwidth),!0):b.x-this.pos.x<this.deadzone.x?(this.pos.x=~~c(b.x-this.deadzone.x,0),!0):!1},_followV:function(b){return b.y-this.pos.y>this._deadheight?(this.pos.y=~~a(b.y-this._deadheight,this._limitheight),!0):b.y-this.pos.y<this.deadzone.y?(this.pos.y=~~c(b.y-
this.deadzone.y,0),!0):!1},reset:function(a,d){this.pos.x=a||0;this.pos.y=d||0;this.follow_axis=this.target=null},setDeadzone:function(a,d){this.deadzone=new me.Vector2d(~~((this.width-a)/2),~~((this.height-d)/2-0.25*d));this._deadwidth=this.width-this.deadzone.x;this._deadheight=this.height-this.deadzone.y;this.update(!0)},setBounds:function(a,d){this.limits.set(a,d);this._limitwidth=this.limits.x-this.width;this._limitheight=this.limits.y-this.height},follow:function(a,d){if(a instanceof me.ObjectEntity)this.target=
a.pos;else if(a instanceof me.Vector2d)this.target=a;else throw"melonJS: invalid target for viewport.follow";this.follow_axis=d||this.AXIS.BOTH;this.update(!0)},move:function(a,d){var c=~~(this.pos.y+d);this.pos.x=(~~(this.pos.x+a)).clamp(0,this._limitwidth);this.pos.y=c.clamp(0,this._limitheight)},update:function(a){if(this.target&&a)switch(this.follow_axis){case this.AXIS.HORIZONTAL:a=this._followH(this.target);break;case this.AXIS.VERTICAL:a=this._followV(this.target);break;case this.AXIS.BOTH:a=
this._followH(this.target),a=this._followV(this.target)||a}if(0<this._shake.duration)if(this._shake.duration-=me.timer.tick,0>this._shake.duration){if(this._shake.onComplete)this._shake.onComplete()}else{if(this._shake.axis==this.AXIS.BOTH||this._shake.axis==this.AXIS.HORIZONTAL)a=Math.random()*this._shake.intensity,this.pos.x=this.pos.x+this.width+a<this.limits.x?this.pos.x+~~a:this.pos.x-~~a;if(this._shake.axis==this.AXIS.BOTH||this._shake.axis==this.AXIS.VERTICAL)a=Math.random()*this._shake.intensity,
this.pos.y=this.pos.y+this.height+a<this.limits.y?this.pos.y+~~a:this.pos.y-~~a;a=!0}if(null!=this._fadeIn.tween||null!=this._fadeOut.tween)a=!0;return a},shake:function(a,d,c,f){c=c||this.AXIS.BOTH;c==this.AXIS.BOTH&&(this.width==this.limits.x?c=this.AXIS.VERTICAL:this.height==this.limits.y&&(c=this.AXIS.HORIZONTAL));!(c==this.AXIS.HORIZONTAL&&this.width==this.limits.x)&&!(c==this.AXIS.VERTICAL&&this.height==this.limits.y)&&(this._shake.intensity=a,this._shake.duration=d,this._shake.axis=c,this._shake.onComplete=
f||null)},fadeOut:function(a,d,c){this._fadeOut.color=a;this._fadeOut.duration=d||1E3;this._fadeOut.alpha=1;this._fadeOut.tween=(new me.Tween(this._fadeOut)).to({alpha:0},this._fadeOut.duration).onComplete(c||null);this._fadeOut.tween.start()},fadeIn:function(a,d,c){this._fadeIn.color=a;this._fadeIn.duration=d||1E3;this._fadeIn.alpha=0;this._fadeIn.tween=(new me.Tween(this._fadeIn)).to({alpha:1},this._fadeIn.duration).onComplete(c||null);this._fadeIn.tween.start()},getWidth:function(){return this.width},
getHeight:function(){return this.height},focusOn:function(a){this.pos.x=a.x-0.5*this.width;this.pos.y=a.y-0.5*this.height},isVisible:function(a){return a.overlaps(this)},draw:function(a){this._fadeIn.tween&&(a.globalAlpha=this._fadeIn.alpha,me.video.clearSurface(a,me.utils.HexToRGB(this._fadeIn.color)),a.globalAlpha=1,1==this._fadeIn.alpha&&(this._fadeIn.tween=null));this._fadeOut.tween&&(a.globalAlpha=this._fadeOut.alpha,me.video.clearSurface(a,me.utils.HexToRGB(this._fadeOut.color)),a.globalAlpha=
1,0==this._fadeOut.alpha&&(this._fadeOut.tween=null))}})})(window);
(function(){me.Renderable=me.Rect.extend({isRenderable:!0,floating:!1,init:function(a,c,b){this.parent(a,c,b)},update:function(){return!1},draw:function(a,c){this.parent(a,c)}});me.SpriteObject=me.Renderable.extend({scale:null,scaleFlag:!1,lastflipX:!1,lastflipY:!1,z:0,offset:null,visible:!0,inViewport:!1,angle:0,anchorPoint:null,alpha:1,image:null,flickering:!1,flickerTimer:-1,flickercb:null,flickerState:!1,init:function(a,c,b,d,e){this.isSprite=!0;this.parent(new me.Vector2d(a,c),d||b.width,e||
b.height);this.image=b;this.scale=new me.Vector2d(1,1);this.scaleFlag=this.lastflipX=this.lastflipY=!1;this.offset=new me.Vector2d(0,0);this.anchorPoint=new me.Vector2d(0.5,0.5);this.alpha=1;this.visible=!0;this.flickering=!1},setTransparency:function(a){a="#"==a.charAt(0)?a.substring(1,7):a;this.image=me.video.applyRGBFilter(this.image,"transparent",a.toUpperCase()).canvas},isFlickering:function(){return this.flickering},flicker:function(a,c){this.flickerTimer=a;0>this.flickerTimer?(this.flickering=
!1,this.flickercb=null):this.flickering||(this.flickercb=c,this.flickering=!0)},flipX:function(a){a!=this.lastflipX&&(this.lastflipX=a,this.scale.x=-this.scale.x,this.scaleFlag=1!=this.scale.x||1!=this.scale.y)},flipY:function(a){a!=this.lastflipY&&(this.lastflipY=a,this.scale.y=-this.scale.y,this.scaleFlag=1!=this.scale.x||1!=this.scale.y)},resize:function(a){0<a&&(this.scale.x=0>this.scale.x?-a:a,this.scale.y=0>this.scale.y?-a:a,this.scaleFlag=1!=this.scale.x||1!=this.scale.y)},getOpacity:function(){return this.alpha},
setOpacity:function(a){a&&(this.alpha=a.clamp(0,1))},update:function(){return this.flickering?(this.flickerTimer-=me.timer.tick,0>this.flickerTimer&&(this.flickercb&&this.flickercb(),this.flicker(-1)),!0):!1},draw:function(a){if(this.flickering&&(this.flickerState=!this.flickerState,!this.flickerState))return;a.save();a.globalAlpha=this.alpha;var c=~~this.pos.x,b=~~this.pos.y;if(this.scaleFlag||0!==this.angle){var d=this.width*this.anchorPoint.x,e=this.height*this.anchorPoint.y;a.translate(c+d,b+
e);this.scaleFlag&&a.scale(this.scale.x,this.scale.y);0!==this.angle&&a.rotate(this.angle);c=-d;b=-e}a.drawImage(this.image,this.offset.x,this.offset.y,this.width,this.height,c,b,this.width,this.height);a.restore();me.debug.renderHitBox&&this.parent(a)},destroy:function(){this.onDestroyEvent.apply(this,arguments)},onDestroyEvent:function(){}});me.AnimationSheet=me.SpriteObject.extend({fpscount:0,spacing:0,margin:0,animationpause:!1,animationspeed:0,init:function(a,c,b,d,e,f,g){this.anim=[];this.current=
this.resetAnim=null;this.spacing=f||0;this.margin=g||0;this.parent(a,c,b,d,e,f,g);this.spritecount=new me.Vector2d(~~((this.image.width-this.margin)/(this.width+this.spacing)),~~((this.image.height-this.margin)/(this.height+this.spacing)));1==this.spritecount.x*this.spritecount.y&&(this.setAnimationFrame=function(){});this.animationspeed=me.sys.fps/10;this.addAnimation("default",null);this.setCurrentAnimation("default")},addAnimation:function(a,c,b){this.anim[a]={name:a,frame:[],idx:0,length:0,animationspeed:b||
this.animationspeed};if(null==c)for(var c=[],b=0,d=this.spritecount.x*this.spritecount.y;b<d;b++)c[b]=b;b=0;for(d=c.length;b<d;b++)this.anim[a].frame[b]=new me.Vector2d(this.margin+(this.spacing+this.width)*(c[b]%this.spritecount.x),this.margin+(this.spacing+this.height)*~~(c[b]/this.spritecount.x));this.anim[a].length=this.anim[a].frame.length},setCurrentAnimation:function(a,c){if(this.anim[a])this.current=this.anim[a],this.resetAnim=c||null,this.setAnimationFrame(this.current.idx);else throw"melonJS: animation id '"+
a+"' not defined";},isCurrentAnimation:function(a){return this.current.name==a},setAnimationFrame:function(a){this.current.idx=(a||0)%this.current.length;this.offset=this.current.frame[this.current.idx]},getCurrentAnimationFrame:function(){return this.current.idx},update:function(){return this.visible&&!this.animationpause&&this.fpscount++>this.current.animationspeed?(this.setAnimationFrame(++this.current.idx),this.fpscount=0,0==this.current.idx&&this.resetAnim&&("string"==typeof this.resetAnim?this.setCurrentAnimation(this.resetAnim):
"function"==typeof this.resetAnim&&this.resetAnim()),this.parent()||!0):this.parent()}})})(window);
(function(){me.ObjectSettings={name:null,image:null,transparent_color:null,spritewidth:null,spriteheight:null,type:0,collidable:!1};var a=me,c={},b={};c.init=function(){c.add("me.ObjectEntity",me.ObjectEntity);c.add("me.CollectableEntity",me.CollectableEntity);c.add("me.LevelEntity",me.LevelEntity)};c.add=function(a,c,f){f?b[a.toLowerCase()]={"class":c,pool:[],active:[]}:b[a.toLowerCase()]=c};c.newInstanceOf=function(a){var c="string"===typeof a?a.toLowerCase():void 0;if(c&&b[c]){if(!b[c].pool){var f=
b[c];arguments[0]=f;return new (f.bind.apply(f,arguments))}var g=b[c],f=g["class"];0<g.pool.length?(f=g.pool.pop(),f.init.apply(f,Array.prototype.slice.call(arguments,1))):(arguments[0]=f,f=new (f.bind.apply(f,arguments)),f.className=c);g.active.push(f);return f}if((g=arguments[3])&&g.image)return new me.SpriteObject(g.x,g.y,g.image);c&&console.error("Cannot instantiate entity of type '"+c+"': Class not found!");return null};c.purge=function(){for(className in b)b[className].pool=[]};c.freeInstance=
function(a){var c=a.className;if(c&&b[c]){for(var f=!0,g=0,h=b[c].active.length;g<h;g++)if(b[c].active[g]===a){f=!1;b[c].active.splice(g,1);break}f||b[c].pool.push(a)}};a.entityPool=c;me.ObjectEntity=me.Rect.extend({GUID:null,type:0,collidable:!1,collisionBox:null,renderable:null,z:0,visible:!0,inViewport:!1,floating:!1,init:function(a,c,b){this.parent(new me.Vector2d(a,c),~~b.spritewidth||~~b.width,~~b.spriteheight||~~b.height);b.image&&(a="string"==typeof b.image?me.loader.getImage(b.image):b.image,
this.renderable=new me.AnimationSheet(0,0,a,~~b.spritewidth,~~b.spriteheight,~~b.spacing,~~b.margin),b.transparent_color&&this.renderable.setTransparency(b.transparent_color));this.GUID=me.utils.createGUID();this.name=b.name?b.name.toLowerCase():"";this.vel=new me.Vector2d;this.accel=new me.Vector2d;this.friction=new me.Vector2d;this.maxVel=new me.Vector2d(1E3,1E3);this.gravity=void 0!=me.sys.gravity?me.sys.gravity:0.98;this.alive=this.isEntity=!0;this.falling=!1;this.jumping=!0;this.slopeY=0;this.onladder=
this.onslope=!1;this.collidable=b.collidable||!1;this.type=b.type||0;this.collisionMap=me.game.collisionMap;this.collisionBox=new me.Rect(this.pos,this.width,this.height);this.canBreakTile=!1;this.onTileBreak=null},updateColRect:function(a,c,b,g){this.collisionBox.adjustSize(a,c,b,g)},onCollision:function(){this.collidable&&this.type==me.game.COLLECTABLE_OBJECT&&me.game.remove(this)},setVelocity:function(a,c){this.accel.x=0!=a?a:this.accel.x;this.accel.y=0!=c?c:this.accel.y;this.setMaxVelocity(a,
c)},setMaxVelocity:function(a,c){this.maxVel.x=a;this.maxVel.y=c},setFriction:function(a,c){this.friction.x=a||0;this.friction.y=c||0},flipX:function(a){a!=this.lastflipX&&(this.renderable&&this.renderable.flipX(a),this.collisionBox.flipX(this.width))},flipY:function(a){a!=this.lastflipY&&(this.renderable&&this.renderable.flipY(a),this.collisionBox.flipY(this.height))},doWalk:function(a){this.flipX(a);this.vel.x+=a?-this.accel.x*me.timer.tick:this.accel.x*me.timer.tick},doClimb:function(a){return this.onladder?
(this.vel.y=a?-this.accel.x*me.timer.tick:this.accel.x*me.timer.tick,!0):!1},doJump:function(){return!this.jumping&&!this.falling?(this.vel.y=-this.maxVel.y*me.timer.tick,this.jumping=!0):!1},forceJump:function(){this.jumping=this.falling=!1;this.doJump()},distanceTo:function(a){var c=this.pos.x+this.hWidth-(a.pos.x+a.hWidth),a=this.pos.y+this.hHeight-(a.pos.y+a.hHeight);return Math.sqrt(c*c+a*a)},distanceToPoint:function(a){var c=this.pos.x+this.hWidth-a.x,a=this.pos.y+this.hHeight-a.y;return Math.sqrt(c*
c+a*a)},angleTo:function(a){return Math.atan2(a.pos.y+a.hHeight-(this.pos.y+this.hHeight),a.pos.x+a.hWidth-(this.pos.x+this.hWidth))},angleToPoint:function(a){return Math.atan2(a.y-(this.pos.y+this.hHeight),a.x-(this.pos.x+this.hWidth))},checkSlope:function(a,c){this.pos.y=a.pos.y-this.height;this.slopeY=c?a.height-(this.collisionBox.right+this.vel.x-a.pos.x):this.collisionBox.left+this.vel.x-a.pos.x;this.vel.y=0;this.pos.y+=this.slopeY.clamp(0,a.height)},computeVelocity:function(a){this.gravity&&
(a.y+=!this.onladder?this.gravity*me.timer.tick:0,this.jumping=(this.falling=0<a.y)?!1:this.jumping);this.friction.x&&(a.x=me.utils.applyFriction(a.x,this.friction.x));this.friction.y&&(a.y=me.utils.applyFriction(a.y,this.friction.y));0!=a.y&&(a.y=a.y.clamp(-this.maxVel.y,this.maxVel.y));0!=a.x&&(a.x=a.x.clamp(-this.maxVel.x,this.maxVel.x))},updateMovement:function(){this.computeVelocity(this.vel);var a=this.collisionMap.checkCollision(this.collisionBox,this.vel);this.onslope=a.yprop.isSlope||a.xprop.isSlope;
this.onladder=!1;if(a.y)if(this.onladder=a.yprop.isLadder,0<a.y)if(a.yprop.isSolid||a.yprop.isPlatform&&this.collisionBox.bottom-1<=a.ytile.pos.y)this.pos.y=~~this.pos.y,this.vel.y=this.falling?a.ytile.pos.y-this.collisionBox.bottom:0,this.falling=!1;else if(a.yprop.isSlope&&!this.jumping)this.checkSlope(a.ytile,a.yprop.isLeftSlope),this.falling=!1;else{if(a.yprop.isBreakable)if(this.canBreakTile){if(me.game.currentLevel.clearTile(a.ytile.col,a.ytile.row),this.onTileBreak)this.onTileBreak()}else this.pos.y=
~~this.pos.y,this.vel.y=this.falling?a.ytile.pos.y-this.collisionBox.bottom:0,this.falling=!1}else 0>a.y&&(!a.yprop.isPlatform&&!a.yprop.isLadder)&&(this.falling=!0,this.vel.y=0);if(a.x)if(this.onladder=a.xprop.isLadder,a.xprop.isSlope&&!this.jumping)this.checkSlope(a.xtile,a.xprop.isLeftSlope),this.falling=!1;else if(!a.xprop.isPlatform&&!a.xprop.isLadder)if(a.xprop.isBreakable&&this.canBreakTile){if(me.game.currentLevel.clearTile(a.xtile.col,a.xtile.row),this.onTileBreak)this.onTileBreak()}else this.vel.x=
0;this.pos.add(this.vel);return a},collide:function(a){return me.game.collide(this,a||!1)},collideType:function(a,c){return me.game.collideType(this,a,c||!1)},update:function(){return this.renderable?this.renderable.update():!1},getRect:function(){return this.renderable?this.renderable.getRect().translateV(this.pos):null},draw:function(a){this.renderable&&(a.translate(this.pos.x,this.pos.y),this.renderable.draw(a),a.translate(-this.pos.x,-this.pos.y));if(me.debug.renderHitBox){this.collisionBox.draw(a,
"red");var c=~~(this.pos.x+this.hWidth),b=~~(this.pos.y+this.hHeight);a.lineWidth=1;a.beginPath();a.moveTo(c,b);a.lineTo(c+~~(this.vel.x*this.hWidth),b+~~(this.vel.y*this.hHeight));a.stroke()}},destroy:function(){this.renderable&&(this.renderable.destroy.apply(this.renderable,arguments),this.renderable=null);this.onDestroyEvent.apply(this,arguments);this.collisionBox=this.pos=null},onDestroyEvent:function(){}});me.CollectableEntity=me.ObjectEntity.extend({init:function(a,c,b){this.parent(a,c,b);this.collidable=
!0;this.type=me.game.COLLECTABLE_OBJECT}});me.LevelEntity=me.ObjectEntity.extend({init:function(a,c,b){this.parent(a,c,b);this.nextlevel=b.to;this.fade=b.fade;this.duration=b.duration;this.fading=!1;this.collidable=!0;this.gotolevel=b.to},onFadeComplete:function(){me.levelDirector.loadLevel(this.gotolevel);me.game.viewport.fadeOut(this.fade,this.duration)},goTo:function(a){this.gotolevel=a||this.nextlevel;this.fade&&this.duration?this.fading||(this.fading=!0,me.game.viewport.fadeIn(this.fade,this.duration,
this.onFadeComplete.bind(this))):me.levelDirector.loadLevel(this.gotolevel)},onCollision:function(){this.goTo()}})})(window);
(function(){me.Font=Object.extend({ALIGN:{LEFT:"left",CENTER:"center",RIGHT:"right"},font:null,height:null,color:null,textAlign:null,init:function(a,c,b,d){this.set(a,c,b,d)},bold:function(){this.font="bold "+this.font},italic:function(){this.font="italic "+this.font},set:function(a,c,b,d){for(var a=a.split(","),e=0;e<a.length;e++)a[e]="'"+a[e]+"'";this.height=parseInt(c);"number"===typeof c&&(c=""+c+"px");this.font=c+" "+a.join(",");this.color=b;this.textAlign=d||"left"},getRect:function(){return new me.Rect(new Vector2d(0,
0),0,0)},measureText:function(a,c){a.font=this.font;a.fillStyle=this.color;a.textAlign=this.textAlign;var b=a.measureText(c);b.height=this.height;return b},draw:function(a,c,b,d){a.font=this.font;a.fillStyle=this.color;a.textAlign=this.textAlign;a.fillText(c,~~b,~~d)}});me.BitmapFont=me.Font.extend({size:null,sSize:null,firstChar:32,charCount:0,init:function(a,c,b,d){this.parent(a,null,null);this.size=new me.Vector2d;this.sSize=new me.Vector2d;this.firstChar=d||32;this.loadFontMetrics(a,c);this.textAlign=
this.ALIGN.LEFT;b&&this.resize(b)},loadFontMetrics:function(a,c){this.font=me.loader.getImage(a);this.size.x=c.x||c;this.size.y=c.y||this.font.height;this.sSize.copy(this.size);this.charCount=~~(this.font.width/this.size.x)},set:function(a,c){this.textAlign=a;c&&this.resize(c)},resize:function(a){this.sSize.copy(this.size);this.sSize.x*=a;this.sSize.y*=a},measureText:function(a){return{width:a.length*this.sSize.x,height:this.sSize.y}},draw:function(a,c,b,d){c=new String(c);switch(this.textAlign){case this.ALIGN.RIGHT:b-=
this.measureText(c).width;break;case this.ALIGN.CENTER:b-=0.5*this.measureText(c).width}for(var e=0,f=c.length;e<f;e++){var g=c.charCodeAt(e)-this.firstChar;a.drawImage(this.font,this.size.x*(g%this.charCount),this.size.y*~~(g/this.charCount),this.size.x,this.size.y,~~b,~~d,this.sSize.x,this.sSize.y);b+=this.sSize.x}}})})(window);
(function(){me.GUI_Object=me.SpriteObject.extend({isClickable:!0,updated:!1,init:function(a,c,b){this.parent(a,c,"string"==typeof b.image?me.loader.getImage(b.image):b.image,b.spritewidth,b.spriteheight);this.floating=!0;me.input.registerMouseEvent("mousedown",this,this.clicked.bind(this))},update:function(){return this.updated?(this.updated=!1,!0):!1},clicked:function(){if(this.isClickable)return this.updated=!0,this.onClick()},onClick:function(){return!0},onDestroyEvent:function(){me.input.releaseMouseEvent("mousedown",
this)}})})(window);
(function(){me.HUD_Item=Object.extend({init:function(a,c,b){this.pos=new me.Vector2d(a||0,c||0);this.visible=!0;this.defaultvalue=b||0;this.value=b||0;this.updated=!0},reset:function(){this.set(this.defaultvalue)},set:function(a){this.value=a;return this.updated=!0},update:function(a){return this.set(this.value+a)},draw:function(){}});me.HUD_Object=me.Rect.extend({init:function(a,c,b,d,e){this.parent(new me.Vector2d(a||0,c||0),b||me.video.getWidth(),d||me.video.getHeight());this.bgcolor=e;this.HUDItems=
{};this.HUDobj=[];this.objCount=0;this.HUD_invalidated=this.floating=this.visible=!0;this.HUDCanvas=me.video.createCanvas(this.width,this.height);this.HUDCanvasSurface=this.HUDCanvas.getContext("2d");this.z=999;this.isPersistent=!0},addItem:function(a,c){this.HUDItems[a]=c;this.HUDobj.push(this.HUDItems[a]);this.objCount++;this.HUD_invalidated=!0},removeItem:function(a){this.HUDItems[a]&&(this.HUDobj.splice(this.HUDobj.indexOf(this.HUDItems[a]),1),this.HUDItems[a]=null,this.objCount--,this.HUD_invalidated=
!0)},setItemValue:function(a,c){this.HUDItems[a]&&!0==this.HUDItems[a].set(c)&&(this.HUD_invalidated=!0)},updateItemValue:function(a,c){this.HUDItems[a]&&!0==this.HUDItems[a].update(c)&&(this.HUD_invalidated=!0)},getItemValue:function(a){return this.HUDItems[a]?this.HUDItems[a].value:0},update:function(){return this.HUD_invalidated},reset:function(a){void 0!=a?(this.HUDItems[a]&&this.HUDItems[a].reset(),this.HUD_invalidated=!0):this.resetAll()},resetAll:function(){for(var a=this.objCount,c;a--,c=
this.HUDobj[a];)c.reset();this.HUD_invalidated=!0},getRect:function(){p=this.pos.clone();p.add(me.game.viewport.pos);return new me.Rect(p,this.width,this.height)},draw:function(a){if(this.HUD_invalidated){this.bgcolor?me.video.clearSurface(this.HUDCanvasSurface,this.bgcolor):this.HUDCanvas.width=this.HUDCanvas.width;for(var c=this.objCount,b;c--,b=this.HUDobj[c];)b.visible&&(b.draw(this.HUDCanvasSurface,0,0),b.updated&&(b.updated=!1))}a.drawImage(this.HUDCanvas,this.pos.x,this.pos.y);this.HUD_invalidated=
!1}})})(window);
(function(){var a=me,c=function(a,d){if(3<u++){var c="melonJS: failed loading "+a+"."+h;if(!1===me.sys.stopOnAudioError)me.audio.disable(),d&&d(),console.log(c+", disabling audio");else throw c;}else g[a][0].load()},b=function(a,d,c){u=0;if(1<d)for(var b=g[a][0],e=1;e<d;e++)g[a][e]=new Audio(b.src),g[a][e].preload="auto",g[a][e].load();c&&c()},d=function(a,d,c,b){var e;a:{for(var a=a.toLowerCase(),a=g[a],f=0,h;h=a[f++];)if(h.ended||!h.currentTime){h.currentTime=n;e=h;break a}a[0].pause();a[0].currentTime=
n;e=a[0]}e.loop=d||!1;e.volume=b?parseFloat(b).clamp(0,1):m.volume;e.muted=m.muted;e.play();c&&!d&&e.addEventListener("ended",function(a){e.removeEventListener("ended",arguments.callee,!1);c()},!1);return e},e=function(a,d,c){c&&!d&&setTimeout(c,2E3);return null},f={},g={},h=-1,i=null,j=null,k=!0,n=0,u=0,m={volume:1,muted:!1};f.capabilities={mp3:{codec:"audio/mpeg",canPlay:!1,canPlayType:"no"},ogg:{codec:'audio/ogg; codecs="vorbis"',canPlay:!1,canPlayType:"no"},m4a:{codec:'audio/mp4; codecs="mp4a.40.2"',
canPlay:!1,canPlayType:"no"},wav:{codec:'audio/wav; codecs="1"',canPlay:!1,canPlayType:"no"}};f.detectCapabilities=function(){var a=document.createElement("audio");if(a.canPlayType)for(var d in f.capabilities){var c=a.canPlayType(f.capabilities[d].codec);""!==c&&"no"!==c&&(f.capabilities[d].canPlay=!0,f.capabilities[d].canPlayType=c);me.sys.sound|=f.capabilities[d].canPlay}if((-1<me.sys.ua.search("iphone")||-1<me.sys.ua.search("ipod")||-1<me.sys.ua.search("ipad")||-1<me.sys.ua.search("android"))&&
!navigator.isCocoonJS)me.sys.sound=!1};f.init=function(a){if(!me.initialized)throw"melonJS: me.audio.init() called before engine initialization.";var a=new String(a?a:"mp3"),a=a.split(","),c="",b=a.length;if(me.sys.sound)for(var g="",i=0;i<b;i++)if(g=a[i].toLowerCase().trim(),f.capabilities[g]&&f.capabilities[g].canPlay&&(""===c||"probably"===f.capabilities[g].canPlayType))if(c=g,"probably"===f.capabilities[g].canPlayType)break;""===c&&(k=!1);h=c;f.play=f.isAudioEnable()?d:e;return f.isAudioEnable()};
f.isAudioEnable=function(){return k};f.enable=function(){k=me.sys.sound;f.play=k?d:e};f.disable=function(){me.audio.stopTrack();f.play=e;k=!1};f.load=function(a,d,e){if(-1==h)return 0;var f=new Audio(a.src+a.name+"."+h+me.nocache);f.preload="auto";var i=a.channel||1,j="canplaythrough";!0===a.stream&&(i=1,j="canplay");f.addEventListener(j,function(c){this.removeEventListener(j,arguments.callee,!1);b.call(me.audio,a.name,i,d)},!1);f.addEventListener("error",function(){c.call(me.audio,a.name,e)},!1);
f.load();g[a.name]=[f];return 1};f.stop=function(a){if(k)for(var a=g[a.toLowerCase()],d=a.length;d--;)a[d].pause(),a[d].currentTime=n};f.pause=function(a){if(k)for(var a=g[a.toLowerCase()],d=a.length;d--;)a[d].pause()};f.playTrack=function(a,d){j=me.audio.play(a,!0,null,d);i=a.toLowerCase()};f.stopTrack=function(){k&&j&&(j.pause(),j=i=null)};f.setVolume=function(a){a&&(m.volume=parseFloat(a).clamp(0,1))};f.getVolume=function(){return m.volume};f.mute=function(a,d){for(var d=void 0===d?!0:!!d,c=g[a.toLowerCase()],
b=0,e;e=c[b++];)e.muted=d};f.unmute=function(a){f.mute(a,!1)};f.muteAll=function(){m.muted=!0;for(var a in g)f.mute(a,m.muted)};f.unmuteAll=function(){m.muted=!1;for(var a in g)f.mute(a,m.muted)};f.getCurrentTrack=function(){return i};f.pauseTrack=function(){k&&j&&j.pause()};f.resumeTrack=function(){k&&j&&j.play()};f.unload=function(a){a=a.toLowerCase();if(!(a in g))return!1;i===a?f.stopTrack():f.stop(a);delete g[a];return!0};f.unloadAll=function(){for(var a in g)f.unload(a)};a.audio=f})(window);
(function(){var a=me,c={},b=null,d=0,e=0,f=0,g=0,h=0,i=Math.ceil(1E3/me.sys.fps),j=1.25*(1E3/me.sys.fps);c.tick=1;c.fps=0;c.init=function(){b=document.getElementById("framecounter");null!==b&&(me.debug.displayFPS=!0);c.reset()};c.reset=function(){g=f=Date.now();d=e=0};c.getTime=function(){return g};c.update=function(){f=g;g=Date.now();h=g-f;d++;e+=h;0==d%10&&(this.fps=(~~(1E3*d/e)).clamp(0,me.sys.fps),d=e=0);c.tick=h>j&&me.sys.interpolation?h/i:1};a.timer=c;var a=me,k={},n=null,u=null,m=null,r=null,
v=null,l=-1,w=!1,s=0,D=0,t=!1,z=!0;k.init=function(a,d,c,b,e,f){if(!me.initialized)throw"melonJS: me.video.init() called before engine initialization.";w=b||!1;t="auto"===e||!1;z=void 0!==f?f:!0;e="auto"!==e?parseFloat(e||1):1;me.sys.scale=new me.Vector2d(e,e);if(t||1!==e)w=!0;s=d*me.sys.scale.x;D=c*me.sys.scale.y;window.addEventListener("resize",function(a){me.event.publish(me.event.WINDOW_ONRESIZE,[a])},!1);window.addEventListener("orientationchange",function(a){me.event.publish(me.event.WINDOW_ONRESIZE,
[a])},!1);me.event.subscribe(me.event.WINDOW_ONRESIZE,me.video.onresize.bind(me.video));n=k.createCanvas(s,D);a&&(v=document.getElementById(a));v||(v=document.body);v.appendChild(n);if(!n.getContext)return!1;u=n.getContext("2d");w?(m=k.createCanvas(d,c),r=m.getContext("2d")):(m=n,r=u);if(t)me.video.onresize(null);return!0};k.getWrapper=function(){return v};k.getWidth=function(){return m.width};k.getPos=function(a){for(var a=a||n,d=new me.Vector2d(a.offsetLeft,a.offsetTop);a=a.offsetParent;)d.x+=a.offsetLeft,
d.y+=a.offsetTop;return d};k.getHeight=function(){return m.height};k.createCanvas=function(a,d){var c=document.createElement("canvas");c.width=a||m.width;c.height=d||m.height;return c};k.createCanvasSurface=function(a,d){return k.createCanvas(a,d).getContext("2d")};k.getScreenCanvas=function(){return n};k.getScreenContext=function(){return u};k.getSystemCanvas=function(){return m};k.getSystemContext=function(){return r};k.getScreenFrameBuffer=function(){return k.getSystemContext()};k.onresize=function(){if(t){var a=
me.video.getScreenCanvas().parentNode,d=a.width||window.innerWidth,a=a.height||window.innerHeight;l&&clearTimeout(l);if(z){var c=me.video.getWidth()/me.video.getHeight(),d=d/a<c?d/me.video.getWidth():a/me.video.getHeight();l=me.video.updateDisplaySize.defer(d,d)}else l=me.video.updateDisplaySize.defer(d/me.video.getWidth(),a/me.video.getHeight())}else me.input.mouse.offset=me.video.getPos()};k.updateDisplaySize=function(a,d){me.sys.scale.set(a,d);n.width=s=m.width*a;n.height=D=m.height*d;me.input.mouse.offset=
me.video.getPos();k.blitSurface();l=-1};k.clearSurface=function(a,d){a.save();a.setTransform(1,0,0,1,0,0);a.fillStyle=d;a.fillRect(0,0,k.getWidth(),k.getHeight());a.restore()};k.scale=function(a,d){a.translate(-(a.canvas.width*d-a.canvas.width>>1),-(a.canvas.height*d-a.canvas.height>>1));a.scale(d,d)};k.setImageSmoothing=function(a){for(var d=["ms","moz","webkit","o"],c=0;c<d.length;++c)void 0!==u[d[c]+"ImageSmoothingEnabled"]&&(u[d[c]+"ImageSmoothingEnabled"]=a);u.imageSmoothingEnabled=a};k.setAlpha=
function(a,d){a.globalCompositeOperation=d?"source-over":"copy"};k.blitSurface=function(){k.blitSurface=w?function(){u.drawImage(m,0,0,m.width,m.height,0,0,s,D)}:function(){};k.blitSurface()};k.applyRGBFilter=function(a,d,c){var b=k.createCanvasSurface(a.width,a.height),a=me.utils.getPixels(a),e=a.data;switch(d){case "b&w":for(var d=0,f=e.length;d<f;d+=4)c=3*e[d]+4*e[d+1]+e[d+2]>>>3,e[d]=c,e[d+1]=c,e[d+2]=c;break;case "brightness":c=Math.abs(c).clamp(0,1);d=0;for(f=e.length;d<f;d+=4)e[d]*=c,e[d+1]*=
c,e[d+2]*=c;break;case "transparent":d=0;for(f=e.length;d<f;d+=4)me.utils.RGBToHex(e[d],e[d+1],e[d+2])===c&&(e[d+3]=0);break;default:return null}b.putImageData(a,0,0);return b};a.video=k})(window);
(function(a){var c=me,b=function(){if(!D){m.touches.push({x:0,y:0});m.mouse.pos=new me.Vector2d(0,0);m.mouse.offset=me.video.getPos();if(me.sys.touch){me.video.getScreenCanvas().addEventListener("touchmove",j,!1);for(var d=2;d<E.length;++d)me.video.getScreenCanvas().addEventListener(E[d],n,!1)}else{me.video.getScreenCanvas().addEventListener("mousemove",j,!1);a.addEventListener("mousewheel",i,!1);for(d=2;d<z.length;++d)me.video.getScreenCanvas().addEventListener(z[d],k,!1)}D=!0}},d=function(a){a.stopPropagation?
a.stopPropagation():a.cancelBubble=!0;a.preventDefault?a.preventDefault():a.returnValue=!1;return!1},e=function(a,c){var b=r[c||a.keyCode||a.which];return b?(w[b]||(v[b]=!0,w[b]=l[b],me.event.publish(me.event.KEYDOWN,[b])),d(a)):!0},f=function(a,c){var b=r[c||a.keyCode||a.which];return b?(v[b]=!1,w[b]=!1,me.event.publish(me.event.KEYUP,[b]),d(a)):!0},g=function(a){var d=!1,c=m.mouse.handlers[a.type];if(c)for(var b=me.game.viewport.pos,e=me.game.currentLevel.pos,f=0,g=m.touches.length;f<g;f++)for(var h=
m.touches[f].x,i=m.touches[f].y,j=c.length,A;j--,A=c[j];){var M=!1===A.floating?{x:h+b.x-e.x,y:i+b.y-e.y}:{x:h,y:i};if((null===A.rect||A.rect.containsPoint(M))&&!1===A.cb(a)){d=!0;break}}return d},h=function(a){m.touches.length=0;if(a.touches)for(var d=m.mouse.offset,c=0,b=a.changedTouches.length;c<b;c++){var e=a.changedTouches[c],f=e.clientX-d.x,g=e.clientY-d.y,h=me.sys.scale;if(1!=h.x||1!=h.y)f/=h.x,g/=h.y;m.touches.push({x:f,y:g,id:e.identifier})}else{var d=m.mouse.offset,f=a.pageX-d.x,g=a.pageY-
d.y,h=me.sys.scale;if(1!=h.x||1!=h.y)f/=h.x,g/=h.y;m.touches.push({x:f,y:g,id:0})}m.mouse.pos.set(m.touches[0].x,m.touches[0].y)},i=function(a){return a.target==me.video.getScreenCanvas()&&g(a)?d(a):!0},j=function(a){h(a);return g(a)?d(a):!0},k=function(a){if(g(a))return d(a);var c=m.mouse.bind[a.button||0];return c?"mousedown"===a.type||"touchstart"===a.type?e(a,c):f(a,c):!0},n=function(a){h(a);return k(a)},u=function(a){m.accel=a.accelerationIncludingGravity},m={},r={},v={},l={},w={},s=!1,D=!1,
t=!1,z="mousewheel mousemove mousedown mouseup click dblclick".split(" "),E=[void 0,"touchmove","touchstart","touchend","tap","dbltap"];m.accel={x:0,y:0,z:0};m.mouse={pos:null,offset:null,LEFT:0,MIDDLE:1,RIGHT:2,bind:[0,0,0],handlers:{}};m.touches=[];m.KEY={LEFT:37,UP:38,RIGHT:39,DOWN:40,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,ESC:27,SPACE:32,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,
P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90};m.isKeyPressed=function(a){return v[a]?(l[a]&&(w[a]=!0,v[a]=!1),!0):!1};m.keyStatus=function(a){return!0===w[a]?!0:v[a]};m.triggerKeyEvent=function(a,d){d?e({},a):f({},a)};m.bindKey=function(d,c,b){s||(a.addEventListener("keydown",e,!1),a.addEventListener("keyup",f,!1),s=!0);r[d]=c;v[c]=!1;l[c]=b?b:!1;w[c]=!1};m.unbindKey=function(a){v[r[a]]=!1;l[r[a]]=!1;r[a]=null};m.bindMouse=function(a,d){b();if(!r[d])throw"melonJS : no action defined for keycode "+
d;m.mouse.bind[a]=d};m.unbindMouse=function(a){m.mouse.bind[a]=null};m.bindTouch=function(a){m.bindMouse(me.input.mouse.LEFT,a)};m.unbindTouch=function(){m.unbindMouse(me.input.mouse.LEFT)};m.registerMouseEvent=function(a,d,c,e){b();me.sys.touch&&-1!==z.indexOf(a)&&(a=E[z.indexOf(a)]);if(a&&(-1!==z.indexOf(a)||-1!==E.indexOf(a))){m.mouse.handlers[a]||(m.mouse.handlers[a]=[]);var f=!0===d.floating?!0:!1;e&&(f=!0===e?!0:!1);m.mouse.handlers[a].push({rect:d||null,cb:c,floating:f})}else throw"melonJS : invalid event type : "+
a;};m.releaseMouseEvent=function(a,d){me.sys.touch&&-1!==z.indexOf(a)&&(a=E[z.indexOf(a)]);if(a&&(-1!==z.indexOf(a)||-1!==E.indexOf(a))){m.mouse.handlers[a]||(m.mouse.handlers[a]=[]);var c=m.mouse.handlers[a];if(c)for(var b=c.length,e;b--,e=c[b];)e.rect===d&&(e.rect=e.cb=e.floating=null,m.mouse.handlers[a].splice(b,1))}else throw"melonJS : invalid event type : "+a;};m.watchAccelerometer=function(){return a.sys.gyro?(t||(a.addEventListener("devicemotion",u,!1),t=!0),!0):!1};m.unwatchAccelerometer=
function(){t&&(a.removeEventListener("devicemotion",u,!1),t=!1)};c.input=m})(window);
(function(a){var c={decode:function(d){d=d.replace(/[^A-Za-z0-9\+\/\=]/g,"");if(me.sys.nativeBase64)return a.atob(d);for(var c=[],b,e,f,g,h,i=0;i<d.length;)b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(d.charAt(i++)),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(d.charAt(i++)),g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(d.charAt(i++)),h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(d.charAt(i++)),
b=b<<2|e>>4,e=(e&15)<<4|g>>2,f=(g&3)<<6|h,c.push(String.fromCharCode(b)),64!=g&&c.push(String.fromCharCode(e)),64!=h&&c.push(String.fromCharCode(f));return c=c.join("")}},b=me,d={},e={},f="",g=0,h=/^.*(\\|\/|\:)/,i=/\.[^\.]*$/;d.decodeBase64=function(a){return c.decode(a)};d.decodeBase64AsArray=function(a,d){var d=d||1,b=c.decode(a),e,f,g,h="function"===typeof window.Uint32Array?new Uint32Array(b.length/d):[];e=0;for(g=b.length/d;e<g;e++){h[e]=0;for(f=d-1;0<=f;--f)h[e]+=b.charCodeAt(e*d+f)<<(f<<3)}return h};
d.decodeCSV=function(a,d){for(var a=a.trim().split("\n"),c=[],b=0;b<a.length;b++){entries=a[b].split(",",d);for(var e=0;e<entries.length;e++)c.push(+entries[e])}return c};d.getBasename=function(a){return a.replace(h,"").replace(i,"")};d.getFileExtension=function(a){return a.substring(a.lastIndexOf(".")+1,a.length)};d.setNocache=function(a){me.nocache=a?"?"+parseInt(1E7*Math.random()):""};d.HexToRGB=function(a,d){if("#"!==a.charAt(0))return a;a=a.substring(1,a.length);if(null==e[a]){if(6>a.length)var c=
a.charAt(0)+a.charAt(0),b=a.charAt(1)+a.charAt(1),f=a.charAt(2)+a.charAt(2);else c=a.substring(0,2),b=a.substring(2,4),f=a.substring(4,6);e[a]=parseInt(c,16)+","+parseInt(b,16)+","+parseInt(f,16)}return(d?"rgba(":"rgb(")+e[a]+(d?","+d+")":")")};d.RGBToHex=function(a,d,c){return a.toHex()+d.toHex()+c.toHex()};d.getPixels=function(a){if(a instanceof HTMLImageElement){var d=me.video.createCanvasSurface(a.width,a.height);d.drawImage(a,0,0);return d.getImageData(0,0,a.width,a.height)}return a.getContext("2d").getImageData(0,
0,a.width,a.height)};d.resetGUID=function(a){f=a.toString().toUpperCase().toHex();g=0};d.createGUID=function(){return f+"-"+g++};d.applyFriction=function(a,d){return 0>a+d?a+d*me.timer.tick:0<a-d?a-d*me.timer.tick:0};b.utils=d})(window);
(function(){function a(a){this.defaultvalue=a||0;this.value=a||0;this.updated=!0}a.prototype.reset=function(){this.set(this.defaultvalue)};a.prototype.update=function(a){return this.set(this.value+a)};a.prototype.set=function(a){this.value=a;return this.updated=!0};var c=me,b={},d={},e=[],f=0;b.add=function(c,b){if(c.constructor===Object)for(var i in c){var j=i;d[j]=new a(c[i]);e.push(d[j]);f++}else d[c]=new a(b),e.push(d[c]),f++};b.updateValue=function(a,c){if(a.constructor===Object)for(var b in a)d[b]&&
d[b].update(a[b]);else d[a]&&d[a].update(c)};b.setValue=function(a,c){if(a.constructor===Object)for(var b in a)d[b]&&d[b].set(a[b]);else d[a]&&d[a].set(c)};b.getItemValue=function(a){return d[a]?d[a].value:0};b.reset=function(a){void 0!=a?d[a]&&d[a].reset():b.resetAll()};b.resetAll=function(){for(var a=f,d;a--,d=e[a];)d.reset()};c.gamestat=b})(window);
(function(){me.LevelConstants={COLLISION_MAP:"collision",PARALLAX_MAP:"parallax"};me.TMX_TAG_MAP="map";me.TMX_TAG_NAME="name";me.TMX_TAG_VALUE="value";me.TMX_TAG_VERSION="version";me.TMX_TAG_ORIENTATION="orientation";me.TMX_TAG_WIDTH="width";me.TMX_TAG_HEIGHT="height";me.TMX_TAG_OPACITY="opacity";me.TMX_TAG_TRANS="trans";me.TMX_TAG_TILEWIDTH="tilewidth";me.TMX_TAG_TILEHEIGHT="tileheight";me.TMX_TAG_TILEOFFSET="tileoffset";me.TMX_TAG_FIRSTGID="firstgid";me.TMX_TAG_GID="gid";me.TMX_TAG_TILE="tile";
me.TMX_TAG_ID="id";me.TMX_TAG_DATA="data";me.TMX_TAG_COMPRESSION="compression";me.TMX_TAG_ENCODING="encoding";me.TMX_TAG_ATTR_BASE64="base64";me.TMX_TAG_CSV="csv";me.TMX_TAG_SPACING="spacing";me.TMX_TAG_MARGIN="margin";me.TMX_TAG_PROPERTIES="properties";me.TMX_TAG_PROPERTY="property";me.TMX_TAG_IMAGE="image";me.TMX_TAG_SOURCE="source";me.TMX_TAG_VISIBLE="visible";me.TMX_TAG_TILESET="tileset";me.TMX_TAG_LAYER="layer";me.TMX_TAG_TILE_LAYER="tilelayer";me.TMX_TAG_IMAGE_LAYER="imagelayer";me.TMX_TAG_OBJECTGROUP=
"objectgroup";me.TMX_TAG_OBJECT="object";me.TMX_TAG_X="x";me.TMX_TAG_Y="y";me.TMX_TAG_WIDTH="width";me.TMX_TAG_HEIGHT="height";me.TMX_TAG_POLYGON="polygon";me.TMX_TAG_POLYLINE="polyline";me.TMX_TAG_POINTS="points";me.TMX_BACKGROUND_COLOR="backgroundcolor"})(window);
(function(){me.TMXUtils={applyTMXPropertiesFromXML:function(a,c){var b=c.getElementsByTagName(me.TMX_TAG_PROPERTIES)[0];if(b)for(var b=b.getElementsByTagName(me.TMX_TAG_PROPERTY),d=0;d<b.length;d++){var e=me.mapReader.TMXParser.getStringAttribute(b[d],me.TMX_TAG_NAME),f=me.mapReader.TMXParser.getStringAttribute(b[d],me.TMX_TAG_VALUE);!f||f.isBoolean()?f=f?"true"==f:!0:f.isNumeric()&&(f=Number(f));a[e]=f}},applyTMXPropertiesFromJSON:function(a,c){var b=c[me.TMX_TAG_PROPERTIES];if(b)for(var d in b){var e=
b[d];!e||e.isBoolean()?e=e?"true"==e:!0:e.isNumeric()&&(e=Number(e));a[d]=e}},mergeProperties:function(a,c,b){for(var d in c)if(b||void 0===a[d])a[d]=c[d];return a}}})(window);
(function(){me.TMXOBjectGroup=Object.extend({initFromXML:function(a,c,b,d){this.name=a;this.width=me.mapReader.TMXParser.getIntAttribute(c,me.TMX_TAG_WIDTH);this.height=me.mapReader.TMXParser.getIntAttribute(c,me.TMX_TAG_HEIGHT);this.visible=1==me.mapReader.TMXParser.getIntAttribute(c,me.TMX_TAG_VISIBLE,1);this.z=d;this.objects=[];c.firstChild&&c.firstChild.nextSibling.nodeName===me.TMX_TAG_PROPERTIES&&me.TMXUtils.applyTMXPropertiesFromXML(this,c);a=c.getElementsByTagName(me.TMX_TAG_OBJECT);for(c=
0;c<a.length;c++){var e=new me.TMXOBject;e.initFromXML(a[c],b,d);this.objects.push(e)}},initFromJSON:function(a,c,b,d){var e=this;this.name=a;this.width=c[me.TMX_TAG_WIDTH];this.height=c[me.TMX_TAG_HEIGHT];this.visible=c[me.TMX_TAG_VISIBLE];this.z=d;this.objects=[];me.TMXUtils.applyTMXPropertiesFromJSON(this,c);c.objects.forEach(function(a){var c=new me.TMXOBject;c.initFromJSON(a,b,d);e.objects.push(c)})},reset:function(){this.objects=null},getObjectCount:function(){return this.objects.length},getObjectByIndex:function(a){return this.objects[a]}});
me.TMXOBject=Object.extend({initFromXML:function(a,c,b){this.name=me.mapReader.TMXParser.getStringAttribute(a,me.TMX_TAG_NAME);this.x=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_X);this.y=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_Y);this.z=b;this.width=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_WIDTH,0);this.height=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_HEIGHT,0);if(this.gid=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_GID,null))this.setImage(this.gid,
c);else if(c=a.getElementsByTagName(me.TMX_TAG_POLYGON),this.isPolygon=!0,c.length||(c=a.getElementsByTagName(me.TMX_TAG_POLYLINE),this.isPolygon=!1),c.length){this.points=[];for(var c=me.mapReader.TMXParser.getStringAttribute(c[0],me.TMX_TAG_POINTS).split(" "),b=0,d;b<c.length;b++)d=c[b].split(","),this.points[b]=new me.Vector2d(+d[0],+d[1])}me.TMXUtils.applyTMXPropertiesFromXML(this,a)},initFromJSON:function(a,c,b){this.name=a[me.TMX_TAG_NAME];this.x=parseInt(a[me.TMX_TAG_X]);this.y=parseInt(a[me.TMX_TAG_Y]);
this.z=parseInt(b);this.width=parseInt(a[me.TMX_TAG_WIDTH]||0);this.height=parseInt(a[me.TMX_TAG_HEIGHT]||0);if(this.gid=parseInt(a[me.TMX_TAG_GID])||null)this.setImage(this.gid,c);else if(c=a[me.TMX_TAG_POLYGON],this.isPolygon=void 0!==c,c||(c=a[me.TMX_TAG_POLYLINE],this.isPolygon=!1),c){this.points=[];var d=this,e=0;c.forEach(function(a){d.points[e++]=new me.Vector2d(parseInt(a.x),parseInt(a.y))})}me.TMXUtils.applyTMXPropertiesFromJSON(this,a)},setImage:function(a,c){var b=c.getTilesetByGid(this.gid);
this.width=b.tilewidth;this.height=b.tileheight;this.spritewidth=this.width;this.y-=this.height;var d=new me.Tile(this.x,this.y,b.tilewidth,b.tileheight,this.gid);this.image=b.getTileImage(d)},getObjectPropertyByName:function(a){return this[a]}})})(window);
(function(){me.Tile=me.Rect.extend({tileId:null,init:function(a,c,b,d,e){this.parent(new me.Vector2d(a*b,c*d),b,d);this.col=a;this.row=c;this.tileId=e;this.flipX=0!==(this.tileId&2147483648);this.flipY=0!==(this.tileId&1073741824);this.flipAD=0!==(this.tileId&536870912);this.flipped=this.flipX||this.flipY||this.flipAD;this.tileId&=536870911}});me.TMXTileset=Object.extend({type:{SOLID:"solid",PLATFORM:"platform",L_SLOPE:"lslope",R_SLOPE:"rslope",LADDER:"ladder",BREAKABLE:"breakable"},initFromXML:function(a){this.TileProperties=
[];this.tileXOffset=[];this.tileYOffset=[];this.firstgid=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_FIRSTGID);var c=me.mapReader.TMXParser.getStringAttribute(a,me.TMX_TAG_SOURCE);if(c){c=me.utils.getBasename(c);a=me.loader.getTMX(c);if(!a)throw"melonJS:"+c+" TSX tileset not found";me.mapReader.TMXParser.parseFromString(a);a=me.mapReader.TMXParser.getFirstElementByTagName("tileset")}this.name=me.mapReader.TMXParser.getStringAttribute(a,me.TMX_TAG_NAME);this.tilewidth=me.mapReader.TMXParser.getIntAttribute(a,
me.TMX_TAG_TILEWIDTH);this.tileheight=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_TILEHEIGHT);this.spacing=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_SPACING,0);this.margin=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_MARGIN,0);this.tileoffset=new me.Vector2d(0,0);c=a.getElementsByTagName(me.TMX_TAG_TILEOFFSET);0<c.length&&(this.tileoffset.x=me.mapReader.TMXParser.getIntAttribute(c[0],me.TMX_TAG_X),this.tileoffset.y=me.mapReader.TMXParser.getIntAttribute(c[0],me.TMX_TAG_Y));
for(var c=a.getElementsByTagName(me.TMX_TAG_TILE),b=0;b<c.length;b++){var d=me.mapReader.TMXParser.getIntAttribute(c[b],me.TMX_TAG_ID)+this.firstgid,e={};me.TMXUtils.applyTMXPropertiesFromXML(e,c[b]);this.setTileProperty(d,e)}(c=(b=a.getElementsByTagName(me.TMX_TAG_IMAGE)[0].getAttribute(me.TMX_TAG_SOURCE))?me.loader.getImage(me.utils.getBasename(b)):null)||console.log("melonJS: '"+b+"' file for tileset '"+this.name+"' not found!");a=a.getElementsByTagName(me.TMX_TAG_IMAGE)[0].getAttribute(me.TMX_TAG_TRANS);
this.initFromImage(c,a)},initFromJSON:function(a){this.TileProperties=[];this.tileXOffset=[];this.tileYOffset=[];this.firstgid=a[me.TMX_TAG_FIRSTGID];var c=a[me.TMX_TAG_SOURCE];if(c&&(c=me.utils.getBasename(c),a=me.loader.getTMX(c),!a))throw"melonJS:"+c+" TSX tileset not found";this.name=a[me.TMX_TAG_NAME];this.tilewidth=parseInt(a[me.TMX_TAG_TILEWIDTH]);this.tileheight=parseInt(a[me.TMX_TAG_TILEHEIGHT]);this.spacing=parseInt(a[me.TMX_TAG_SPACING]||0);this.margin=parseInt(a[me.TMX_TAG_MARGIN]||0);
this.tileoffset=new me.Vector2d(0,0);if(c=a[me.TMX_TAG_TILEOFFSET])this.tileoffset.x=parseInt(c[me.TMX_TAG_X]),this.tileoffset.y=parseInt(c[me.TMX_TAG_Y]);var c=a.tileproperties,b;for(b in c){var d={};me.TMXUtils.mergeProperties(d,c[b]);this.setTileProperty(parseInt(b)+this.firstgid,d)}(c=(b=me.utils.getBasename(a[me.TMX_TAG_IMAGE]))?me.loader.getImage(b):null)||console.log("melonJS: '"+b+"' file for tileset '"+this.name+"' not found!");this.initFromImage(c,a[me.TMX_TAG_TRANS]||null)},initFromImage:function(a,
c){a&&(this.image=a,this.hTileCount=~~((this.image.width-this.margin)/(this.tilewidth+this.spacing)),this.vTileCount=~~((this.image.height-this.margin)/(this.tileheight+this.spacing)));this.lastgid=this.firstgid+(this.hTileCount*this.vTileCount-1||0);null!==c&&this.image&&(this.image=me.video.applyRGBFilter(this.image,"transparent",c.toUpperCase()).canvas)},setTileProperty:function(a,c){c.isSolid=c.type?c.type.toLowerCase()===this.type.SOLID:!1;c.isPlatform=c.type?c.type.toLowerCase()===this.type.PLATFORM:
!1;c.isLeftSlope=c.type?c.type.toLowerCase()===this.type.L_SLOPE:!1;c.isRightSlope=c.type?c.type.toLowerCase()===this.type.R_SLOPE:!1;c.isBreakable=c.type?c.type.toLowerCase()===this.type.BREAKABLE:!1;c.isLadder=c.type?c.type.toLowerCase()===this.type.LADDER:!1;c.isSlope=c.isLeftSlope||c.isRightSlope;c.isCollidable=!!c.type;this.TileProperties[a]=c},contains:function(a){return a>=this.firstgid&&a<=this.lastgid},getTileImage:function(a){var c=me.video.createCanvasSurface(this.tilewidth,this.tileheight);
this.drawTile(c,0,0,a);return c.canvas},getTileProperties:function(a){return this.TileProperties[a]},isTileCollidable:function(a){return this.TileProperties[a].isCollidable},getTileOffsetX:function(a){null==this.tileXOffset[a]&&(this.tileXOffset[a]=this.margin+(this.spacing+this.tilewidth)*(a%this.hTileCount));return this.tileXOffset[a]},getTileOffsetY:function(a){null==this.tileYOffset[a]&&(this.tileYOffset[a]=this.margin+(this.spacing+this.tileheight)*parseInt(a/this.hTileCount));return this.tileYOffset[a]},
drawTile:function(a,c,b,d){if(d.flipped){var e=1,f=0,g=0,h=1,i=c,j=b,c=b=0;a.save();d.flipAD&&(e=0,g=f=1,h=0,j+=this.tileheight-this.tilewidth);d.flipX&&(e=-e,g=-g,i+=d.flipAD?this.tileheight:this.tilewidth);d.flipY&&(f=-f,h=-h,j+=d.flipAD?this.tilewidth:this.tileheight);a.transform(e,f,g,h,i,j)}e=d.tileId-this.firstgid;a.drawImage(this.image,this.getTileOffsetX(e),this.getTileOffsetY(e),this.tilewidth,this.tileheight,c,b,this.tilewidth,this.tileheight);d.flipped&&a.restore()}});me.TMXTilesetGroup=
Object.extend({init:function(){this.tilesets=[]},add:function(a){this.tilesets.push(a)},getTilesetByIndex:function(a){return this.tilesets[a]},getTilesetByGid:function(a){for(var c=-1,b=0,d=this.tilesets.length;b<d;b++){if(this.tilesets[b].contains(a))return this.tilesets[b];this.tilesets[b].firstgid==this.tilesets[b].lastgid&&a>=this.tilesets[b].firstgid&&(c=b)}if(-1!=c)return this.tilesets[c];throw"no matching tileset found for gid "+a;}})})(window);
(function(){me.TMXOrthogonalRenderer=Object.extend({init:function(a,c,b,d){this.width=a;this.height=c;this.tilewidth=b;this.tileheight=d},canRender:function(a){return"orthogonal"===a.orientation&&this.width===a.width&&this.height===a.height&&this.tilewidth===a.tilewidth&&this.tileheight===a.tileheight},pixelToTileCoords:function(a,c){return new me.Vector2d(a/this.tilewidth,c/this.tileheight)},tileToPixelCoords:function(a,c){return new me.Vector2d(a*this.tilewidth,c*this.tileheight)},drawTile:function(a,
c,b,d,e){e.drawTile(a,e.tileoffset.x+c*this.tilewidth,e.tileoffset.y+(b+1)*this.tileheight-e.tileheight,d)},drawTileLayer:function(a,c,b,d){var e=this.pixelToTileCoords(b.x+d.pos.x,b.y+d.pos.y).floorSelf(),b=this.pixelToTileCoords(b.x+d.pos.x+d.width+this.tilewidth,b.y+d.pos.y+d.height+this.tileheight).ceilSelf();b.x=b.x>this.width?this.width:b.x;b.y=b.y>this.height?this.height:b.y;for(d=e.y;d<b.y;d++)for(var f=e.x;f<b.x;f++){var g=c.layerData[f][d];g&&(c.tileset.contains(g.tileId)||(c.tileset=c.tilesets.getTilesetByGid(g.tileId)),
this.drawTile(a,f,d,g,c.tileset))}}});me.TMXIsometricRenderer=Object.extend({init:function(a,c,b,d){this.width=a;this.height=c;this.tilewidth=b;this.tileheight=d;this.hTilewidth=b/2;this.hTileheight=d/2;this.ratio=this.tilewidth/this.tileheight;this.originX=this.height*this.hTilewidth},canRender:function(a){return"isometric"===a.orientation&&this.width===a.width&&this.height===a.height&&this.tilewidth===a.tilewidth&&this.tileheight===a.tileheight},pixelToTileCoords:function(a,c){a-=this.originX;return new me.Vector2d((c+
a/this.ratio)/this.tileheight,(c-a/this.ratio)/this.tileheight)},tileToPixelCoords:function(a,c){return new me.Vector2d((a-c)*this.hTilewidth+this.originX,(a+c)*this.hTileheight)},drawTile:function(a,c,b,d,e){e.drawTile(a,(this.width-1)*e.tilewidth+(c-b)*e.tilewidth>>1,-e.tilewidth+(c+b)*e.tileheight>>2,d)},drawTileLayer:function(a,c,b,d){"houselayer_1"===c.name&&(!window.flag&&console.log(c),window.flag=!0);var e=c.tileset,f=e.tileoffset,g=this.pixelToTileCoords(b.x+d.pos.x-e.tilewidth,b.y+d.pos.y-
e.tileheight).floorSelf(),h=this.pixelToTileCoords(b.x+d.pos.x+d.width+e.tilewidth,b.y+d.pos.y+d.height+e.tileheight).ceilSelf(),h=this.tileToPixelCoords(h.x,h.y),i=this.tileToPixelCoords(g.x,g.y);i.x-=this.hTilewidth;i.y+=this.tileheight;var j=i.y-d.pos.y+b.y>this.hTileheight,b=d.pos.x+b.x-i.x<this.hTilewidth;j&&(b?(g.x--,i.x-=this.hTilewidth):(g.y--,i.x+=this.hTilewidth),i.y-=this.hTileheight);b^=j;d=g.clone();for(j=i.y;j-this.tileheight<h.y;j+=this.hTileheight){d.setV(g);for(var k=i.x;k<h.x;k+=
this.tilewidth){if(0<=d.x&&0<=d.y&&d.x<this.width&&d.y<this.height){var n=c.layerData[d.x][d.y];n&&(e.contains(n.tileId)||(e=c.tileset=c.tilesets.getTilesetByGid(n.tileId),f=e.tileoffset),e.drawTile(a,f.x+k,f.y+j-e.tileheight,n))}d.x++;d.y--}b?(g.y++,i.x-=this.hTilewidth,b=!1):(g.x++,i.x+=this.hTilewidth,b=!0)}}})})(window);
(function(a,c){me.ColorLayer=Object.extend({init:function(a,d,c){this.name=a;this.color=me.utils.HexToRGB(d);this.z=c;this.visible=!0;this.opacity=1;this.floating=!0},reset:function(){},getOpacity:function(){return this.opacity},setOpacity:function(a){a&&(this.opacity=a.clamp(0,1))},update:function(){return!1},draw:function(a,d){var c=a.globalAlpha;a.globalAlpha=this.opacity;a.fillStyle=this.color;a.fillRect(d.left,d.top,d.width,d.height);a.globalAlpha=c}});me.ImageLayer=Object.extend({ratio:1,init:function(a,
d,e,f,g,h){this.name=a;(this.image=f?me.loader.getImage(me.utils.getBasename(f)):null)||console.log("melonJS: '"+f+"' file for Image Layer '"+this.name+"' not found!");this.imagewidth=this.image.width;this.imageheight=this.image.height;this.z=g;this.ratio=h||1;this.lastpos=c.viewport.pos.clone();this.offset=new me.Vector2d(0,0);this.width=d?Math.min(c.viewport.width,d):c.viewport.width;this.height=e?Math.min(c.viewport.height,e):c.viewport.height;this.visible=!0;this.opacity=1;this.floating=!0;this._repeat=
"repeat";this.repeatY=this.repeatX=!0;Object.defineProperty(this,"repeat",{get:function(){return this._repeat},set:function(a){this._repeat=a;switch(this._repeat){case "no-repeat":this.repeatY=this.repeatX=!1;break;case "repeat-x":this.repeatX=!0;this.repeatY=!1;break;case "repeat-y":this.repeatX=!1;this.repeatY=!0;break;default:this.repeatY=this.repeatX=!0}}})},reset:function(){this.offset=this.viewport=this.lastpos=this.image=null},getOpacity:function(){return this.opacity},setOpacity:function(a){a&&
(this.opacity=a.clamp(0,1))},update:function(){if(0!==this.ratio){var a=c.viewport.pos;if(!this.lastpos.equals(a))return this.offset.x=(this.imagewidth+this.offset.x+(a.x-this.lastpos.x)*this.ratio)%this.imagewidth,this.offset.y=(this.imageheight+this.offset.y+(a.y-this.lastpos.y)*this.ratio)%this.imageheight,this.lastpos.setV(a),!0}return!1},draw:function(a,d){if(1>this.opacity){var c=a.globalAlpha;a.globalAlpha=this.opacity}if(0===this.ratio)j=Math.min(d.width,this.imagewidth),k=Math.min(d.height,
this.imageheight),a.drawImage(this.image,d.left,d.top,j,k,d.left,d.top,j,k);else{var f=~~this.offset.x,g=~~this.offset.y,h=0,i=0,j=Math.min(this.imagewidth-f,this.width),k=Math.min(this.imageheight-g,this.height);do{do a.drawImage(this.image,f,g,j,k,h,i,j,k),g=0,i+=k,k=Math.min(this.imageheight,this.height-i);while(this.repeatY&&i<this.height);h+=j;if(!this.repeatX||h>=this.width)break;f=0;j=Math.min(this.imagewidth,this.width-h);g=~~this.offset.y;i=0;k=Math.min(this.imageheight-~~this.offset.y,this.height)}while(1)}1>
this.opacity&&(a.globalAlpha=c)}});CollisionTiledLayer=Object.extend({init:function(a,d){this.realwidth=a;this.realheight=d;this.isCollisionMap=!0},reset:function(){},checkCollision:function(a,d){var c=0>d.x?a.left+d.x:a.right+d.x,f=0>d.y?a.top+d.y:a.bottom+d.y,g={x:0,y:0,xprop:{},yprop:{}};if(0>=c||c>=this.realwidth)g.x=d.x;if(0>=f||f>=this.realheight)g.y=d.y;return g}});me.TMXLayer=Object.extend({layerData:null,init:function(a,d,c,f,g){this.tilewidth=a;this.tileheight=d;this.orientation=c;this.z=
g;this.tileset=(this.tilesets=f)?this.tilesets.getTilesetByIndex(0):null},initFromXML:function(a){this.name=me.mapReader.TMXParser.getStringAttribute(a,me.TMX_TAG_NAME);this.visible=1==me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_VISIBLE,1);this.opacity=me.mapReader.TMXParser.getFloatAttribute(a,me.TMX_TAG_OPACITY,1).clamp(0,1);this.width=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_WIDTH);this.height=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_HEIGHT);this.realwidth=this.width*
this.tilewidth;this.realheight=this.height*this.tileheight;me.TMXUtils.applyTMXPropertiesFromXML(this,a);void 0===this.preRender&&(this.preRender=me.sys.preRender);if((this.isCollisionMap=this.name.toLowerCase().contains(me.LevelConstants.COLLISION_MAP))&&!me.debug.renderCollisionMap)this.visible=!1;this.preRender&&(this.layerCanvas=me.video.createCanvas(this.width*this.tilewidth,this.height*this.tileheight),this.layerSurface=this.layerCanvas.getContext("2d"),this.layerSurface.globalAlpha=this.opacity)},
initFromJSON:function(a){this.name=a[me.TMX_TAG_NAME];this.visible=a[me.TMX_TAG_VISIBLE];this.opacity=parseFloat(a[me.TMX_TAG_OPACITY]).clamp(0,1);this.width=parseInt(a[me.TMX_TAG_WIDTH]);this.height=parseInt(a[me.TMX_TAG_HEIGHT]);this.realwidth=this.width*this.tilewidth;this.realheight=this.height*this.tileheight;me.TMXUtils.applyTMXPropertiesFromJSON(this,a);void 0===this.preRender&&(this.preRender=me.sys.preRender);if((this.isCollisionMap=this.name.toLowerCase().contains(me.LevelConstants.COLLISION_MAP))&&
!me.debug.renderCollisionMap)this.visible=!1;this.preRender&&(this.layerCanvas=me.video.createCanvas(this.width*this.tilewidth,this.height*this.tileheight),this.layerSurface=this.layerCanvas.getContext("2d"),this.layerSurface.globalAlpha=this.opacity)},reset:function(){this.preRender&&(this.layerSurface=this.layerCanvas=null);this.tilesets=this.tileset=this.layerData=this.renderer=null},setRenderer:function(a){this.renderer=a},initArray:function(a,d){this.layerData=[];for(var c=0;c<a;c++){this.layerData[c]=
[];for(var f=0;f<d;f++)this.layerData[c][f]=null}},getTileId:function(a,d){var c=this.getTile(a,d);return c?c.tileId:null},getTile:function(a,d){return this.layerData[~~(a/this.tilewidth)][~~(d/this.tileheight)]},setTile:function(a,d,c){this.layerData[a][d]=new me.Tile(a,d,this.tilewidth,this.tileheight,c)},clearTile:function(a,d){this.layerData[a][d]=null;this.visible&&this.preRender&&this.layerSurface.clearRect(a*this.tilewidth,d*this.tileheight,this.tilewidth,this.tileheight)},getOpacity:function(){return this.opacity},
setOpacity:function(a){a&&(this.opacity=a.clamp(0,1),this.preRender&&(this.layerSurface.globalAlpha=this.opacity))},checkCollision:function(a,d){var c=0>d.x?~~(a.left+d.x):Math.ceil(a.right-1+d.x),f=0>d.y?~~(a.top+d.y):Math.ceil(a.bottom-1+d.y),g={x:0,xtile:void 0,xprop:{},y:0,ytile:void 0,yprop:{}};0>=c||c>=this.realwidth?g.x=d.x:0!=d.x&&(g.xtile=this.getTile(c,Math.ceil(a.bottom-1)),g.xtile&&this.tileset.isTileCollidable(g.xtile.tileId)?(g.x=d.x,g.xprop=this.tileset.getTileProperties(g.xtile.tileId)):
(g.xtile=this.getTile(c,~~a.top),g.xtile&&this.tileset.isTileCollidable(g.xtile.tileId)&&(g.x=d.x,g.xprop=this.tileset.getTileProperties(g.xtile.tileId))));0!=d.y&&(g.ytile=this.getTile(0>d.x?~~a.left:Math.ceil(a.right-1),f),g.ytile&&this.tileset.isTileCollidable(g.ytile.tileId)?(g.y=d.y||1,g.yprop=this.tileset.getTileProperties(g.ytile.tileId)):(g.ytile=this.getTile(0>d.x?Math.ceil(a.right-1):~~a.left,f),g.ytile&&this.tileset.isTileCollidable(g.ytile.tileId)&&(g.y=d.y||1,g.yprop=this.tileset.getTileProperties(g.ytile.tileId))));
return g},update:function(){return!1},draw:function(a,d){var e=c.viewport.pos;if(this.preRender){var f=Math.min(d.width,this.realwidth),g=Math.min(d.height,this.realheight);a.drawImage(this.layerCanvas,e.x+d.pos.x,e.y+d.pos.y,f,g,e.x+d.pos.x,e.y+d.pos.y,f,g)}else f=a.globalAlpha,a.globalAlpha=this.opacity,this.renderer.drawTileLayer(a,this,e,d),a.globalAlpha=f}})})(window,me.game);
(function(){me.TMXTileMap=Object.extend({init:function(a,c,b){this.pos=new me.Vector2d(c,b);this.levelId=a;this.z=0;this.name=null;this.height=this.width=0;this.realheight=this.realwidth=-1;this.tileheight=this.tilewidth=0;this.tilesets=null;this.mapLayers=[];this.objectGroups=[];this.initialized=!1;this.orientation=this.version="";this.tilesets=null},reset:function(){if(!0===this.initialized){for(var a=this.mapLayers.length;a--;)this.mapLayers[a].reset(),this.mapLayers[a]=null;for(a=this.objectGroups.length;a--;)this.objectGroups[a].reset(),
this.objectGroups[a]=null;this.tilesets=null;this.mapLayers.length=0;this.objectGroups.length=0;this.pos.set(0,0);this.initialized=!1}},getObjectGroupByName:function(a){for(var c=null,a=a.trim().toLowerCase(),b=this.objectGroups.length;b--;)if(this.objectGroups[b].name.toLowerCase().contains(a)){c=this.objectGroups[b];break}return c},getObjectGroups:function(){return this.objectGroups},getLayers:function(){return this.mapLayers},getLayerByName:function(a){for(var c=null,a=a.trim().toLowerCase(),b=
this.mapLayers.length;b--;)if(this.mapLayers[b].name.toLowerCase().contains(a)){c=this.mapLayers[b];break}a.toLowerCase().contains(me.LevelConstants.COLLISION_MAP)&&null==c&&(c=new CollisionTiledLayer(me.game.currentLevel.realwidth,me.game.currentLevel.realheight));return c},clearTile:function(a,c){for(var b=this.mapLayers.length;b--;)this.mapLayers[b]instanceof me.TMXLayer&&this.mapLayers[b].clearTile(a,c)}})})(window);
(function(){function a(){return{tmxDoc:null,setData:function(a){this.tmxDoc=a},getFirstElementByTagName:function(a){return this.tmxDoc?this.tmxDoc.getElementsByTagName(a)[0]:null},getAllTagElements:function(){return this.tmxDoc?this.tmxDoc.getElementsByTagName("*"):null},getStringAttribute:function(a,c,b){return(a=a.getAttribute(c))?a.trim():b},getIntAttribute:function(a,c,b){return(a=this.getStringAttribute(a,c,b))?parseInt(a):b},getFloatAttribute:function(a,c,b){return(a=this.getStringAttribute(a,
c,b))?parseFloat(a):b},getBooleanAttribute:function(a,c,b){return(a=this.getStringAttribute(a,c,b))?"true"==a:b},free:function(){this.tmxDoc=null}}}me.TMXMapReader=Object.extend({XMLReader:null,JSONReader:null,TMXParser:null,readMap:function(a){if(!a.initialized){"xml"===me.loader.getTMXFormat(a.levelId)?(null===this.XMLReader&&(this.XMLReader=new c),this.TMXParser=this.XMLReader.TMXParser,this.XMLReader.readXMLMap(a,me.loader.getTMX(a.levelId))):(null===this.JSONReader&&(this.JSONReader=new b),console.log("readJSONMap"),
this.JSONReader.readJSONMap(a,me.loader.getTMX(a.levelId)));if(a.realwidth<me.game.viewport.width||a.realheight<me.game.viewport.height){var e=~~((me.game.viewport.width-a.realwidth)/2),f=~~((me.game.viewport.height-a.realheight)/2);a.pos.add({x:0<e?e:0,y:0<f?f:0})}a.initialized=!0}},getNewDefaultRenderer:function(a){switch(a.orientation){case "orthogonal":return new me.TMXOrthogonalRenderer(a.width,a.height,a.tilewidth,a.tileheight);case "isometric":return new me.TMXIsometricRenderer(a.width,a.height,
a.tilewidth,a.tileheight);default:throw"melonJS: "+a.orientation+" type TMX Tile Map not supported!";}},setLayerData:function(a,c,b,g){a.initArray(a.width,a.height);switch(g){case null:switch(b){case null:c=c.getElementsByTagName(me.TMX_TAG_TILE);break;case "json":break;case me.TMX_TAG_CSV:case me.TMX_TAG_ATTR_BASE64:for(var g="",h=0,i=c.childNodes.length;h<i;h++)g+=c.childNodes[h].nodeValue;c=b==me.TMX_TAG_ATTR_BASE64?me.utils.decodeBase64AsArray(g,4):me.utils.decodeCSV(g,a.width);break;default:throw"melonJS: TMX Tile Map "+
b+" encoding not supported!";}break;default:throw"melonJS: "+g+" compressed TMX Tile Map not supported!";}for(h=g=0;h<a.height;h++)for(i=0;i<a.width;i++){var j=null==b?this.TMXParser.getIntAttribute(c[g++],me.TMX_TAG_GID):c[g++];0!==j&&(j=new me.Tile(i,h,a.tilewidth,a.tileheight,j),a.layerData[i][h]=j,a.tileset.contains(j.tileId)||(a.tileset=a.tilesets.getTilesetByGid(j.tileId)),a.visible&&a.preRender&&a.renderer.drawTile(a.layerSurface,i,h,j,a.tileset))}}});var c=me.TMXMapReader.extend({TMXParser:null,
init:function(){this.TMXParser||(this.TMXParser=new a)},readXMLMap:function(a,c){if(!c)throw"melonJS:"+a.levelId+" TMX map not found";var b=0;this.TMXParser.setData(c);for(var g=this.TMXParser.getAllTagElements(),h=0;h<g.length;h++)switch(g.item(h).nodeName){case me.TMX_TAG_MAP:var i=g.item(h);a.version=this.TMXParser.getStringAttribute(i,me.TMX_TAG_VERSION);a.orientation=this.TMXParser.getStringAttribute(i,me.TMX_TAG_ORIENTATION);a.width=this.TMXParser.getIntAttribute(i,me.TMX_TAG_WIDTH);a.height=
this.TMXParser.getIntAttribute(i,me.TMX_TAG_HEIGHT);a.tilewidth=this.TMXParser.getIntAttribute(i,me.TMX_TAG_TILEWIDTH);a.tileheight=this.TMXParser.getIntAttribute(i,me.TMX_TAG_TILEHEIGHT);a.realwidth=a.width*a.tilewidth;a.realheight=a.height*a.tileheight;a.backgroundcolor=this.TMXParser.getStringAttribute(i,me.TMX_BACKGROUND_COLOR);a.z=b++;me.TMXUtils.applyTMXPropertiesFromXML(a,i);a.background_color=a.backgroundcolor?a.backgroundcolor:a.background_color;a.background_color&&a.mapLayers.push(new me.ColorLayer("background_color",
a.background_color,b++));a.background_image&&a.mapLayers.push(new me.ImageLayer("background_image",a.width,a.height,a.background_image,b++));if(null===me.game.renderer||!me.game.renderer.canRender(a))me.game.renderer=this.getNewDefaultRenderer(a);break;case me.TMX_TAG_TILESET:a.tilesets||(a.tilesets=new me.TMXTilesetGroup);a.tilesets.add(this.readTileset(g.item(h)));break;case me.TMX_TAG_IMAGE_LAYER:a.mapLayers.push(this.readImageLayer(a,g.item(h),b++));break;case me.TMX_TAG_LAYER:a.mapLayers.push(this.readLayer(a,
g.item(h),b++));break;case me.TMX_TAG_OBJECTGROUP:a.objectGroups.push(this.readObjectGroup(a,g.item(h),b++))}this.TMXParser.free()},readLayer:function(a,c,b){a=new me.TMXLayer(a.tilewidth,a.tileheight,a.orientation,a.tilesets,b);a.initFromXML(c);var c=c.getElementsByTagName(me.TMX_TAG_DATA)[0],b=this.TMXParser.getStringAttribute(c,me.TMX_TAG_ENCODING,null),g=this.TMXParser.getStringAttribute(c,me.TMX_TAG_COMPRESSION,null);""==b&&(b=null);""==g&&(g=null);a.isCollisionMap||(me.game.renderer.canRender(a)?
a.setRenderer(me.game.renderer):a.setRenderer(me.mapReader.getNewDefaultRenderer(a)));this.setLayerData(a,c,b,g);return a},readImageLayer:function(a,c,b){var g=this.TMXParser.getStringAttribute(c,me.TMX_TAG_NAME),h=this.TMXParser.getIntAttribute(c,me.TMX_TAG_WIDTH),i=this.TMXParser.getIntAttribute(c,me.TMX_TAG_HEIGHT),j=c.getElementsByTagName(me.TMX_TAG_IMAGE)[0].getAttribute(me.TMX_TAG_SOURCE),a=new me.ImageLayer(g,h*a.tilewidth,i*a.tileheight,j,b);a.visible=1==this.TMXParser.getIntAttribute(c,me.TMX_TAG_VISIBLE,
1);a.opacity=this.TMXParser.getFloatAttribute(c,me.TMX_TAG_OPACITY,1);me.TMXUtils.applyTMXPropertiesFromXML(a,c);return a},readTileset:function(a){var c=new me.TMXTileset;c.initFromXML(a);return c},readObjectGroup:function(a,c,b){var g=this.TMXParser.getStringAttribute(c,me.TMX_TAG_NAME),h=new me.TMXOBjectGroup;h.initFromXML(g,c,a.tilesets,b);return h}}),b=me.TMXMapReader.extend({readJSONMap:function(a,c){if(!c)throw"melonJS:"+a.levelId+" TMX map not found";var b=0,g=this;a.version=c[me.TMX_TAG_VERSION];
a.orientation=c[me.TMX_TAG_ORIENTATION];a.width=parseInt(c[me.TMX_TAG_WIDTH]);a.height=parseInt(c[me.TMX_TAG_HEIGHT]);a.tilewidth=parseInt(c[me.TMX_TAG_TILEWIDTH]);a.tileheight=parseInt(c[me.TMX_TAG_TILEHEIGHT]);a.realwidth=a.width*a.tilewidth;a.realheight=a.height*a.tileheight;a.backgroundcolor=c[me.TMX_BACKGROUND_COLOR];a.z=b++;me.TMXUtils.applyTMXPropertiesFromJSON(a,c);a.background_color=a.backgroundcolor?a.backgroundcolor:a.background_color;a.background_color&&a.mapLayers.push(new me.ColorLayer("background_color",
a.background_color,b++));a.background_image&&a.mapLayers.push(new me.ImageLayer("background_image",a.width,a.height,a.background_image,b++));if(null===me.game.renderer||!me.game.renderer.canRender(a))me.game.renderer=this.getNewDefaultRenderer(a);a.tilesets||(a.tilesets=new me.TMXTilesetGroup);c.tilesets.forEach(function(c){a.tilesets.add(g.readTileset(c))});c.layers.forEach(function(c){switch(c.type){case me.TMX_TAG_IMAGE_LAYER:a.mapLayers.push(g.readImageLayer(a,c,b++));break;case me.TMX_TAG_TILE_LAYER:a.mapLayers.push(g.readLayer(a,
c,b++));break;case me.TMX_TAG_OBJECTGROUP:a.objectGroups.push(g.readObjectGroup(a,c,b++))}})},readLayer:function(a,c,b){a=new me.TMXLayer(a.tilewidth,a.tileheight,a.orientation,a.tilesets,b);a.initFromJSON(c);a.isCollisionMap||(me.game.renderer.canRender(a)?a.setRenderer(me.game.renderer):a.setRenderer(me.mapReader.getNewDefaultRenderer(a)));this.setLayerData(a,c[me.TMX_TAG_DATA],"json",null);return a},readImageLayer:function(a,c,b){var g=c[me.TMX_TAG_NAME],h=parseInt(c[me.TMX_TAG_WIDTH]),i=parseInt(c[me.TMX_TAG_HEIGHT]),
a=new me.ImageLayer(g,h*a.tilewidth,i*a.tileheight,c[me.TMX_TAG_IMAGE],b);a.visible=c[me.TMX_TAG_VISIBLE];a.opacity=parseFloat(c[me.TMX_TAG_OPACITY]);me.TMXUtils.applyTMXPropertiesFromJSON(a,c);a.ratio=parseFloat(a.ratio);return a},readTileset:function(a){var c=new me.TMXTileset;c.initFromJSON(a);return c},readObjectGroup:function(a,c,b){var g=new me.TMXOBjectGroup;g.initFromJSON(c[me.TMX_TAG_NAME],c,a.tilesets,b);return g}})})(window);
(function(){var a=me,c={},b={},d=[],e=0;c.reset=function(){};c.addLevel=function(){throw"melonJS: no level loader defined";};c.addTMXLevel=function(a,c){if(null==b[a])b[a]=new me.TMXTileMap(a,0,0),b[a].name=a,d[d.length]=a;else return!1;c&&c();return!0};c.loadLevel=function(a){a=a.toString().toLowerCase();if(void 0===b[a])throw"melonJS: level "+a+" not found";if(b[a]instanceof me.TMXTileMap){var g=me.state.isRunning();g&&me.state.pause();me.game.reset();me.utils.resetGUID(a);b[c.getCurrentLevelId()]&&
b[c.getCurrentLevelId()].reset();me.mapReader.readMap(b[a]);e=d.indexOf(a);me.game.loadTMXLevel(b[a]);g&&me.state.resume()}else throw"melonJS: no level loader defined";return!0};c.getCurrentLevelId=function(){return d[e]};c.reloadLevel=function(){return c.loadLevel(c.getCurrentLevelId())};c.nextLevel=function(){return e+1<d.length?c.loadLevel(d[e+1]):!1};c.previousLevel=function(){return 0<=e-1?c.loadLevel(d[e-1]):!1};c.levelCount=function(){return d.length};a.levelDirector=c})(window);
(function(){me.Tween=function(a){var c={},b={},d={},e=1E3,f=0,g=null,h=0,i=me.Tween.Easing.Linear.EaseNone,j=null,k=null,n=null;this.to=function(c,b){void 0!==b&&(e=b);for(var f in c)null!==a[f]&&(d[f]=c[f]);return this};this.start=function(){me.game.add(this,999);g=me.timer.getTime()+f;h=0;for(var e in d)null!==a[e]&&(c[e]=a[e],b[e]=d[e]-a[e]);return this};this.stop=function(){me.game.remove(this);return this};this.delay=function(a){f=a;return this};me.event.subscribe(me.event.STATE_PAUSE,function(){g&&
(h=me.timer.getTime())});me.event.subscribe(me.event.STATE_RESUME,function(){g&&h&&(g+=me.timer.getTime()-h)});this.easing=function(a){i=a;return this};this.chain=function(a){j=a;return this};this.onUpdate=function(a){k=a;return this};this.onComplete=function(a){n=a;return this};this.update=function(){var d,f,h;f=me.timer.getTime();if(f<g)return!0;if(1<=(f=(f-g)/e))f=1;h=i(f);for(d in b)a[d]=c[d]+b[d]*h;null!==k&&k.call(a,h);return 1===f?(me.game.remove(this),null!==n&&n.call(a),null!==j&&j.start(),
!1):!0};this.destroy=function(){return!0}};me.Tween.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}};me.Tween.Easing.Linear.EaseNone=function(a){return a};me.Tween.Easing.Quadratic.EaseIn=function(a){return a*a};me.Tween.Easing.Quadratic.EaseOut=function(a){return a*(2-a)};me.Tween.Easing.Quadratic.EaseInOut=function(a){return 1>(a*=2)?0.5*a*a:-0.5*(--a*(a-2)-1)};me.Tween.Easing.Cubic.EaseIn=function(a){return a*a*
a};me.Tween.Easing.Cubic.EaseOut=function(a){return--a*a*a+1};me.Tween.Easing.Cubic.EaseInOut=function(a){return 1>(a*=2)?0.5*a*a*a:0.5*((a-=2)*a*a+2)};me.Tween.Easing.Quartic.EaseIn=function(a){return a*a*a*a};me.Tween.Easing.Quartic.EaseOut=function(a){return 1- --a*a*a*a};me.Tween.Easing.Quartic.EaseInOut=function(a){return 1>(a*=2)?0.5*a*a*a*a:-0.5*((a-=2)*a*a*a-2)};me.Tween.Easing.Quintic.EaseIn=function(a){return a*a*a*a*a};me.Tween.Easing.Quintic.EaseOut=function(a){return--a*a*a*a*a+1};me.Tween.Easing.Quintic.EaseInOut=
function(a){return 1>(a*=2)?0.5*a*a*a*a*a:0.5*((a-=2)*a*a*a*a+2)};me.Tween.Easing.Sinusoidal.EaseIn=function(a){return 1-Math.cos(a*Math.PI/2)};me.Tween.Easing.Sinusoidal.EaseOut=function(a){return Math.sin(a*Math.PI/2)};me.Tween.Easing.Sinusoidal.EaseInOut=function(a){return 0.5*(1-Math.cos(Math.PI*a))};me.Tween.Easing.Exponential.EaseIn=function(a){return 0===a?0:Math.pow(1024,a-1)};me.Tween.Easing.Exponential.EaseOut=function(a){return 1===a?1:1-Math.pow(2,-10*a)};me.Tween.Easing.Exponential.EaseInOut=
function(a){return 0===a?0:1===a?1:1>(a*=2)?0.5*Math.pow(1024,a-1):0.5*(-Math.pow(2,-10*(a-1))+2)};me.Tween.Easing.Circular.EaseIn=function(a){return 1-Math.sqrt(1-a*a)};me.Tween.Easing.Circular.EaseOut=function(a){return Math.sqrt(1- --a*a)};me.Tween.Easing.Circular.EaseInOut=function(a){return 1>(a*=2)?-0.5*(Math.sqrt(1-a*a)-1):0.5*(Math.sqrt(1-(a-=2)*a)+1)};me.Tween.Easing.Elastic.EaseIn=function(a){var c,b=0.1;if(0===a)return 0;if(1===a)return 1;!b||1>b?(b=1,c=0.1):c=0.4*Math.asin(1/b)/(2*Math.PI);
return-(b*Math.pow(2,10*(a-=1))*Math.sin((a-c)*2*Math.PI/0.4))};me.Tween.Easing.Elastic.EaseOut=function(a){var c,b=0.1;if(0===a)return 0;if(1===a)return 1;!b||1>b?(b=1,c=0.1):c=0.4*Math.asin(1/b)/(2*Math.PI);return b*Math.pow(2,-10*a)*Math.sin((a-c)*2*Math.PI/0.4)+1};me.Tween.Easing.Elastic.EaseInOut=function(a){var c,b=0.1;if(0===a)return 0;if(1===a)return 1;!b||1>b?(b=1,c=0.1):c=0.4*Math.asin(1/b)/(2*Math.PI);return 1>(a*=2)?-0.5*b*Math.pow(2,10*(a-=1))*Math.sin((a-c)*2*Math.PI/0.4):0.5*b*Math.pow(2,
-10*(a-=1))*Math.sin((a-c)*2*Math.PI/0.4)+1};me.Tween.Easing.Back.EaseIn=function(a){return a*a*(2.70158*a-1.70158)};me.Tween.Easing.Back.EaseOut=function(a){return--a*a*(2.70158*a+1.70158)+1};me.Tween.Easing.Back.EaseInOut=function(a){return 1>(a*=2)?0.5*a*a*(3.5949095*a-2.5949095):0.5*((a-=2)*a*(3.5949095*a+2.5949095)+2)};me.Tween.Easing.Bounce.EaseIn=function(a){return 1-me.Tween.Easing.Bounce.EaseOut(1-a)};me.Tween.Easing.Bounce.EaseOut=function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=
1.5/2.75)*a+0.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+0.9375:7.5625*(a-=2.625/2.75)*a+0.984375};me.Tween.Easing.Bounce.EaseInOut=function(a){return 0.5>a?0.5*me.Tween.Easing.Bounce.EaseIn(2*a):0.5*me.Tween.Easing.Bounce.EaseOut(2*a-1)+0.5}})();
(function(){var a=me,c={},b={};c.STATE_PAUSE="me.state.onPause";c.STATE_RESUME="me.state.onResume";c.GAME_INIT="me.game.onInit";c.LEVEL_LOADED="me.game.onLevelLoaded";c.LOADER_COMPLETE="me.loader.onload";c.LOADER_PROGRESS="me.loader.onProgress";c.KEYDOWN="me.input.keydown";c.KEYUP="me.input.keyup";c.WINDOW_ONRESIZE="window.onresize";c.publish=function(a,c){for(var f=b[a],g=f?f.length:0;g--;)f[g].apply(window,c||[])};c.subscribe=function(a,c){b[a]||(b[a]=[]);b[a].push(c);return[a,c]};c.unsubscribe=
function(a,c){for(var f=b[c?a:a[0]],c=c||a[1],g=f?f.length:0;g--;)f[g]===c&&f.splice(g,1)};a.event=c})();
(function(){var a=me,c={};c.Base=Object.extend({version:void 0,init:function(){}});c.patch=function(a,c,e){void 0!==a.prototype&&(a=a.prototype);if("function"==typeof a[c]){var f=a[c];a[c]=function(){var a=this.parent;this.parent=f;var c=e.apply(this,arguments);this.parent=a;return c}}else console.error(c+" is not an existing function")};c.register=function(a,c){me.plugin[c]&&console.error("plugin "+c+" already registered");if(void 0===a.prototype.version)throw"melonJS: Plugin version not defined !";
if(0<me.sys.checkVersion(a.prototype.version))throw"melonJS: Plugin version mismatch, expected: "+a.prototype.version+", got: "+me.version;var e=[];2<arguments.length&&(e=Array.prototype.slice.call(arguments,1));e[0]=a;me.plugin[c]=new (a.bind.apply(a,e));if(!(me.plugin[c]instanceof me.plugin.Base))throw"melonJS: Plugin should extend the me.plugin.Base Class !";};a.plugin=c})();var astar={init:function(a){for(var c=0,b=a.length;c<b;c++)for(var d=0,e=a[c].length;d<e;d++){var f=a[c][d];f.f=0;f.g=0;f.h=0;f.cost=f.type;f.visited=!1;f.closed=!1;f.parent=null}},heap:function(){return new BinaryHeap(function(a){return a.f})},search:function(a,c,b,d,e){astar.init(a);var e=e||astar.manhattan,d=!!d,f=astar.heap();for(f.push(c);0<f.size();){c=f.pop();if(c===b){a=c;for(b=[];a.parent;)b.push(a),a=a.parent;return b.reverse()}c.closed=!0;for(var g=astar.neighbors(a,c,d),h=0,i=g.length;h<
i;h++){var j=g[h];if(!j.closed&&!j.isWall()){var k=c.g+j.cost,n=j.visited;if(!n||k<j.g)j.visited=!0,j.parent=c,j.h=j.h||e(j.pos,b.pos),j.g=k,j.f=j.g+j.h,n?f.rescoreElement(j):f.push(j)}}}return[]},manhattan:function(a,c){var b=Math.abs(c.x-a.x),d=Math.abs(c.y-a.y);return b+d},neighbors:function(a,c,b){var d=[],e=c.x,c=c.y;a[e-1]&&a[e-1][c]&&d.push(a[e-1][c]);a[e+1]&&a[e+1][c]&&d.push(a[e+1][c]);a[e]&&a[e][c-1]&&d.push(a[e][c-1]);a[e]&&a[e][c+1]&&d.push(a[e][c+1]);b&&(a[e-1]&&a[e-1][c-1]&&d.push(a[e-
1][c-1]),a[e+1]&&a[e+1][c-1]&&d.push(a[e+1][c-1]),a[e-1]&&a[e-1][c+1]&&d.push(a[e-1][c+1]),a[e+1]&&a[e+1][c+1]&&d.push(a[e+1][c+1]));return d}};var GraphNodeType={OPEN:1,WALL:0};function Graph(a){for(var c=[],b=0;b<a.length;b++){c[b]=[];for(var d=0,e=a[b];d<e.length;d++)c[b][d]=new GraphNode(b,d,e[d])}this.input=a;this.nodes=c}Graph.prototype.toString=function(){for(var a="\n",c=this.nodes,b,d,e,f,g=0,h=c.length;g<h;g++){b="";d=c[g];e=0;for(f=d.length;e<f;e++)b+=d[e].type+" ";a=a+b+"\n"}return a};function GraphNode(a,c,b){this.data={};this.x=a;this.y=c;this.pos={x:a,y:c};this.type=b}
GraphNode.prototype.toString=function(){return"["+this.x+" "+this.y+"]"};GraphNode.prototype.isWall=function(){return this.type==GraphNodeType.WALL};function BinaryHeap(a){this.content=[];this.scoreFunction=a}
BinaryHeap.prototype={push:function(a){this.content.push(a);this.sinkDown(this.content.length-1)},pop:function(){var a=this.content[0],c=this.content.pop();0<this.content.length&&(this.content[0]=c,this.bubbleUp(0));return a},remove:function(a){var c=this.content.indexOf(a),b=this.content.pop();c!==this.content.length-1&&(this.content[c]=b,this.scoreFunction(b)<this.scoreFunction(a)?this.sinkDown(c):this.bubbleUp(c))},size:function(){return this.content.length},rescoreElement:function(a){this.sinkDown(this.content.indexOf(a))},
sinkDown:function(a){for(var c=this.content[a];0<a;){var b=(a+1>>1)-1,d=this.content[b];if(this.scoreFunction(c)<this.scoreFunction(d))this.content[b]=c,this.content[a]=d,a=b;else break}},bubbleUp:function(a){for(var c=this.content.length,b=this.content[a],d=this.scoreFunction(b);;){var e=a+1<<1,f=e-1,g=null;if(f<c){var h=this.scoreFunction(this.content[f]);h<d&&(g=f)}if(e<c&&this.scoreFunction(this.content[e])<(null===g?d:h))g=e;if(null!==g)this.content[a]=this.content[g],this.content[g]=b,a=g;else break}}};function addPlayer(a){console.log("addPlayer");a.characterId=1;me.ObjectSettings.spritewidth=g_config.character[a.characterId].width;me.ObjectSettings.spriteheight=g_config.character[a.characterId].height;me.ObjectSettings.image="character"+g_config.character[a.characterId].id;btg.otherPlayers[a.id]=new btg.CharacterBase(a.x,a.y,me.ObjectSettings);btg.otherPlayers[a.id].z=btg.map.playerLayerZ;btg.otherPlayers[a.id].renderable.setCurrentAnimation("stand-down");me.game.add(btg.otherPlayers[a.id],btg.map.playerLayerZ);
me.game.sort()}function mouseDown(){}function mouseMove(){}function mouseUp(){var a=me.game.viewport.pos.y+me.input.mouse.pos.y,a={x:parseInt(me.game.viewport.pos.x+me.input.mouse.pos.x),y:parseInt(a)},c={x:parseInt(btg.mainPlayer.pos.x+btg.mainPlayer.width/2),y:parseInt(btg.mainPlayer.pos.y+100)},a=btg.pathSearcher.searchPixelCoordsPath(c,a);btg.mainPlayer.moveByPath(a);return!0}
function getOrthogonalPosition(){var a=me.game.viewport.pos.x+me.input.mouse.pos.x,c=me.game.viewport.pos.y+me.input.mouse.pos.y-btg.mainPlayer.height;0>a&&(a=0);a>me.game.currentLevel.realwidth&&(a=me.game.currentLevel.realwidth);c<-btg.mainPlayer.height&&(c=-btg.mainPlayer.height);c>me.game.currentLevel.realheight-btg.mainPlayer.height&&(c=me.game.currentLevel.realheight-btg.mainPlayer.height);var b=convertToOrthogonalCase(btg.mainPlayer.pos.x,btg.mainPlayer.pos.y,1),a=convertToOrthogonalCase(a,
c,1);debug({currentPosition:{x:btg.mainPlayer.pos.x,y:btg.mainPlayer.pos.y},gotoPosition:{x:me.game.viewport.pos.x+me.input.mouse.pos.x,y:me.game.viewport.pos.y+me.input.mouse.pos.y-btg.mainPlayer.height}});return{currentPosition:b,gotoPosition:a}}
function getIsometricPosition(){var a=btg.map.diamondwidth,c=btg.map.diamondheight,b={x:me.game.currentLevel.realwidth/2-btg.mainPlayer.pos.x,y:btg.mainPlayer.pos.y-c/2},d={x:me.game.currentLevel.realwidth/2-(me.game.viewport.pos.x+me.input.mouse.pos.x),y:me.game.viewport.pos.y+me.input.mouse.pos.y-c/2-btg.mainPlayer.height},a=[[-a/2,-c/2],[a/2,c/2]],c=testPoint(a,[b.x,b.y]),b={x:Math.floor(c[0]),y:Math.floor(c[1])},c=testPoint(a,[d.x,d.y]),d={x:Math.floor(c[0]),y:Math.floor(c[1])};return{currentPosition:b,
gotoPosition:d}}function drawPath(){if(btg.debug){var a=getOrthogonalPosition();currentPosition=btg.map.graph.nodes[a.currentPosition.x][a.currentPosition.y];gotoPosition=btg.map.graph.nodes[a.gotoPosition.x][a.gotoPosition.y];a=astar.search(btg.map.graph.nodes,currentPosition,gotoPosition,!0);me.game.HUD.removeItem("rect");me.game.HUD.addItem("rect",new btg.ui.rect(me.input.mouse.pos.x,me.input.mouse.pos.y,94,91,a,1))}}
function drawPathByIsometric(){if(btg.debug){var a={x:me.game.viewport.pos.x+me.input.mouse.pos.x,y:me.game.viewport.pos.y+me.input.mouse.pos.y},c={x:btg.mainPlayer.pos.x+btg.mainPlayer.width/2,y:btg.mainPlayer.pos.y+100},b=g_config.map.level[btg.game.currentLevel].polygonData;if(a=b?btg.navMeshPathSearcher.searchPath(b,c,a):[{x:x,y:y}])a.unshift(c),me.game.HUD.removeItem("path"),me.game.HUD.addItem("path",new btg.ui.path(0,0,a))}}
function getPath(){var a=getOrthogonalPosition();btg.mainPlayer.gotoPosition(a.currentPosition,a.gotoPosition);return!0}
function testPoint(a,c){function b(a,c){return[a[0][0]*c[0]+a[0][1]*c[1],a[1][0]*c[0]+a[1][1]*c[1]]}var d=[-(a[0][0]+a[1][0])/2,-a[0][1]],a=[[a[0][0]+d[0],a[0][1]+d[1]],[a[1][0]+d[0],a[1][1]+d[1]]],e=-Math.atan2(a[1][1]-a[0][1],a[1][0]-a[0][0]),e=[[Math.cos(e),-Math.sin(e)],[Math.sin(e),Math.cos(e)]],f=[a[0][0],(a[0][1]+a[1][1])/2],f=b(e,f),g=[[1,-f[0]/f[1]],[0,1]],f=b(g,f),h=[a[1][0],(a[0][1]+a[1][1])/2],h=b(e,h),h=b(g,h);return b([[1/h[0],0],[0,1/f[1]]],b(g,b(e,[d[0]+c[0],d[1]+c[1]])))}
function convertToOrthogonalCase(a,c){var b=btg.map.scale;3==arguments.length&&(b=arguments[2]);return{x:Math.floor(c/(btg.map.collision_tileheight/b)),y:Math.floor(a/(btg.map.collision_tilewidth/b))}}function convertToOrthogonalPixel(a,c){var b=btg.map.scale;3==arguments.length&&(b=arguments[2]);return{x:Math.floor(c*btg.map.collision_tilewidth/b),y:Math.floor(a*btg.map.collision_tileheight/b)}}function debug(a){btg.debug&&console.log(a)};var g_config={map:{level:[{id:0,npcs:[20,21],fightSceneX:2700,fightSceneY:2E3,pos:{x:3E3,y:1600},mapData:[[0,2,3,4,5,0],[7,8,9,10,11,0],[0,0,15,0,0,0]],polygonData:[[[3018,1914],[2759,2045],[2673,2001],[2717,1848],[2504,1740],[2547,1717],[2458,1673],[2500,1650],[2412,1476],[2470,1462],[2499,1475],[2555,1463],[2800,1451],[2930,1560],[2974,1586],[3232,1454],[3318,1496],[3100,1607],[3187,1653],[3446,1522],[3618,1736],[3530,1783],[3660,1848],[3445,1956],[3360,1911],[3314,1936],[3275,1914],[3144,1977]],
[[2846,1786],[3061,1672],[2844,1563],[2630,1674]],[[3404,1893],[3320,1850],[3447,1784],[3535,1826]]]},{id:1,npcs:[20],fightSceneX:2E3,fightSceneY:2E3,pos:{x:3E3,y:1600}},{id:2,npcs:[],fightSceneX:2E3,fightSceneY:2E3,pos:{x:3E3,y:2E3},mapData:[[0,2,3,4,5,6,0,0],[9,10,11,12,13,14,15,16],[17,18,19,20,21,22,23,0],[0,0,27,28,29,0,0,0]]}]},character:[{id:0,name:"\u5973\u4e3b\u89d2",width:80,height:114,standDown:[0,1,2,3,4,5],standLeft:[72,73,74,75,76,77],standUp:[6,7,8,9,10,11],standRight:[78,79,80,81,
82,83],standLeftDown:[30,31,32,33,34,35],standLeftUp:[24,25,26,27,28,29],standRightUp:[12,13,14,15,16,17],standRightDown:[18,19,20,21,22,23],down:[42,43,44,45,46,47],left:[90,91,92,93,94,95],up:[36,37,38,39,40,41],right:[84,85,86,87,88,89],leftDown:[66,67,68,69,70,71],leftUp:[60,61,62,63,64,65],rightUp:[48,49,50,51,52,53],rightDown:[54,55,56,57,58,59]},{id:1,name:"\u7537\u4e3b\u89d2",width:80,height:114,standDown:[0,1,2,3,4,5],standLeft:[72,73,74,75,76,77],standUp:[6,7,8,9,10,11],standRight:[78,79,
80,81,82,83],standLeftDown:[30,31,32,33,34,35],standLeftUp:[24,25,26,27,28,29],standRightUp:[12,13,14,15,16,17],standRightDown:[18,19,20,21,22,23],down:[42,43,44,45,46,47],left:[90,91,92,93,94,95],up:[36,37,38,39,40,41],right:[84,85,86,87,88,89],leftDown:[66,67,68,69,70,71],leftUp:[60,61,62,63,64,65],rightUp:[48,49,50,51,52,53],rightDown:[54,55,56,57,58,59]},{id:2},{id:3},{id:4},{id:5},{id:6},{id:7},{id:8},{id:9},{id:10},{id:11},{id:12},{id:13},{id:14},{id:15},{id:16},{id:17},{id:18},{id:19},{id:20,
name:"npc20",width:77,height:150,standDown:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]},{id:21,name:"npc21",width:102,height:136,standDown:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]},{id:22}],pirateBoat:[{id:0,name:"boat1",width:150,height:150,stand:[0]},{id:1,name:"boat2",width:150,height:150,stand:[0]},{id:2,name:"boat2",width:150,height:150,stand:[0]},{id:3,name:"boat2",width:150,height:150,stand:[0]},{id:4,name:"boat2",width:150,height:150,stand:[0]},{id:5,name:"boat2",width:150,
height:150,stand:[0]},{id:6,name:"boat2",width:150,height:150,stand:[0]},{id:7},{id:8},{id:9},{id:10},{id:11},{id:12},{id:13},{id:14},{id:15},{id:16},{id:17},{id:18},{id:19},{id:20,name:"boat20",width:150,height:150,stand:[0]},{id:21},{id:22}],npc:{20:{id:20,name:"test",width:77,height:150,standDown:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]}},mainTask:[{id:0,name:"",getItems:[{id:0,num:10}]}],dayTask:[{id:0,name:"",getItems:[{id:0,num:10}]}],items:[{id:0,name:"",type:1}],skills:[{id:0,name:""}],
formation:{bg:{left:0,top:219,width:476,height:350,marginLeft:8,positionWidth:90,positionHeight:60},positions:{mainPlayer:[{x:234,y:167},{x:266,y:39},{x:408,y:114},{x:387,y:246},{x:200,y:304},{x:48,y:218},{x:90,y:87}],enemy:[{x:243,y:167},{x:210,y:39},{x:68,y:114},{x:89,y:246},{x:277,y:304},{x:428,y:218},{x:386,y:87}]}}};var g_resources=[{name:"cc_bg",type:"image",src:"res/ui/layout/cc/bg.png"},{name:"play",type:"image",src:"res/ui/layout/cc/play.png"},{name:"play_h",type:"image",src:"res/ui/layout/cc/play_h.png"},{name:"boy",type:"image",src:"res/ui/layout/cc/boy.png"},{name:"girl",type:"image",src:"res/ui/layout/cc/girl.png"},{name:"clouds1",type:"image",src:"res/ui/layout/cc/clouds1.png"},{name:"clouds2",type:"image",src:"res/ui/layout/cc/clouds2.png"},{name:"stage",type:"image",src:"res/ui/layout/cc/stage.png"},
{name:"chooseCharacter",type:"image",src:"res/e/special_003.png"},{name:"map0",type:"tmx",src:"res/w/c/0/map.tmx"},{name:"map1",type:"tmx",src:"res/w/c/1/map.tmx"},{name:"map2",type:"tmx",src:"res/w/c/2/map.tmx"},{name:"map2_1",type:"image",src:"res/w/c/2/1.png"},{name:"water",type:"image",src:"res/w/t/water.png"},{name:"land",type:"image",src:"res/w/t/land.png"},{name:"land2",type:"image",src:"res/w/t/land2.png"},{name:"tiled_collision",type:"image",src:"res/w/t/tiled_collision.png"},{name:"dbwj1",
type:"image",src:"res/w/o/dbwj1.png"},{name:"dbwj2",type:"image",src:"res/w/o/dbwj2.png"},{name:"dbwj3",type:"image",src:"res/w/o/dbwj3.png"},{name:"dbwj4",type:"image",src:"res/w/o/dbwj4.png"},{name:"house1",type:"image",src:"res/w/o/house1.png"},{name:"house2",type:"image",src:"res/w/o/house2.png"},{name:"house3",type:"image",src:"res/w/o/house3.png"},{name:"house4",type:"image",src:"res/w/o/house4.png"},{name:"house5",type:"image",src:"res/w/o/house5.png"},{name:"mountain1",type:"image",src:"res/w/o/mountain1.png"},
{name:"mountain2",type:"image",src:"res/w/o/mountain2.png"},{name:"mountain3",type:"image",src:"res/w/o/mountain3.png"},{name:"mountain",type:"image",src:"res/w/o/mountain.png"},{name:"shu1",type:"image",src:"res/w/o/shu1.png"},{name:"smithy",type:"image",src:"res/w/o/smithy.png"},{name:"teahouse",type:"image",src:"res/w/o/teahouse.png"},{name:"shop",type:"image",src:"res/w/o/shop.png"},{name:"house6",type:"image",src:"res/w/o/house6.png"},{name:"house7",type:"image",src:"res/w/o/house7.png"},{name:"house8",
type:"image",src:"res/w/o/house8.png"},{name:"louti2",type:"image",src:"res/w/o/louti2.png"},{name:"louti3",type:"image",src:"res/w/o/louti3.png"},{name:"bridge",type:"image",src:"res/w/o/bridge.png"},{name:"bridge1",type:"image",src:"res/w/o/bridge1.png"},{name:"boat1",type:"image",src:"res/w/o/boat1.png"},{name:"character0",type:"image",src:"res/c/0/0.png"},{name:"character1",type:"image",src:"res/c/1/1.png"},{name:"character20",type:"image",src:"res/c/20/20.png"},{name:"character21",type:"image",
src:"res/c/21/21.png"},{name:"symbol",type:"image",src:"res/c/symbol.png"},{name:"pirateBoat0",type:"image",src:"res/p/0/0.png"},{name:"pirateBoat1",type:"image",src:"res/p/1/1.png"},{name:"pirateBoat2",type:"image",src:"res/p/2/2.png"},{name:"pirateBoat3",type:"image",src:"res/p/3/3.png"},{name:"pirateBoat4",type:"image",src:"res/p/4/4.png"},{name:"pirateBoat5",type:"image",src:"res/p/5/5.png"},{name:"pirateBoat6",type:"image",src:"res/p/6/6.png"},{name:"logo",type:"image",src:"res/ui/ci/0/0_bust.png"},
{name:"seaport_000",type:"image",src:"res/e/seaport_000.png"},{name:"seaport_001",type:"image",src:"res/e/seaport_001.png"},{name:"fire_001",type:"image",src:"res/e/fire_001.png"},{name:"click_000",type:"image",src:"res/e/click_000.png"},{name:"click_001",type:"image",src:"res/e/click_001.png"},{name:"0_buff",type:"image",src:"res/ui/ci/0/0_buff.png"},{name:"fi_anger_center",type:"image",src:"res/ui/layout/f/fi_anger_center.png"},{name:"fi_anger_left",type:"image",src:"res/ui/layout/f/fi_anger_left.png"},
{name:"fi_anger_right",type:"image",src:"res/ui/layout/f/fi_anger_right.png"},{name:"fi_life_bg",type:"image",src:"res/ui/layout/f/fi_life_bg.png"},{name:"fi_life_center",type:"image",src:"res/ui/layout/f/fi_life_center.png"},{name:"fi_life_left",type:"image",src:"res/ui/layout/f/fi_life_left.png"},{name:"fi_life_right",type:"image",src:"res/ui/layout/f/fi_life_right.png"},{name:"fi_magic_bg",type:"image",src:"res/ui/layout/f/fi_magic_bg.png"}];
(function(){for(var a=1,c=0;c<g_config.map.level.length;c++)if(a=1,g_config.map.level[c].mapData)for(var b=0;b<g_config.map.level[c].mapData.length;b++)for(var d=0;d<g_config.map.level[c].mapData[b].length;d++)0!=g_config.map.level[c].mapData[b][d]&&g_resources.push({name:"map"+c+"_"+a,type:"image",src:"res/w/c/"+c+"/"+a+".png"}),a++})();var btg=function(){return{map:{tileWidth:45,tileHeight:44,collision_tilewidth:40,collision_tileheight:40,tiled:{row:0,col:0},scale:2,isometricToOrthogonalGrid:[],orthogonalToIsometricGrid:{},orthogonalGrid:[],isometricGridXY:[],orthogonalGridXY:[],isometricGridMatrix:{},orthogonalGridMatrix:{},isometric_tilewidth:48,isometric_tileheight:48,tileset_width:94,tileset_height:91,tileset_sidelength:Math.round(Math.sqrt(Math.pow(94,2)+Math.pow(91,2))),diamondwidth:0,diamondheight:0,playerLayerZ:0,fightLayerZ:100,
graph:null,isometricGraph:null,findPathMethod:2,bg_layer:null},character:{cId:0},mainPlayer:{},otherPlayers:{},screen:{width:960,height:640,maxWindowWidthSize:960,scale:1,double_buffer:!1},canvas:{width:960,height:640},game:{currentLevel:0,currentMap:{seaport:{x:0,y:0}},isFight:!1,font:{fontName:"\u5fae\u8f6f\u96c5\u9ed1 bold",fontSize:"14",fontColor:"white",defaultFont:new me.Font("\u5fae\u8f6f\u96c5\u9ed1 bold",14,"white")}},debug:!1,debugGrid:!1,os:"iPhone",canTouch:!0}}();window.btg=btg||{};
(function(a){a.map.getIsometricTileId=function(c,b){var d=me.game.currentLevel.width,e=me.game.currentLevel.height,f=a.map.tileWidth*d,g=a.map.tileHeight*e,h=0,i=0,h=0>=b?0:b>=g-a.map.tileHeight?e:Math.floor(b/a.map.tileHeight),i=0>=c?0:c>=f-a.map.tileWidth?d:Math.floor(c/a.map.tileWidth);return{row:h,col:i}};a.map.getOrthogonalTileId=function(c,b,d){null==d&&(d=a.map.scale);var e=me.game.currentLevel.width*d,f=me.game.currentLevel.height*d,g=me.game.currentLevel.realwidth,h=me.game.currentLevel.realHeight,
i=0,j=0,i=0>=b?0:b>=h-me.game.currentLevel.tileheight/d?f:Math.floor(b/(me.game.currentLevel.tileheight/d)),j=0>=c?0:c>=g-me.game.currentLevel.tilewidth/d?e:Math.floor(c/(me.game.currentLevel.tilewidth/d)),c=[];1==d?c.push({row:i,col:j}):2==d&&(c.push({row:i,col:j}),c.push({row:i-1,col:j}),c.push({row:i-1,col:j+1}),c.push({row:i,col:j+1}));return c};a.map.getOrthogonalTileId2Time=function(c,b){a.map.getOrthogonalTileId(c,b,2)};a.map.getIsometricPosition=function(c,b){var d=0,e=0,d=a.map.tileWidth*
b,e=a.map.tileHeight*c;return{x:d,y:e}};a.map.getOrthogonalPosition=function(a,b){var d=0,e=0,d=2*me.game.currentLevel.width,e=2*me.game.currentLevel.height,f=me.game.currentLevel.realwidth,g=me.game.currentLevel.realheight,d=b>=a?f/2+(b-a)*Math.round(f/d):f/2-(a-b)*Math.round(f/d),e=b<=e/2-a?g/2-(e/2-a-b)*Math.round(g/e):g/2+(b-(e/2-a))*Math.round(g/e);return{x:d-me.game.currentLevel.tilewidth/2,y:e+me.game.currentLevel.tileheight/2}};a.map.getOrthogonalPos=function(a,b){return{x:me.game.currentLevel.tilewidth/
2*(me.game.currentLevel.width+a-b-1),y:me.game.currentLevel.tileheight/2*(2*me.game.currentLevel.height-a-b-2)}};a.map.initIsometricGrid=function(){scale=1;for(var c=me.game.currentLevel.height,b=me.game.currentLevel.width,d={},d={},e=0;e<c;e+=1){a.map.isometricToOrthogonalGrid[e]=[];for(var f=0;f<b;f+=1)d=a.map.getOrthogonalPosition(e,f),d=a.map.getOrthogonalTileId(d.x,d.y,scale),d=d[0],a.map.isometricToOrthogonalGrid[e][f]=d,null==a.map.orthogonalToIsometricGrid[d.row]&&(a.map.orthogonalToIsometricGrid[d.row]=
{}),a.map.orthogonalToIsometricGrid[d.row][d.col]={row:e,col:f}}};a.map.initIsometricGridXY=function(){var c=me.game.currentLevel.height,b=me.game.currentLevel.width;a.map.diamondwidth=me.game.currentLevel.tilewidth;a.map.diamondheight=me.game.currentLevel.tileheight-4;for(var d=a.map.diamondwidth,e=a.map.diamondheight,f=me.game.currentLevel.realwidth,g=0,h=0,i=0,j=0,k=0;k<c;k+=1){a.map.isometricGridXY[k]=[];for(var n=0;n<b;n+=1)g=(n-k)*d/2,h=(k+n)*e/2,i=f/2+(n-k)*d/2,j=(k+n)*e/2+e/2,a.map.isometricGridXY[k][n]=
{isometric:{x:g,y:h},orthogonal:{x:i,y:j},orthogonalMatrix:{x:i/(d/2),y:j/(e/2)}},null==a.map.isometricGridMatrix[g]&&(a.map.isometricGridMatrix[g]={}),a.map.isometricGridMatrix[g][h]={isometric:{x:k,y:n},orthogonal:{x:i/(d/2),y:j/(e/2)}},null==a.map.orthogonalGridMatrix[i]&&(a.map.orthogonalGridMatrix[i]={}),a.map.orthogonalGridMatrix[i][j]={isometric:{x:k,y:n},orthogonal:{x:i/(d/2),y:j/(e/2)}}}debug(a.map.isometricGridXY);debug(a.map.isometricGridMatrix);debug(a.map.orthogonalGridMatrix)};a.map.initOrthogonalGridXY=
function(){for(var c=me.game.currentLevel.height,b=me.game.currentLevel.width,d=me.game.currentLevel.tilewidth,e=me.game.currentLevel.tileheight,f=me.game.currentLevel.realwidth,g=0,h=0,i=0,j=0,k=0;k<c;k+=1){a.map.orthogonalGridXY[k]=[];for(var n=0;n<b;n+=1)g=(n-k)*d/2,h=(k+n)*e/2,i=f/2+(n-k)*d/2,j=(k+n)*e/2+e/2,a.map.orthogonalGridXY[k][n]={isometric:{x:g,y:h},orthogonal:{x:i,y:j}}}};a.map.initOrthogonalGrid=function(){for(var c=me.game.currentLevel.height*a.map.scale,b=me.game.currentLevel.width*
a.map.scale,d=0;d<c;d+=1){a.map.orthogonalGrid[d]=[];for(var e=0;e<b;e+=1)a.map.orthogonalGrid[d][e]=1}};a.map.orthogonalXYToIsometricXY=function(){};a.map.isometricXYToOrthogonalXY=function(){};a.map.pixelToTileCoords=function(a,b){var d=me.game.currentLevel.tileheight,e=me.game.currentLevel.tilewidth/me.game.currentLevel.tileheight,a=a-me.game.currentLevel.height*(me.game.currentLevel.tilewidth/2);return new me.Vector2d((b+a/e)/d,(b-a/e)/d)};a.map.tileToPixelCoords=function(a,b){var d=me.game.currentLevel.tilewidth/
2;return new me.Vector2d((a-b)*d+me.game.currentLevel.height*d,(a+b)*(me.game.currentLevel.tileheight/2))};a.map.getGraph=function(){var c=me.game.currentLevel.getLayerByName("collision");debug(c);if(c.layerData){a.map.initIsometricGrid();a.map.initOrthogonalGrid();for(var b=c.height,d=c.width,e={},e={},f=0;f<b;f+=1)for(var g=0;g<d;g+=1)e=a.map.convertToPixel(g,f),null!=c.getTile(e.x,e.y)&&(e=a.map.getOrthogonalPosition(f,g),e=a.map.getOrthogonalTileId(e.x,e.y),e=e[0],a.map.orthogonalGrid[e.row][e.col]=
0);debug(a.map.orthogonalGrid);return new Graph(a.map.orthogonalGrid)}alert("no LAYER COL")};a.map.getGraphInfo=function(){var c=me.game.currentLevel.getLayerByName("collision");debug(c);if(c.layerData){a.map.initIsometricGridXY();a.map.initOrthogonalGrid();for(var b=c.height,d=c.width,e=me.game.currentLevel.tilesets,f=null,g=null,h=0;h<b;h+=1)for(var i=0;i<d;i+=1)f=a.map.convertToPixel(i,h),g=c.getTile(f.x,f.y),null!=g&&(debug("i:"+h+" j:"+i),f=e.getTilesetByGid(g.tileId),"no"==f.TileProperties[g.tileId].canwalk&&
(a.map.orthogonalGrid[h][i]=0));debug(a.map.orthogonalGrid);return new Graph(a.map.orthogonalGrid)}alert("no LAYER COL")};a.map.getCurrentGraphInfo=function(){for(var a=me.game.collisionMap.layerData,b=a.length,d=a[0].length,e=[],f=0;f<b;f++){e[f]=[];for(var g=0;g<d;g++)e[f][g]=a[f][g]?0:1,a[f][g]=null}return new Graph(e)};a.map.getGraphInOrthogonal=function(){a.map.orthogonalGrid=tile_collisions["map"+a.game.currentLevel];debug(a.map.orthogonalGrid);return new Graph(a.map.orthogonalGrid)};a.map.convertToPixel=
function(a,b){a=Math.floor(a*me.game.currentLevel.tilewidth);b=Math.floor(b*me.game.currentLevel.tileheight);return{x:a,y:b}};a.map.getTilePixel=function(c,b){return a.map.bg_layer.renderer.tileToPixelCoords(c,b).floorSelf()};a.map.getTileCoords=function(c,b){return a.map.bg_layer.renderer.pixelToTileCoords(c,b).floorSelf()};a.map.getPlayerLayerZ=function(){for(var a=0,b=me.game.currentLevel.objectGroups,d=0;d<=b.length;d++)if("player"==b[d].name){a=b[d].z;break}return a}})(btg);
(function(a){a.calculateScreen=function(){if("pc"==a.os)a.canvas.width=a.screen.maxWindowWidthSize,a.canvas.height=a.screen.height;else{a.screen.maxWindowWidthSize=a.screen.width;var c=window.innerHeight;a.canvas.width=window.innerWidth-20;a.canvas.height=c;400>c&&(a.canvas.height=400);c>a.screen.height&&(a.canvas.height=a.screen.height);a.canvas.width>a.screen.maxWindowWidthSize&&(a.canvas.width=a.screen.maxWindowWidthSize);a.screen.scale=a.canvas.height/a.screen.height;1>a.screen.scale&&(a.screen.double_buffer=
!0)}}})(btg);(function(a){a.getCenterX=function(a){return(me.game.viewport.getWidth()-a.width)/2};a.getCenterY=function(a){return(me.game.viewport.getHeight()-a.height)/2};a.getScreenXY=function(a){return{x:a.x-me.game.viewport.pos.x,y:a.y-me.game.viewport.pos.y}};a.getScreenRect=function(){return new me.Rect(new me.Vector2d(0,0),me.video.getWidth(),me.video.getHeight())}})(btg);
(function(a){a.drawStokeFont=function(c,b,d,e){c.font="bold 14px Arial";c.textAlign=e;c.lineWidth=2;c.strokeStyle="#000000";c.strokeText(b,d.x,d.y-20);c.fillStyle=a.font.fontColor;c.fillText(b,d.x,d.y-20)};a.drawFont=function(c,b,d,e,f,g){var h=a.game.font.defaultFont.measureText(c,b),i=0,i="undefined"==typeof g||"left"==g?0:"center"==g?f.width/2-h.width/2:f.width-h.width;a.game.font.defaultFont.draw(c,b,d+i,e-10)}})(btg);(function(a){a.createCharacter=function(c){for(var b in c)a.character[b]=c[b]}})(btg);
(function(a){a.game.loadLevel=function(c){me.levelDirector.loadLevel("map"+c);loading.info.style.display="none";var b=g_config.map.level[c].mapData;if(b){for(var d=0;d<b.length;d++)for(var e=0;e<b[d].length;e++)b[d][e]=b[d][e]?"map"+c+"_"+b[d][e]:"map2_1";b=new a.MultipleImageLayer("bg",me.game.currentLevel.realwidth,me.game.currentLevel.realheight,1024,1024,b,2);me.game.add(b,b.z)}(c=g_config.map.level[c].polygonData)&&a.debug&&me.game.add(new a.ui.polygonShape(0,0,null,c),300);c=a.getScreenRect();
seaking.registerEvent(c);a.mainPlayer=new a.PlayerEntity(g_config.map.level[a.game.currentLevel].pos.x,g_config.map.level[a.game.currentLevel].pos.y,me.ObjectSettings,a.character.cId);for(var f in a.character)a.mainPlayer[f]=a.character[f];a.mainPlayer.photo="./res/ui/ci/0/0_photo.png";UI.getDom("#leftTop")||seaking.showMainSceneUI();me.game.add(a.mainPlayer,a.map.playerLayerZ);me.game.sort();a.map.bg_layer=me.game.currentLevel.getLayerByName("bg");a.map.graph=1==a.map.findPathMethod?a.map.getGraphInOrthogonal():
2==a.map.findPathMethod?a.map.getGraphInfo():a.map.getCurrentGraphInfo()}})(btg);(function(a){var c=navigator.userAgent;a.os="pc";a.canTouch=!1;0<c.indexOf("iPhone")?(a.os="iPhone",a.canTouch=!0):0<c.indexOf("iPod")?(a.os="iPod",a.canTouch=!0):0<c.indexOf("iPad")?(a.os="iPad",a.canTouch=!0):0<c.indexOf("Android")&&(a.os="Android",a.canTouch=!0)})(btg);(function(a){a.addNpc=function(){}})(btg);
(function(a){a.point=function(){2==arguments.length?(this.x=arguments[0],this.y=arguments[1]):this.y=this.x=0};a.getLineFunc=function(a,b,d,e,f){var g=0,h=0,i=d-a,g=0==i?0:(e-b)/i,h=b-g*a,a=Math.round((d-a)/f);0==g&&0==i&&(a=Math.round((e-b)/f));return{a:g,b:h,step:a}};a.getLinePoint=function(c,b,d,e,f){var e=a.getLineFunc(c,b,d,e,f),g=[],h=null;debug("num:"+f);for(var i=0;i<f;i++)h=new a.point,0==e.a&&0==d-c?(h.x=c,h.y=b+e.step*(i+1)):(h.x=c+e.step*(i+1),h.y=e.a*h.x+e.b),g.push(h);debug(g);return g};
a.random=function(a,b){return Math.floor(Math.random()*(b+1-a))+a}})(btg);(function(a){a.getLinePoint(2924,1012,2924,1056,20)})(btg);(function(a){a.game_socket={host:"project.wozlla.com",port:7002,connect:null};a.talk_socket={host:"project.wozlla.com",port:7002,connect:null};a.uc_socket={host:"project.wozlla.com",port:7002,connect:null};a.socket={host:"project.wozlla.com",port:8002,timer:null,loaded:!1,status:{OK:200}};a.position_timer=null;a.initSocket=function(){try{var c=document.getElementsByTagName("head"),b=document.createElement("script");b.id="socket";b.type="text/javascript";b.src="http://"+a.socket.host+":"+a.socket.port+
"/socket.io/socket.io.js";"socket"==c[0].children[c[0].children.length-1].id&&c[0].removeChild(c[0].lastChild);c[0].appendChild(b);a.socket.timer=setTimeout(a.socket.load,3E3);loading.show();b.onload=function(){a.socket.loaded=!0;clearTimeout(a.socket.timer);loading.hide();a.game_socket.connect=io.connect("http://"+a.game_socket.host+":"+a.game_socket.port+"");a.talk_socket.connect=io.connect("http://"+a.talk_socket.host+":"+a.talk_socket.port+"");a.game_socket.bind();a.talk_socket.bind();loading.reconnect.hide()}}catch(d){loading.reconnect.show()}};
a.socket.load=function(){loading.hide();loading.reconnect.show()};a.createMainPlayer=function(c){a.game_socket.connect.emit("logon",c.pos)};a.socket.bind=function(){a.socket.connect.on("connect",function(){console.log("socket connect")});a.socket.connect.on("serverList",function(a){console.log(a)})};a.uc_socket.bind=function(){a.uc_socket.connect.on("connect",function(){console.log("uc_socket connect")});a.uc_socket.connect.on("1002",function(a){console.log(a);"200"==a.status&&(localStorage.setItem("registerType",
a.registerType),localStorage.setItem("loginName",a.loginName),localStorage.setItem("userId",a.userId),localStorage.setItem("sessionId",a.sessionId))});a.uc_socket.connect.on("1004",function(a){console.log(a);"200"==a.status&&(localStorage.setItem("registerType",a.registerType),localStorage.setItem("loginName",a.loginName),localStorage.setItem("userId",a.userId),localStorage.setItem("sessionId",a.sessionId))});a.uc_socket.connect.on("1006",function(a){console.log(a);"200"==a.status&&(localStorage.setItem("registerType",
a.registerType),localStorage.setItem("loginName",a.loginName),localStorage.setItem("userId",a.userId),localStorage.setItem("sessionId",a.sessionId))});a.uc_socket.connect.on("1602",function(a){console.log(a)})};a.game_socket.bind=function(){a.game_socket.connect.on("connect",function(){console.log("connect")});a.game_socket.connect.on("players",function(c){function b(){a.game_socket.connect.emit("move",a.mainPlayer.pos);a.position_timer=setTimeout(b,200)}console.log("players: "+c);c.forEach(addPlayer);
a.position_timer=setTimeout(b,200)});a.game_socket.connect.on("moved",function(c){var b=a.otherPlayers[c.id];b&&(b.destinationX=c.x,b.destinationY=c.y)});a.game_socket.connect.on("connected",function(a){console.log("connected: "+a);addPlayer(a)});a.game_socket.connect.on("disconnected",function(c){console.log("disconnected: "+c);me.game.remove(a.otherPlayers[c.id]);delete a.otherPlayers[c.id]});a.game_socket.connect.on("1008",function(a){console.log(a)});a.game_socket.connect.on("1010",function(c){console.log(c);
a.mainPlayer={id:0,cId:0,level:1,nickname:"\u6c34\u795e",maxEnergy:0,energy:0,getEnergySpeed:0,speed:0,lucky:0,life:100,powerful:0,attack:0,skillHurt:0,weaponDef:0,fireDef:0,crit:0,parry:0,hit:0,dodge:0,currentExp:100,needExp:100,photo:"./res/ui/ci/0/0_photo.png",money:0,gameCurrency:0};if(c.status==a.socket.status.OK){for(var b in c)"status"!=b&&(a.mainPlayer[b]=c[b]);UI.initMainScene()}console.log(a.mainPlayer)});a.game_socket.connect.on("1302",function(c){console.log(c);c.status==a.socket.status.OK&&
UI.taskWindow.fillData(UI.taskWindow,c.taskInfo)})};a.talk_socket.bind=function(){a.talk_socket.connect.on("1602",function(a){200==a.status&&UI.chat.addMsg([["test",a.message]])})};a.initSocket();a.talkToWorld=function(){UI.chat.addMsg([["test","hello world!"]]);a.talk_socket.connect.emit("1601",{registerType:1,loginName:"test",userId:100006,sessionId:"1D74C6CE3A8DB50E6B4A2410E6E37D19",serverId:1,message:"hello world!",lang:"zh_CN"})};a.socket.getServerList=function(){socket.emit("getServerList")};
a.uc_socket.register=function(){var c=$("#loginName").value,b=$("#password").value,c={registerType:1,loginName:c,password:hex_md5(b)};console.log(c);a.uc_socket.emit("1001",c)};a.uc_socket.login=function(){var c=$("#loginName").value,b=$("#password").value,c={registerType:1,loginName:c,password:hex_md5(b)};console.log(c);a.uc_socket.emit("1003",c)};a.uc_socket.loginBySessionId=function(){var a={registerType:1,loginName:"wozlla",userId:100001,sessionId:"29197A14BA49DDFCDA3C48559E413ADF"};console.log(a);
uc_socket.emit("1005",a)};a.uc_socket.getUserInfo=function(){return{registerType:1,loginName:"wozlla",userId:100001,sessionId:"29197A14BA49DDFCDA3C48559E413ADF",serverId:1,lang:"zh_CN"}};a.game_socket.createCharacter=function(){var c=a.uc_socket.getUserInfo();c.characterId=1;c.sex=1;c.nickName="";console.log(c);a.game_socket.connect.emit("1007",c)};a.game_socket.getCharacterInfo=function(){var c=a.uc_socket.getUserInfo();console.log(c);a.game_socket.connect.emit("1009",c)};a.game_socket.getCurrentTaskInfo=
function(){var c=a.uc_socket.getUserInfo();c.type=2;console.log(c);a.game_socket.connect.emit("1301",c)};a.game_socket.getTaskInfo=function(c){var b=a.uc_socket.getUserInfo();b.type=1;b.taskId=c;a.game_socket.connect.emit("1301",b)}})(btg);(function(){var a=new function(){var a=0,c=this;this.graphWeightCache={};this.searchTileCoordsPath=function(e,f,g){var g=g||me.game.currentLevel.getLayerByName("collision"),h=g.$_graph_hash;h||(h=g.$_graph_hash="graph"+a++);var i=null,i=c.graphWeightCache[h];if(!i){for(var j=g.layerData,i=[],k=j.length,n=j[0].length,u=0;u<k;u++){for(var m=[],r=0;r<n;r++)for(var v=j[u][r]?0:1,l=0;1>l;l++)m.push(v);for(r=0;1>r;r++)i.push(m)}i=new Graph(i);this.graphWeightCache[h]=i}g=c.getRenderer(g);j=g.pixelToTileCoords(e.x,
e.y).ceilSelf();h=g.pixelToTileCoords(f.x,f.y).ceilSelf();j=i.nodes[j.x][j.y];h=i.nodes[h.x][h.y];h.isWall()&&(h=this.searchClosestMovableTileCoords(e,f,i,g));return astar.search(i.nodes,j,h,!0)};this.searchClosestMovableTileCoords=function(a,c,d,b){for(var i=0<c.x-a.x?10:-10,j=10*Math.abs((c.y-a.y)/(c.x-a.x)),j=0<c.y-a.y?j:-j;;)if(c.x-=i,c.y-=j,a=b.pixelToTileCoords(c.x,c.y).ceilSelf(),a=d.nodes[a.x][a.y],!a.isWall())return a;return null};this.searchPixelCoordsPath=function(a,b,g){for(var a=c.searchTileCoordsPath(a,
b,g),g=c.getRenderer(g),b=[],h=0,i=a.length;h<i;h++){var j=g.tileToPixelCoords(a[h].x,a[h].y).ceilSelf();b.push(j)}return b};this.getRenderer=function(a){var a=a||me.game.currentLevel.getLayerByName("collision"),c=a.extension_renderer;if(!c){switch(a.orientation){case "orthogonal":c=new me.TMXOrthogonalRenderer(a.width,a.height,a.tilewidth,a.tileheight);break;case "isometric":c=new me.TMXIsometricRenderer(1*a.width,1*a.height,a.tilewidth/1,a.tileheight/1);break;default:throw"melonJS: "+this.orientation+
" type TMX Tile Map not supported!";}a.extension_renderer=c}return c}},c=new function(){var a=0,c={};this.searchPath=function(e,f,g){var h,i,j,k,n,u,m=e._navMeshKey=e._navMeshKey||"nav_mesh_"+a++,r=[],v=[];h=c[m];if(!h){j=e.length;for(h=0;h<j;h++){n=e[h];k=[];u=n.length;for(i=0;i<u;i++)k.push(new navmesh.Vector2f(n[i][0],n[i][1]));v.push(new navmesh.Polygon(k.length,k))}h=(new navmesh.Delaunay).createDelaunay(v);c[m]=h}for(i=0;i<h.length;i++)e=h[i],e=new navmesh.Cell(e.getVertex(0),e.getVertex(1),
e.getVertex(2)),e.index=i,r.push(e);for(h=0;h<r.length;h++){e=r[h];for(i=0;i<r.length;i++)m=r[i],e!=m&&e.checkAndLink(m)}(f=(new navmesh.NavMesh(r)).findPath(f,g))&&f.shift();return f}};btg.pathSearcher=a;btg.navMeshPathSearcher=c})();btg=btg||{};
(function(a){a.DefaultLoadingScreen=me.DefaultLoadingScreen.extend({init:function(){this.parent(!0);this.logo1.set("century gothic",32,"yellow","middle");this.logo2.set("century gothic",32,"red","middle")},draw:function(a){var b=this.logo1.measureText(a,"wozlla").width,d=(a.canvas.width-b-this.logo2.measureText(a,"Game").width)/2,e=a.canvas.height/2;me.video.clearSurface(a,"black");this.logo1.draw(a,"wozlla",d,e);this.logo2.draw(a,"Game",d+b,e);e+=this.logo1.measureText(a,"wozlla").height/2;b=Math.floor(this.loadPercent*
a.canvas.width);a.strokeStyle="silver";a.strokeRect(0,e,a.canvas.width,6);a.fillStyle="#89b002";a.fillRect(2,e+2,b-4,2)}})})(btg);btg=btg||{};
(function(a){a.StartScreen=me.ScreenObject.extend({startScene:[],clouds:[],init:function(){this.zIndex=1;this.startScene=[{name:"cc_bg",x:0,y:0,visible:!0},{name:"boy",x:246,y:106,visible:!0},{name:"boy_stage",x:200,y:261,visible:!0},{name:"girl",x:577,y:113,visible:!0},{name:"girl_stage",x:526,y:261,flip:!0,visible:!0},{name:"play",x:359,y:414,visible:!0}];this.startScene.items={};for(var a=0;a<this.startScene.length;a++)this.startScene.items[this.startScene[a].name]={x:this.startScene[a].x,y:this.startScene[a].y};
this.cloudType={1:{width:452,height:276},2:{width:350,height:202}};this.clouds=[{type:1,x:100,y:100},{type:2,x:300,y:300},{type:1,x:400,y:400}];this.parent(!0);me.video.clearSurface(me.video.getSystemContext(),"black")},update:function(){},onResetEvent:function(){loading.hide();me.game.add(new a.ui.BackGround("cc_bg"),this.zIndex++);for(var c=0;c<this.clouds.length;c++){this.clouds[c].sprite=new me.SpriteObject(this.clouds[c].x,this.clouds[c].y,me.loader.getImage("clouds"+this.clouds[c].type));var b=
c;this.clouds[b].tween=(new me.Tween(this.clouds[b].sprite.pos)).to({x:-100},2E4).onComplete(this.tweenbw.bind(this,b)).start();me.game.add(this.clouds[c].sprite,this.zIndex)}this.zIndex++;this.boyStage=new me.SpriteObject(this.startScene.items.boy_stage.x,this.startScene.items.boy_stage.y,me.loader.getImage("stage"));this.girlStage=new me.SpriteObject(this.startScene.items.girl_stage.x,this.startScene.items.girl_stage.y,me.loader.getImage("stage"));this.girlStage.flipX();me.game.add(this.boyStage,
this.zIndex);me.game.add(this.girlStage,this.zIndex);this.zIndex++;this.boy=new a.ui.Character(this.startScene.items.boy.x,this.startScene.items.boy.y,"boy",{x:-10,y:10});this.girl=new a.ui.Character(this.startScene.items.girl.x,this.startScene.items.girl.y,"girl",{x:10,y:10});me.game.add(this.boy,this.zIndex);me.game.add(this.girl,this.zIndex);me.gamestat.add("chooseCharacter","");this.zIndex++;me.game.add(new a.ui.Button(this.startScene.items.play.x,this.startScene.items.play.y,"play",{click:function(){me.game.viewport.fadeIn("#000000",
1E3,function(){loading.info.style.display="block";seaking.initLevel()})}}),this.zIndex++)},tweenbw:function(a){this.clouds[a].sprite.pos.x=1E3;this.clouds[a].tween.to({x:-1E3},2E4).onComplete(this.tweenbw.bind(this,a)).start()},tweenff:function(a){this.clouds[a].tween.to({x:0},2E4).onComplete(this.tweenbw.bind(this,a)).start()},onDestroyEvent:function(){},handleEvent:function(){},draw:function(){},_draw:function(a){a.save();for(var b=0;b<this.startScene.length;b++)this.startScene[b].visible&&a.drawImage(this.startScene[b].image,
this.startScene[b].x,this.startScene[b].y);a.restore()}});a.PlayScreen=me.ScreenObject.extend({currentLevel:0,init:function(){this.parent(!0)},onResetEvent:function(){a.game.loadLevel(a.game.currentLevel)},onUpdateFrame:function(){me.input.isKeyPressed("left")?me.game.viewport.move(-(me.game.currentLevel.tilewidth/2),0):me.input.isKeyPressed("right")&&me.game.viewport.move(me.game.currentLevel.tilewidth/2,0);me.input.isKeyPressed("up")?me.game.viewport.move(0,-(me.game.currentLevel.tileheight/2)):
me.input.isKeyPressed("down")&&me.game.viewport.move(0,me.game.currentLevel.tileheight/2);this.parent(this)},onDestroyEvent:function(){me.game.disableHUD();me.audio.stopTrack()},draw:function(a){this.parent(a)}});a.FightScreen=me.ScreenObject.extend({init:function(){},onResetEvent:function(){a.game.isFight=!0;a.game.loadLevel(a.game.currentLevel)},onDestroyEvent:function(){me.game.disableHUD();me.audio.stopTrack()},draw:function(){}})})(btg);var seaking={onload:function(){btg.calculateScreen();me.video.init("jsapp",btg.screen.width,btg.screen.height)?(me.state.set(me.state.LOADING,new btg.DefaultLoadingScreen),me.state.set(me.state.Ready,new btg.StartScreen),me.state.set(me.state.PLAY,new btg.PlayScreen),me.sys.useNativeAnimFrame=!0,me.sys.gravity=0,me.audio.init("mp3,ogg"),me.loader.onload=this.loaded.bind(this),me.loader.preload(g_resources)):alert("Sorry but your browser does not support html 5 canvas.")},loaded:function(){console.log(me);
me.state.change(me.state.Ready)},initLevel:function(){me.state.change(me.state.PLAY);me.entityPool.add("mainPlayer",btg.PlayerEntity);for(var a=0;a<g_config.map.level[btg.game.currentLevel].npcs.length;a++)me.entityPool.add("npc"+g_config.map.level[btg.game.currentLevel].npcs[a],btg.NpcEntity);me.entityPool.add("seaport",btg.Seaport);me.game.addHUD(0,0,me.game.viewport.getWidth(),me.game.viewport.getHeight());me.debug.renderHitBox=btg.debug;me.debug.renderCollisionMap=btg.debug},registerEvent:function(a){me.input.registerMouseEvent("mousedown",
a,mouseDown,!0);me.input.registerMouseEvent("mousemove",a,mouseMove,!0);me.input.registerMouseEvent("mouseup",a,mouseUp,!0);me.input.bindKey(me.input.KEY.LEFT,"left");me.input.bindKey(me.input.KEY.RIGHT,"right");me.input.bindKey(me.input.KEY.UP,"up");me.input.bindKey(me.input.KEY.DOWN,"down")},unregisterEvent:function(a){me.input.releaseMouseEvent("mousedown",a);me.input.releaseMouseEvent("mousemove",a);me.input.releaseMouseEvent("mouseup",a)},showMainSceneUI:function(){btg.canvas=UI.getDom("#jsapp > canvas");
UI.init(!0);UI.loading(UI.initMainScene,ui_resources.mainScene)},gotoPreviousLevel:function(){me.game.reset();btg.game.currentLevel--;btg.game.loadLevel(btg.game.currentLevel)},gotoNextLevel:function(){me.game.reset();btg.game.currentLevel++;btg.game.loadLevel(btg.game.currentLevel)},gotoLevel:function(a){me.game.reset();btg.game.currentLevel=a;for(a=0;a<g_config.map.level[btg.game.currentLevel].npcs.length;a++)me.entityPool.add("npc"+g_config.map.level[btg.game.currentLevel].npcs[a],btg.NpcEntity);
btg.game.loadLevel(btg.game.currentLevel)},reset:function(){me.game.reset();me.levelDirector.loadLevel("map"+btg.game.currentLevel);null==btg.map.graph&&(me.game.sort(),btg.map.graph=btg.map.getGraph())},onUpdateFrame:function(){me.game.update();me.game.draw()},onDestroyEvent:function(){me.game.disableHUD();me.audio.stopTrack()}};(function(a){a.CharacterBase=me.ObjectEntity.extend({isMe:!1,pirateBoatId:0,boatMode:!1,pirateBoat:null,pirateBoats:[],mainBoatId:0,fight:null,formation:null,gotoEffect:null,id:0,cId:0,level:1,nickname:"\u6c34\u795e",maxEnergy:0,energy:0,getEnergySpeed:0,speed:0,lucky:0,life:100,powerful:0,attack:0,skillHurt:0,weaponDef:0,fireDef:0,crit:0,parry:0,hit:0,dodge:0,currentExp:100,needExp:100,money:100,gameCurrency:100,buff:[],_self:null,shadowImg:null,path:null,linePoint:[],currentPos:null,nextPos:null,
_updated:!1,x:0,y:0,direction:"down",animation:"down",init:function(a,b,d){this.shadowImg=me.loader.getImage("shadow");this.parent(a,b,d);this.setVelocity(10,10);this.setFriction(0.1,0.1);this.updateColRect(18,46,-1,0);this.photo="./res/ui/ci/"+this.cId+"/"+this.cId+"_photo.png";this.waitTime=55E3;this.gravity=this.timer=0;this.firstUpdates=2;this.animation=this.direction="down";this.destinationX=a;this.destinationY=b;this.cos225=Math.cos(45*Math.PI/360);this.animationspeed=3;this.motionState="stop";
this.moveSpeed=6;this.pathChanged=!1;this.allDirVec={up:{x:0,y:-1},down:{x:0,y:1},right:{x:1,y:0},left:{x:-1,y:0},rightdown:{x:1,y:1},leftup:{x:-1,y:-1},rightup:{x:1,y:-1},leftdown:{x:-1,y:1}};this.__defineGetter__("curX",function(){return this.pos.x+this.width/2});this.__defineGetter__("curY",function(){return this.pos.y+this.height});this.initAnimation(a,b,d)},initAnimation:function(a,b,d){a=d.image.replace("character","");this.animationspeed=3;this.renderable.addAnimation("stand-down",g_config.character[a].standDown);
this.renderable.addAnimation("stand-left",g_config.character[a].standLeft);this.renderable.addAnimation("stand-up",g_config.character[a].standUp);this.renderable.addAnimation("stand-right",g_config.character[a].standRight);this.renderable.addAnimation("stand-leftdown",g_config.character[a].standLeftDown);this.renderable.addAnimation("stand-leftup",g_config.character[a].standLeftUp);this.renderable.addAnimation("stand-rightup",g_config.character[a].standRightUp);this.renderable.addAnimation("stand-rightdown",
g_config.character[a].standRightDown);this.renderable.addAnimation("down",g_config.character[a].down);this.renderable.addAnimation("left",g_config.character[a].left);this.renderable.addAnimation("up",g_config.character[a].up);this.renderable.addAnimation("right",g_config.character[a].right);this.renderable.addAnimation("leftdown",g_config.character[a].leftDown);this.renderable.addAnimation("leftup",g_config.character[a].leftUp);this.renderable.addAnimation("rightup",g_config.character[a].rightUp);
this.renderable.addAnimation("rightdown",g_config.character[a].rightDown)},moveByPath:function(a){this.path=a||[];this.pathChanged=!0},update:function(a){if(this.pathChanged)if(this.pathChanged=!1,this.nextPos=this.path.shift()){this.nextPos.x-=this.width/2;this.nextPos.y-=100;this.accel.set(this.nextPos.x-this.pos.x,this.nextPos.y-this.pos.y);this.accel.normalize();this.motionState="run";for(var b in this.allDirVec){var d=this.accel.x,e=this.accel.y,f=this.allDirVec[b].x,g=this.allDirVec[b].y,d=
(d*f+e*g)/(Math.sqrt(d*d+e*e)*Math.sqrt(f*f+g*g));if(1>=d&&d>=this.cos225){this.direction=b;break}}}else this.motionState="stop";"run"===this.motionState?(this.vel.set(this.moveSpeed*this.accel.x*me.sys.fps/me.timer.fps,this.moveSpeed*this.accel.y*me.sys.fps/me.timer.fps),this.follow(),this.renderable.setCurrentAnimation(this.direction)):(this.vel.set(0,0),this.renderable.setCurrentAnimation("stand-"+this.direction),this._updated=!0);"run"===this.motionState&&(this.pos.add(this.vel),0>=(new me.Vector2d(this.nextPos.x-
this.pos.x,this.nextPos.y-this.pos.y)).dotProduct(this.accel)&&(this.pathChanged=!0,this.pos.set(this.nextPos.x,this.nextPos.y)));(this._updated||a)&&this.parent(this);return this._updated},follow:function(){me.game.viewport.reset(this.pos.x-me.video.getWidth()/2+this.width/2,this.pos.y-me.video.getHeight()/2+this.height/2)},draw:function(a){this.drawCharactorName(a,"\u6c34\u795e");this.parent(a)},drawCharactorName:function(c,b){var d=a.getScreenXY(this.pos);a.drawFont(c,b,d.x,d.y,this,"center")},
_draw:function(a){if(this.flickering&&(this.flickerState=!this.flickerState,!this.flickerState))return;var b=~~(this.pos.x-this.vp.pos.x),d=~~(this.pos.y-this.vp.pos.y);if(this.scaleFlag||0!==this.angle){a.save();var e=this.width*this.anchorPoint.x,f=this.height*this.anchorPoint.y;a.translate(b+e,d+f);this.scaleFlag&&a.scale(this.scale.x,this.scale.y);0!==this.angle&&a.rotate(this.angle);b=-e;d=-f}a.drawImage(this.image,this.offset.x,this.offset.y,this.width,this.height,b,d,this.width,this.height);
a.drawImage(this.shadowImg,this.offset.x,this.offset.y,this.width,this.height,b,d,this.width,this.height);(this.scaleFlag||0!==this.angle)&&a.restore();me.debug.renderHitBox&&(this.parent(a,"blue"),this.collisionBox.draw(a,"red"))}})})(btg);(function(a){a.PlayerEntity=a.CharacterBase.extend({init:function(c,b,d,e){this.isMe=!0;this.cId=e;d.image="character"+this.cId;d.spritewidth=g_config.character[a.character.cId].width;d.spriteheight=g_config.character[a.character.cId].height;this.parent(c,b-d.spriteheight/2,d);this.follow();a.createMainPlayer(this)},update:function(){this.parent(this);this.pos.x>a.game.currentMap.seaport.pos.x-a.game.currentMap.seaport.width&&(this.pos.x<a.game.currentMap.seaport.pos.x+a.game.currentMap.seaport.width&&
this.pos.y>a.game.currentMap.seaport.pos.y-a.game.currentMap.seaport.width&&this.pos.y<a.game.currentMap.seaport.pos.y+a.game.currentMap.seaport.width)&&this.goToCity()},goToCity:function(){seaking.unregisterEvent(a.getScreenRect());a.mainPlayer.pirateBoat=new a.PirateBoat(a.mainPlayer.pos.x,a.mainPlayer.pos.y,me.ObjectSettings,a.mainPlayer.mainBoatId);a.mainPlayer.pirateBoat.z=a.map.playerLayerZ;a.mainPlayer.pirateBoat.setCurrentAnimation("stand");a.mainPlayer.pirateBoat.gravity=0.98;a.mainPlayer.pirateBoat.setVelocity(6,
6);a.mainPlayer.boatMode=!0;me.game.add(a.mainPlayer.pirateBoat,a.map.playerLayerZ);me.game.remove(this);me.game.sort()},goToFight:function(){var c=this;c.visible=!1;seaking.unregisterEvent(a.getScreenRect());a.game.isFight||(UI.mainScene.hide(),a.game.boatMode=!0,a.game.isFight=!0,me.game.viewport.fadeIn("#000000",1E3,function(){a.mainPlayer.fight||(me.game.viewport.reset(g_config.map.level[a.game.currentLevel].fightSceneX,g_config.map.level[a.game.currentLevel].fightSceneY),a.enemy=new a.EnemyEntity(c.pos.x,
c.pos.y,me.ObjectSettings,0),UI.loading(c.createFight,ui_resources.fightScene))}))},createFight:function(){UI.fightScene.createScene();a.mainPlayer.fight=new a.Fight(a.mainPlayer,a.enemy)},quitFight:function(){var c=this;c.visible=!0;seaking.registerEvent(a.getScreenRect());a.game.isFight&&(UI.fightScene.hide(),a.game.boatMode=!1,a.game.isFight=!1,me.game.viewport.fadeIn("#000000",1E3,function(){a.mainPlayer.fight&&(c.follow(),UI.mainScene.show(),a.mainPlayer.fight.removeAll(),a.mainPlayer.fight=
null)}))}})})(btg);(function(a){a.BoatBase=me.ObjectEntity.extend({cId:0,boatId:0,formationPosition:0,font:null,lifeProgress:null,angerProgress:null,layer:0,boatImg:null,context:null,effect:null,x:0,y:0,shakeCount:0,shakeTween:[],fontName:"\u5fae\u8f6f\u96c5\u9ed1 bold",fontSize:14,fontColor:"white",effectName:"",_scale:0.5,marginTop:0,boatName:"\u9690\u5f62\u6218\u8230",boatLevel:0,currentLife:100,life:100,maxAnger:150,fullAnger:100,currentAnger:0,attack:100,attackType:1,skillHurt:100,skillHurtType:1,weaponDef:1,fireDef:1,
actionSpeed:1,crit:1,parray:1,hit:1,dodge:1,buff:null,fightData:null,init:function(a,b,d){"undefined"==typeof this.boatId&&(this.boatId=0);d.image="pirateBoat"+this.boatId;this.boatImg=me.loader.getImage(d.image);d.spritewidth=this.boatImg.width;d.spriteheight=this.boatImg.height;a-=this.boatImg.width/4;this.parent(a,b,d);this.renderable=this;this.renderable.resize(this._scale);this.marginTop=this.hHeight/4;this.setVelocity(0,0);this.x=a;this.y=b;this.setFriction(0.1,0.1);this.initAnimation(a,b,d);
this.addLifeProgress();this.addAngerProgress()},initAnimation:function(){this.renderable.animationspeed=me.sys.fps/10;this.renderable.addAnimation("stand",g_config.pirateBoat[this.boatId].stand)},update:function(a){((updated=this.updateMovement())||a)&&this.parent(this);return updated},gotoPlace:function(){},updateShake:function(){6<=this.shakeCount?(this.pos.x=this.x,this.pos.y=this.y,this.shakeCount=0):(x=Number.prototype.random(this.pos.x-10,this.pos.x+10),y=Number.prototype.random(this.pos.y-
10,this.pos.y+10),this.pos.x=x,this.pos.y=y,this.shakeCount++)},addBoatName:function(c,b){var d=a.game.font.defaultFont.measureText(c,b),d=a.getScreenXY(new me.Vector2d(this.pos.x+this.hWidth-d.width/2,this.pos.y+this.marginTop-d.height));a.game.font.defaultFont.draw(c,b,d.x,d.y)},addEffectName:function(a,b,d,e){e&&(this.fontName=e);this.fontSize=a;this.fontColor=b;this.effectName=d},addLifeProgress:function(){this.lifeProgress=new a.ProgressEntity(this,me.ObjectSettings,"life");me.game.add(this.lifeProgress,
this.layer+10)},addLife:function(a){this.currentLife+=a;this.currentLife>=this.life&&(this.currentLife=this.life)},subLife:function(a){this.currentLife-=a;0>=this.currentLife&&(this.currentLife=0)},addAngerProgress:function(){this.angerProgress=new a.ProgressEntity(this,me.ObjectSettings,"anger");me.game.add(this.angerProgress,this.layer+10)},addAnger:function(a){this.currentAnger+=a;this.currentAnger>=this.maxAnger&&(this.currentAnger=this.maxAnger)},subAnger:function(a){this.currentAnger-=a;0>=
this.currentAnger&&(this.currentAnger=0)},updateProgress:function(a,b){"life"==a?this.currentLife+=b:this.currentAnger+=b},addEffect:function(c){this.effect=new a.Effect(this,c,me.ObjectSettings);me.game.add(this.effect,this.layer+20)},addBuff:function(){this.buff=new a.Buff(this,me.ObjectSettings);me.game.add(this.buff,this.layer);this.buff.alpha=1;var c=(new me.Tween(this.buff)).to({alpha:0},1E3).onComplete(function(){});c.chain((new me.Tween(this.buff)).to({alpha:1},1E3).onComplete(function(){}).chain(c));
c.start();me.game.sort()},shakeBoat:function(){for(var a=this.pos.x,b=this.pos.y,d=0;10>d;d++)9==d?(a=this.x,b=this.y):(a=Number.prototype.random(this.pos.x-10,this.pos.x+10),b=Number.prototype.random(this.pos.y-10,this.pos.y+10)),this.shakeTween[d]=(new me.Tween(this.pos)).to({x:a,y:b},100),0<d&&this.shakeTween[d-1].chain(this.shakeTween[d]);this.shakeTween[0].start()},fight:function(){},draw:function(c){this.addBoatName(c,this.boatName);""!=this.effectName&&(this.font||(this.font=new a.Font(c,this)),
this.font.drawFont(c));this.parent(c)}})})(btg);(function(a){a.PirateBoat=a.BoatBase.extend({init:function(a,b,d,e,f,g,h){this.cId=e;this.boatId=f;this.formationPosition=g;this.layer=h;this.parent(a,b,d);me.game.viewport.follow(this.pos,me.game.viewport.AXIS.BOTH)},update:function(){if(this.pos.y>me.game.currentLevel.realheight-200)return this.setVelocity(0,0),(new me.Tween(this.pos)).to({x:this.pos.x-60},1E3).onComplete(function(){loading.info.style.display="block";me.game.viewport.fadeIn("#000000",1E3,function(){a.mainPlayer.boatMode=!1;seaking.gotoLevel(2)})}).start(),
!1;this.parent(this)}})})(btg);(function(a){a.NpcEntity=me.ObjectEntity.extend({isNpc:!0,init:function(c,b,d){this.symbolImg=me.loader.getImage("symbol");this.symbol="questionMark";this.isHidden=!1;var e=d.name.replace("npc","");d.spritewidth=g_config.character[e].width;d.spriteheight=g_config.character[e].height;c=a.map.getIsometricTileId(c,b);c=a.map.getOrthogonalPosition(c.row,c.col);this.parent(c.x-d.spritewidth/2,c.y-d.spriteheight/2,d)},update:function(){this.parent(this)},draw:function(a){this.parent(a);""!=this.symbol&&
this.addSymbol(a)},addSymbol:function(a){a.drawImage(this.symbolImg,this.x,this.y)}})})(btg);(function(a){a.EnemyEntity=a.CharacterBase.extend({cId:0,init:function(a,b,d,e){this.cId=e;this.visible=!1;d.image="character"+e;d.spritewidth=g_config.pirateBoat[this.cId].width;d.spriteheight=g_config.pirateBoat[this.cId].height;this.parent(a,b,d)},update:function(){this.parent(this)}})})(btg);(function(a){a.EnemyBoat=a.BoatBase.extend({boatId:0,init:function(a,b,d,e,f,g,h){this.cId=e;this.boatId=f;this.formationPosition=g;this.layer=h;this.parent(a,b,d)},update:function(){this.parent(this)}})})(btg);(function(a){a.Formation=Object.extend({cId:0,formation_bg:null,type:{left:"mainPlayer",right:"enemy"},x:0,y:0,position:"left",formationBG:null,boats:{},buff:null,fightSceneX:0,fightSceneY:0,init:function(c,b,d,e){e&&(this.type=e);this.formation_bg=me.loader.getImage("fi_magic_bg");this.position=c;this.x="left"==c?b:b+this.formation_bg.width+g_config.formation.bg.marginLeft;this.boats={};this.y=d+g_config.formation.bg.top;this.fightSceneX=g_config.map.level[a.game.currentLevel].fightSceneX;this.fightSceneY=
g_config.map.level[a.game.currentLevel].fightSceneY;me.game.add(this,999)},createFormation:function(a,b){this.createBackground(b);"left"==this.position?this.addPirateBoat(a):this.addEnemyBoat(a)},createBackground:function(){this.formationBG=new me.SpriteObject(this.x,this.y,this.formation_bg,this.formation_bg.width,this.formation_bg.height);"left"==this.position&&this.formationBG.flipX(!0);me.game.add(this.formationBG,a.map.fightLayerZ)},addPirateBoat:function(c){for(var b=null,d=b=0;d<g_config.formation.positions.mainPlayer.length;d++)"object"==
typeof c[d]&&(b=c[d].pId,b=new a.PirateBoat(this.getBoatX("mainPlayer",d,b),this.getBoatY("mainPlayer",d,b),me.ObjectSettings,mainPlayer.cId,b,d,a.map.fightLayerZ),b.flipX(!0),this.boats["p"+d]=b,me.game.add(b,a.map.fightLayerZ+10))},addEnemyBoat:function(){for(var c=null,b=0;3>b;b++)cId=0,pId=b,c=new a.EnemyBoat(this.getBoatX("enemy",b,pId),this.getBoatY("enemy",b,pId),me.ObjectSettings,cId,pId,b,a.map.fightLayerZ),this.boats["p"+b]=c,me.game.add(c,a.map.fightLayerZ+10)},getBoatX:function(a,b,d){return this.formationBG.pos.x+
g_config.formation.positions[a][b].x-g_config.pirateBoat[d].width/2},getBoatY:function(a,b,d){return this.formationBG.pos.y+g_config.formation.positions[a][b].y-g_config.pirateBoat[d].height},registerEvent:function(){},update:function(){},draw:function(){}})})(btg);(function(a){a.Fight=me.ObjectEntity.extend({player:null,enemy:null,fightSceneX:0,fightSceneY:0,player_formation:null,enemy_formation:null,init:function(c,b){this.player=c;this.enemy=b;this.fightSceneX=g_config.map.level[a.game.currentLevel].fightSceneX;this.fightSceneY=g_config.map.level[a.game.currentLevel].fightSceneY;this.fpscount=0;this.animationspeed=6;this.animationpause=!1;this.currentFight={};this.attackSide="left";this.defenseSide="right";this.rightRound=this.leftRound=0;this.fightData=
[{attackSide:"left",attackData:{fId:0},defenseData:{fId:0}},{attackSide:"right",attackData:{fId:1},defenseData:{fId:1}},{attackSide:"left",attackData:{fId:2},defenseData:{fId:2}},{attackSide:"right",attackData:{fId:0},defenseData:{fId:0}},{attackSide:"left",attackData:{fId:1},defenseData:{fId:1}},{attackSide:"right",attackData:{fId:2},defenseData:{fId:2}},{attackSide:"left",attackData:{fId:0},defenseData:{fId:0}},{attackSide:"right",attackData:{fId:1},defenseData:{fId:1}},{attackSide:"left",attackData:{fId:2},
defenseData:{fId:2}}];this.createFormation(!1);me.game.add(this,999)},createFormation:function(c){var b;c?b=c=0:(c=me.game.viewport.pos.x,b=me.game.viewport.pos.y);this.player_formation=new a.Formation("left",c,b);this.player_formation.createFormation(this.player.formation);this.enemy_formation=new a.Formation("right",c,b);this.enemy_formation.createFormation(this.enemy);me.game.sort();me.game.viewport.reset(this.fightSceneX,this.fightSceneY)},update:function(){if(!a.game.isFight||null==this.fightData||
0==this.fightData.length)return!1;if(this.visible&&!this.animationpause&&this.fpscount++>this.animationspeed)return this.fpscount=0,this.currentFight=this.fightData.shift(),"left"==this.currentFight.attackSide?(this.attackSide=this.player_formation,this.defenseSide=this.enemy_formation,this.leftRound++,UI.fightScene.updateLeftRound(this.leftRound)):(this.attackSide=this.enemy_formation,this.defenseSide=this.player_formation,this.rightRound++,UI.fightScene.updateRightRound(this.rightRound)),this.attackSide.boats["p"+
this.currentFight.attackData.fId].addEffectName(20,"blue","\u653b\u51fb+20"),this.attackSide.boats["p"+this.currentFight.attackData.fId].addBuff(),this.defenseSide.boats["p"+this.currentFight.defenseData.fId].subLife(20),this.defenseSide.boats["p"+this.currentFight.defenseData.fId].addEffectName(20,"red","\u547d\u4e2d-10"),this.defenseSide.boats["p"+this.currentFight.defenseData.fId].addAnger(10),this.defenseSide.boats["p"+this.currentFight.defenseData.fId].shakeBoat(),this.defenseSide.boats["p"+
this.currentFight.defenseData.fId].addEffect("fire_001"),!0},removeAll:function(){},draw:function(){},fight:function(){}})})(btg);(function(a){a.ProgressEntity=me.ObjectEntity.extend({currentPosition:100,type:"life",bgImgName:"fi_life_bg",bgImg:null,leftImg:null,rightImg:null,centerImg:null,prefix:"fi_",suffix_left:"_left",suffix_center:"_center",suffix_right:"_right",x:0,y:0,anchor:0,paddingTop:3,paddingLeft:3,paddingRight:7,beginX:0,beginY:0,length:0,updated:!0,boat:null,percent:0,init:function(c,b,d){this.type=d;this.bgImg=me.loader.getImage(this.bgImgName);b.image=this.bgImgName;b.spritewidth=this.bgImg.width;b.spriteheight=
this.bgImg.height;this.leftImg=me.loader.getImage(this.prefix+this.type+this.suffix_left);this.rightImg=me.loader.getImage(this.prefix+this.type+this.suffix_right);this.centerImg=me.loader.getImage(this.prefix+this.type+this.suffix_center);this.x=c.pos.x+c.hWidth-g_config.map.level[a.game.currentLevel].fightSceneX;this.x-=this.bgImg.width/2;this.y=c.pos.y+c.marginTop-g_config.map.level[a.game.currentLevel].fightSceneY;this.length=this.bgImg.width-2*this.leftImg.width-2*this.paddingLeft;"anger"==this.type&&
(this.y+=this.bgImg.height);this.beginX=this.x+this.paddingLeft;this.beginY=this.y+this.paddingTop;this.boat=c;this.animationspeed=me.sys.fps/1},update:function(){"life"==this.type?this.percent=this.boat.currentLife/this.boat.life:(this.percent=this.boat.currentAnger/this.boat.fullAnger,1<=this.percent&&(this.percent=1));this.x=this.boat.pos.x+this.boat.hWidth-me.game.viewport.pos.x;this.y=this.boat.pos.y+this.boat.marginTop-me.game.viewport.pos.y;this.x-=this.bgImg.width/2;"anger"==this.type&&(this.y+=
this.bgImg.height);this.beginX=this.x+this.paddingLeft;this.beginY=this.y+this.paddingTop},draw:function(a){this.updated&&(a.save(),this.drawBackground(a),0!=this.percent&&(this.drawLeft(a),this.drawCenter(a),this.drawRight(a)),a.restore())},drawBackground:function(a){a.drawImage(this.bgImg,this.x,this.y)},drawLeft:function(a){a.drawImage(this.leftImg,this.beginX,this.beginY)},drawCenter:function(a){a.drawImage(this.centerImg,0,0,this.centerImg.width,this.centerImg.height,this.beginX+this.leftImg.width,
this.beginY,this.length*this.percent,this.centerImg.height)},drawRight:function(a){a.drawImage(this.rightImg,this.beginX+this.leftImg.width+this.length*this.percent,this.beginY)}})})(btg);(function(a){a.Buff=me.ObjectEntity.extend({cId:0,boatId:0,buffImg:null,buffImgName:null,suffix:"_buff",init:function(a,b){x=a.pos.x+a.hWidth;y=a.pos.y+a.marginTop;a.cId=0;this.buffImgName=a.cId+this.suffix;this.buffImg=me.loader.getImage(this.buffImgName);x-=2*this.buffImg.width;b.image=this.buffImgName;b.spritewidth=this.buffImg.width;b.spriteheight=this.buffImg.height;this.cId=a.cId;this.boatId=a.boatId;this.parent(x,y,b)},update:function(){this.parent(this)},draw:function(a){var b=a.globalAlpha;
a.globalAlpha=this.alpha;this.parent(a);a.globalAlpha=b}})})(btg);(function(a){a.MultipleImageLayer=Object.extend({ratio:1,init:function(a,b,d,e,f,g,h){this.name=a;this.images=[];for(a=0;a<g.length;a++)for(var i=0;i<g[a].length;i++)this.images.push({rect:{top:a*e,left:i*f,right:i*e+e,bottom:a*f+f},image:me.loader.getImage(g[a][i])});0===this.images.length&&console.log("melonJS: can't read images in MultipleImageLayer");this.imagewidth=e;this.imageheight=f;this.z=h;this.ratio=1;this.lastpos=me.game.viewport.pos.clone();this.offset=new me.Vector2d(0,0);this.width=
b?Math.min(me.game.viewport.width,b):me.game.viewport.width;this.height=d?Math.min(me.game.viewport.height,d):me.game.viewport.height;this.visible=!0;this.opacity=1},reset:function(){this.offset=this.viewport=this.lastpos=this.image=null},getOpacity:function(){return this.opacity},setOpacity:function(a){a&&(this.opacity=a.clamp(0,1))},update:function(){if(0!==this.ratio){var a=me.game.viewport.pos;if(!this.lastpos.equals(a))return this.offset=a.clone(),this.lastpos.setV(a),!0}return!1},draw:function(a){var b=
this.images;if(1>this.opacity){var d=a.globalAlpha;a.globalAlpha=this.opacity}for(var e=0,f=b.length;e<f;e++){var g=b[e].rect;me.game.viewport.overlaps(g)&&a.drawImage(b[e].image,g.left,g.top)}1>this.opacity&&(a.globalAlpha=d)}})})(btg);(function(a){a.Seaport=me.ObjectEntity.extend({id:1,newAngle:0,imgName:"seaport_001",img:null,init:function(c,b,d){this.img=me.loader.getImage(this.imgName);d.image?c={x:c,y:b}:(d.image=this.imgName,d.spritewidth=192,d.spriteheight=190,c=a.map.getIsometricTileId(c,b),c=a.map.getOrthogonalPosition(c.row,c.col));this.parent(c.x,c.y,d);a.map.playerLayerZ=d.z;this.initAnimation(c.x,c.y,d);a.game.currentMap.seaport=this},initAnimation:function(){this.setVelocity(1,1)},onCollision:function(){this.collidable=
!1},update:function(){this.newAngle+=20;360<this.newAngle&&(this.newAngle=0);this.parent(this);return!0},drawParticle:function(a){a.save();a.globalCompositeOperation="source-over";a.fillStyle="black";a.globalCompositeOperation="lighter";for(var b=0;b<this.particles.length;b++){var d=this.particles[b];a.beginPath();d.opacity=Math.round(100*(d.remaining_life/d.life))/100;var e=a.createRadialGradient(d.location.x,d.location.y,0,d.location.x,d.location.y,d.radius);e.addColorStop(0,"rgba("+d.r+", "+d.g+
", "+d.b+", "+d.opacity+")");e.addColorStop(0.5,"rgba("+d.r+", "+d.g+", "+d.b+", "+d.opacity+")");e.addColorStop(1,"rgba("+d.r+", "+d.g+", "+d.b+", 0)");a.fillStyle=e;a.arc(d.location.x,d.location.y,d.radius,2*Math.PI,!1);a.fill();d.remaining_life--;d.radius--;d.location.x+=d.speed.x;d.location.y+=d.speed.y;if(0>d.remaining_life||0>d.radius)this.particles[b]=new particle}a.restore()}})})(btg);
function particle(){var a={};this.speed={x:-2.5+5*Math.random(),y:-15+10*Math.random()};this.location=a.x&&a.y?{x:a.x,y:a.y}:{x:me.video.getWidth()/2,y:me.video.getHeight()/2};this.radius=10+20*Math.random();this.remaining_life=this.life=20+10*Math.random();this.r=Math.round(255*Math.random());this.g=Math.round(255*Math.random());this.b=Math.round(255*Math.random())};(function(a){a.Effect=me.ObjectEntity.extend({id:0,effectName:"fire_001",effectImg:null,boat:null,init:function(a,b,d){x=a.pos.x+a.hWidth;y=a.pos.y+a.marginTop;this.effectName=b;d.image=this.effectName;d.spritewidth=192;d.spriteheight=190;x-=d.spritewidth/2;this.boat=a;this.parent(x,y,d);this.initAnimation(x,y,d)},initAnimation:function(){this.setVelocity(1,1)},onCollision:function(){this.collidable=!1},update:function(){this.parent(this);return!0}})})(btg);(function(a){a.Font=Object.extend({id:0,type:1,fontName:"\u5fae\u8f6f\u96c5\u9ed1 bold",fontSize:"14",fontColor:"white",font:null,fontImgName:"",fontImg:null,text:"",x:0,y:0,alpha:1,container:null,init:function(c,b){this.fontName=b.fontName;this.fontSize=b.fontSize;this.fontColor=b.fontColor;this.font=new me.Font(this.fontName,this.fontSize,this.fontColor);var d=this.font.measureText(c,b.effectName),d=a.getScreenXY(new me.Vector2d(b.pos.x+b.hWidth-d.width/2,b.pos.y-d.height));this.x=d.x;this.y=d.y;
this.container=b;this.text=b.effectName;(new me.Tween(this)).to({y:this.y-50,alpha:0},3E3).onComplete(function(){b.effectName=""}).start()},measureText:function(){},update:function(){},draw:function(a){this.drawFont(a)},drawFont:function(a){a.globalAlpha=this.alpha;this.font.draw(a,this.text,this.x,this.y);a.globalAlpha=1}})})(btg);(function(a){a.Click=me.ObjectEntity.extend({id:0,init:function(a,b,d,e){x=b.x;y=b.y;e?this.effectName=e.image:(this.effectName="click_000",e={},e.image=this.effectName,e.spritewidth=64,e.spriteheight=128);(this.canWalk=d)?(y-=e.spriteheight-40,x-=e.spritewidth/2):(x-=e.spritewidth/2,y+=e.spriteheight/2);this.parent(x,y,e);this.initAnimation(x,y,e)},initAnimation:function(){this.animationspeed=1},onCollision:function(){this.collidable=!1},update:function(){if(this.current.idx==this.spritecount.x-
1)return me.game.remove(this),me.game.sort(),!1;this.parent(this);return!0}})})(btg);btg.ui=btg.ui||{};
(function(a){a.BackGround=me.SpriteObject.extend({init:function(a){this.image=me.loader.getImage(a);y=x=0;this.parent(x,y,this.image)},draw:function(a){me.video.clearSurface(a,"black");this.parent(a)}});a.Button=me.SpriteObject.extend({init:function(a,b,d,e){this.imageName=d;for(var f in e)this[f]=e[f];this.image=me.loader.getImage(this.imageName);this.parent(a,b,this.image);me.input.registerMouseEvent("mousedown",this,this._mousedown.bind(this));me.input.registerMouseEvent("mouseup",this,this._mouseup.bind(this))},
_click:function(){return this.click?(this.click(),!0):!1},_mousedown:function(){this.image=me.loader.getImage(this.imageName+"_h");me.game.sort()},_mousemove:function(){},_mouseup:function(a){this.image=me.loader.getImage(this.imageName);me.game.sort();this._click(a);return!1}});a.Character=me.SpriteObject.extend({init:function(a,b,d,e,f){this.imageName=d;for(var g in f)this[g]=f[g];this.image=me.loader.getImage(this.imageName);this.cId="boy"==this.imageName?1:0;this.x=a;this.y=b;this.selectOffset=
e;this.parent(a,b,this.image);me.input.registerMouseEvent("mousedown",this,this._mousedown.bind(this));me.input.registerMouseEvent("mouseup",this,this._mouseup.bind(this))},_click:function(){return this.click?(this.click(),!0):!1},_mousedown:function(){},_mousemove:function(){},_mouseup:function(a){if(""==me.gamestat.getItemValue("chooseCharacter")||me.gamestat.getItemValue("chooseCharacter").imageName!=this.imageName)this.pos.x+=this.selectOffset.x,this.pos.y+=this.selectOffset.y,""!=me.gamestat.getItemValue("chooseCharacter")&&
(me.gamestat.getItemValue("chooseCharacter").pos.x=me.gamestat.getItemValue("chooseCharacter").x,me.gamestat.getItemValue("chooseCharacter").pos.y=me.gamestat.getItemValue("chooseCharacter").y),btg.character.cId=this.cId,me.gamestat.setValue("chooseCharacter",this);this._click(a);return!1}});a.MoveableEntity=me.AnimationSheet.extend({init:function(a,b,d,e,f){"string"==typeof d&&(d=me.loader.getImage(d));this.parent(a,b,d,e,f);me.input.registerMouseEvent("mousedown",this,this.mouseDown.bind(this));
me.input.registerMouseEvent("mouseup",this,this.mouseUp.bind(this));me.input.registerMouseEvent("mousemove",null,this.mouseMove.bind(this))},mouseUp:function(){this.mDown=!1;me.sys.touch&&this.mouseout()},mouseDown:function(){this.mDown=!0;me.sys.touch&&(mX=me.input.mouse.pos.x,mY=me.input.mouse.pos.y);this.v=new me.Vector2d(mX-this.left,mY-this.top);return!1},mouseMove:function(){mX=me.input.mouse.pos.x;mY=me.input.mouse.pos.y;return this.mDown?(this.pos.x=mX-this.v.x,this.pos.y=mY-this.v.y,!1):
!0}});a.mainScene=me.HUD_Item.extend({leftTop:null,leftBottom:null,rightTop:null,init:function(a,b){this.parent(a,b);this.leftTop=[];this.leftBottom=[];this.rightTop=[]},draw:function(){}});a.path=me.HUD_Item.extend({init:function(a,b,d){this.parent(a,b);this.x=a;this.y=b;this.path=[].concat(d)},draw:function(a){var b=me.game.viewport.pos,d=this.path;a.save();a.beginPath();a.lineWidth=4;a.strokeStyle="red";a.moveTo(d[0].x-b.x,d[0].y-b.y);for(var e=1;e<d.length;e++)a.lineTo(d[e].x-b.x,d[e].y-b.y);
a.stroke();a.restore()}});a.polygonShape=me.ObjectEntity.extend({init:function(a,b,d,e){this.polygonV=e},update:function(){return!0},draw:function(){}});a.rect=me.HUD_Item.extend({init:function(a,b,d,e,f,g){this.parent(a,b);this.x=a;this.y=b;this.width=d;this.height=e;this.sideLength=Math.round(Math.sqrt(Math.pow(this.width,2)+Math.pow(this.height,2)));this.path=f;this.type=g},draw:function(a){this.drawPath(a)},drawPath:function(a){a.save();a.translate(this.x,this.y);a.fillStyle="black";a.fillText("orthogonal x:"+
(me.game.viewport.pos.x+this.x)+" y:"+(me.game.viewport.pos.y+this.y),-43,0);var b=0,b=me.game.viewport.pos.x+this.x-me.game.currentLevel.realwidth/2;a.fillText("isometric x:"+b+" y:"+(me.game.viewport.pos.y+this.y-me.game.currentLevel.tileheight/2),-43,10);a.fillText("ort_tiled x:"+Math.floor((me.game.viewport.pos.y+this.y)/me.game.currentLevel.tileheight)+" y:"+Math.floor((me.game.viewport.pos.x+this.x)/me.game.currentLevel.tilewidth),-43,20);a.fillText("iso_tiled x:"+Math.floor((me.game.viewport.pos.y+
this.y-me.game.currentLevel.tileheight/2)/(me.game.currentLevel.tileheight/2))+" y:"+Math.floor(b/(me.game.currentLevel.tilewidth/2)),-43,30);a.fillStyle="green";a.globalAlpha=0.6;a.scale(1,0.5);a.rotate(45*Math.PI/180);a.fillRect(0,0,this.sideLength/2,this.sideLength/2);a.globalAlpha=0.2;a.fillStyle="yellow";a.restore();a.save();if(0<this.path.length){var b=null,d=btg.mainPlayer.pos.x-me.game.viewport.pos.x+btg.mainPlayer.width/2,e=btg.mainPlayer.pos.y-me.game.viewport.pos.y+btg.mainPlayer.height;
a.translate(d,e);a.beginPath();a.strokeStyle="#000000";a.arc(0,0,5,0,2*Math.PI);for(var f=0;f<this.path.length;f++)b=1==this.type?convertToOrthogonalPixel(this.path[f].pos.x,this.path[f].pos.y,1):btg.map.isometricGridXY[this.path[f].pos.x][this.path[f].pos.y].orthogonal,a.lineTo(b.x-20-me.game.viewport.pos.x+btg.mainPlayer.width/2-d,b.y+20-me.game.viewport.pos.y+btg.mainPlayer.height-e),a.arc(b.x-20-me.game.viewport.pos.x+btg.mainPlayer.width/2-d,b.y+20-me.game.viewport.pos.y+btg.mainPlayer.height-
e,5,0,2*Math.PI);a.stroke()}a.restore()}});a.loading=me.HUD_Item.extend({allcount:0,count:0,init:function(){this.leftImg;this.loadingImg;this.rightImg},draw:function(){}})})(btg.ui);window.onReady(function(){me.sys.fps=60;seaking.onload()});var smartlib=window.smartlib||{};
(function(a){a.ui={};a.getDom=function(a){try{return document.getElementById(a)}catch(b){return document.all[a]}};a.interFace=function(){var a=this.clone(arguments[0])||{},b=1,d=arguments.length,e=!1,f;"boolean"===typeof a&&(e=a,a=arguments[1]||{},b=2);"object"!==typeof a&&(a={});d==b&&(a=this,--b);for(;b<d;b++)if(null!=(f=arguments[b]))for(var g in f){var h=a[g],i=f[g];a!==i&&(e&&i&&"object"===typeof i&&!i.nodeType?a[g]=this.objExtend(e,h||(null!=i.length?[]:{}),i):void 0!==i&&(a[g]=i))}return a};
a.extend=function(a,b,d){d=d||{};if(b){var e=function(){};e.prototype=b.prototype;a.prototype=new e;a.prototype.constructor=a;a.prototype.superClass=b.prototype;e=null}for(var f in d)a.prototype[f]=d[f];d=null;return a};a.clone=function(a){var b=a||[];if("object"==typeof b)if(void 0!=b.length)for(var a=[],d=0,e=b.length;d<e;d++)void 0!==b[d]&&(a[d]=null!=b[d]&&"object"==typeof b[d]?void 0!=b[d].length?b[d].slice(0):b[d]:b[d]);else for(d in a={},b)void 0!==b[d]&&(a[d]=null!=b[d]&&"object"==typeof b[d]?
void 0!=b[d].length?b[d].slice(0):b[d]:b[d]);return a}})(smartlib);(function(a){a.ui.core=function(a,b,d,e,f,g){this.id=a;this.x=b;this.y=d;this.width=e;this.height=f;this.hided=g};a.ui.core.prototype={makeDom:function(a,b,d,e){var b=b||{},d=d||{},e=e||{},a=document.createElement(a),f;d.width&&0<=d.width.indexOf("%")&&(d.width=d.width.replace("px",""));d.height&&0<=d.height.indexOf("auto")&&(d.height=d.height.replace("px",""));for(f in b)a[f]=b[f];for(f in d)a.style[f]=d[f];for(f in e)a["on"+f]=e[f];a.style["float"]&&(a.style.cssFloat=a.style["float"],a.style.styleFloat=
a.style["float"]);d.radius&&(f=d.radius+"px",a.style.WebkitBorderRadius=f,a.style.MozBorderRadius=f,a.style.MsBorderRadius=f,a.style.OBorderRadius=f,a.style.BorderRadius=f,a.style.borderRadius=f);return a},makeFrame:function(c){var c=a.interFace({id:"",width:600,height:400,x:0,y:0,bgColor:"#F9ECC2",bgStyle:"frameStyle",hided:!1,clips:[],background:"",backgroundSize:"",zIndex:0},c),b;b=this.makeDom("div",{attr:"id",value:c.id},{position:"absolute",left:c.x+"px",top:c.y+"px",width:c.width+"px",height:c.height+
"px",background:c.background,backgroundSize:c.backgroundSize,backgroundColor:c.bgColor,display:c.hided?"none":"block",zIndex:c.zIndex},null);this.setFrameBG(b,c.clips,c.width,c.height);_son$tyles=null;return b},setFrameBG:function(a,b,d,e){if(a&&b&&9<=b.length){b[1].w=parseInt(d-b[0].w-b[2].w);1>b[1].w&&(b[1].w=1);b[7].w=b[1].w;b[3].h=parseInt(e-b[0].h-b[6].h);1>b[3].h&&(b[3].h=1);b[5].h=b[3].h;b[4].w=b[1].w;b[4].h=b[3].h;for(var d=[],e=["0 0",b[0].w+"px 0",b[0].w+b[1].w+"px 0","0 "+b[0].h+"px",b[0].w+
"px "+b[0].h+"px",b[0].w+b[1].w+"px "+b[2].h+"px","0 "+(b[0].h+b[3].h)+"px",b[0].w+"px "+(b[0].h+b[3].h)+"px",b[0].w+b[1].w+"px "+(b[0].h+b[3].h)+"px"],f=[],g=[],h=0,i;i=b[h];h++)d.push("url("+i.bg+")"),f.push(i.w+"px "+i.h+"px"),g.push("no-repeat");a.style.backgroundImage=d.join(",");a.style.backgroundPosition=e.join(",");a.style.backgroundSize=f.join(",");a.style.backgroundRepeat=g.join(",")}},append:function(a){if(!a)return this;this.dom.appendChild(a);return this},appendTo:function(c){("body"==
c?document.body:a.getDom(c)).appendChild(this.dom);return this}}})(smartlib);(function(a){a.ui.window=function(c){c=a.interFace({id:"",width:400,height:400,context:null,fontSize:"14px",color:"#FFF",textShadow:"",titleHeight:30,title:"\u7a97\u4f53",x:-1,y:-1,items:[],hided:!1,showTool:!0,padding:20,bgColor:"",block:!1,blockClick:!1,blockColor:"rgba(0, 0, 0, 0.2)",clips:[],background:"",backgroundSize:"",closeBtnUi:{bg:"",width:20,height:20,value:"",sx:0,sy:0,hx:20,hy:0,dx:0,dy:0},closed:function(){},data:null,zIndex:1E3,html:"",scroll:"auto",parentNode:null},c||{});a.ui.core.call(this,
c.id,c.x,c.y,c.width,c.height,c.hided);this.block=c.block;this.blockContext=null;this.data=c.data;this.parentNode=c.parentNode;var b=this;this.block&&(this.blockContext=document.createElement("div"),this.blockContext.style.position="absolute",this.blockContext.style.left="0px",this.blockContext.style.top="0px",this.blockContext.style.width=window.sceneSize.width+"px",this.blockContext.style.height=window.sceneSize.height+"px",this.blockContext.style.backgroundColor=c.blockColor,this.blockContext.style.zIndex=
c.zIndex,this.blockContext.style.display=this.hided?"none":"block",c.blockClick&&(this.blockContext.closeBtn=this.closeBtn,this.blockContext.onmouseup=function(){b.destroy()},this.blockContext.ontouchend=this.blockContext.onmouseup),null!=c.parentNode?c.parentNode.appendChild(this.blockContext):document.body.appendChild(this.blockContext));this.closed=c.closed;this.html=c.html;this.type="window";0>this.x&&(this.x=parseInt(parseInt(window.sceneSize.width)-this.width>>1),0>this.x&&(this.x=0));0>this.y&&
(this.y=parseInt(parseInt(window.sceneSize.height)-this.height>>1),0>this.y&&(this.y=0));this.dom=this.makeFrame({width:this.width,height:this.height,x:this.x,y:this.y,bgColor:c.bgColor,bgStyle:c.bgStyle,clips:c.clips,background:c.background,backgroundSize:c.backgroundSize,hided:!1,color:c.color,zIndex:c.zIndex});this.dom.appendChild(this.makeDom("div",{innerHTML:this.html},{position:"absolute",left:c.padding+"px",top:c.padding+c.titleHeight+"px",width:this.width-2*c.padding+"px",height:this.height-
c.titleHeight-2*c.padding+"px",padding:"0px",color:c.color,overflowY:c.scroll,overflowX:"hidden",WebkitOverflowScrolling:"hidden"==c.scroll?"hidden":"touch"},null));this.dom.appendChild(this.makeDom("div",{innerHTML:c.title},{position:"absolute",left:"0px",top:"0px",width:this.width-2*c.padding+"px",height:c.titleHeight+"px",lineHeight:c.titleHeight+"px",padding:c.padding+"px",color:c.color,zIndex:c.zIndex},null));var d="";""!=c.closeBtnUi.bg&&(d="url("+c.closeBtnUi.bg+") -"+c.closeBtnUi.sx+"px -"+
c.closeBtnUi.sy+"px");this.dom.appendChild(this.makeDom("input",{type:"button",value:c.closeBtnUi.value||""},{position:"absolute",left:this.width-c.closeBtnUi.width+c.closeBtnUi.dx+"px",top:c.closeBtnUi.dy+"px",background:d,border:"0px",width:c.closeBtnUi.width+"px",height:c.closeBtnUi.height+"px",zIndex:c.zIndex,display:c.showTool?"block":"none"},{click:function(){b.destroy()}}));d=null;null!=c.parentNode?c.parentNode.appendChild(this.dom):document.body.appendChild(this.dom);c=null};a.extend(a.ui.window,
a.ui.core,{destroy:function(){this.dom&&(a.ui.window.beforeClosed&&a.ui.window.beforeClosed(),this.blockContext&&(null!=this.parentNode?this.parentNode.removeChild(this.blockContext):document.body.removeChild(this.blockContext)),this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.dom=null,this.closed&&this.closed(),a.ui.window.afterClosed&&a.ui.window.afterClosed());return this}});a.ui.window.beforeClosed=null;a.ui.window.afterClosed=null})(smartlib);(function(a,c){function b(a){if(""===f)return a;a=a.charAt(0).toUpperCase()+a.substr(1);return f+a}var d=Math,e=c.createElement("div").style,f;a:{for(var g=["t","webkitT","MozT","msT","OT"],h,i=0,j=g.length;i<j;i++)if(h=g[i]+"ransform",h in e){f=g[i].substr(0,g[i].length-1);break a}f=!1}var k=f?"-"+f.toLowerCase()+"-":"",n=b("transform"),u=b("transitionProperty"),m=b("transitionDuration"),r=b("transformOrigin"),v=b("transitionTimingFunction"),l=b("transitionDelay"),w=/android/gi.test(navigator.appVersion),
s=/iphone|ipad/gi.test(navigator.appVersion),g=/hp-tablet/gi.test(navigator.appVersion),D=b("perspective")in e,t="ontouchstart"in a&&!g,z=!!f,E=b("transition")in e,L="onorientationchange"in a?"orientationchange":"resize",K=t?"touchstart":"mousedown",I=t?"touchmove":"mousemove",J=t?"touchend":"mouseup",F=t?"touchcancel":"mouseup",H="Moz"==f?"DOMMouseScroll":"mousewheel",q;q=!1===f?!1:{"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"oTransitionEnd",ms:"MSTransitionEnd"}[f];var C=
a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(a){return setTimeout(a,1)},G=a.cancelRequestAnimationFrame||a.webkitCancelAnimationFrame||a.webkitCancelRequestAnimationFrame||a.mozCancelRequestAnimationFrame||a.oCancelRequestAnimationFrame||a.msCancelRequestAnimationFrame||clearTimeout,B=D?" translateZ(0)":"",g=function(d,b){var e=this,f;e.wrapper="object"==typeof d?d:c.getElementById(d);e.wrapper.style.overflow=
"hidden";e.scroller=e.wrapper.children[0];e.options={hScroll:!0,vScroll:!0,x:0,y:0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,topOffset:0,checkDOMChanges:!1,handleClick:!0,hScrollbar:!0,vScrollbar:!0,fixedScrollbar:w,hideScrollbar:s,fadeScrollbar:s&&D,scrollbarClass:"",zoom:!1,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",snap:!1,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(a){a.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,
onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(f in b)e.options[f]=b[f];e.x=e.options.x;e.y=e.options.y;e.options.useTransform=z&&e.options.useTransform;e.options.hScrollbar=e.options.hScroll&&e.options.hScrollbar;e.options.vScrollbar=e.options.vScroll&&e.options.vScrollbar;e.options.zoom=e.options.useTransform&&e.options.zoom;e.options.useTransition=E&&e.options.useTransition;e.options.zoom&&w&&(B="");e.scroller.style[u]=
e.options.useTransform?k+"transform":"top left";e.scroller.style[m]="0";e.scroller.style[r]="0 0";e.options.useTransition&&(e.scroller.style[v]="cubic-bezier(0.33,0.66,0.66,1)");e.options.useTransform?e.scroller.style[n]="translate("+e.x+"px,"+e.y+"px)"+B:e.scroller.style.cssText+=";position:absolute;top:"+e.y+"px;left:"+e.x+"px";e.options.useTransition&&(e.options.fixedScrollbar=!0);e.refresh();e._bind(L,a);e._bind(K);t||(e._bind("mouseout",e.wrapper),"none"!=e.options.wheelAction&&e._bind(H));e.options.checkDOMChanges&&
(e.checkDOMTime=setInterval(function(){e._checkDOMChanges()},500))};g.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(a){switch(a.type){case K:if(!t&&0!==a.button)break;this._start(a);break;case I:this._move(a);break;case J:case F:this._end(a);break;case L:this._resize();break;case H:this._wheel(a);break;case "mouseout":this._mouseout(a);break;case q:this._transitionEnd(a)}},_checkDOMChanges:function(){!this.moved&&
(!this.zoomed&&!(this.animating||this.scrollerW==this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale))&&this.refresh()},_scrollbar:function(a){var b;this[a+"Scrollbar"]?(this[a+"ScrollbarWrapper"]||(b=c.createElement("div"),this.options.scrollbarClass?b.className=this.options.scrollbarClass+a.toUpperCase():b.style.cssText="position:absolute;z-index:100;"+("h"==a?"height:7px;bottom:1px;left:2px;right:"+(this.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(this.hScrollbar?
"7":"2")+"px;top:2px;right:1px"),b.style.cssText+=";pointer-events:none;"+k+"transition-property:opacity;"+k+"transition-duration:"+(this.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(this.options.hideScrollbar?"0":"1"),this.wrapper.appendChild(b),this[a+"ScrollbarWrapper"]=b,b=c.createElement("div"),this.options.scrollbarClass||(b.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);"+k+"background-clip:padding-box;"+k+"box-sizing:border-box;"+
("h"==a?"height:100%":"width:100%")+";"+k+"border-radius:3px;border-radius:3px"),b.style.cssText+=";pointer-events:none;"+k+"transition-property:"+k+"transform;"+k+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);"+k+"transition-duration:0;"+k+"transform: translate(0,0)"+B,this.options.useTransition&&(b.style.cssText+=";"+k+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)"),this[a+"ScrollbarWrapper"].appendChild(b),this[a+"ScrollbarIndicator"]=b),"h"==a?(this.hScrollbarSize=this.hScrollbarWrapper.clientWidth,
this.hScrollbarIndicatorSize=d.max(d.round(this.hScrollbarSize*this.hScrollbarSize/this.scrollerW),8),this.hScrollbarIndicator.style.width=this.hScrollbarIndicatorSize+"px",this.hScrollbarMaxScroll=this.hScrollbarSize-this.hScrollbarIndicatorSize,this.hScrollbarProp=this.hScrollbarMaxScroll/this.maxScrollX):(this.vScrollbarSize=this.vScrollbarWrapper.clientHeight,this.vScrollbarIndicatorSize=d.max(d.round(this.vScrollbarSize*this.vScrollbarSize/this.scrollerH),8),this.vScrollbarIndicator.style.height=
this.vScrollbarIndicatorSize+"px",this.vScrollbarMaxScroll=this.vScrollbarSize-this.vScrollbarIndicatorSize,this.vScrollbarProp=this.vScrollbarMaxScroll/this.maxScrollY),this._scrollbarPos(a,!0)):this[a+"ScrollbarWrapper"]&&(z&&(this[a+"ScrollbarIndicator"].style[n]=""),this[a+"ScrollbarWrapper"].parentNode.removeChild(this[a+"ScrollbarWrapper"]),this[a+"ScrollbarWrapper"]=null,this[a+"ScrollbarIndicator"]=null)},_resize:function(){var a=this;setTimeout(function(){a.refresh()},w?200:0)},_pos:function(a,
b){this.zoomed||(a=this.hScroll?a:0,b=this.vScroll?b:0,this.options.useTransform?this.scroller.style[n]="translate("+a+"px,"+b+"px) scale("+this.scale+")"+B:(a=d.round(a),b=d.round(b),this.scroller.style.left=a+"px",this.scroller.style.top=b+"px"),this.x=a,this.y=b,this._scrollbarPos("h"),this._scrollbarPos("v"))},_scrollbarPos:function(a,b){var c="h"==a?this.x:this.y;this[a+"Scrollbar"]&&(c*=this[a+"ScrollbarProp"],0>c?(this.options.fixedScrollbar||(c=this[a+"ScrollbarIndicatorSize"]+d.round(3*c),
8>c&&(c=8),this[a+"ScrollbarIndicator"].style["h"==a?"width":"height"]=c+"px"),c=0):c>this[a+"ScrollbarMaxScroll"]&&(this.options.fixedScrollbar?c=this[a+"ScrollbarMaxScroll"]:(c=this[a+"ScrollbarIndicatorSize"]-d.round(3*(c-this[a+"ScrollbarMaxScroll"])),8>c&&(c=8),this[a+"ScrollbarIndicator"].style["h"==a?"width":"height"]=c+"px",c=this[a+"ScrollbarMaxScroll"]+(this[a+"ScrollbarIndicatorSize"]-c))),this[a+"ScrollbarWrapper"].style[l]="0",this[a+"ScrollbarWrapper"].style.opacity=b&&this.options.hideScrollbar?
"0":"1",this[a+"ScrollbarIndicator"].style[n]="translate("+("h"==a?c+"px,0)":"0,"+c+"px)")+B)},_start:function(a){var b=t?a.touches[0]:a,c,e;if(this.enabled){this.options.onBeforeScrollStart&&this.options.onBeforeScrollStart.call(this,a);(this.options.useTransition||this.options.zoom)&&this._transitionTime(0);this.zoomed=this.animating=this.moved=!1;this.dirY=this.dirX=this.absDistY=this.absDistX=this.distY=this.distX=0;this.options.zoom&&(t&&1<a.touches.length)&&(e=d.abs(a.touches[0].pageX-a.touches[1].pageX),
c=d.abs(a.touches[0].pageY-a.touches[1].pageY),this.touchesDistStart=d.sqrt(e*e+c*c),this.originX=d.abs(a.touches[0].pageX+a.touches[1].pageX-2*this.wrapperOffsetLeft)/2-this.x,this.originY=d.abs(a.touches[0].pageY+a.touches[1].pageY-2*this.wrapperOffsetTop)/2-this.y,this.options.onZoomStart&&this.options.onZoomStart.call(this,a));if(this.options.momentum&&(this.options.useTransform?(c=getComputedStyle(this.scroller,null)[n].replace(/[^0-9\-.,]/g,"").split(","),e=1*c[4],c=1*c[5]):(e=1*getComputedStyle(this.scroller,
null).left.replace(/[^0-9-]/g,""),c=1*getComputedStyle(this.scroller,null).top.replace(/[^0-9-]/g,"")),e!=this.x||c!=this.y))this.options.useTransition?this._unbind(q):G(this.aniTime),this.steps=[],this._pos(e,c);this.absStartX=this.x;this.absStartY=this.y;this.startX=this.x;this.startY=this.y;this.pointX=b.pageX;this.pointY=b.pageY;this.startTime=a.timeStamp||Date.now();this.options.onScrollStart&&this.options.onScrollStart.call(this,a);this._bind(I);this._bind(J);this._bind(F)}},_move:function(a){var b=
t?a.touches[0]:a,c=b.pageX-this.pointX,e=b.pageY-this.pointY,f=this.x+c,g=this.y+e,h=a.timeStamp||Date.now();this.options.onBeforeScrollMove&&this.options.onBeforeScrollMove.call(this,a);if(this.options.zoom&&t&&1<a.touches.length)f=d.abs(a.touches[0].pageX-a.touches[1].pageX),g=d.abs(a.touches[0].pageY-a.touches[1].pageY),this.touchesDist=d.sqrt(f*f+g*g),this.zoomed=!0,b=1/this.touchesDistStart*this.touchesDist*this.scale,b<this.options.zoomMin?b=0.5*this.options.zoomMin*Math.pow(2,b/this.options.zoomMin):
b>this.options.zoomMax&&(b=2*this.options.zoomMax*Math.pow(0.5,this.options.zoomMax/b)),this.lastScale=b/this.scale,f=this.originX-this.originX*this.lastScale+this.x,g=this.originY-this.originY*this.lastScale+this.y,this.scroller.style[n]="translate("+f+"px,"+g+"px) scale("+b+")"+B,this.options.onZoom&&this.options.onZoom.call(this,a);else{this.pointX=b.pageX;this.pointY=b.pageY;if(0<f||f<this.maxScrollX)f=this.options.bounce?this.x+c/2:0<=f||0<=this.maxScrollX?0:this.maxScrollX;if(g>this.minScrollY||
g<this.maxScrollY)g=this.options.bounce?this.y+e/2:g>=this.minScrollY||0<=this.maxScrollY?this.minScrollY:this.maxScrollY;this.distX+=c;this.distY+=e;this.absDistX=d.abs(this.distX);this.absDistY=d.abs(this.distY);6>this.absDistX&&6>this.absDistY||(this.options.lockDirection&&(this.absDistX>this.absDistY+5?(g=this.y,e=0):this.absDistY>this.absDistX+5&&(f=this.x,c=0)),this.moved=!0,this._pos(f,g),this.dirX=0<c?-1:0>c?1:0,this.dirY=0<e?-1:0>e?1:0,300<h-this.startTime&&(this.startTime=h,this.startX=
this.x,this.startY=this.y),this.options.onScrollMove&&this.options.onScrollMove.call(this,a))}},_end:function(a){if(!(t&&0!==a.touches.length)){var b=this,e=t?a.changedTouches[0]:a,f,g,h={dist:0,time:0},i={dist:0,time:0},j=(a.timeStamp||Date.now())-b.startTime,k=b.x,l=b.y;b._unbind(I);b._unbind(J);b._unbind(F);b.options.onBeforeScrollEnd&&b.options.onBeforeScrollEnd.call(b,a);if(b.zoomed)k=b.scale*b.lastScale,k=Math.max(b.options.zoomMin,k),k=Math.min(b.options.zoomMax,k),b.lastScale=k/b.scale,b.scale=
k,b.x=b.originX-b.originX*b.lastScale+b.x,b.y=b.originY-b.originY*b.lastScale+b.y,b.scroller.style[m]="200ms",b.scroller.style[n]="translate("+b.x+"px,"+b.y+"px) scale("+b.scale+")"+B,b.zoomed=!1,b.refresh(),b.options.onZoomEnd&&b.options.onZoomEnd.call(b,a);else{if(b.moved){if(300>j&&b.options.momentum){h=k?b._momentum(k-b.startX,j,-b.x,b.scrollerW-b.wrapperW+b.x,b.options.bounce?b.wrapperW:0):h;i=l?b._momentum(l-b.startY,j,-b.y,0>b.maxScrollY?b.scrollerH-b.wrapperH+b.y-b.minScrollY:0,b.options.bounce?
b.wrapperH:0):i;k=b.x+h.dist;l=b.y+i.dist;if(0<b.x&&0<k||b.x<b.maxScrollX&&k<b.maxScrollX)h={dist:0,time:0};if(b.y>b.minScrollY&&l>b.minScrollY||b.y<b.maxScrollY&&l<b.maxScrollY)i={dist:0,time:0}}h.dist||i.dist?(h=d.max(d.max(h.time,i.time),10),b.options.snap&&(i=k-b.absStartX,j=l-b.absStartY,d.abs(i)<b.options.snapThreshold&&d.abs(j)<b.options.snapThreshold?b.scrollTo(b.absStartX,b.absStartY,200):(i=b._snap(k,l),k=i.x,l=i.y,h=d.max(i.time,h))),b.scrollTo(d.round(k),d.round(l),h)):b.options.snap?
(i=k-b.absStartX,j=l-b.absStartY,d.abs(i)<b.options.snapThreshold&&d.abs(j)<b.options.snapThreshold?b.scrollTo(b.absStartX,b.absStartY,200):(i=b._snap(b.x,b.y),(i.x!=b.x||i.y!=b.y)&&b.scrollTo(i.x,i.y,i.time))):b._resetPos(200)}else t&&(b.doubleTapTimer&&b.options.zoom?(clearTimeout(b.doubleTapTimer),b.doubleTapTimer=null,b.options.onZoomStart&&b.options.onZoomStart.call(b,a),b.zoom(b.pointX,b.pointY,1==b.scale?b.options.doubleTapZoom:1),b.options.onZoomEnd&&setTimeout(function(){b.options.onZoomEnd.call(b,
a)},200)):this.options.handleClick&&(b.doubleTapTimer=setTimeout(function(){b.doubleTapTimer=null;for(f=e.target;1!=f.nodeType;)f=f.parentNode;"SELECT"!=f.tagName&&("INPUT"!=f.tagName&&"TEXTAREA"!=f.tagName)&&(g=c.createEvent("MouseEvents"),g.initMouseEvent("click",!0,!0,a.view,1,e.screenX,e.screenY,e.clientX,e.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,0,null),g._fake=!0,f.dispatchEvent(g))},b.options.zoom?250:0))),b._resetPos(200);b.options.onTouchEnd&&b.options.onTouchEnd.call(b,a)}}},_resetPos:function(a){var b=
0<=this.x?0:this.x<this.maxScrollX?this.maxScrollX:this.x,d=this.y>=this.minScrollY||0<this.maxScrollY?this.minScrollY:this.y<this.maxScrollY?this.maxScrollY:this.y;b==this.x&&d==this.y?(this.moved&&(this.moved=!1,this.options.onScrollEnd&&this.options.onScrollEnd.call(this)),this.hScrollbar&&this.options.hideScrollbar&&("webkit"==f&&(this.hScrollbarWrapper.style[l]="300ms"),this.hScrollbarWrapper.style.opacity="0"),this.vScrollbar&&this.options.hideScrollbar&&("webkit"==f&&(this.vScrollbarWrapper.style[l]=
"300ms"),this.vScrollbarWrapper.style.opacity="0")):this.scrollTo(b,d,a||0)},_wheel:function(a){var b=this,d,c;if("wheelDeltaX"in a)d=a.wheelDeltaX/12,c=a.wheelDeltaY/12;else if("wheelDelta"in a)d=c=a.wheelDelta/12;else if("detail"in a)d=c=3*-a.detail;else return;"zoom"==b.options.wheelAction?(c=b.scale*Math.pow(2,1/3*(c?c/Math.abs(c):0)),c<b.options.zoomMin&&(c=b.options.zoomMin),c>b.options.zoomMax&&(c=b.options.zoomMax),c!=b.scale&&(!b.wheelZoomCount&&b.options.onZoomStart&&b.options.onZoomStart.call(b,
a),b.wheelZoomCount++,b.zoom(a.pageX,a.pageY,c,400),setTimeout(function(){b.wheelZoomCount--;!b.wheelZoomCount&&b.options.onZoomEnd&&b.options.onZoomEnd.call(b,a)},400))):(d=b.x+d,c=b.y+c,0<d?d=0:d<b.maxScrollX&&(d=b.maxScrollX),c>b.minScrollY?c=b.minScrollY:c<b.maxScrollY&&(c=b.maxScrollY),0>b.maxScrollY&&b.scrollTo(d,c,0))},_mouseout:function(a){var b=a.relatedTarget;if(b)for(;b=b.parentNode;)if(b==this.wrapper)return;this._end(a)},_transitionEnd:function(a){a.target==this.scroller&&(this._unbind(q),
this._startAni())},_startAni:function(){var a=this,b=a.x,c=a.y,e=Date.now(),f,g,h;a.animating||(a.steps.length?(f=a.steps.shift(),f.x==b&&f.y==c&&(f.time=0),a.animating=!0,a.moved=!0,a.options.useTransition?(a._transitionTime(f.time),a._pos(f.x,f.y),a.animating=!1,f.time?a._bind(q):a._resetPos(0)):(h=function(){var i=Date.now(),j;i>=e+f.time?(a._pos(f.x,f.y),a.animating=!1,a.options.onAnimationEnd&&a.options.onAnimationEnd.call(a),a._startAni()):(i=(i-e)/f.time-1,g=d.sqrt(1-i*i),i=(f.x-b)*g+b,j=(f.y-
c)*g+c,a._pos(i,j),a.animating&&(a.aniTime=C(h)))},h())):a._resetPos(400))},_transitionTime:function(a){a+="ms";this.scroller.style[m]=a;this.hScrollbar&&(this.hScrollbarIndicator.style[m]=a);this.vScrollbar&&(this.vScrollbarIndicator.style[m]=a)},_momentum:function(a,b,c,e,f){var b=d.abs(a)/b,g=b*b/0.0012;0<a&&g>c?(c+=f/(6/(6E-4*(g/b))),b=b*c/g,g=c):0>a&&g>e&&(e+=f/(6/(6E-4*(g/b))),b=b*e/g,g=e);return{dist:g*(0>a?-1:1),time:d.round(b/6E-4)}},_offset:function(a){for(var b=-a.offsetLeft,d=-a.offsetTop;a=
a.offsetParent;)b-=a.offsetLeft,d-=a.offsetTop;a!=this.wrapper&&(b*=this.scale,d*=this.scale);return{left:b,top:d}},_snap:function(a,b){var c,e,f;f=this.pagesX.length-1;c=0;for(e=this.pagesX.length;c<e;c++)if(a>=this.pagesX[c]){f=c;break}f==this.currPageX&&(0<f&&0>this.dirX)&&f--;a=this.pagesX[f];e=(e=d.abs(a-this.pagesX[this.currPageX]))?500*(d.abs(this.x-a)/e):0;this.currPageX=f;f=this.pagesY.length-1;for(c=0;c<f;c++)if(b>=this.pagesY[c]){f=c;break}f==this.currPageY&&(0<f&&0>this.dirY)&&f--;b=this.pagesY[f];
c=(c=d.abs(b-this.pagesY[this.currPageY]))?500*(d.abs(this.y-b)/c):0;this.currPageY=f;f=d.round(d.max(e,c))||200;return{x:a,y:b,time:f}},_bind:function(a,b,d){(b||this.scroller).addEventListener(a,this,!!d)},_unbind:function(a,b,d){(b||this.scroller).removeEventListener(a,this,!!d)},destroy:function(){this.scroller.style[n]="";this.vScrollbar=this.hScrollbar=!1;this._scrollbar("h");this._scrollbar("v");this._unbind(L,a);this._unbind(K);this._unbind(I);this._unbind(J);this._unbind(F);this.options.hasTouch||
(this._unbind("mouseout",this.wrapper),this._unbind(H));this.options.useTransition&&this._unbind(q);this.options.checkDOMChanges&&clearInterval(this.checkDOMTime);this.options.onDestroy&&this.options.onDestroy.call(this)},refresh:function(){var a,b,c,e=0;b=0;this.scale<this.options.zoomMin&&(this.scale=this.options.zoomMin);this.wrapperW=this.wrapper.clientWidth||1;this.wrapperH=this.wrapper.clientHeight||1;this.minScrollY=-this.options.topOffset||0;this.scrollerW=d.round(this.scroller.offsetWidth*
this.scale);this.scrollerH=d.round((this.scroller.offsetHeight+this.minScrollY)*this.scale);this.maxScrollX=this.wrapperW-this.scrollerW;this.maxScrollY=this.wrapperH-this.scrollerH+this.minScrollY;this.dirY=this.dirX=0;this.options.onRefresh&&this.options.onRefresh.call(this);this.hScroll=this.options.hScroll&&0>this.maxScrollX;this.vScroll=this.options.vScroll&&(!this.options.bounceLock&&!this.hScroll||this.scrollerH>this.wrapperH);this.hScrollbar=this.hScroll&&this.options.hScrollbar;this.vScrollbar=
this.vScroll&&this.options.vScrollbar&&this.scrollerH>this.wrapperH;a=this._offset(this.wrapper);this.wrapperOffsetLeft=-a.left;this.wrapperOffsetTop=-a.top;if("string"==typeof this.options.snap){this.pagesX=[];this.pagesY=[];c=this.scroller.querySelectorAll(this.options.snap);a=0;for(b=c.length;a<b;a++)e=this._offset(c[a]),e.left+=this.wrapperOffsetLeft,e.top+=this.wrapperOffsetTop,this.pagesX[a]=e.left<this.maxScrollX?this.maxScrollX:e.left*this.scale,this.pagesY[a]=e.top<this.maxScrollY?this.maxScrollY:
e.top*this.scale}else if(this.options.snap){for(this.pagesX=[];e>=this.maxScrollX;)this.pagesX[b]=e,e-=this.wrapperW,b++;this.maxScrollX%this.wrapperW&&(this.pagesX[this.pagesX.length]=this.maxScrollX-this.pagesX[this.pagesX.length-1]+this.pagesX[this.pagesX.length-1]);b=e=0;for(this.pagesY=[];e>=this.maxScrollY;)this.pagesY[b]=e,e-=this.wrapperH,b++;this.maxScrollY%this.wrapperH&&(this.pagesY[this.pagesY.length]=this.maxScrollY-this.pagesY[this.pagesY.length-1]+this.pagesY[this.pagesY.length-1])}this._scrollbar("h");
this._scrollbar("v");this.zoomed||(this.scroller.style[m]="0",this._resetPos(200))},scrollTo:function(a,b,d,c){var e=a;this.stop();e.length||(e=[{x:a,y:b,time:d,relative:c}]);a=0;for(b=e.length;a<b;a++)e[a].relative&&(e[a].x=this.x-e[a].x,e[a].y=this.y-e[a].y),this.steps.push({x:e[a].x,y:e[a].y,time:e[a].time||0});this._startAni()},scrollToElement:function(a,b){var c;if(a=a.nodeType?a:this.scroller.querySelector(a))c=this._offset(a),c.left+=this.wrapperOffsetLeft,c.top+=this.wrapperOffsetTop,c.left=
0<c.left?0:c.left<this.maxScrollX?this.maxScrollX:c.left,c.top=c.top>this.minScrollY?this.minScrollY:c.top<this.maxScrollY?this.maxScrollY:c.top,b=void 0===b?d.max(2*d.abs(c.left),2*d.abs(c.top)):b,this.scrollTo(c.left,c.top,b)},scrollToPage:function(a,b,d){d=void 0===d?400:d;this.options.onScrollStart&&this.options.onScrollStart.call(this);this.options.snap?(a="next"==a?this.currPageX+1:"prev"==a?this.currPageX-1:a,b="next"==b?this.currPageY+1:"prev"==b?this.currPageY-1:b,a=0>a?0:a>this.pagesX.length-
1?this.pagesX.length-1:a,b=0>b?0:b>this.pagesY.length-1?this.pagesY.length-1:b,this.currPageX=a,this.currPageY=b,a=this.pagesX[a],b=this.pagesY[b]):(a*=-this.wrapperW,b*=-this.wrapperH,a<this.maxScrollX&&(a=this.maxScrollX),b<this.maxScrollY&&(b=this.maxScrollY));this.scrollTo(a,b,d)},disable:function(){this.stop();this._resetPos(0);this.enabled=!1;this._unbind(I);this._unbind(J);this._unbind(F)},enable:function(){this.enabled=!0},stop:function(){this.options.useTransition?this._unbind(q):G(this.aniTime);
this.steps=[];this.animating=this.moved=!1},zoom:function(a,b,d,c){var e=d/this.scale;this.options.useTransform&&(this.zoomed=!0,c=void 0===c?200:c,a=a-this.wrapperOffsetLeft-this.x,b=b-this.wrapperOffsetTop-this.y,this.x=a-a*e+this.x,this.y=b-b*e+this.y,this.scale=d,this.refresh(),this.x=0<this.x?0:this.x<this.maxScrollX?this.maxScrollX:this.x,this.y=this.y>this.minScrollY?this.minScrollY:this.y<this.maxScrollY?this.maxScrollY:this.y,this.scroller.style[m]=c+"ms",this.scroller.style[n]="translate("+
this.x+"px,"+this.y+"px) scale("+d+")"+B,this.zoomed=!1)},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}};e=null;"undefined"!==typeof exports?exports.iScroll=g:a.iScroll=g})(this,document);var ui_config={},mainScene=[{id:0,name:"leftTop",style:{position:"absolute",left:0,top:0},items:[{name:"mainPlayer_photo",style:{left:10,top:10,height:74,width:74},items:[{tag:"img"}]},{name:"mainPlayer",style:{height:107,width:260,left:0,top:0},items:[{name:"nickname",className:"nickname",innerText:"nickname",style:{height:33,width:165,top:6,right:5}},{name:"experience_progress",style:{height:19,width:164}},{name:"exp",className:"number exp",innerHTML:'<span id="currentExp"></span>/<span id="needExp"></span>',
style:{}},{name:"level",innerText:"level",style:{}},{name:"money",className:"number money",innerText:"money",style:{}},{name:"gameCurrency",className:"number gameCurrency",innerText:"gameCurrency",style:{}}]},{name:"recharge",bgName:"recharge",style:{top:30,left:270},items:[]}]},{id:1,name:"rightTop",style:{position:"absolute",left:796,top:0},items:[{name:"rightTopBG",style:{height:154,width:163,left:0,top:0},items:[{name:"map",style:{height:75,width:75,top:14,right:15}},{name:"postMessage",style:{height:64,
width:54,bottom:0,right:11}},{name:"assistant",style:{height:67,width:62,top:7,right:93}}]}]},{id:2,name:"leftBottom",style:{position:"absolute",left:5,top:528},items:[{name:"chatBtnDiv",style:{},items:[{name:"chatBtn",style:{left:"-10px",top:"30px",width:"90px",height:"88px"}}]},{name:"chatMessageDiv",style:{display:"none"},items:[{name:"chatMessage",style:{height:"0px",width:"0px",top:"100px",left:"0px",radius:5,border:"2px solid black",background:"-webkit-linear-gradient(top, #333333, #181818)",
position:"absolute",overflow:"hidden"}},{name:"chatMessageRight",style:{background:"url(./res/ui/btn/chat_arrow.png)",top:"2px",left:"270px",height:"104px",width:"21px",position:"absolute","z-index":258}}]},{name:"chatRoomDiv",style:{},items:[{name:"chatRoom",innerHTML:'<div id="chatContent" style="width: 100%"></div>',style:{height:"104px",width:"280px",top:"0px",left:"0px",display:"none"}},{name:"chat-input-div",innerHTML:'<input id="chatInputMessage" style="height: 53px;width: 692px"/>\t\t\t\t\t\t<div id="chat-submit" class="btn" style="height: 80px;width: 128px">\u53d1&nbsp;\u9001</div>',
style:{height:"53px",width:"801px",top:"-98px",left:"72px",display:"none"}},{name:"chatWindow-close-btn",style:{top:"-444px",left:"887px",display:"none"}}]}]},{id:3,name:"rightCenter",style:{position:"absolute",left:880,top:224},items:[{name:"task",style:{height:116,width:80,left:0,top:0}},{name:"nearby",style:{height:116,width:80,left:0,top:116}}]},{id:4,name:"rightBottom",style:{position:"absolute",width:79,height:79,top:561,left:880},items:[{name:"menu",style:{}}]},{id:5,name:"marquee",style:{position:"absolute",
left:"227px",top:"115px",width:"519px",height:"23px","z-index":101,overflow:"hidden"},className:"marquee",items:[{name:"marquee_message",style:{position:"absolute",left:"519px",top:"0px","font-weight":"normal","letter-spacing":"4px","text-align":"left","font-size":"14px","word-break":"break-all","float":"left",color:"yellow","z-index":100,overflow:"hidden"}}]}],fightScene=[{id:0,name:"top",style:{position:"absolute",left:"0px",top:"0px"},items:[{name:"topBG",style:{position:"absolute",left:"0px",
top:"0px",height:"62px",width:"960px",background:"url(./res/ui/layout/f/fi_top_bg.png)"}},{name:"titile",style:{position:"absolute",top:"12px",left:"450px",height:"27px",width:"75px",background:"url(./res/ui/font/zh_CN/rounds.png) no-repeat"}},{name:"round_left",className:"fight-round-num",innerText:"0",style:{top:"15px",left:"385px"}},{name:"round_right",className:"fight-round-num",innerText:"0",style:{top:"15px",left:"565px"}}]},{id:1,name:"leftCharacter",style:{position:"absolute",top:"60px",left:"10px",
width:"50px"},items:[{name:"l_cr1",className:"fight-character-bg",style:{width:50,height:50,top:0,left:0,"margin-bottom":10}}]},{id:2,name:"rightCharacter",style:{position:"absolute",top:"60px",left:"900px",width:"50px"},items:[{name:"r_cr1",className:"fight-character-bg",style:{width:50,height:50,top:0,left:0,"margin-bottom":10}}]},{id:3,name:"rightBottom",style:{position:"absolute",left:"832px",top:"560px"},items:[{name:"skipBattle",className:"skipBattle",style:{left:"0px",top:"0px"}}]}],casinoScene=
[{name:"leftTop",style:{position:"absolute",top:"5px",left:"5px"},items:[{name:"player-bg",style:{position:"absolute",width:"226px",height:"83px",top:"0px",left:"0px",background:"url(./res/ui/layout/g/casino_photoleft_bg.png)"}},{name:"player-photo",style:{position:"absolute",width:"74px",height:"74px","border-radius":"37px",overflow:"hidden",top:"4px",left:"4px"}},{name:"player-money",style:{position:"absolute",top:"9px",left:"100px",width:"128px",color:"#FFFFFF","font-size":"14px","text-shadow":"0 0 3px #000000"}},
{name:"player-stake",style:{position:"absolute",top:"48px",left:"90px",width:"128px",color:"#febb11","font-size":"14px","text-shadow":"0 0 3px #000000"}}]},{name:"rightTop",style:{position:"absolute",top:"5px",left:"730px"},items:[{name:"boss-bg",style:{position:"absolute",width:"226px",height:"83px",top:"0px",left:"0px",background:"url(./res/ui/layout/g/casino_photoright_bg.png)"}},{name:"boss-photo",style:{position:"absolute",width:"74px",height:"74px","border-radius":"37px",overflow:"hidden",top:"4px",
left:"149px",background:"url(./res/ui/ci/0/0_photo.png)"}},{name:"boss-name",innerHTML:"\u8d4c\u573a\u8001\u677f",style:{position:"absolute",top:"9px",left:"50px",width:"128px",color:"#FFFFFF","font-size":"14px","text-shadow":"0 0 3px #000000"}},{name:"boss-stake",innerHTML:"\u8d4c\u6ce8\u7269\u54c1\uff1a1",style:{position:"absolute",top:"48px",left:"40px",width:"128px",color:"#febb11","font-size":"14px","text-shadow":"0 0 3px #000000"}}]},{name:"topCenter",style:{position:"absolute",left:"440px",
top:"40px"},items:[{name:"casino-stake",style:{width:"70px",height:"70px",top:"0px",left:"0px"}},{name:"casino-stake-picture",style:{width:"68px",height:"68px",top:"2px",left:"2px"}},{name:"rb",style:{width:"20px",height:"20px",top:"56px",left:"56px"}},{name:"casino-stake-name",style:{height:"21px",width:"144px",top:"80px",left:"-32px"}}]},{name:"bottom",style:{position:"absolute",left:"238px",top:"563px"},items:[{name:"add-stake",className:"casino-btn",innerHTML:"\u589e\u52a01000\u8d4c\u91d1",style:{left:"0px",
top:"0px",height:"77px",width:"218px"}},{name:"casino-btn",className:"casino-btn",innerHTML:"\u5c0f\u8bd5\u4e00\u628a",style:{left:"280px",top:"0px",height:"77px",width:"218px"}}]},{name:"table",style:{position:"absolute",background:"green",left:"280px",top:"200px",width:"400px",height:"300px"},items:[]}],taskWindow=[{name:"taskWindow",style:{display:"none",width:"363px",height:"467px",top:"50px",right:"288px"},items:[{name:"task-content-holder",style:{height:"90px",width:"300px",left:"30px",position:"absolute"}},
{name:"submit-btn",style:{height:"60px",width:"108px",top:"38px",right:"5px",position:"absolute","line-height":"60px","text-align":"center",color:"black"}},{name:"task-type",style:{height:"17px",width:"70px",top:"7px",left:"5px",position:"absolute"}},{name:"task-name",style:{top:"3px",left:"85px",position:"absolute"}},{name:"task-description",style:{top:"25px",left:"7px",position:"absolute"}},{name:"task-reward",innerHTML:'<span class="task-reward-title">\u5956\u52b1</span>',style:{top:"47px",left:"7px",
position:"absolute"}}]}],tab={beginTop:37,height:77},grid={width:60,height:60},menu={width:70},gridPopup=[{name:"gridPopup",items:{wraperStyle:{position:"absolute",display:"none",width:"188px",height:"352px",color:"#00deff","font-size":"12px",background:"-webkit-repeating-linear-gradient(45deg,#0d263c, #0d263c 6px, #0c2338 6px, #0c2338 12px)","border-radius":"5px",border:"1px solid #00eaff","box-shadow":"0 0 10px #28d7ff inset","z-index":2048},textStyle:{margin:"25px"},btnStyle:{position:"absolute",
height:"50px",width:"83px",bottom:"16px",left:"50px","line-height":"50px","text-align":"center","font-size":"18px",color:"#292c2d",background:"url(./res/ui/btn/popupbox_btn.png) no-repeat"}}}],characterWindow={name:"character",style:{width:"363px",height:"467px",top:"50px"},equipmentGrid:{beginTop:53,beginLeft:50,marginTop:20,marginLeft:152},buffGrid:{beginTop:15,beginLeft:12,marginTop:0,marginLeft:12},items:[{name:"tab_left_bg",style:{position:"absolute",height:"84px",width:"50px",left:"-44px"}},
{name:"equipmentGrid",style:{}},{name:"nickname",style:{left:"110px",top:"53px",width:"135px",height:"21px"}},{name:"level",style:{}},{name:"bust",style:{left:"133px",top:"76px",width:"90px",height:"125px",position:"absolute"}},{name:"hr",style:{width:"300px",height:"1px",border:"none",position:"absolute",top:"194px",left:"33px",background:"-webkit-radial-gradient(circle,rgb(4, 27, 40) 80%,transparent 100%)"}},{name:"middleBG",style:{width:"293px",radius:5,background:"rgb(16, 44, 74)",border:"2px solid rgb(14, 37, 60)",
"box-shadow":"0 0 1px rgb(0, 234, 255)",position:"absolute",left:"35px",height:"74px",top:"210px","background-image":"url(./res/ui/layout/c/cr_exp.png)"}},{name:"experienceBG",style:{background:"-webkit-linear-gradient(top, #e86bfe, #a406bf)",top:"229px"}},{name:"experience",style:{top:"229px"}},{name:"energyBG",style:{background:"-webkit-linear-gradient(top, #48b5fa, #0d6ce2)",top:"260px"}},{name:"energy",style:{top:"260px"}},{name:"addEnergy",style:{}},{name:"buffBG",style:{left:"35px",top:"312px",
width:"293px",height:"85px"},items:[{name:"buffTitle",style:{position:"absolute",left:"94px",top:"-20px",background:"url(./res/ui/font/zh_CN/cr_buff_font.png)",width:"107px",height:"27px"}},{name:"buffGrid",style:{"z-index":10}}]},{name:"showOnMSBtn",style:{position:"absolute",left:"77px",top:"392px",width:"213px",height:"70px",background:"url(./res/ui/btn/btn_bg_disable.png)","text-align":"center","line-height":"70px"}}]},characterAttrWindow={name:"charactorAttr",style:{},items:[{}]};
(function(a){a.mainScene=mainScene;a.fightScene=fightScene;a.casinoScene=casinoScene;a.waterDrop={width:27,height:85,className:"water-drop",l_cr_begin:{top:20,left:0},l_cr_end:{top:20,left:298},r_cr_begin:{top:20,left:932},r_cr_end:{top:20,left:648}};a.characterWindow=characterWindow;a.characterAttrWindow=characterAttrWindow;a.window={left:298,top:90};a.attrWindow={}})(ui_config);
var packageWindow=[{name:"packageWindow",style:{display:"none",width:"363px",height:"467px",top:"50px"},items:[{name:"tab_right_bg",style:{height:"77px",width:"70px",left:"359px"}},{name:"cell",style:{height:"60px",width:"60px"},items:[{name:"click",className:"click",style:{}}]}]}],dialogueScene=[{name:"dialogueScene",style:{},items:[{name:"dialogue-background",style:{height:"120px",width:"960px",left:0,top:"518px",position:"absolute","z-index":258,"border-top":"2px solid white"}},{name:"speaker-name",
style:{height:"30px",left:"288px",top:"544px",color:"#3B9BCC","z-index":259,position:"absolute"}},{name:"dialogue-hr",tag:"hr",style:{height:"1px",width:"420px",top:"566px",left:"288px",position:"absolute",border:"none","z-index":259}},{name:"scripts",style:{height:"30px",top:"586px",left:"288px","z-index":259,position:"absolute",color:"white"}},{name:"next",style:{width:"68px",height:"19px",top:"604px",left:"874px",position:"absolute","z-index":259}},{name:"bust",style:{height:"367px",width:"250px",
top:"273px",left:0,position:"absolute","z-index":259}}]}],skillWindow=[{name:"skillWindow",items:[{name:"tab_right_bg",style:{height:"77px",width:"70px",left:"357px"}},{name:"frame-btn-alone",innerHTML:"\u5f3a\u5316\u6218\u8230",style:{}}],grid9Items:[{name:"cell-skill",style:{height:"60px",width:"60px","border-radius":"6px","box-shadow":"0 0 10px #00ebff",border:"2px solid #9f9f9f",position:"absolute","z-index":612,"background-repeat":"no-repeat","background-color":"#0e345a"}},{name:"pipeline-vertical",
innerHTML:'<div class="pipeline-filler" style="top:-3px;width:100%;"></div>',style:{height:"35px",width:"10px",position:"absolute","z-index":602,border:"2px solid #9f9f9f","box-shadow":"0 0 10px #00ebff"}},{name:"pipeline-horizontal",innerHTML:'<div class="pipeline-filler" style="left:-3px;height:100%;"></div>',style:{height:"10px",width:"35px",position:"absolute","z-index":602,border:"2px solid #9f9f9f","box-shadow":"0 0 10px #00ebff"}},{name:"skills-content-holder",style:{height:"345px",width:"305px",
"border-radius":"5px",background:"#102c4a",border:"2px solid #0e253c","box-shadow":"0 0 1px #00eaff",position:"absolute",left:"27px",top:"52px","z-index":513}},{name:"skills-content-hr",style:{position:"absolute",left:"26px",top:"100px",height:"21px",width:"311px",background:"url(./res/ui/layout/c/skill_ph_bg.png)","z-index":514}},{name:"position","0-1":"top:162px;left:114px;","1-2":"top:162px;left:210px;","3-4":"top:254px;left:114px;","4-5":"top:254px;left:210px;","6-7":"top:350px;left:114px;","7-8":"top:350px;left:210px;",
"0-3":"top:195px;left:79px;","1-4":"top:195px;left:175px;","2-5":"top:195px;left:268px;","3-6":"top:288px;left:79px;","4-7":"top:288px;left:175px;","5-8":"top:288px;left:268px;"}]}],pirateBoatWindow=[{name:"pirateBoatWindow",items:[{name:"pirate-boat-nickname",style:{width:"135px",height:"21px",position:"absolute",top:"53px",left:"110px","text-align":"center",color:"#00eaff","font-size":"14px"}},{name:"pirate-boat-bust",style:{height:"125px",width:"90px",position:"absolute",top:"76px",left:"133px"}},
{name:"pirate-boat-level",style:{height:"17px",width:"28px",display:"inline-block","font-style":"italic","font-size":"12px",color:"red",position:"absolute",left:"215px",top:"55px","line-height":"17px",background:"url(./res/ui/layout/c/cr_level_bg.png)"}},{name:"frame-hr",tag:"hr",style:{width:"300px",height:"1px",border:"none",position:"absolute",top:"194px",left:"33px",background:"-webkit-radial-gradient(circle,#041b28 80%,transparent 100%)"}},{name:"pirate-boat-content-holder",innerHTML:'<div id="content-left" style="position:absolute;left:10px;top:10px;width:128px;"></div><div id="content-right" style="position:absolute;left:164px;top:10px;width:128px;"></div><div id="active-skill-content" style="position:absolute;top:136px;left:10px;color:#0292c7;"></div>',
style:{height:"188px",width:"293px","border-radius":"5px",background:"#102c4a",border:"2px solid #0e253c","box-shadow":"0 0 1px #00eaff",position:"absolute",top:"210px",left:"35px","font-size":"12px",color:"#00d3ff","text-shadow":"0 0 1px #000817"}},{name:"active-skill-label",style:{position:"absolute",left:"43px",top:"329px",height:"16px",width:"58px","z-index":522}},{name:"active-skill-content",style:{position:"absolute",left:"10px",top:"136px",color:"#0292c7","z-index":512}},{name:"frame-btn-alone",
innerHTML:"\u5f3a\u5316\u6218\u8230",className:"frame-btn-alone",style:{}},{name:"pirate-boat-tab",style:{position:"absolute",left:"-65px",height:"77px",width:"70px"}}]}],strengthenWindow=[{name:"strengthenWindow",style:{display:"none",width:"363px",height:"467px",top:"50px"},items:[{name:"tab_right_bg",style:{height:"77px",width:"42px",left:"359px"}}]},{name:"transform",items:[{name:"transform-bg",style:{position:"absolute","z-index":513,top:"75px",left:"19px",width:"325px",height:"318px",background:"url(./res/ui/layout/c/st_tfm_boat_bg.png) no-repeat"}},
{name:"pic0",style:{position:"absolute","z-index":514,top:"118px",left:"96px",width:"60px",height:"60px"}},{name:"pic1",style:{position:"absolute","z-index":514,top:"98px",left:"252px",width:"60px",height:"60px"}},{name:"pic2",style:{position:"absolute","z-index":514,top:"252px",left:"195px",width:"60px",height:"60px"}},{name:"pic3",style:{position:"absolute","z-index":514,top:"310px",left:"84px",width:"60px",height:"60px"}},{name:"pic4",style:{position:"absolute","z-index":514,top:"316px",left:"262px",
width:"60px",height:"60px"}},{name:"frame-btn-tween",className:"frame-btn-tween",innerHTML:"\u91cd\u65b0\u6539\u9020",style:{top:"391px",left:"30px"}},{name:"frame-btn-tween",className:"frame-btn-tween",innerHTML:"\u6539\u9020\u6218\u8230",style:{top:"391px",left:"185px"}}]},{name:"research",items:[{name:"frame-btn-alone",innerHTML:"\u5b66\u4e60/\u5347\u7ea7",style:{}}]},{name:"recast",items:[{name:"recast-holder",style:{width:"293px",height:"268px","border-radius":"5px",background:"#102c4a",border:"2px solid #0e253c",
"box-shadow":"0 0 1px #00eaff",position:"absolute",left:"33px",top:"130px"}},{name:"recast-left-text",style:{position:"absolute",top:"140px",left:"88px",width:"186px",height:"22px",background:"url(./res/ui/font/zh_CN/st_rst_surplus.png) no-repeat","z-index":513}},{name:"recast-left-num",style:{position:"absolute",top:"134px",left:"218px",color:"#ff6000","font-size":"24px","z-index":513}},{name:"circle-progress-holder",style:{position:"absolute",height:"202px",width:"202px",top:"168px",left:"82px",
overflow:"hidden","border-radius":"101px"}},{name:"circle-progress-left",style:{position:"absolute",width:"101px",height:"202px"}},{name:"circle-progress-right",style:{left:"101px",position:"absolute",width:"101px",height:"202px"}},{name:"circle-progress-rotate",style:{position:"absolute",width:"101px",height:"202px",background:"#102c4a","z-index":565}},{name:"circle-progress-cover",style:{position:"absolute",top:"168px",left:"82px","z-index":567,height:"203px",width:"203px",background:"url(../res/ui/layout/c/rst_bg_icon.png) no-repeat"}},
{name:"circle-progress-cover-type",style:{position:"absolute",top:"211px",left:"125px","z-index":568,height:"117px",width:"117px",background:"url(../res/ui/layout/c/rst_1_icon.png) no-repeat"}},{name:"recast-description",style:{position:"absolute","font-size":"12px",top:"380px","font-size":"12px",color:"#00d3ff","text-shadow":"0 0 1px #000817","z-index":513,width:"363px","text-align":"center"}},{name:"recast-percent",style:{position:"absolute",top:"296px",left:"159px","font-size":"14px","font-style":"italic",
color:"#00a8ff","text-shadow":"0 0 1px #000817","z-index":569}},{name:"cell",style:{width:"60px",height:"60px",top:"56px"}},{name:"frame-btn-alone",innerHTML:"\u91cd\u94f8\u88c5\u5907",style:{}}]},{name:"made",items:[{name:"made-holder",style:{position:"absolute",width:"298px",height:"76px",left:"32px"},items:[{name:"made-type",style:{position:"absolute",left:"4px",top:"5px"}},{name:"made-cover",style:{position:"absolute","z-index":512,width:"300px",height:"78px",background:"url(./res/ui/layout/c/sy_abd_alone_bg.png) no-repeat"}},
{name:"made-upgrade-btn",style:{position:"absolute",left:"4px",top:"5px"}},{name:"made-point",style:{position:"absolute",height:"29px",width:"28px",background:"url(./res/ui/layout/c/st_adb_leve_bg.png) no-repeat","line-height":"29px","text-align":"center",color:"white","font-size":"14px","font-style":"italic",left:"50px",top:"16px","z-index":513}},{name:"made-upgrade-btn",style:{position:"absolute",right:"5px",top:"18px",height:"25px",width:"25px",background:"url(./res/ui/btn/pb_up.png) no-repeat"}},
{name:"made-description",style:{position:"absolute",width:"298px","font-size":"12px","text-align":"center",color:"#00d3ff","text-shadow":"0 0 1px #000817",bottom:"3px",left:"1px"}},{name:"made-progress-filler",style:{position:"absolute","z-index":511,height:"22px",top:"20px",left:"77px",background:"-webkit-linear-gradient(right, #ff8d28, #990d00)"}},{name:"made-next-point",src:"./res/ui/layout/c/st_sbd_chose.png",style:{position:"absolute","z-index":567,top:"17px",height:"28px",width:"29px",background:"url(./res/ui/layout/c/st_sbd_chose.png) no-repeat"}}]},
{name:"made-holder-branch",style:{position:"absolute",width:"300px",height:"109px",left:"32px"},items:[{name:"made-type",style:{position:"absolute",left:"4px",top:"5px",height:"40px",width:"40px"}},{name:"made-cover-branch",style:{position:"absolute","z-index":512,width:"300px",height:"109px",background:"url(./res/ui/layout/c/sy_abd_double_bg.png) no-repeat"}},{name:"made-upgrade-btn",style:{position:"absolute",left:"4px",top:"5px"}},{name:"made-point",style:{position:"absolute",height:"29px",width:"28px",
background:"url(./res/ui/layout/c/st_adb_leve_bg.png) no-repeat","line-height":"29px","text-align":"center",color:"white","font-size":"14px","font-style":"italic",left:"50px",top:"31px","z-index":513}},{name:"made-upgrade-btn",style:{position:"absolute",right:"5px",top:"18px",height:"25px",width:"25px",background:"url(./res/ui/btn/pb_up.png) no-repeat"}},{name:"made-description",style:{position:"absolute",width:"298px","font-size":"12px","text-align":"center",color:"#00d3ff","text-shadow":"0 0 1px #000817",
bottom:"3px",left:"1px"}},{name:"made-progress-filler",style:{position:"absolute","z-index":511,height:"36px",top:"16px",left:"77px",background:"-webkit-linear-gradient(right, #ff8d28, #990d00)"}},{name:"made-next-point",style:{position:"absolute","z-index":567,top:"17px",height:"28px",width:"29px",background:"url(./res/ui/layout/c/st_sbd_chose.png) no-repeat"}}]}]}],formation=[{name:"formationWindow",items:[{name:"tab_right_bg",style:{height:"77px",width:"42px",right:"-38px"}}]},{name:"formation",
cssText:"position:absolute;top:90px;width:534px;height:466px;color:#000000;background:url(./res/ui/layout/c/ft_windowright_bg.png) no-repeat;z-index:513;",items:[{name:"AP-tag",style:{position:"absolute",top:"65px",height:"25px",width:"68px",background:"url(./res/ui/font/zh_CN/fightingpower.png) no-repeat",left:"90px"}},{name:"HP_tag",style:{position:"absolute",top:"65px",height:"25px",width:"68px",background:"url(./res/ui/font/zh_CN/vitality.png) no-repeat",left:"275px"}},{name:"AP",className:"formation-data-value",
style:{top:"63px",left:"166px"}},{name:"HP",className:"formation-data-value",style:{top:"63px",left:"351px"}},{name:"AP-arrow-up",className:"arrow-up",style:{height:"26px",width:"12px",top:"65px",left:"215px"}},{name:"AP-arrow-down",className:"arrow-down",style:{height:"26px",width:"12px",top:"65px",left:"243px"}},{name:"HP-arrow-up",className:"arrow-up",style:{height:"26px",width:"12px",top:"65px",left:"404px"}},{name:"HP-arrow-down",className:"arrow-down",style:{height:"26px",width:"12px",top:"65px",
left:"433px"}},{name:"description",style:{width:"372px",height:"44px",top:"120px",left:"60px",position:"absolute"}},{name:"cr",className:"cell-cr",position:["top:274px;left:440px;","top:334px;left:380px;","top:334px;left:440px;"],style:{height:"50px",width:"50px",top:"65px",left:"433px"}},{name:"frameS",className:"frameS",style:{position:"absolute",width:"198px",height:"468px",left:"-200px",background:"url(./res/ui/layout/c/ft_windowleft_bg.png) no-repeat"},items:{title:{position:"absolute",width:"198px",
height:"40px","line-height":"40px","font-size":"18px","text-align":"center"},rb:{position:"absolute",left:"38px",top:"38px","z-index":612,height:"27px",width:"27px",background:"url(../res/ui/layout/c/ft_use.png) no-repeat"},wraper:{position:"absolute",left:"16px",top:"60px",height:"389px",width:"164px",overflow:"hidden"}}},{name:"blueCircle",position:"top:239px;left:176px top:273px;left:272px top:332px;left:258px top:358px;left:130px top:320px;left:27px; top:261px;left:56px;".split(" ")},{name:"redCircle",
position:"top:150px;left:395px; top:170px;left:458px; top:210px;left:450px; top:226px;left:365px; top:201px;left:297px; top:163px;left:317px;".split(" ")}]},{name:"battleformation",cssText:"position:absolute;top:90px;width:363px;height:467px;color:#000000;background:url(./res/ui/layout/c/window_bg.png) no-repeat;z-index:513;",items:[{name:"bg",tag:"img",src:"./res/ui/layout/c/bft_magic.png",style:{position:"absolute",top:"48px",left:"40px"}},{name:"wrap",id:"battleformation-wrap",innerHTML:'<div style="margin:10px;position:absolute;width:287px;"></div>',
style:{top:"246px",left:"32px",width:"298px",height:"150px"}}]},{name:"governing",cssText:"position:absolute;top:90px;width:363px;height:467px;color:#000000;background:url(./res/ui/layout/c/window_bg.png) no-repeat;z-index:513;",items:[{name:"frame-btn-alone",innerHTML:"\u5b66\u4e60/\u5347\u7ea7",style:{}}]}],shopWindow=[{name:"shopWindow",items:[{name:"tab",className:"tab_left_bg",style:{"line-height":"77px","padding-left":"12px",width:"70px",height:"77px",color:"#292c2d",position:"absolute","text-align":"center",
left:"-66px"}},{name:"dividingLeft",className:"dividing",style:{left:"24px"}},{name:"dividingRight",className:"dividing",style:{left:"186px"}},{name:"item",className:"item",style:{width:"157px",height:"73px"},items:[{name:"click",className:"click",style:{}},{name:"img",className:"item-img",style:{width:"55px",height:"55px",top:"8px",left:"20px"}},{name:"bg",className:"item-bg",style:{width:"55px",height:"55px",top:"8px",left:"20px"}},{name:"name",className:"item-name",style:{top:"18px",left:"82px"}},
{name:"price",className:"item-price",style:{top:"38px",left:"82px"}}]}]}],messageBox=[{name:"messageBox",style:{position:"absolute",height:"188px",width:"352px",background:"-webkit-repeating-linear-gradient(45deg, #0d263c, #0d263c 6px, #0c2338 6px, #0c2338 12px)","border-radius":"5px",border:"1px solid #00eaff","box-shadow":"0 0 10px #28d7ff inset",color:"white","z-index":5120},items:[{name:"content",style:{position:"absolute","line-height":"200px","text-align":"center",height:"188px",width:"352px"}},
{name:"btnA",innerHTML:"\u786e\u8ba4",style:{position:"absolute",bottom:"25px",left:"60px",width:"83px",height:"50px","line-height":"50px",background:"url(./res/ui/btn/popupbox_btn.png) no-repeat","text-align":"center",display:"none"}},{name:"btnB",innerHTML:"\u53d6\u6d88",style:{position:"absolute",bottom:"25px",right:"60px",width:"83px",height:"50px","line-height":"50px",background:"url(./res/ui/btn/popupbox_btn.png) no-repeat","text-align":"center",display:"none"}}]}],fightSettleWindow=[{name:"fightSettleWindow",
style:{background:"url(./res/ui/layout/f/res_bg.png) no-repeat",width:593,height:428,top:110,left:190,titleHeight:40,titleFontSize:24},items:[{name:"fight-tag",quantity:2,differ:[{top:"53px"},{top:"203px"}],style:{width:"89px",height:"30px",left:"31px"}},{name:"fight-purple-txt",quantity:2,differ:[{top:"154px"},{top:"237px"}],style:{left:"170px"}},{name:"fight-golden-txt",quantity:2,differ:[{top:"154px"},{top:"237px"}],style:{left:"310px"}},{name:"fight-star",quantity:3,differ:[{left:"195px"},{left:"265px"},
{left:"335px"}],style:{top:"85px",width:"59px",height:"61px"}},{name:"fight-cell",quantity:4,differ:[{left:"160px"},{left:"232px"},{left:"304px"},{left:"376px"}],style:{top:"272px",width:"60px",height:"60px"}},{name:"frame-btn-alone",quantity:2,differ:[{left:"57px"},{left:"322px"}],style:{top:"347px"}}]}];var ui_resources={mainScene:[{name:"cr_attribute_bg",type:"image",src:"res/ui/layout/c/cr_attribute_bg.png"},{name:"cr_buff_font",type:"image",src:"res/ui/font/zh_CN/cr_buff_font.png"},{name:"cr_exp",type:"image",src:"res/ui/layout/c/cr_exp.png"},{name:"cr_level_bg",type:"image",src:"res/ui/layout/c/cr_level_bg.png"},{name:"ft_arrowdown_bg",type:"image",src:"res/ui/layout/c/ft_arrowdown_bg.png"},{name:"ft_arrowup_bg",type:"image",src:"res/ui/layout/c/ft_arrowup_bg.png"},{name:"ft_attack",type:"image",
src:"res/ui/layout/c/ft_attack.png"},{name:"ft_down_bg",type:"image",src:"res/ui/layout/c/ft_down_bg.png"},{name:"ft_position",type:"image",src:"res/ui/layout/c/ft_position.png"},{name:"ft_up_bg",type:"image",src:"res/ui/layout/c/ft_up_bg.png"},{name:"ft_use",type:"image",src:"res/ui/layout/c/ft_use.png"},{name:"ft_windowleft_bg",type:"image",src:"res/ui/layout/c/ft_windowleft_bg.png"},{name:"ft_windowright_bg",type:"image",src:"res/ui/layout/c/ft_windowright_bg.png"},{name:"lock",type:"image",src:"res/ui/layout/c/lock.png"},
{name:"mainPlayer_bg",type:"image",src:"res/ui/layout/c/mainPlayer_bg.png"},{name:"pb_up",type:"image",src:"res/ui/layout/c/pb_up.png"},{name:"pb_up_h",type:"image",src:"res/ui/layout/c/pb_up_h.png"},{name:"popupbox_bg1",type:"image",src:"res/ui/layout/c/popupbox_bg1.png"},{name:"popupbox_bg2",type:"image",src:"res/ui/layout/c/popupbox_bg2.png"},{name:"rightTop_bg",type:"image",src:"res/ui/layout/c/rightTop_bg.png"},{name:"rst_1_icon",type:"image",src:"res/ui/layout/c/rst_1_icon.png"},{name:"rst_bg_icon",
type:"image",src:"res/ui/layout/c/rst_bg_icon.png"},{name:"shop_line",type:"image",src:"res/ui/layout/c/shop_line.png"},{name:"skill_ph_bg",type:"image",src:"res/ui/layout/c/skill_ph_bg.png"},{name:"st_adb_leve_bg",type:"image",src:"res/ui/layout/c/st_adb_leve_bg.png"},{name:"st_sbd_chose",type:"image",src:"res/ui/layout/c/st_sbd_chose.png"},{name:"st_tfm_boat_bg",type:"image",src:"res/ui/layout/c/st_tfm_boat_bg.png"},{name:"sy_abd_alone_bg",type:"image",src:"res/ui/layout/c/sy_abd_alone_bg.png"},
{name:"sy_abd_double_bg",type:"image",src:"res/ui/layout/c/sy_abd_double_bg.png"},{name:"tips",type:"image",src:"res/ui/layout/c/tips.png"},{name:"window_bg",type:"image",src:"res/ui/layout/c/window_bg.png"},{name:"add",type:"image",src:"res/ui/btn/add.png"},{name:"add_h",type:"image",src:"res/ui/btn/add_h.png"},{name:"assistant",type:"image",src:"res/ui/btn/assistant.png"},{name:"assistant_h",type:"image",src:"res/ui/btn/assistant_h.png"},{name:"btn_bg",type:"image",src:"res/ui/btn/btn_bg.png"},
{name:"btn_bg_disable",type:"image",src:"res/ui/btn/btn_bg_disable.png"},{name:"btn_bg_h",type:"image",src:"res/ui/btn/btn_bg_h.png"},{name:"btn_tfm_bg",type:"image",src:"res/ui/btn/btn_tfm_bg.png"},{name:"btn_tfm_bg_h",type:"image",src:"res/ui/btn/btn_tfm_bg_h.png"},{name:"casino_btn",type:"image",src:"res/ui/btn/casino_btn.png"},{name:"casino_btn_h",type:"image",src:"res/ui/btn/casino_btn_h.png"},{name:"chat_arrow",type:"image",src:"res/ui/btn/chat_arrow.png"},{name:"chat_icon",type:"image",src:"res/ui/btn/chat_icon.png"},
{name:"chat_submit",type:"image",src:"res/ui/btn/chat_submit.png"},{name:"chat_submit_h",type:"image",src:"res/ui/btn/chat_submit_h.png"},{name:"close",type:"image",src:"res/ui/btn/close.png"},{name:"close_h",type:"image",src:"res/ui/btn/close_h.png"},{name:"map",type:"image",src:"res/ui/btn/map.png"},{name:"map_h",type:"image",src:"res/ui/btn/map_h.png"},{name:"menu",type:"image",src:"res/ui/btn/menu.png"},{name:"menu_h",type:"image",src:"res/ui/btn/menu_h.png"},{name:"menuicon",type:"image",src:"res/ui/btn/menuicon.png"},
{name:"nearby_tab_btn",type:"image",src:"res/ui/btn/nearby_tab_btn.png"},{name:"nearby_tab_btn_h",type:"image",src:"res/ui/btn/nearby_tab_btn_h.png"},{name:"pb_up",type:"image",src:"res/ui/btn/pb_up.png"},{name:"pb_up_h",type:"image",src:"res/ui/btn/pb_up_h.png"},{name:"popupbox_btn",type:"image",src:"res/ui/btn/popupbox_btn.png"},{name:"postMessage",type:"image",src:"res/ui/btn/postMessage.png"},{name:"postMessage_h",type:"image",src:"res/ui/btn/postMessage_h.png"},{name:"recharge",type:"image",
src:"res/ui/btn/recharge.png"},{name:"recharge_h",type:"image",src:"res/ui/btn/recharge_h.png"},{name:"shop_tag_bg",type:"image",src:"res/ui/btn/shop_tag_bg.png"},{name:"shop_tag_h_bg",type:"image",src:"res/ui/btn/shop_tag_h_bg.png"},{name:"tab_left_bg",type:"image",src:"res/ui/btn/tab_left_bg.png"},{name:"tab_left_bg_h",type:"image",src:"res/ui/btn/tab_left_bg_h.png"},{name:"tab_right_bg",type:"image",src:"res/ui/btn/tab_right_bg.png"},{name:"tab_right_bg_h",type:"image",src:"res/ui/btn/tab_right_bg_h.png"},
{name:"task_accept_btn",type:"image",src:"res/ui/btn/task_accept_btn.png"},{name:"task_disable_btn",type:"image",src:"res/ui/btn/task_disable_btn.png"},{name:"task_submit_btn",type:"image",src:"res/ui/btn/task_submit_btn.png"},{name:"task_tab_btn",type:"image",src:"res/ui/btn/task_tab_btn.png"},{name:"task_tab_btn_h",type:"image",src:"res/ui/btn/task_tab_btn_h.png"}],fightScene:[{name:"fi_mark_bg",type:"image",src:"res/ui/layout/f/fi_mark_bg.png"},{name:"fi_top_bg",type:"image",src:"res/ui/layout/f/fi_top_bg.png"},
{name:"res_bg",type:"image",src:"res/ui/layout/f/res_bg.png"},{name:"res_lose_tab",type:"image",src:"res/ui/layout/f/res_lose_tab.png"},{name:"res_star_bg",type:"image",src:"res/ui/layout/f/res_star_bg.png"},{name:"res_starwin_bg",type:"image",src:"res/ui/layout/f/res_starwin_bg.png"},{name:"res_win_tab",type:"image",src:"res/ui/layout/f/res_win_tab.png"}],characterWindow:[{name:"0_buff",type:"image",src:"res/ui/ci/0/0_buff.png"},{name:"0_bust",type:"image",src:"res/ui/ci/0/0_bust.png"},{name:"0_photo",
type:"image",src:"res/ui/ci/0/0_photo.png"},{name:"0_tab",type:"image",src:"res/ui/ci/0/0_tab.png"},{name:"0_tab_h",type:"image",src:"res/ui/ci/0/0_tab_h.png"}],casinoScene:[{name:"casino_font_bg",type:"image",src:"res/ui/layout/g/casino_font_bg.png"},{name:"casino_photoleft_bg",type:"image",src:"res/ui/layout/g/casino_photoleft_bg.png"},{name:"casino_photoright_bg",type:"image",src:"res/ui/layout/g/casino_photoright_bg.png"},{name:"dice",type:"image",src:"res/ui/layout/g/dice.png"}]};var UI=function(){return{isDebug:!1,gameCanvas:null,scale:0.9,mainDiv:null,lang:null,canUseLang:{en:"en_US",zh:"zh_TW",de:"de_DE",es:"es_ES",fr:"fr_FR",it:"it_IT",ja:"ja_JP",ko:"ko_KR",pt:"pt_BR",ru:"ru_RU","zh-cn":"zh_CN"},offset:{left:0,top:0,right:0,bottom:0},sceneSize:{width:window.innerWidth,height:window.innerHeight},deviceType:"pc",enums:{deviceType:{touch:1,pc:2}},sys:{fps:200,enable_shadow:!0}}}();window.UI=UI;
(function(a,c){a.init=function(b){a.mainDiv=a.getDom("body")[0];a.deviceType=btg.os;a.gameCanvas=btg.canvas||a.getDom("#canvas");window.sceneSize=a.sceneSize={width:window.innerWidth,height:window.innerHeight};var d=(navigator.language||navigator.browserLanguage).toLowerCase(),d="zh-cn"===d?"zh-cn":d.slice(0,d.indexOf("_"));a.lang=a.canUseLang[d]||"en_US";d=null;a.offset.left=a.gameCanvas.offsetLeft;a.offset.top=a.gameCanvas.offsetTop;a.offset.right=a.gameCanvas.offsetLeft;a.offset.bottom=a.gameCanvas.offsetTop;
"function"!=typeof document.querySelector&&(document.querySelector=function(a){return document.getElementById(a.replace("#",""))});a._ui=new c.ui.core;b&&(a.isDebug=b);a.debug("width:"+a.sceneSize.width+" height:"+a.sceneSize.height);a.debug("offset left:"+a.offset.left)};a.bind=function(b,d,c,f){"string"===typeof b&&(b=a.getDom(b),b.hasOwnProperty("length")&&(b=b[f]));b.addEventListener?b.addEventListener(d,c,!!f||!1):b.attachEvent("on"+d,c)};a.live=function(a,d,c,f){function g(d){var c;"string"===
typeof a&&(c="."===a[0]?"className":"id");return c?a.slice(1)==d[c]:a==d}f=f||document;f.addEventListener?f.addEventListener(d,function(a){g(a.srcElement||a.target)&&c.call(a.srcElement||a.target,a)},!0):f.attachEvent(d,function(a){g(a.srcElement||a.target)&&c.call(a.srcElement||a.target,a)});f=null};a.unbind=function(b,d,c,f){"string"===typeof b&&("undefined"!=typeof a[b]?b=a[b]:(b=a.getDom(b),b.hasOwnProperty("length")&&(b=b[f])));b.removeEventListener?b.removeEventListener(d,c,!1):b.detachEvent("on"+
d,c)};a.fire=function(b,d,c,f){"string"===typeof b&&(b=a.getDom(b),b.hasOwnProperty("length")&&(b=b[f]));b.addEventListener?b.click():(d=document.createEvent("MouseEvents"),d.initEvent("click",!0,!0),b.dispatchEvent(d))};a.stopPropagation=function(a){a=a||window.event;a.cancelBubble=!0;a.stopPropagation&&a.stopPropagation()};a.vendor=function(b){if(void 0!=document.body.style[b])return b;for(var d=["webkit","Moz","O","ms"],c=0,f=d.length;c<f;++c)if(b=d[c]+b[0].toUpperCase()+b.slice(1),void 0!=a.mainDiv.style[b])return b};
a.getDom=function(a){return 0===a.indexOf("#")?document.querySelector(a):document.querySelectorAll(a)};a.show=function(a){a.style.display="block"};a.hide=function(a){a.style.display="none"};a.toggle=function(b){if("block"==b.style.display)a.hide(b);else return a.show(b),!0;return!1};a.initSceneItems=function(a,d){if(null==a.items){a.items={};for(var c="",f=0;f<d.length;f++){a.items[d[f].name]={};d[f].hasOwnProperty("style")&&(a.items[d[f].name].style=d[f].style);a.items[d[f].name].className=d[f].className||
"";for(var g=0;g<d[f].items.length;g++)c=d[f].items[g].name.replace("#","").replace(".",""),a.items[d[f].name][c]={},a.items[d[f].name][c].style=d[f].items[g].style,d[f].items[g].hasOwnProperty("className")&&(a.items[d[f].name][c].className=d[f].items[g].className)}}};a.addPx=function(a){var d={},c;for(c in a)d[c]="number"==typeof a[c]?a[c]+"px":a[c];return d};a.getStyle=function(a,d,c){return a.items[d][c].style};a.formatSingleNode=function(b,d,c,f){var b=a.getStyle(b,d,c),c=RegExp("{"+c+"}","g"),
d="",g;for(g in b)d="number"==typeof b[g]?d+(g+":"+b[g]+"px;"):d+(g+":"+b[g]+";");return f=f.replace(c,d)};a.debug=function(b){a.isDebug&&console.log(b)};a.display=function(a,d){for(var d=!0===d?"block":"none",c=0,f=a.length||1;c<f;c++){if(1===f){a.style.display=d;break}a[c].style.display=d}};a.onProgress=function(){};a.loaded=function(a){loading.hide();a.call(this)};a.loading=function(b,d){loading.show();object=this;3==arguments.length&&(object=arguments[2]);me.loader.onload=a.loaded.bind(object,
b);me.loader.preload(d)};a.getRect=function(a,d){var c=me.loader.getImage(d);a.width=c.width+"px";a.height=c.height+"px"};a.Tween={Bounce:{easeIn:function(a,d,c,f){return c-Tween.Bounce.easeOut(f-a,0,c,f)+d},easeOut:function(a,d,c,f){return(a/=f)<1/2.75?c*7.5625*a*a+d:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+0.75)+d:a<2.5/2.75?c*(7.5625*(a-=2.25/2.75)*a+0.9375)+d:c*(7.5625*(a-=2.625/2.75)*a+0.984375)+d},easeInOut:function(a,d,c,f){return a<f/2?0.5*Tween.Bounce.easeIn(2*a,0,c,f)+d:0.5*Tween.Bounce.easeOut(2*
a-f,0,c,f)+0.5*c+d}}};a.animate=function(b,d,c,f,g){function h(a){var g=(new Date).getTime(),h=c,i=parseInt(b.style[a])||b.offsetTop,l=parseInt(d[a]);(function(){var d=(new Date).getTime()-g;if(d>h)return d=h,b.style[a]=k(i,l,d,h)+"px",++finishedFrame===j&&f&&f.apply(b),!0;b.style[a]=k(i,l,d,h)+"px";setTimeout(arguments.callee,13)})()}function i(){this.def=function(a,b,d,c){return-(b-a)*(d/=c)*(d-2)+a};this.easeOutBack=function(a,b,d,c){return(d/=c)<1/2.75?(b-a)*7.5625*d*d+a:d<2/2.75?(b-a)*(7.5625*
(d-=1.5/2.75)*d+0.75)+a:d<2.5/2.75?(b-a)*(7.5625*(d-=2.25/2.75)*d+0.9375)+a:(b-a)*(7.5625*(d-=2.625/2.75)*d+0.984375)+a};return this}if(c){var j=finishedFrame=0,k=i()[g||"def"];for(n in d)++j,h(a.vendor(n))}else{for(var n in d)b.style[a.vendor(n)]=d[n];f&&f.apply(b);return!0}}})(window.UI,smartlib);(function(a){a.mainScene={};a.menus=["character","package","skill","formation","pirateBoat"];a.mainScene.reflowPosition=function(){for(var c=0;c<ui_config.mainScene.length;c++)a.mainScene[ui_config.mainScene[c].name].style.top=parseInt(ui_config.mainScene[c].style.top)+a.offset.top+"px",a.mainScene[ui_config.mainScene[c].name].style.left=parseInt(ui_config.mainScene[c].style.left)+a.offset.left+"px"};a.initMainScene=function(){a.initSceneItems(a.mainScene,ui_config.mainScene);a.bind(window,"resize",
function(){a.sceneSize={width:window.innerWidth,height:window.innerHeight};a.offset.left=a.gameCanvas.offsetLeft;a.offset.top=a.gameCanvas.offsetTop;a.mainScene.reflowPosition()});a.mainScene.createMainScene();a.mainScene.reflowPosition();a.mainScene.setExp();new iScroll("chatRoom",{hScrollbar:!0,vScrollbar:!0})};a.mainScene.createMainScene=function(){for(var c=document.createDocumentFragment(),b=0;b<ui_config.mainScene.length;b++)switch(ui_config.mainScene[b].name){case "leftTop":a.mainScene.createLeftTop(c,
"");break;case "rightTop":a.mainScene.createRightTop(c,"");break;case "leftBottom":a.mainScene.createLeftBottom(c,"");break;case "rightCenter":a.mainScene.createRightCenter(c,"");break;case "rightBottom":a.mainScene.createRightBottom(c,"");break;case "marquee":a.mainScene.createMarquee(c,"")}a.mainDiv.appendChild(c);a.mainScene.doMarquee();a.chatWindow.bindEvent();a.characterWindow.bindEvent();a.taskWindow.bindEvent();a.dialogueScene.bindEvent()};a.mainScene.createLeftTop=function(c){a.mainScene.leftTop=
a._ui.makeDom("div",{id:"leftTop"},a.addPx(a.mainScene.items.leftTop.style),null);for(var b=ui_config.mainScene[0].items,d=null,e="div",f="",g="",h="",i={},d={},j=0;j<b.length;j++){d=a.addPx(b[j].style);b[j].bgName&&a.getRect(d,b[j].bgName);for(var d=a._ui.makeDom("div",{id:b[j].name.replace("#","")},d,null),k=0;k<b[j].items.length;k++)b[j].items[k].hasOwnProperty("tag")&&(e=b[j].items[k].tag),f=b[j].items[k].className||"",g=b[j].items[k].innerText||"",h=b[j].items[k].innerHTML||"",i="img"==e?{src:btg.mainPlayer.photo,
alt:btg.mainPlayer.nickname}:{id:b[j].items[k].name.replace("#","")},i.className=f,""!=g&&(i.innerText=btg.mainPlayer[g]),""!=h&&(i.innerHTML=h),d.appendChild(a._ui.makeDom(e,i,a.addPx(b[j].items[k].style),null)),e="div";a.mainScene.leftTop.appendChild(d)}c.appendChild(a.mainScene.leftTop)};a.mainScene.createRightTop=function(c){a.mainScene.rightTop=a._ui.makeDom("div",{id:"rightTop"},a.addPx(a.mainScene.items.rightTop.style),null);for(var b=ui_config.mainScene[1].items,d=null,e=0;e<b.length;e++){for(var d=
a._ui.makeDom("div",{id:b[e].name.replace("#","")},a.addPx(b[e].style),null),f=0;f<b[e].items.length;f++)d.appendChild(a._ui.makeDom("div",{id:b[e].items[f].name.replace("#","")},a.addPx(b[e].items[f].style),{click:function(){btg.mainPlayer.goToFight()}}));a.mainScene.rightTop.appendChild(d)}c.appendChild(a.mainScene.rightTop)};a.mainScene.createLeftBottom=function(c){a.mainScene.leftBottom=a._ui.makeDom("div",{id:"leftBottom"},a.addPx(a.mainScene.items.leftBottom.style),null);for(var b=ui_config.mainScene[2].items,
d=null,e="",f=0;f<b.length;f++){for(var d=a._ui.makeDom("div",{id:b[f].name.replace("#","")},a.addPx(b[f].style),null),g=0;g<b[f].items.length;g++)b[f].items[g].hasOwnProperty("innerHTML")&&(e=b[f].items[g].innerHTML),d.appendChild(a._ui.makeDom("div",{id:b[f].items[g].name.replace("#",""),innerHTML:e},b[f].items[g].style,null)),e="";a.mainScene.leftBottom.appendChild(d)}c.appendChild(a.mainScene.leftBottom)};a.mainScene.createRightCenter=function(c){a.mainScene.rightCenter=a._ui.makeDom("div",{id:"rightCenter"},
a.addPx(a.mainScene.items.rightCenter.style),null);for(var b=ui_config.mainScene[3].items,d=0;d<b.length;d++)a.mainScene.rightCenter.appendChild(a._ui.makeDom("div",{id:b[d].name.replace("#",""),className:"rightCenter"},a.addPx(b[d].style),null));c.appendChild(a.mainScene.rightCenter)};a.mainScene.createRightBottom=function(c){a.mainScene.rightBottom=a._ui.makeDom("div",{id:"rightBottom"},a.addPx(a.mainScene.items.rightBottom.style),null);a.mainScene.rightBottom.appendChild(a._ui.makeDom("div",{id:"menu"},
{position:"absolute",background:"url(./res/ui/btn/menu.png)",width:"79px",height:"79px",top:"0px",left:"0px","z-index":100},{click:function(){for(var b="",d=0;d<a.menus.length;d++)b=a.getDom("#menu_"+(d+1)),""==b.className||"hide"==b.className?(this.style.background="url(./res/ui/btn/menu_h.png)",b.className="show"):(this.style.background="url(./res/ui/btn/menu.png)",b.className="hide")}}));for(var b="",d=a._ui.makeDom("ul",{className:"items"},{},null),e=null,f=0;f<a.menus.length;f++)b=a.menus[f],
e=a._ui.makeDom("li",{id:"menu_"+(f+1)},{position:"absolute",left:"0px",top:"0px",width:menu.width+"px",height:menu.width+"px","background-image":"url(res/ui/btn/menuicon.png)","background-position":"0px -"+menu.width*f+"px","background-repeat":"no-repeat"},{click:function(b){"character"==this.getAttribute("data-name")&&(a.stopPropagation(b),a.mainPlayerWindow=new a.characterWindow,a.loading(a.mainPlayerWindow.createWindow,ui_resources.characterWindow,a.mainPlayerWindow));"task"==this.getAttribute("data-name")&&
a.showTaskWindow();"package"==this.getAttribute("data-name")&&a.packageWindow.showPackageWindow();"skill"==this.getAttribute("data-name")&&a.skillWindow.showSkillWindow();"formation"==this.getAttribute("data-name")&&a.formationWindow.showFormationWindow();"pirateBoat"==this.getAttribute("data-name")&&a.pirateBoatWindow.showPirateBoatWindow()},mousedown:function(){var a=this.style.backgroundPosition.split(" ");this.style.backgroundPosition=a[0].replace("0","-"+menu.width)+" "+a[1]},mouseup:function(){var a=
this.style.backgroundPosition.split(" ");this.style.backgroundPosition=a[0].replace("-"+menu.width,"0")+" "+a[1]}}),e.setAttribute("data-name",b),d.appendChild(e);a.mainScene.rightBottom.appendChild(d);c.appendChild(a.mainScene.rightBottom)};a.mainScene.createMarquee=function(c){a.mainScene.marquee=a._ui.makeDom("div",{id:"marquee",className:a.mainScene.items.marquee.className||""},a.mainScene.items.marquee.style,{click:function(){a.mainScene.hide();a.loading(a.casinoScene.init,ui_resources.casinoScene)}});
for(var b=ui_config.mainScene[5].items,d={},e=0;e<b.length;e++)d=b[e].style,d.width="270px",a.mainScene.marquee.appendChild(a._ui.makeDom("div",{id:b[e].name.replace("#",""),innerHTML:"\u4f60\u77e5\u9053\u7684\u6211\u77e5\u9053\u4f60\u77e5\u9053\u7684\u6211\u90fd\u77e5\u9053"},d,null));a.mainScene.count=0;b=null;c.appendChild(a.mainScene.marquee)};a.mainScene.doMarquee=function(){var c=a.getDom("#marquee_message");a.mainScene.count<=-519-c.clientWidth?clearTimeout(a.mainScene.timer):(a.mainScene.count-=
3,c.style.webkitTransform="translate3d("+(a.mainScene.count+"px")+","+c.style.top+",0px)",a.mainScene.timer=setTimeout(a.mainScene.doMarquee,100))};a.mainScene.show=function(){for(var c=0;c<ui_config.mainScene.length;c++)a.show(a.getDom("#"+ui_config.mainScene[c].name))};a.mainScene.hide=function(){for(var c=0;c<ui_config.mainScene.length;c++)a.hide(a.getDom("#"+ui_config.mainScene[c].name))};a.mainScene.setExp=function(){a.getDom("#currentExp").innerHTML=btg.mainPlayer.currentExp;a.getDom("#needExp").innerHTML=
btg.mainPlayer.needExp;a.getDom("#experience_progress").style.width=164*(btg.mainPlayer.currentExp/btg.mainPlayer.needExp)+"px"}})(window.UI,smartlib);(function(a,c){a.fightScene={};a.fightScene.suffix="fightScene_";a.fightScene.items=null;var b=[{cId:0},{cId:0},{cId:0}],d=[{cId:0}];a.fightScene.reflowPosition=function(){for(var b=0;b<ui_config.fightScene.length;b++)a.fightScene[ui_config.fightScene[b].name].style.top=parseInt(ui_config.fightScene[b].style.top.replace("px",""))+a.offset.top+"px",a.fightScene[ui_config.fightScene[b].name].style.left=parseInt(ui_config.fightScene[b].style.left.replace("px",""))+a.offset.left+"px"};a.fightScene.createScene=
function(){null==a.fightScene.items?(a.initSceneItems(a.fightScene,ui_config.fightScene),a.fightScene._ui=new c.ui.core,a.bind(window,"resize",function(){a.fightScene.reflowPosition()}),a.fightScene.createDom(),a.fightScene.reflowPosition()):a.fightScene.show()};a.fightScene.createDom=function(){var b=document.createDocumentFragment();a.fightScene.createTop(b,"");a.fightScene.createLeftCharactor(b,"");a.fightScene.createRightCharactor(b,"");a.fightScene.createRightBottom(b,"");a.mainDiv.appendChild(b)};
a.fightScene.createTop=function(c){var f=a.fightScene.suffix+"top",g=ui_config.fightScene[0].items,h="",i="";a.fightScene.top=a._ui.makeDom("div",{id:f},a.fightScene.items.top.style,null);for(var j=0;j<g.length;j++)g[j].hasOwnProperty("className")&&(h=g[j].className),g[j].hasOwnProperty("className")&&(i=g[j].innerText),a.fightScene.top.appendChild(a._ui.makeDom("div",{id:f+"_"+g[j].name,className:h,innerText:i},g[j].style,null)),h="";for(j=0;j<b.length;j++)a.fightScene.top.appendChild(a._ui.makeDom("div",
{id:f+"_l_cr"+j,className:ui_config.waterDrop.className,innerText:j},{left:ui_config.waterDrop.l_cr_begin.left+"px",top:ui_config.waterDrop.l_cr_begin.top+"px"},null));for(j=0;j<d.length;j++)a.fightScene.top.appendChild(a._ui.makeDom("div",{id:f+"_r_cr"+j,className:ui_config.waterDrop.className,innerText:j},{left:ui_config.waterDrop.r_cr_begin.left+"px",top:ui_config.waterDrop.r_cr_begin.top+"px"},null));c.appendChild(a.fightScene.top)};a.fightScene.createLeftCharactor=function(d,c){a.fightScene.createCharactor(d,
c,"left",b)};a.fightScene.createRightCharactor=function(b,c){a.fightScene.createCharactor(b,c,"right",d)};a.fightScene.createCharactor=function(b,d,c,h){var d=a.fightScene.suffix+c+"Character",i="",i="left"==c?"l_cr1":"r_cr1",j=a.fightScene.items[c+"Character"][i].style;a.fightScene[c+"Character"]=a._ui.makeDom("div",{id:d},a.fightScene.items[c+"Character"].style,null);for(var k=0;k<h.length;k++)a.fightScene[c+"Character"].appendChild(a._ui.makeDom("div",{id:d+"_cr_"+k,className:a.fightScene.items[c+
"Character"][i].className,innerHTML:'<img src="res/ui/ci/'+h[k].cId+"/"+h[k].cId+'_photo.png" class="fight-character" style="max-width:'+j.width+'px"></img>'},{left:j.left+"px",top:j.top+k*j.height+k*j["margin-bottom"]+"px",width:j.width+"px",height:j.height+"px"},null));b.appendChild(a.fightScene[c+"Character"])};a.fightScene.createRightBottom=function(b){var d=a.fightScene.suffix+"rightBottom",c=ui_config.fightScene[3].items,h="";a.fightScene.rightBottom=a._ui.makeDom("div",{id:d},a.fightScene.items.rightBottom.style,
null);for(var i=0;i<c.length;i++)c[i].hasOwnProperty("className")&&(h=c[i].className),a.fightScene.rightBottom.appendChild(a._ui.makeDom("div",{id:d+"_"+c[i].name,className:h,innerText:"\u8df3\u8fc7\u6218\u6597"},c[i].style,{click:function(){btg.mainPlayer.quitFight()}})),h="";h=c=d=null;b.appendChild(a.fightScene.rightBottom)};a.fightScene.updateLeftRound=function(b){a.getDom("#fightScene_top_round_left").innerHTML=b};a.fightScene.updateRightRound=function(b){a.getDom("#fightScene_top_round_right").innerHTML=
b};a.fightScene.show=function(){for(var b=0;b<ui_config.fightScene.length;b++)a.show(a.getDom("#"+a.fightScene.suffix+ui_config.fightScene[b].name))};a.fightScene.hide=function(){for(var b=0;b<ui_config.fightScene.length;b++)a.hide(a.getDom("#"+a.fightScene.suffix+ui_config.fightScene[b].name))}})(window.UI,smartlib);(function(a){a.ui.baseWindow=function(c){c=a.interFace({id:"window",type:"window",className:"",width:363,height:467,left:ui_config.window.left+UI.offset.left,top:ui_config.window.top,fontSize:"14px",color:"#000000",textShadow:"",titleHeight:40,titleFontSize:24,titleTextAlign:"center",title:"\u5f39\u51fa\u6846",x:-1,y:-1,block:!1,items:[],hided:!1,bgColor:"",blockColor:"rgba(0, 0, 0, 0.5)",background:"url(./res/ui/layout/c/window_bg.png) no-repeat",closeBtnUi:{bg:"url(./res/ui/btn/close.png) no-repeat",
bg_h:"url(./res/ui/btn/close_h.png) no-repeat",width:60,height:60,top:-20,right:-20},closed:function(){},zIndex:513,html:"",parentNode:null},c||{});a.ui.core.call(this,c.id,c.x,c.y,c.width,c.height,c.hided);this.block=c.block;this.activeTab=c.activeTab;this.data=c.data;this.parentNode=c.parentNode;var b=this;this.blockContext=null;this.closed=c.closed;this.html=c.html;this.type=c.type;this._closeBtn={bg:c.closeBtnUi.bg,bg_h:c.closeBtnUi.bg_h};this.block&&(this.blockContext=document.createElement("div"),
this.blockContext.style.position="absolute",this.blockContext.style.left="0px",this.blockContext.style.top="0px",this.blockContext.style.width=window.innerWidth+"px",this.blockContext.style.height=window.innerHeight+"px",this.blockContext.style.backgroundColor=c.blockColor,this.blockContext.style.zIndex=c.zIndex,this.blockContext.style.display=this.hided?"none":"block",UI.mainDiv.appendChild(this.blockContext));this.dom=this.makeDom("div",{id:c.id,innerHTML:this.html,className:c.className},{position:"absolute",
left:c.left+"px",top:c.top+"px",width:this.width+"px",height:this.height+"px",color:c.color,background:c.background,zIndex:c.zIndex},null);this.dom.appendChild(this.makeDom("div",{innerHTML:c.title},{position:"absolute",left:"0",top:"0",width:this.width+"px",height:c.titleHeight+"px",lineHeight:c.titleHeight+"px",fontSize:c.titleFontSize+"px",color:c.color,textAlign:c.titleTextAlign},null));this.dom.appendChild(this.makeDom("div",{id:"closeBtn"},{position:"absolute",right:c.closeBtnUi.right+"px",
top:c.closeBtnUi.top+"px",background:c.closeBtnUi.bg,width:c.closeBtnUi.width+"px",height:c.closeBtnUi.height+"px"},{click:function(){b.destroy()},mousedown:function(){this.style.background=b._closeBtn.bg_h},mouseup:function(){this.style.background=b._closeBtn.bg},mouseover:function(){this.style.background=b._closeBtn.bg_h},mouseout:function(){this.style.background=b._closeBtn.bg}}));c=null;return this};a.extend(a.ui.baseWindow,a.ui.core,{show:function(){this.dom.style.display="block"},hide:function(){this.dom.style.display=
"none"},destroy:function(){this.dom&&(a.ui.baseWindow.beforeClosed&&a.ui.baseWindow.beforeClosed(),this.blockContext&&(null!=this.parentNode?this.parentNode.removeChild(this.blockContext):document.body.removeChild(this.blockContext)),this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.closed&&this.closed(this.dom),this.dom=null,a.ui.baseWindow.afterClosed&&a.ui.baseWindow.afterClosed());return this}});a.ui.baseWindow.beforeClosed=null;a.ui.baseWindow.afterClosed=null})(smartlib);(function(a){a.windowManager={};a.windowManager.windows=[];a.windowManager.scene={};a.windowManager.messageBox={};var c;a.bind(window,"resize",function(){c&&clearTimeout(c);c=setTimeout(function(){a.windowManager.reflowPosition()},100)});a.windowManager.coexistMatch={strengthenWindow:"pirateBoatWindow",packageWindow:"characterWindow",characterWindow:"packageWindow"};a.windowManager.push=function(b,d){var c=b.w.dom.id.match(/Window|Scene|messageBox/)[0];console.log(c);if("Scene"===c)a.windowManager.scene.close&&
a.windowManager.scene.close(),a.windowManager.scene=b,a.windowManager.reflowPositionScene();else if("messageBox"===c)a.windowManager.messageBox.close&&a.windowManager.messageBox.close(),a.windowManager.messageBox=b,a.windowManager.reflowPositionMessageBox();else{if(this.windows.length&&this.windows[0].w.type!==this.coexistMatch[b.w.type]){for(var c=0,f=this.windows[0].w.dom.childNodes.length;c<f;c++)if("closeBtn"===this.windows[0].w.dom.childNodes[c].id){a.fire(this.windows[0].w.dom.childNodes[c],
"click");break}this.windows.pop()}this.windows.push({w:b.w,l:b.tabs?55:115,offsetLeft:d||0});a.windowManager.reflowPositionWindow()}};a.windowManager.pop=function(b){var d=b.w.dom.id.match(/Window|Scene|messageBox/)[0];if("Scene"===d)a.windowManager.scene={};else if("messageBox"===d)a.windowManager.messageBox={};else for(d=this.windows.length-1;0<=d;d--)if(this.windows[d].w.dom.id==b.w.dom.id){this.windows.splice(d,1);break}};a.windowManager.reflowPosition=function(){a.windowManager.reflowPositionScene();
a.windowManager.reflowPositionWindow();a.windowManager.reflowPositionMessageBox()};a.windowManager.reflowPositionWindow=function(){0!=a.windowManager.windows.length&&(1==a.windowManager.windows.length?a.animate(a.windowManager.windows[0].w.dom,{left:a.offset.left+(this.windows[0].offsetLeft||~~((960-parseInt(this.windows[0].w.dom.style.width))/2))+"px",top:a.offset.top+ui_config.window.top+"px"}):2==a.windowManager.windows.length&&parseInt(a.windowManager.windows[0].w.dom.style.left)==485+a.offset.left?
a.animate(a.windowManager.windows[1].w.dom,{left:a.windowManager.windows[1].l+a.offset.left+"px",top:a.offset.top+ui_config.window.top+"px"},a.sys.fps):(a.animate(a.windowManager.windows[0].w.dom,{left:a.windowManager.windows[0].l+a.offset.left+"px",top:a.offset.top+ui_config.window.top+"px"},a.sys.fps),a.animate(a.windowManager.windows[1].w.dom,{left:485+a.offset.left+"px",top:a.offset.top+ui_config.window.top+"px"},a.sys.fps)),a.characterWindow.attrWindow.w.dom&&a.animate(a.characterWindow.attrWindow.w.dom,
{left:a.windowManager.windows[0].l+a.offset.left+parseInt(a.characterWindow.w.dom.style.width)+5+"px",top:a.offset.top+ui_config.window.top+"px"},a.sys.fps))};a.windowManager.reflowPositionScene=function(){a.windowManager.scene.reflowPosition&&a.windowManager.scene.reflowPosition()};a.windowManager.reflowPositionMessageBox=function(){a.messageBox.w.dom&&a.messageBox.reflowPosition&&a.messageBox.reflowPosition()}})(window.UI,smartlib);(function(a,c){a.taskWindow={};a.taskWindow.taskType=["currentMainTask","currentBranchTask","currentDayTask","currentExerciseTask"];a.taskWindow.w={};a.taskWindow.initTaskWindow=function(){var b=document.createDocumentFragment();a.taskWindow.w=new c.ui.baseWindow({title:"\u4efb&nbsp;\u52a1",closed:function(){a.windowManager.pop(a.taskWindow);a.taskWindow.w={}},id:"taskWindow"});for(var d=0,e;d<a.taskWindow.taskType.length;d++){e=a._ui.makeDom("div",{className:taskWindow[0].items[0].name},taskWindow[0].items[0].style,
null);e.style.top=100*d+50+"px";e.dataset.taskType=a.taskWindow.taskType[d];var f=document.createDocumentFragment();a.taskWindow[a.taskWindow.taskType[d]]={};for(var g=taskWindow[0].items.length-1,h;0<g;g--)h=a._ui.makeDom("div",{className:taskWindow[0].items[g].name,innerHTML:taskWindow[0].items[g].innerHTML||""},taskWindow[0].items[g].style,null),f.appendChild(h),a.taskWindow[a.taskWindow.taskType[d]][h.className]=h;a.taskWindow[a.taskWindow.taskType[d]].rewards=[];a.taskWindow[a.taskWindow.taskType[d]].rewards[0]=
a._ui.makeDom("span",{},{"padding-left":"6px"},null);a.taskWindow[a.taskWindow.taskType[d]]["task-reward"].appendChild(a.taskWindow[a.taskWindow.taskType[d]].rewards[0]);a.taskWindow[a.taskWindow.taskType[d]].rewards[1]=a._ui.makeDom("span",{},{"padding-left":"4px"},null);a.taskWindow[a.taskWindow.taskType[d]]["task-reward"].appendChild(a.taskWindow[a.taskWindow.taskType[d]].rewards[1]);e.appendChild(f);b.appendChild(e)}a.taskWindow.w.dom.appendChild(b);b=null;a.windowManager.push(a.taskWindow);a.taskWindow.w.dom.style.opacity=
0;a.mainDiv.appendChild(a.taskWindow.w.dom)};a.taskWindow.fillData=function(b,d){var c=[{taskStatusText:"\u53ef\u63a5",taskStatusClass:"accepted",taskBtnText:"\u63a5\u53d7",taskBtnStatus:"enableTask"},{taskStatusText:"\u5df2\u63a5",taskStatusClass:"unfinished",taskBtnText:"\u8fdb\u884c\u4e2d",taskBtnStatus:"enableTask"},{taskStatusText:"\u4e0d\u53ef\u63a5",taskStatusClass:"disable",taskBtnText:"\u63a5\u53d7",taskBtnStatus:"disableTask"},{taskStatusText:"\u5df2\u5b8c\u6210",taskStatusClass:"finished",
taskBtnText:"\u63d0\u4ea4",taskBtnStatus:"submitTask"}],f;for(f in d)b[f]["task-type"].style.background="url(./res/ui/font/"+a.lang+"/"+f.replace("current","")+".png) no-repeat",b[f]["task-name"].innerHTML="["+d[f].taskName+']<span class="task-'+c[d[f].status].taskStatusClass+'">('+c[d[f].status].taskStatusText+")</span>",b[f]["task-description"].innerHTML=d[f].taskDescription,b[f].rewards[0].innerHTML="\u7ecf\u9a8c"+d[f].getExp,b[f].rewards[1].innerHTML="\u91d1\u94b1"+d[f].getMoney,b[f]["submit-btn"].className+=
" "+c[d[f].status].taskBtnStatus,b[f]["submit-btn"].innerHTML=c[d[f].status].taskBtnText};a.taskWindow.showTaskWindow=function(){a.taskWindow.w.dom||a.taskWindow.initTaskWindow();a.display(a.taskWindow.w.dom,!0);a.taskWindow.w.dom.style.opacity=1;btg.game_socket.getCurrentTaskInfo()};a.taskWindow.bindEvent=function(){a.bind("#task","click",function(b){a.stopPropagation(b);a.taskWindow.showTaskWindow()})}})(window.UI,smartlib);(function(a){a.chat={};a.chatWindow={};a.chatWindow.currentState=1;a.chatWindow.state={BTN:1,CHATMESSAGE:2,CHATROOM:3};a.showChatWindow=function(c){if(c==a.chatWindow.state.CHATROOM){var b=a.getDom("#chatRoom"),c=a.getDom("#chatMessageDiv"),d=a.getDom("#chat-input-div"),e=a.getDom("#chatWindow-close-btn");a.show(b);a.hide(c);a.display(d,!0);a.display([a.mainScene.leftTop,a.mainScene.rightTop,a.mainScene.rightCenter,a.mainScene.rightBottom],!1);b.className="blackbg";a.animate(b,{height:"403px",width:"881px",
top:"-419px",left:"32px"},a.sys.fps,function(){a.display(e,!0)});a.animate(d,{width:"801px"},a.sys.fps)}else b=a.getDom("#chatBtnDiv"),c=a.getDom("#chatMessageDiv"),d=a.getDom("#chatMessage"),a.show(c),a.hide(b),a.animate(d,{height:"104px",width:"290px",top:"0px"},a.sys.fps,function(){})};a.closeChatWindow=function(c){if(c==a.chatWindow.state.CHATMESSAGE){var b=a.getDom("#chatRoom"),d=a.getDom("#chatMessageDiv"),c=a.getDom("#chat-input-div"),e=a.getDom("#chatWindow-close-btn");a.display([c,e],!1);
a.display([a.mainScene.leftTop,a.mainScene.rightTop,a.mainScene.rightCenter,a.mainScene.rightBottom],!0);a.animate(b,{height:a.getDom("#chatMessage").style.height,width:a.getDom("#chatMessage").style.width,top:a.getDom("#chatMessage").style.top},a.sys.fps,function(){a.hide(b);a.show(d)})}else{var f=a.getDom("#chatBtnDiv"),d=a.getDom("#chatMessageDiv"),c=a.getDom("#chatMessage");a.animate(c,{height:"0px",width:"0px",top:"100px"},a.sys.fps,function(){a.hide(d);a.show(f)})}};a.chat.addMsg=function(c){for(var b=
[],d=0;d<c.length;d++)b.push('<p><span class="nickname">'+c[d][0]+':</span><span class="chatMessage">'+c[d][1]+"</span></p>");a.getDom("#chatContent").innerHTML+=b.join("")};a.chatWindow.bindEvent=function(){a.bind("#chatMessageRight","click",function(c){a.stopPropagation(c);a.closeChatWindow(a.chatWindow.state.BTN)},0);a.bind("#chatMessage","click",function(c){a.stopPropagation(c);a.showChatWindow(a.chatWindow.state.CHATROOM)});a.bind("#chatBtn","click",function(c){a.stopPropagation(c);a.showChatWindow(a.chatWindow.state.CHATMESSAGE)});
a.bind("#chatWindow-close-btn","click",function(c){a.stopPropagation(c);a.closeChatWindow(a.chatWindow.state.CHATMESSAGE)});a.bind("#chat-submit","click",function(){btg.talkToWorld()})}})(window.UI,smartlib);(function(a,c){a.characterWindow=function(){this.cId=btg.mainPlayer.cId};a.characterWindow.equipmentGrid=[0,0,0,0];a.characterWindow.buffGrid=[0,0,0,0];a.characterWindow.attrWindow={showAttrs:[{id:"energy",name:"\u7cbe\u529b"},{id:"getEnergySpeed",name:"\u6062\u590d\u901f\u5ea6"},{id:"br"},{id:"speed",name:"\u79fb\u52a8\u901f\u5ea6"},{id:"br"},{id:"lucky",name:"\u5e78\u8fd0"},{id:"hr"},{id:"life",name:"\u8010\u4e45"},{id:"attack",name:"\u666e\u901a\u653b\u51fb"},{id:"skillHurt",name:"\u6280\u80fd\u653b\u51fb"},
{id:"weaponDef",name:"\u7269\u7406\u9632\u5fa1"},{id:"fireDef",name:"\u706b\u7130\u9632\u5fa1"},{id:"powerful",name:"\u52a8\u529b"},{id:"hr"},{id:"crit",name:"\u66b4\u51fb"},{id:"parry",name:"\u683c\u6321"},{id:"hit",name:"\u547d\u4e2d"},{id:"dodge",name:"\u95ea\u907f"}]};a.characterWindow.attrWindow.w={};a.characterWindow.prototype.createWindow=function(b){b=[{cId:0,name:"\u4eb2\uff0c\u4f60\u61c2\u5f97",equipment:[],experience:10,level:1,energy:10,buff:[]},{cId:0,name:"\u4eb2\uff0c\u4f60\u61c2\u5f97",
equipment:[],experience:10,level:1,energy:10,buff:[]},{cId:-1,name:"\u4eb2\uff0c\u4f60\u61c2\u5f97",equipment:[],experience:10,level:1,energy:10,buff:[]}];a.characterWindow.w=new c.ui.baseWindow({id:"characterWindow"+this.cId,type:"characterWindow",title:"\u89d2&nbsp;\u8272",block:!1,activeTab:0,closed:function(){a.windowManager.pop(a.characterWindow);a.characterWindow.w={};if(a.characterWindow.attrWindow.w.dom)for(var b=0,c=a.characterWindow.attrWindow.w.dom.childNodes.length;b<c;b++)if("closeBtn"===
a.characterWindow.attrWindow.w.dom.childNodes[b].id){a.fire(a.characterWindow.attrWindow.w.dom.childNodes[b],"click");break}if(a.packageWindow.w.dom){b=0;for(c=a.packageWindow.w.dom.childNodes.length;b<c;b++)if("closeBtn"===a.packageWindow.w.dom.childNodes[b].id){a.fire(a.packageWindow.w.dom.childNodes[b],"click");break}}}});c.ui.baseWindow.beforeClosed=function(){};a.windowManager.push(a.characterWindow);a.characterWindow.w.dom.appendChild(a.characterWindow.makeDom(b,a.characterWindow.w));a.mainDiv.appendChild(a.characterWindow.w.dom);
a.bind(window,"resize",function(){a.characterWindow.reflowPosition()})};a.characterWindow.makeDom=function(b,c){for(var e=document.createElement("div"),f={},g=0;g<characterWindow.items.length;g++)switch(characterWindow.items[g].name){case "tab_left_bg":a.characterWindow.createTabLeftBg(e,c,b,"",f,"",characterWindow.items[g]);break;case "equipmentGrid":a.characterWindow.createEquipmentGrid(e,c,b,"",f,"",characterWindow.items[g]);break;case "buffBG":a.characterWindow.createBuffBG(e,c,b,"",f,"",characterWindow.items[g]);
break;case "nickname":a.characterWindow.createNickname(e,c,b,"",f,"",characterWindow.items[g]);break;case "bust":a.characterWindow.createBust(e,c,b,"",f,"",characterWindow.items[g]);break;case "hr":a.characterWindow.createHr(e,c,b,"",f,"",characterWindow.items[g]);break;case "middleBG":a.characterWindow.createMiddleBG(e,c,b,"",f,"",characterWindow.items[g]);break;case "experienceBG":a.characterWindow.createExperienceBG(e,c,b,"",f,"",characterWindow.items[g]);break;case "experience":a.characterWindow.createExperience(e,
c,b,"",f,"",characterWindow.items[g]);break;case "energyBG":a.characterWindow.createEnergyBG(e,c,b,"",f,"",characterWindow.items[g]);break;case "energy":a.characterWindow.createEnergy(e,c,b,"",f,"",characterWindow.items[g]);break;case "addEnergy":a.characterWindow.createAddEnergy(e,c,b,"",f,"",characterWindow.items[g]);break;case "showOnMSBtn":a.characterWindow.showOnMSBtn(e,c,b,"",f,"",characterWindow.items[g])}return e};a.characterWindow.createTabLeftBg=function(b,c,e,f,g,h,i){for(var j=0;j<e.length;j++)j==
c.activeTab&&(f="_h"),h=-1==e[j].cId?"res/ui/ci/d.png":"res/ui/ci/"+e[j].cId+"/"+e[j].cId+"_tab"+f+".png",i.style.background="url("+h+")",g=a._ui.makeDom("div",{id:"characterTab"+j},i.style,{click:a.characterWindow.changeTab}),g.setAttribute("data-cId",e[j].cId),f="",g.style.top=tab.beginTop+tab.height*j+"px",b.appendChild(g)};a.characterWindow.createEquipmentGrid=function(b,c,e,f,g,h,i){for(c=0;c<a.characterWindow.equipmentGrid.length;c++)g=a._ui.makeDom("div",{className:"cell"},i.style,null),g.style.top=
characterWindow.equipmentGrid.beginTop+(grid.width+characterWindow.equipmentGrid.marginTop)*Math.floor(c/2)+"px",g.style.left=characterWindow.equipmentGrid.beginLeft+(grid.width+characterWindow.equipmentGrid.marginLeft)*Math.floor(c%2)+"px",b.appendChild(g)};a.characterWindow.createBuffGrid=function(b,c,e,f,g,h,i){for(c=0;c<a.characterWindow.equipmentGrid.length;c++)g=a._ui.makeDom("div",{className:"cell"},i.style,null),g.style.top=ui_config.characterWindow.buffGrid.beginTop+"px",g.style.left=ui_config.characterWindow.buffGrid.beginLeft+
(grid.width+characterWindow.buffGrid.marginLeft)*c+"px",b.appendChild(g)};a.characterWindow.createBuffTitle=function(b,c,e,f,g,h,i){g=a._ui.makeDom("div",{},i.style,null);b.appendChild(g)};a.characterWindow.createBuffBG=function(b,c,e,f,g,h,i){for(var g=a._ui.makeDom("div",{className:"cr-buffBG"},i.style,null),j={},k=0;k<i.items.length;k++)switch(i.items[k].name){case "buffTitle":a.characterWindow.createBuffTitle(g,c,e,f,j,h,i.items[k]);break;case "buffGrid":a.characterWindow.createBuffGrid(g,c,e,
f,j,h,i.items[k])}b.appendChild(g)};a.characterWindow.createNickname=function(b,c,e,f,g,h,i){g=a._ui.makeDom("div",{id:"cr_nickname",innerHTML:e[c.activeTab].name+'<div id="cr_level">'+e[c.activeTab].level+"</div>"},i.style,null);b.appendChild(g)};a.characterWindow.createBust=function(b,d,e,f,g,h,i){g=a._ui.makeDom("img",{id:"character"+e[d.activeTab].cId,src:"res/ui/ci/"+e[d.activeTab].cId+"/"+e[d.activeTab].cId+"_bust.png"},i.style,{click:function(){var b=this.id.replace("character",""),d=parseInt(a.characterWindow.w.dom.style.left)+
parseInt(a.characterWindow.w.dom.style.width)+5,e=parseInt(a.characterWindow.w.dom.style.top);if(a.characterWindow.attrWindow.w.dom)a.characterWindow.attrWindow.w.show();else{a.characterWindow.attrWindow.w=new c.ui.baseWindow({id:"attrWindow"+b,width:142,height:467,left:d,top:e,background:"url(./res/ui/layout/c/cr_attribute_bg.png) no-repeat",title:"\u5c5e&nbsp;\u6027",titleHeight:46,titleFontSize:20,block:!1,className:"attrWindow",closed:function(){a.characterWindow.attrWindow.w={}}});for(var b=
a._ui.makeDom("div",{},{position:"absolute",left:"20px",top:"70px"},null),d="div",e="",f={},g=0;g<a.characterWindow.attrWindow.showAttrs.length;g++)"br"==a.characterWindow.attrWindow.showAttrs[g].id?(d="br",e=""):"hr"==a.characterWindow.attrWindow.showAttrs[g].id?(d="hr",e="",f={width:"100px"}):(d="div",e=a.characterWindow.attrWindow.showAttrs[g].name+"\uff1a"+btg.mainPlayer[a.characterWindow.attrWindow.showAttrs[g].id]),b.appendChild(a._ui.makeDom(d,{innerHTML:e},f,null));a.characterWindow.attrWindow.w.dom.appendChild(b);
a.mainDiv.appendChild(a.characterWindow.attrWindow.w.dom)}}});b.appendChild(g)};a.characterWindow.createHr=function(b,c,e,f,g,h,i){g=a._ui.makeDom("hr",{},i.style,null);b.appendChild(g)};a.characterWindow.createMiddleBG=function(b,c,e,f,g,h,i){g=a._ui.makeDom("div",{},i.style,null);b.appendChild(g)};a.characterWindow.createExperienceBG=function(b,c,e,f,g,h,i){g=a._ui.makeDom("div",{className:"experienceBG"},i.style,null);b.appendChild(g)};a.characterWindow.createExperience=function(b,c,e,f,g,h,i){g=
a._ui.makeDom("div",{className:"experience",innerText:"1/1"},i.style,null);b.appendChild(g)};a.characterWindow.createEnergyBG=function(b,c,e,f,g,h,i){g=a._ui.makeDom("div",{className:"experienceBG"},i.style,null);b.appendChild(g)};a.characterWindow.createEnergy=function(b,c,e,f,g,h,i){g=a._ui.makeDom("div",{className:"experience",innerText:"1/1"},i.style,null);b.appendChild(g)};a.characterWindow.createAddEnergy=function(b,c,e,f,g,h,i){g=a._ui.makeDom("div",{id:"cr-addEnergy"},i.style,null);b.appendChild(g)};
a.characterWindow.showOnMSBtn=function(b,c,e,f,g,h,i){g=a._ui.makeDom("div",{innerHTML:"\u663e\u793a\u5230\u573a\u666f"},i.style,null);b.appendChild(g)};a.characterWindow.changeTab=function(){var b=this.getAttribute("data-cId"),c=a.characterWindow.w.activeTab,e=a.getDom("#characterTab"+c);-1!=b&&"characterTab"+c!=this.id&&(c="res/ui/ci/"+e.getAttribute("data-cId")+"/"+e.getAttribute("data-cId")+"_tab.png",e.style.background="url("+c+")",this.style.background="url("+("res/ui/ci/"+b+"/"+b+"_tab_h.png")+
")",a.characterWindow.w.activeTab=this.id.replace("characterTab",""))};a.characterWindow.reflowPosition=function(){var b=a.characterWindow.w.dom;b&&(b.style.top=ui_config.window.top+a.offset.top+"px",b.style.left=ui_config.window.left+a.offset.left+"px",a.characterWindow.attrWindow.w.dom&&(a.characterWindow.attrWindow.w.dom.style.left=parseInt(b.style.left)+parseInt(b.style.width)+5+"px"))};a.characterWindow.bindEvent=function(){a.bind("#mainPlayer","click",function(b){a.stopPropagation(b);a.mainPlayerWindow=
new a.characterWindow;a.loading(a.mainPlayerWindow.createWindow,ui_resources.characterWindow,a.mainPlayerWindow)})}})(window.UI,smartlib);(function(a,c){a.packageWindow={};a.packageWindow.w={};a.packageWindow.initPackageWindow=function(){a.packageWindow.w=new c.ui.baseWindow({title:"\u7269&nbsp;\u54c1",id:"packageWindow",type:"packageWindow",closed:function(b){a.windowManager.pop(a.packageWindow);a.packageWindow.w={};a.cellPopup.call(b,"destory")}});a.packageWindow.items=[];a.packageWindow.tabs={};a.packageWindow.activeTab="equipment";for(var b=["equipment","consume","primordialSprite","spritePearl","material"],d=["\u88c5\u5907","\u6d88\u8017",
"\u5143\u795e","\u7075\u73e0","\u6750\u6599"],e="",f=packageWindow[0].items.length-1;0<=f;f--){if("tab_right_bg"===packageWindow[0].items[f].name)for(var g=b.length-1;0<=g;g--)b[g]==a.packageWindow.activeTab&&(e="_h"),a.packageWindow.tabs[b[g]]=a._ui.makeDom("div",{className:packageWindow[0].items[f].name+e,id:b[g]},packageWindow[0].items[f].style,{click:function(b){a.stopPropagation(b);if(this.id===a.packageWindow.activeTab)return!0;a.packageWindow.tabs[a.packageWindow.activeTab].className="tab_right_bg";
a.packageWindow.activeTab=this.id;this.className="tab_right_bg_h";a.cellPopup.call(this.parentNode||this.parentElement,"hide");a.packageWindow.fillData(this.id)}}),e="",a.packageWindow.tabs[b[g]].innerHTML='<span class="tab_text">'+d[g]+"</span>",a.packageWindow.tabs[b[g]].style.top=37+77*g+"px",a.packageWindow.w.dom.appendChild(a.packageWindow.tabs[b[g]]);if("cell"===packageWindow[0].items[f].name)for(g=0;20>g;g++){a.packageWindow.items[g]={};a.packageWindow.items[g].dom=a._ui.makeDom("div",{className:"cell",
id:"c"+g},packageWindow[0].items[f].style);a.packageWindow.items[g].dom.style.top=67+78*parseInt(g/4)+"px";a.packageWindow.items[g].dom.style.left=34+77*parseInt(g%4)+"px";for(var h=packageWindow[0].items[f].items.length-1;0<=h;h--)a.packageWindow.items[g].dom.appendChild(a._ui.makeDom("div",{className:packageWindow[0].items[f].items[h].className},packageWindow[0].items[f].items[h].style));a.packageWindow.w.dom.appendChild(a.packageWindow.items[g].dom)}}a.windowManager.push(a.packageWindow);a.cellPopup(a.packageWindow.items,
function(){return"\u6d4b\u8bd5\u6587\u672c\u6d4b\u8bd5\u6587\u672c\u6d4b\u8bd5\u6587\u672c\u6d4b\u8bd5\u6587\u672c"},{text:"\u8d2d\u4e70",onClick:function(b){a.stopPropagation(b);console.log("\u8d2d\u4e70\u6309\u94ae\u70b9\u51fb")}},null);a.packageWindow.w.dom.style.opacity=0;a.mainDiv.appendChild(a.packageWindow.w.dom)};a.packageWindow.fillData=function(){};a.packageWindow.showPackageWindow=function(){a.packageWindow.w.dom||a.packageWindow.initPackageWindow();a.display(a.packageWindow.w.dom,!0);
a.packageWindow.w.dom.style.opacity=1};a.packageWindow.bindEvent=function(){}})(window.UI,smartlib);(function(a){a.dialogueScene={};a.dialogueScene.w={};a.dialogueScene.currentDialogueFrame=-1;var c=[{speakerName:"\u7ea6\u7ff0\u5c3c\u5fb7\u666e",speakerImg:"./res/ui/ci/1/1_bust.png",scripts:"\u5230\u8fd9\u91cc\u771f\u4e0d\u5bb9\u6613\u554a"},{speakerName:"\u795e\u79d8\u5c0f\u5973\u5b69",speakerImg:"./res/ui/ci/0/0_bust.png",scripts:"\u662f\u554a\uff0c\u4e00\u8def\u8f9b\u82e6"},{scripts:"\u6211\u518d\u8bf4\u4e00\u53e5"},{scripts:"\u518d\u70b9\u5c31\u7ed3\u675f\u4e86\uff01"}];a.dialogueScene.initDialogueScene=
function(){a.dialogueScene.currentDialogueFrame=-1;var b=document.createDocumentFragment();a.dialogueScene.w.dom=document.createElement("div");a.dialogueScene.w.dom.id="dialogueScene";for(var d=dialogueScene.length-1;0<=d;d--)for(var e=dialogueScene[d].items.length-1,f;0<=e;e--)f=dialogueScene[d].items[e].name,a.dialogueScene[f]=a._ui.makeDom("div",{id:f},dialogueScene[d].items[e].style,null),b.appendChild(a.dialogueScene[f]);a.dialogueScene.changeDialogue(c);a.dialogueScene.w.dom.appendChild(b);
b=null;a.dialogueScene.next.style.backgroundImage="url(./res/ui/font/"+a.lang+"/next.png)";a.mainDiv.appendChild(a.dialogueScene.w.dom);a.windowManager.push(a.dialogueScene);a.bind("#next","click",function(b){a.stopPropagation(b);a.dialogueScene.changeDialogue(c)})};a.dialogueScene.changeDialogue=function(b){var c=++a.dialogueScene.currentDialogueFrame;c<b.length?(b[c].speakerName&&(a.dialogueScene["speaker-name"].innerHTML=b[c].speakerName),b[c].scripts&&(a.dialogueScene.scripts.innerHTML=b[c].scripts),
b[c].speakerImg&&(a.dialogueScene.bust.style.backgroundImage="url("+b[c].speakerImg+")")):a.dialogueScene.hidedialogueScene()};a.dialogueScene.reflowPosition=function(){for(var b=dialogueScene.length-1,c;0<=b;b--)for(var e=dialogueScene[b].items.length-1;0<=e;e--)c=a.dialogueScene[dialogueScene[b].items[e].name],dialogueScene[b].items[e].style.hasOwnProperty("top")&&(c.style.top=parseInt(dialogueScene[b].items[e].style.top)+a.offset.top+"px"),dialogueScene[b].items[e].style.hasOwnProperty("left")&&
(c.style.left=parseInt(dialogueScene[b].items[e].style.left)+a.offset.left+"px")};a.dialogueScene.showDialogueScene=function(){a.dialogueScene.w.dom||a.dialogueScene.initDialogueScene();a.dialogueScene.currentDialogueFrame=-1;a.dialogueScene.changeDialogue(c);a.display(a.dialogueScene.w.dom,!0)};a.dialogueScene.hidedialogueScene=function(){a.display(a.dialogueScene.w.dom,!1)};a.dialogueScene.bindEvent=function(){a.bind("#nearby","click",function(b){a.stopPropagation(b);a.dialogueScene.showDialogueScene()})}})(window.UI,
smartlib);(function(a,c){a.skillWindow={};a.skillWindow.w={};a.skillWindow.Grid9={};a.skillWindow.initSkillWindow=function(){var b=document.createDocumentFragment();a.skillWindow.w=new c.ui.baseWindow({title:"\u6280&nbsp;\u80fd",closed:function(){a.windowManager.pop(a.skillWindow);a.skillWindow.w={}},id:"skillWindow"});a.skillWindow.changeableDom=document.createElement("div");a.skillWindow.w.dom.appendChild(a.skillWindow.changeableDom);a.skillWindow.tabs={};a.skillWindow.activeTab="energy";for(var e=skillWindow[0].items.length-
1,f;0<=e;e--)if("tab_right_bg"===skillWindow[0].items[e].name){f=["energy","combatPower","momentum"];for(var g=["\u7cbe\u529b","\u6218\u529b","\u6c14\u52bf"],h="",i=f.length-1;0<=i;i--)f[i]==a.skillWindow.activeTab&&(h="_h"),a.skillWindow.tabs[f[i]]=a._ui.makeDom("div",{className:skillWindow[0].items[e].name+h,id:f[i]},skillWindow[0].items[e].style,{click:function(b){a.stopPropagation(b);if(this.id===a.skillWindow.activeTab)return!0;a.skillWindow.tabs[a.skillWindow.activeTab].className="tab_right_bg";
a.skillWindow.activeTab=this.id;this.className="tab_right_bg_h";a.skillWindow.fillData(this.id,a.skillWindow.changeableDom)}}),h="",a.skillWindow.tabs[f[i]].innerHTML='<span class="tab_text">'+g[i]+"</span>",a.skillWindow.tabs[f[i]].style.top=37+77*i+"px",b.appendChild(a.skillWindow.tabs[f[i]])}else f=a._ui.makeDom("div",{className:skillWindow[0].items[e].name,innerHTML:skillWindow[0].items[e].innerHTML||""},skillWindow[0].items[e].style,null),b.appendChild(f),a.skillWindow[f.className]=f,f=null;
a.skillWindow.Grid9.create(b);a.skillWindow.w.dom.appendChild(b);b=null;a.skillWindow.fillData("energy",a.skillWindow.changeableDom);a.windowManager.push(a.skillWindow);a.skillWindow.w.dom.style.opacity=0;a.mainDiv.appendChild(a.skillWindow.w.dom)};a.skillWindow.fillData=function(c,e){a.skillWindow.Grid9.fill(b[c],e,"skillId")};a.skillWindow.Grid9.create=function(b){this.cells=[];this.pipStyle={};this.pipStyle.pipV={};this.pipStyle.pipH={};this.pipStyle.pos={};for(var c=skillWindow[0].grid9Items.length-
1,f;0<=c;c--)if("position"===skillWindow[0].grid9Items[c].name)this.pipStyle.pos=skillWindow[0].grid9Items[c];else if("pipeline-vertical"===skillWindow[0].grid9Items[c].name)this.pipStyle.pipV=skillWindow[0].grid9Items[c];else if("pipeline-horizontal"===skillWindow[0].grid9Items[c].name)this.pipStyle.pipH=skillWindow[0].grid9Items[c];else if("cell-skill"===skillWindow[0].grid9Items[c].name)for(f=0;9>f;f++)this.cells[f]=a._ui.makeDom("div",{className:"cell-skill"},skillWindow[0].grid9Items[c].style,
null),this.cells[f].style.top=134+95*parseInt(f/3)+"px",this.cells[f].style.left=54+95*parseInt(f%3)+"px",b.appendChild(this.cells[f]);else f=a._ui.makeDom(skillWindow[0].grid9Items[c].tag||"div",{className:skillWindow[0].grid9Items[c].name,innerHTML:skillWindow[0].grid9Items[c].innerHTML||"",src:skillWindow[0].grid9Items[c].src||""},skillWindow[0].grid9Items[c].style,null),b.appendChild(f)};a.skillWindow.Grid9.fill=function(b,c,f){c.innerHTML="";for(var f=f||"id",g={},h=this.cells.length-1;0<=h;h--)if(this.cells[h].style.backgroundImage=
"url(./res/ui/icon/"+b[h][f]+".png)",0<b[h].level&&("number"==typeof b[h].level&&10>b[h].level&&(b[h].level="0"+b[h].level),g=document.createElement("div"),g.innerHTML=b[h].level,g.className="rt",this.cells[h].innerHTML="",this.cells[h].appendChild(g)),b[h].next){g=1==b[h].next-b[h][f]?a._ui.makeDom("div",{innerHTML:this.pipStyle.pipH.innerHTML},this.pipStyle.pipH.style,null):a._ui.makeDom("div",{innerHTML:this.pipStyle.pipV.innerHTML},this.pipStyle.pipV.style,null);g.style.cssText+=this.pipStyle.pos[h+
"-"+(b[h].next-1001)];if(0<b[h].level&&0<b[b[h].next-1001].level){var i=g;"100%"===i.childNodes[0].style.width?i.childNodes[0].style.height="39px":i.childNodes[0].style.width="39px"}c.appendChild(g)}};a.skillWindow.showSkillWindow=function(){a.skillWindow.w.dom||a.skillWindow.initSkillWindow();a.display(a.skillWindow.w.dom,!0);a.skillWindow.w.dom.style.opacity=1};a.skillWindow.bindEvent=function(){};var b={energy:[{skillId:1001,name:"",level:8,next:1004},{skillId:1002,name:"",level:8,next:1005},{skillId:1003,
name:"",level:8,next:1006},{skillId:1004,name:"",level:3,next:1005},{skillId:1005,name:"",level:2,next:1008},{skillId:1006,name:"",level:1,next:1009},{skillId:1007,name:"",level:10},{skillId:1008,name:"",level:10},{skillId:1009,name:"",level:10}],combatPower:[{skillId:1001,name:"",level:"05",next:1004},{skillId:1002,name:"",level:"08",next:1005},{skillId:1003,name:"",level:"11",next:1006},{skillId:1004,name:"",level:"15",next:1007},{skillId:1005,name:"",level:"65",next:1008},{skillId:1006,name:"",
level:10,next:1009},{skillId:1007,name:"",level:10},{skillId:1008,name:"",level:10},{skillId:1009,name:"",level:10}],momentum:[{skillId:1001,name:"",level:"99",next:1004},{skillId:1002,name:"",level:"9",next:1005},{skillId:1003,name:"",level:"07",next:1006},{skillId:1004,name:"",level:"02",next:1007},{skillId:1005,name:"",level:"06",next:1008},{skillId:1006,name:"",level:10,next:1009},{skillId:1007,name:"",level:10,next:1008},{skillId:1008,name:"",level:"01"},{skillId:1009,name:"",level:10}]}})(window.UI,
smartlib);(function(a,c){a.pirateBoatWindow={};a.pirateBoatWindow.w={};a.pirateBoatWindow.initPirateBoatWindow=function(b){var e=document.createDocumentFragment();a.pirateBoatWindow.w=new c.ui.baseWindow({id:"pirateBoatWindow",type:"pirateBoatWindow",title:"\u6218&nbsp;\u8230",closed:function(){a.windowManager.pop(a.pirateBoatWindow);a.pirateBoatWindow.w={};if(a.strengthenWindow.w.dom)for(var b=0,c=a.strengthenWindow.w.dom.childNodes.length;b<c;b++)if("closeBtn"===a.strengthenWindow.w.dom.childNodes[b].id){a.fire(a.strengthenWindow.w.dom.childNodes[b],
"click");break}}});a.pirateBoatWindow.leftTabs=[];a.pirateBoatWindow.activeTab=0;for(var f=pirateBoatWindow[0].items.length-1;0<=f;f--)if("pirate-boat-tab"===pirateBoatWindow[0].items[f].name)for(var g=0,h=b.length;g<h;g++)a.pirateBoatWindow.leftTabs.push(a._ui.makeDom("div",{},pirateBoatWindow[0].items[f].style,{click:function(){if(a.pirateBoatWindow.activeTab!=this.index){var c=a.pirateBoatWindow.leftTabs[a.pirateBoatWindow.activeTab].style.backgroundPosition.split(" ");c[0]=parseInt(c[0])+70+"px";
a.pirateBoatWindow.leftTabs[a.pirateBoatWindow.activeTab].style.backgroundPosition=c.join(" ");c=this.style.backgroundPosition.split(" ");c[0]=parseInt(c[0])-70+"px";this.style.backgroundPosition=c.join(" ");a.pirateBoatWindow.activeTab=this.index;a.pirateBoatWindow.fillData(b[this.index])}}})),a.pirateBoatWindow.leftTabs[g].index=g,a.animate(a.pirateBoatWindow.leftTabs[g],{top:37+77*g+"px",backgroundImage:"url(./res/ui/pb/tab_boat_"+b[g].type+".png)",backgroundPosition:g==a.pirateBoatWindow.activeTab?
70*-(2*(b[g].pId%6)+1)+"px -"+77*parseInt(b[g].pId/6)+"px":140*(-b[g].pId%6)+"px -"+77*parseInt(b[g].pId/6)+"px"},0),e.appendChild(a.pirateBoatWindow.leftTabs[g]);else a.pirateBoatWindow[pirateBoatWindow[0].items[f].name]=a._ui.makeDom("div",{innerHTML:pirateBoatWindow[0].items[f].innerHTML||"",className:pirateBoatWindow[0].items[f].className||""},pirateBoatWindow[0].items[f].style,null),e.appendChild(a.pirateBoatWindow[pirateBoatWindow[0].items[f].name]);a.pirateBoatWindow["active-skill-label"].style.background=
"url(./res/ui/font/"+a.lang+"/activeskills.png) no-repeat";a.pirateBoatWindow.equipmentGrid={};g=["speed","luck","maxEnergy","getEnergy"];for(f=g.length-1;0<=f;f--)a.pirateBoatWindow.equipmentGrid[g[f]]=a._ui.makeDom("div",{className:"cell"},{top:53+80*Math.floor(f/2)+"px",left:50+202*Math.floor(f%2)+"px"},{click:function(b){a.stopPropagation(b);a.strengthenWindow.showStrengthenWindow("transform")}}),e.appendChild(a.pirateBoatWindow.equipmentGrid[g[f]]);a.pirateBoatWindow.w.dom.appendChild(e);e=null;
a.pirateBoatWindow.fillData(b[a.pirateBoatWindow.activeTab]);a.windowManager.push(a.pirateBoatWindow);a.pirateBoatWindow.w.dom.style.opacity=0;a.mainDiv.appendChild(a.pirateBoatWindow.w.dom);a.pirateBoatWindow.bindEvent()};a.pirateBoatWindow.fillData=function(b){a.pirateBoatWindow["pirate-boat-nickname"].innerHTML=b.name;a.pirateBoatWindow["pirate-boat-bust"].style.backgroundImage="url("+b.bustImg+")";a.pirateBoatWindow["pirate-boat-level"].innerHTML=b.level;var c=a.pirateBoatWindow["pirate-boat-content-holder"].childNodes;
c[2].innerHTML=b.activeSkillDescription;c[1].innerHTML=c[0].innerHTML="";for(var f=b.boatAttr.length-1,g=Math.floor(b.boatAttr.length/2);0<=f;f--)f>=g?c[1].innerHTML+=b.boatAttr[f]+"<br>":c[0].innerHTML+=b.boatAttr[f]+"<br>";c=null;for(f=b.equipment.length-1;0<=f;f--)a.pirateBoatWindow.equipmentGrid[b.equipment[f].type].innerHTML="",b.equipment[f].levelUp&&a.pirateBoatWindow.equipmentGrid[b.equipment[f].type].appendChild(a._ui.makeDom("div",{className:"upgrade"},null,{click:function(b){a.stopPropagation(b)},
mousedown:function(b){a.stopPropagation(b);this.style.background="url(./res/ui/btn/pb_up_h.png) no-repeat"},mouseup:function(b){a.stopPropagation(b);this.style.background="url(./res/ui/btn/pb_up.png) no-repeat"}}))};a.pirateBoatWindow.showPirateBoatWindow=function(){a.pirateBoatWindow.w.dom||a.pirateBoatWindow.initPirateBoatWindow(b);a.display(a.pirateBoatWindow.w.dom,!0);a.pirateBoatWindow.w.dom.style.opacity=1};a.pirateBoatWindow.bindEvent=function(){a.bind(a.pirateBoatWindow["frame-btn-alone"],
"click",function(){a.strengthenWindow.showStrengthenWindow("made")})};var b=[{pId:10,type:"defense",name:"\u5c0f\u6c14\u7403",level:99,equipment:[{name:"",type:"speed",levelUp:!0,img:""},{name:"",type:"luck",levelUp:!0,img:""},{name:"",type:"maxEnergy",img:""},{name:"",type:"getEnergy",img:""}],bustImg:"./res/ui/ci/0/0_bust.png",boatAttr:'\u8010\u3000\u3000\u4e45\uff1a5000<span data-for="naijiu" class="extra-num">+5</span>;\u666e\u901a\u653b\u51fb\uff1a5000<span data-for="" class="extra-num">+500</span>;\u7269\u7406\u9632\u5fa1\uff1a5000<span data-for="" class="extra-num"></span>;;\u66b4\u3000\u3000\u51fb\uff1a5000<span data-for="" class="extra-num"></span>;\u547d\u3000\u3000\u4e2d\uff1a5000<span data-for="" class="extra-num"></span>;\u52a8\u3000\u3000\u529b\uff1a5000<span data-for="dongli" class="extra-num">+5</span>;\u6280\u80fd\u653b\u51fb\uff1a5000<span data-for="" class="extra-num">+500</span>;\u706b\u7130\u9632\u5fa1\uff1a5000<span data-for="" class="extra-num"></span>;;\u683c\u3000\u3000\u6321\uff1a5000<span data-for="" class="extra-num"></span>;\u95ea\u3000\u3000\u907f\uff1a5000<span data-for="" class="extra-num"></span>'.split(";"),
activeSkillDescription:"\u5f00\u5929\u8f9f\u5730\uff1a\u7b56\u5212\u541b\u8bf4\u8fd9\u91cc\u653e\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e2a\u5b57"},{pId:7,type:"export",name:"\u9ed1\u73cd\u73e0",equipment:[],level:33,tabImg:"url(./res/ui/pb/tab_boat_defense.png) 140px 0",bustImg:"./res/ui/ci/0/0_bust.png",boatAttr:'\u8010\u3000\u3000\u4e45\uff1a4590<span data-for="naijiu" class="extra-num">+5</span>;\u666e\u901a\u653b\u51fb\uff1a4590<span data-for="" class="extra-num">+500</span>;\u7269\u7406\u9632\u5fa1\uff1a4590<span data-for="" class="extra-num"></span>;;\u66b4\u3000\u3000\u51fb\uff1a4590<span data-for="" class="extra-num"></span>;\u547d\u3000\u3000\u4e2d\uff1a4590<span data-for="" class="extra-num"></span>;\u52a8\u3000\u3000\u529b\uff1a4590<span data-for="dongli" class="extra-num">+5</span>;\u6280\u80fd\u653b\u51fb\uff1a4590<span data-for="" class="extra-num">+500</span>;\u706b\u7130\u9632\u5fa1\uff1a4590<span data-for="" class="extra-num"></span>;;\u683c\u3000\u3000\u6321\uff1a4590<span data-for="" class="extra-num"></span>;\u95ea\u3000\u3000\u907f\uff1a4590<span data-for="" class="extra-num"></span>'.split(";"),
activeSkillDescription:"\u5f00\u5929\u8f9f\u5730\uff1a\u7b56\u5212\u541b\u8bf4\u8fd9\u91cc\u653e\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e2a\u5b57"},{pId:3,type:"supply",name:"\u98de\u7fd4\u8377\u5170\u4eba",equipment:[],level:66,tabImg:"url(./res/ui/pb/tab_boat_defense.png) 280px 0",bustImg:"./res/ui/ci/1/1_bust.png",boatAttr:'\u8010\u3000\u3000\u4e45\uff1a7000<span data-for="naijiu" class="extra-num">+5</span>;\u666e\u901a\u653b\u51fb\uff1a7000<span data-for="" class="extra-num">+500</span>;\u7269\u7406\u9632\u5fa1\uff1a7000<span data-for="" class="extra-num"></span>;;\u66b4\u3000\u3000\u51fb\uff1a7000<span data-for="" class="extra-num"></span>;\u547d\u3000\u3000\u4e2d\uff1a7000<span data-for="" class="extra-num"></span>;\u52a8\u3000\u3000\u529b\uff1a7000<span data-for="dongli" class="extra-num">+5</span>;\u6280\u80fd\u653b\u51fb\uff1a7000<span data-for="" class="extra-num">+500</span>;\u706b\u7130\u9632\u5fa1\uff1a7000<span data-for="" class="extra-num"></span>;;\u683c\u3000\u3000\u6321\uff1a7000<span data-for="" class="extra-num"></span>;\u95ea\u3000\u3000\u907f\uff1a7000<span data-for="" class="extra-num"></span>'.split(";"),
activeSkillDescription:"\u5f00\u5929\u8f9f\u5730\uff1a\u7b56\u5212\u541b\u8bf4\u8fd9\u91cc\u653e\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e94\u5341\u4e2a\u5b57"}]})(window.UI,smartlib);(function(a,c){a.strengthenWindow={};a.strengthenWindow.w={};a.strengthenWindow.initStrengthenWindow=function(b){var d=document.createDocumentFragment();a.strengthenWindow.w=new c.ui.baseWindow({id:"strengthenWindow",type:"strengthenWindow",title:"\u5f3a&nbsp;\u5316",closed:function(){a.windowManager.pop(a.strengthenWindow);a.strengthenWindow.w={}}});a.strengthenWindow.tabs={};a.strengthenWindow.activeTab=b||"recast";a.strengthenWindow.changeableDom=document.createElement("div");a.strengthenWindow.styles=
{};for(var e=strengthenWindow.length-1;0<=e;e--)a.strengthenWindow.styles[strengthenWindow[e].name]=strengthenWindow[e].items;for(e=a.strengthenWindow.styles.strengthenWindow.length-1;0<=e;e--)if("tab_right_bg"==strengthenWindow[0].items[e].name)for(var b=["recast","made","transform","research"],f=["\u91cd\u94f8","\u7ec4\u88c5","\u6539\u9020","\u7814\u7a76"],g="",h=b.length-1;0<=h;h--)b[h]==a.strengthenWindow.activeTab&&(g="_h"),a.strengthenWindow.tabs[b[h]]=a._ui.makeDom("div",{className:strengthenWindow[0].items[e].name+
g,id:b[h]},strengthenWindow[0].items[e].style,{click:function(b){a.stopPropagation(b);if(this.id===a.strengthenWindow.activeTab)return!0;a.strengthenWindow.tabs[a.strengthenWindow.activeTab].className="tab_right_bg";a.strengthenWindow[a.strengthenWindow.activeTab].close();a.strengthenWindow.activeTab=this.id;this.className="tab_right_bg_h";a.strengthenWindow[this.id].init(a.strengthenWindow.changeableDom,a.strengthenWindow.styles[this.id])}}),g="",a.strengthenWindow.tabs[b[h]].innerHTML='<span class="tab_text">'+
f[h]+"</span>",a.strengthenWindow.tabs[b[h]].style.top=37+77*h+"px",d.appendChild(a.strengthenWindow.tabs[b[h]]);a.strengthenWindow.w.dom.appendChild(d);d=null;a.strengthenWindow[a.strengthenWindow.activeTab].init(a.strengthenWindow.changeableDom,a.strengthenWindow.styles[a.strengthenWindow.activeTab]);a.strengthenWindow.w.dom.appendChild(a.strengthenWindow.changeableDom);a.windowManager.push(a.strengthenWindow);a.strengthenWindow.w.dom.style.opacity=0;a.mainDiv.appendChild(a.strengthenWindow.w.dom)};
a.strengthenWindow.showStrengthenWindow=function(b){a.strengthenWindow.w.dom||a.strengthenWindow.initStrengthenWindow(b);b&&a.fire(a.strengthenWindow.tabs[b],"click");a.show(a.strengthenWindow.w.dom);a.strengthenWindow.w.dom.style.opacity=1};a.strengthenWindow.bindEvent=function(){}})(window.UI,smartlib);(function(a){a.strengthenWindow.recast={};a.strengthenWindow.recast.active="magicDamage";a.strengthenWindow.recast.init=function(b,d){b.innerHTML="";for(var e=document.createDocumentFragment(),f=[],g=d.length-1;0<=g;g--)if("circle-progress-left"===d[g].name||"circle-progress-right"===d[g].name||"circle-progress-rotate"===d[g].name)f.push(d[g]);else if("cell"===d[g].name)for(var h=0,i=["magicDamage","damage","magicDefense","defense"];4>h;h++)a.strengthenWindow.recast[i[h]]=a._ui.makeDom("div",{className:"cell",
id:i[h]},d[g].style,{click:function(b){a.stopPropagation(b);this.id!=a.strengthenWindow.recast.active&&(a.strengthenWindow.recast.fillData(this.id,c),a.strengthenWindow.recast.active=this.id)}}),a.strengthenWindow.recast[i[h]].style.left=34+77*h+"px",e.appendChild(a.strengthenWindow.recast[i[h]]);else"frame-btn-alone"===d[g].name&&e.appendChild(a._ui.makeDom("div",{className:"frame-btn-alone",innerHTML:d[g].innerHTML},null,{click:function(b){a.stopPropagation(b);a.strengthenWindow.recast.recastEquipment()}})),
a.strengthenWindow.recast[d[g].name]=a._ui.makeDom("div",null,d[g].style,null),e.appendChild(a.strengthenWindow.recast[d[g].name]);a.strengthenWindow.recast["recast-left-text"].style.background="url(./res/ui/font/"+a.lang+"/st_rst_surplus.png) no-repeat";a.strengthenWindow.recast["circle-progress-cover"].style.background="url(./res/ui/layout/c/rst_bg_icon.png) no-repeat";for(g=f.length-1;0<=g;g--)a.strengthenWindow.recast[f[g].name]=a._ui.makeDom("div",null,f[g].style,null),a.strengthenWindow.recast["circle-progress-holder"].appendChild(a.strengthenWindow.recast[f[g].name]);
a.strengthenWindow.recast.fillData(a.strengthenWindow.recast.active,c);b.appendChild(e)};a.strengthenWindow.recast.fillData=function(b,c){a.strengthenWindow.recast["circle-progress-cover-type"].style.background="url(./res/ui/layout/c/rst_1_icon.png) no-repeat";"number"==typeof c[b].left&&10>c[b].left&&(c[b].left="0"+c[b].left);a.strengthenWindow.recast["recast-left-num"].innerHTML=c[b].left;a.strengthenWindow.recast["recast-description"].innerHTML=c[b].description;a.strengthenWindow.recast["recast-percent"].innerHTML=
c[b].percent+"/100";50>=c[b].percent?(a.animate(a.strengthenWindow.recast["circle-progress-left"],{background:"#ff6000",zIndex:564},0),a.animate(a.strengthenWindow.recast["circle-progress-right"],{background:"#102c4a",zIndex:566},0),a.animate(a.strengthenWindow.recast["circle-progress-rotate"],{transformOrigin:"right center",transform:"rotate("+360*(c[b].percent/100)+"deg)",background:"#102c4a"},0)):(a.animate(a.strengthenWindow.recast["circle-progress-left"],{background:"#ff6000",zIndex:566},0),
a.animate(a.strengthenWindow.recast["circle-progress-right"],{background:"#102c4a",zIndex:564},0),a.animate(a.strengthenWindow.recast["circle-progress-rotate"],{transformOrigin:"right center",transform:"rotate("+360*((c[b].percent-50)/100)+"deg)",background:"#ff6000"},0))};a.strengthenWindow.recast.recastEquipment=function(){console.log("\u9700\u88c5\u5907\u5347\u7ea7\u6570\u636e\u652f\u6301")};a.strengthenWindow.recast.close=function(){};a.strengthenWindow.recast.bindEvent=function(){};var c={magicDamage:{left:5,
description:'\u57fa\u7840\u653b\u51fb\u529b<span style="color:#36ff00;">+6</span>',percent:40},damage:{left:6,description:'\u57fa\u7840\u653b\u51fb\u529b<span style="color:#36ff00;">+7</span>',percent:50},magicDefense:{left:3,description:'\u57fa\u7840\u653b\u51fb\u529b<span style="color:#36ff00;">+8</span>',percent:60},defense:{left:0,description:'\u57fa\u7840\u653b\u51fb\u529b<span style="color:#36ff00;">+9</span>',percent:90}}})(window.UI,smartlib);(function(a){a.strengthenWindow.made={};a.strengthenWindow.made.items=[];a.strengthenWindow.made.init=function(b,d){b.innerHTML="";for(var e=document.createDocumentFragment(),f={},g=d.length-1;0<=g;g--)"made-holder-branch"===d[g].name?f.branch=d[g]:"made-holder"===d[g].name&&(f.alone=d[g]);a.strengthenWindow.made.fillData(c,e,f);b.appendChild(e)};a.strengthenWindow.made.fillData=function(b,c,e){for(var f,g=58,h=0;h<b.length;h++){f=b[h].branch?e.branch:e.alone;a.strengthenWindow.made.items[h]=a._ui.makeDom("div",
{},f.style,null);a.strengthenWindow.made.items[h].style.top=g+"px";g+=parseInt(a.strengthenWindow.made.items[h].style.height)+15;f=f.items;for(var i=f.length-1;0<=i;i--)a.strengthenWindow.made.items[h][f[i].name]=a._ui.makeDom("div",{},f[i].style,null),a.strengthenWindow.made.items[h].appendChild(a.strengthenWindow.made.items[h][f[i].name]);"number"===typeof b[h].level&&10>b[h].level&&(b[h].level="0"+b[h].level);f=b[h].next;f.hasOwnProperty("length")&&(f[1]?(a.strengthenWindow.made.items[h]["made-progress-filler"].style.top=
"42px",a.strengthenWindow.made.items[h]["made-next-point"].style.top="53px",f=f[1]):f=f[0]);a.strengthenWindow.made.items[h]["made-point"].innerHTML=b[h].level;a.strengthenWindow.made.items[h]["made-description"].innerHTML=b[h].description;a.strengthenWindow.made.items[h]["made-progress-filler"].style.width=45*(f-1)+"px";a.strengthenWindow.made.items[h]["made-next-point"].style.left=46*(f-1)+103+"px";c.appendChild(a.strengthenWindow.made.items[h])}};a.strengthenWindow.made.close=function(){};a.strengthenWindow.made.bindEvent=
function(){};var c=[{id:0,name:"",branch:!1,level:8,next:3,description:'\u4e0b\u4e00\u7b49\u7ea7\uff1a\u7269\u7406\u653b\u51fb <span style="color:#36ff00">+5</span></div>'},{id:31,name:"",branch:!0,level:12,next:[0,3],description:'\u4e0b\u4e00\u7b49\u7ea7\uff1a\u7269\u7406\u653b\u51fb <span style="color:#36ff00">+4</span></div>'},{id:34,name:"",branch:!1,level:82,next:1,description:'\u4e0b\u4e00\u7b49\u7ea7\uff1a\u7269\u7406\u653b\u51fb <span style="color:#36ff00">+6</span></div>'},{id:88,name:"",
branch:!1,level:5,next:2,description:'\u4e0b\u4e00\u7b49\u7ea7\uff1a\u7269\u7406\u653b\u51fb <span style="color:#36ff00">+5</span></div>'}]})(window.UI,smartlib);(function(a){a.strengthenWindow.research={};a.strengthenWindow.research.init=function(b,d){b.innerHTML="";for(var e=document.createDocumentFragment(),f=d.length-1;0<=f;f--)a.strengthenWindow.research[d[f].name]=a._ui.makeDom("div",{className:d[f].name,innerHTML:d[f].innerHTML},null,{click:function(b){a.stopPropagation(b);console.log("\u5b66\u4e60\u5347\u7ea7")}}),e.appendChild(a.strengthenWindow.research[d[f].name]);a.skillWindow.Grid9.create(e);a.strengthenWindow.research.fillData(c,e);b.appendChild(e)};
a.strengthenWindow.research.fillData=function(b,c){a.skillWindow.Grid9.fill(b,c)};a.strengthenWindow.research.close=function(){};a.strengthenWindow.research.bindEvent=function(){};var c=[{id:0,name:"",level:8,next:3},{id:1,name:"",level:8,next:4},{id:2,name:"",level:8,next:5},{id:3,name:"",level:3,next:4},{id:4,name:"",level:2,next:7},{id:5,name:"",level:1,next:8},{id:6,name:""},{id:7,name:""},{id:8,name:""}]})(window.UI,smartlib);(function(a){a.strengthenWindow.transform={};a.strengthenWindow.transform.init=function(b,d){b.innerHTML="";for(var e=document.createDocumentFragment(),f=d.length-1;0<=f;f--)a.strengthenWindow.transform[d[f].name]=a._ui.makeDom("div",{className:d[f].className,innerHTML:d[f].innerHTML||""},d[f].style,null),e.appendChild(a.strengthenWindow.transform[d[f].name]);a.strengthenWindow.transform.fillData(c);b.appendChild(e)};a.strengthenWindow.transform.fillData=function(b){a.strengthenWindow.transform["transform-bg"].src=
"./res/ui/layout/c/st_tfm_boat_bg.png";for(var c in b)a.strengthenWindow.transform[c].style.backgroundImage="url("+b[c].img+")"};a.strengthenWindow.transform.close=function(){};var c={pic0:{img:"./res/ui/icon/Ability_Racial_Avatar.png"},pic1:{img:"./res/ui/icon/Ability_Racial_Avatar.png"},pic2:{img:"./res/ui/icon/Ability_Racial_Avatar.png"},pic3:{img:"./res/ui/icon/Ability_Racial_Avatar.png"},pic4:{img:"./res/ui/icon/Ability_Racial_Avatar.png"}}})(window.UI,smartlib);(function(a){a.messageBox={};a.messageBox.w={};a.messageBox.show=function(c,b,d,e,f){c=c||"\u6b63\u6587";b=b||3E3;d=d?0.5:0;a.messageBox.w.dom=a._ui.makeDom("div",{id:"messageBox"},messageBox[0].style,null);for(var g=messageBox[0].items.length-1;0<=g;g--)a.messageBox[messageBox[0].items[g].name]=a._ui.makeDom("div",{innerHTML:messageBox[0].items[g].innerHTML||""},messageBox[0].items[g].style,null),a.messageBox.w.dom.appendChild(a.messageBox[messageBox[0].items[g].name]);a.messageBox.content.innerHTML=
c;a.mainDiv.appendChild(a.messageBox.w.dom);a.messageBox.block=a._ui.makeDom("div",{},{position:"absolute",width:"960px",height:"640px",background:"#000000","z-index":5119,opacity:d,top:a.offset.top+"px",left:a.offset.left+"px"},{click:function(b){a.stopPropagation(b);a.messageBox.close()}});e&&(e.text&&(a.messageBox.btnA.innerHTML=e.text),a.show(a.messageBox.btnA),a.bind(a.messageBox.btnA,"click",function(){e.onClick&&e.onClick.apply(a.messageBox)}));f&&(f.text&&(a.messageBox.btnB.innerHTML=f.text),
a.show(a.messageBox.btnB),a.bind(a.messageBox.btnB,"click",function(){f.onClick&&f.onClick.apply(a.messageBox)}));a.windowManager.push(a.messageBox,310);a.mainDiv.appendChild(a.messageBox.block);this.timer=setTimeout(function(){a.messageBox.close()},b)};a.messageBox.close=function(){clearTimeout(this.timer);a.mainDiv.removeChild(a.messageBox.block);a.mainDiv.removeChild(a.messageBox.w.dom);a.windowManager.pop(a.messageBox);a.messageBox.w.dom=null};a.messageBox.reflowPosition=function(){a.messageBox.w.dom.style.top=
a.offset.top+90+"px";a.messageBox.w.dom.style.left=a.offset.left+~~((960-parseInt(a.messageBox.w.dom.style.width))/2)+"px"}})(window.UI,smartlib);(function(a,c){a.formationWindow={};a.formationWindow.w={};a.formationWindow.initFormationWindow=function(){var b=document.createDocumentFragment();a.formationWindow.w=new c.ui.baseWindow({title:"\u9635&nbsp;\u5f62",closed:function(){a.windowManager.pop(a.formationWindow);a.formationWindow.w={}},id:"formationWindow"});a.formationWindow.tabs={};a.formationWindow.activeTab="formation";a.formationWindow.changeableDom=document.createElement("div");a.formationWindow.w.dom.appendChild(a.formationWindow.changeableDom);
for(var d=["formation","battleformation","governing"],e=["\u9635\u5f62","\u9635\u6cd5","\u7edf\u5fa1"],f="",g=formation[0].items.length-1;0<=g;g--)if("tab_right_bg"===formation[0].items[g].name){for(var h=d.length-1;0<=h;h--)d[h]==a.formationWindow.activeTab&&(f="_h"),a.formationWindow.tabs[d[h]]=a._ui.makeDom("div",{className:formation[0].items[g].name+f,id:d[h]},formation[0].items[g].style,{click:function(b){a.stopPropagation(b);if(this.id===a.formationWindow.activeTab)return!0;a.formationWindow.tabs[a.formationWindow.activeTab].className=
"tab_right_bg";a.formationWindow.activeTab=this.id;this.className="tab_right_bg_h";a.formationWindow[this.id].init(a.formationWindow.changeableDom)}}),f="",a.formationWindow.tabs[d[h]].innerHTML='<span class="tab_text">'+e[h]+"</span>",a.formationWindow.tabs[d[h]].style.top=37+77*h+"px",b.appendChild(a.formationWindow.tabs[d[h]]);break}a.formationWindow.w.dom.appendChild(b);a.formationWindow[a.formationWindow.activeTab].init(a.formationWindow.changeableDom);b=null;a.formationWindow.w.dom.style.opacity=
0;a.windowManager.push(a.formationWindow,310);a.mainDiv.appendChild(a.formationWindow.w.dom)};a.formationWindow.showFormationWindow=function(){a.formationWindow.w.dom||a.formationWindow.initFormationWindow();a.show(a.formationWindow.w.dom);a.formationWindow.w.dom.style.opacity=1};a.formationWindow.bindEvent=function(){}})(window.UI,smartlib);(function(a){a.formationWindow.formation={};a.formationWindow.formation.init=function(c){c.innerHTML="";for(var b=document.createDocumentFragment(),d,e=formation.length-1;0<=e;e--)if("formation"===formation[e].name){d=formation[e].items;a.formationWindow.w.dom.style.cssText=formation[e].cssText;a.formationWindow.w.dom.childNodes[0].style.width="534px";a.formationWindow.w.dom.style.left=310+a.offset.left+"px";a.formationWindow.w.dom.style.top=a.offset.top+ui_config.window.top+"px";break}for(e=d.length-
1;0<=e;e--)if("blueCircle"!==d[e].name&&"redCircle"!==d[e].name)if("cr"===d[e].name)for(var f=0,g;3>f;f++)g=d[e].name+f,a.formationWindow.formation[g]=a._ui.makeDom("div",{className:d[e].className},d[e].style),a.formationWindow.formation[g].style.cssText+=d[e].position[f],b.appendChild(a.formationWindow.formation[g]);else"frameS"===d[e].name?a.formationWindow.formation.initFrameS(b,d[e]):(a.formationWindow.formation[d[e].name]=a._ui.makeDom("div",{className:d[e].className||""},d[e].style),b.appendChild(a.formationWindow.formation[d[e].name]));
a.formationWindow.formation.fillData();a.formationWindow.formation.description.style.background="url(./res/ui/font/"+a.lang+"/enemyfleet.png) no-repeat";c.appendChild(b)};a.formationWindow.formation.initFrameS=function(c,b){function d(b){a.formationWindow.formation.frameS.wraper.childNodes[0].innerHTML="";for(var b="player"===b?4:16,c=0;c<b;c++)a.formationWindow.formation.frameS.wraper.childNodes[0].appendChild(a._ui.makeDom("div",{className:"cell"},{top:75*parseInt(c/2)+"px",left:c%2?"85px":"10px",
height:"60px",width:"60px"},{click:function(b){a.stopPropagation(b)}}))}a.formationWindow.formation.frameS=document.createElement("div");var e=a.formationWindow.formation.frameS;e.activeTab="player";a.animate(e,b.style,0);for(var f=["player","defense","export","supply"],g=["\u89d2\u8272","\u9632\u5fa1","\u8f93\u51fa","\u652f\u63f4"],h=0;4>h;h++)e[f[h]]=a._ui.makeDom("div",{id:f[h],className:f[h]===e.activeTab?"tab_left_bg_h":"tab_left_bg",innerHTML:'<span class="tab_text">'+g[h]+"</span>"},{position:"absolute",
height:"77px",width:"70px",left:"-66px",top:38+77*h+"px"},{click:function(b){a.stopPropagation(b);if(this.id===a.formationWindow.formation.frameS.activeTab)return!0;a.formationWindow.formation.frameS[a.formationWindow.formation.frameS.activeTab].className="tab_left_bg";a.formationWindow.formation.frameS.activeTab=this.id;this.className="tab_left_bg_h";d(this.id);a.formationWindow.formation.frameS.scroll.scrollTo(0,0,0)}}),e.appendChild(e[f[h]]);e.wraper=a._ui.makeDom("div",{id:"wraper"},b.items.wraper,
null);e.wraper.innerHTML='<div style="width:164px;height:590px;"></div>';e.appendChild(e.wraper);d(e.activeTab,e.wraper.childNodes[0]);c.appendChild(e);e=null;setTimeout(function(){a.formationWindow.formation.frameS.scroll=new iScroll("wraper",{scrollbarClass:"scrollbar"})},100)};a.formationWindow.formation.fillData=function(){a.formationWindow.formation.AP.innerHTML=12345;a.formationWindow.formation.HP.innerHTML=12345;a.formationWindow.formation["AP-arrow-up"].className+=" g";a.formationWindow.formation["HP-arrow-down"].className+=
" r";a.formationWindow.formation.cr0.innerHTML='<div style="background-image:url(./res/ui/ci/1/1_photo.png)"></div>';a.formationWindow.formation.cr0.className+=" cell-cr-active";a.formationWindow.formation.cr1.innerHTML='<div style="background-image:url(./res/ui/ci/0/0_photo.png)"></div>';a.formationWindow.formation.cr1.className+=" cell-cr-active"}})(window.UI,smartlib);(function(a){a.formationWindow.battleformation={};a.formationWindow.battleformation.init=function(c){c.innerHTML="";for(var b=document.createDocumentFragment(),d,e=formation.length-1;0<=e;e--)if("battleformation"===formation[e].name){d=formation[e].items;a.formationWindow.w.dom.style.cssText=formation[e].cssText;a.formationWindow.w.dom.childNodes[0].style.width="363px";a.formationWindow.w.dom.style.left=481+a.offset.left+"px";a.formationWindow.w.dom.style.top=a.offset.top+ui_config.window.top+"px";
break}for(e=d.length-1;0<=e;e--)a.formationWindow.battleformation[d[e].name]=a._ui.makeDom(d[e].tag||"div",{id:d[e].id||"",src:d[e].src||"",innerHTML:d[e].innerHTML||""},d[e].style,null),b.appendChild(a.formationWindow.battleformation[d[e].name]);a.formationWindow.battleformation.fillData(data[0]);setTimeout(function(){a.formationWindow.battleformation.scroll=new iScroll("battleformation-wrap",{scrollbarClass:"scrollbar"})},100);c.appendChild(b);d=b=null};a.formationWindow.battleformation.fillData=
function(c){a.formationWindow.battleformation.wrap.childNodes[0].innerHTML=c};data=["\u6d4b\u8bd5\u7684\u6587\u5b57\u591f\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417\u591a\u5417"]})(window.UI,
smartlib);(function(a){a.formationWindow.governing={};a.formationWindow.governing.init=function(b){var d=document.createDocumentFragment();b.innerHTML="";for(var e=formation.length-1;0<=e;e--)if("governing"===formation[e].name){a.formationWindow.w.dom.style.cssText=formation[e].cssText;a.formationWindow.w.dom.childNodes[0].style.width="363px";a.formationWindow.w.dom.style.left=481+a.offset.left+"px";a.formationWindow.w.dom.style.top=a.offset.top+ui_config.window.top+"px";for(var f=formation[e].items.length-
1;0<=f;f--)a.formationWindow.governing[formation[e].items[f].name]=a._ui.makeDom("div",{className:formation[e].items[f].name,innerHTML:formation[e].items[f].innerHTML},null,{click:function(b){a.stopPropagation(b);console.log("\u5b66\u4e60\u5347\u7ea7")}}),d.appendChild(a.formationWindow.governing[formation[e].items[f].name]);break}a.skillWindow.Grid9.create(d);a.formationWindow.governing.fillData(c,d);b.appendChild(d);d=null};a.formationWindow.governing.fillData=function(b,c){a.skillWindow.Grid9.fill(b,
c)};var c=[{id:0,name:"",level:8,next:3},{id:1,name:"",level:8,next:4},{id:2,name:"",level:8,next:5},{id:3,name:"",level:3,next:4},{id:4,name:"",level:2,next:7},{id:5,name:"",level:1,next:8},{id:6,name:""},{id:7,name:""},{id:8,name:""}]})(window.UI,smartlib);(function(a,c){a.casinoScene=function(){};a.casinoScene.suffix="casinoScene_";a.casinoScene.w={};a.casinoScene.init=function(){a.casinoScene.w.dom=document.createElement("div");a.casinoScene.w.dom.id="casinoScene";for(var b=document.createDocumentFragment(),c=0;c<ui_config.casinoScene.length;c++)switch(ui_config.casinoScene[c].name){case "leftTop":a.casinoScene.createLeftTop(ui_config.casinoScene[c].style,ui_config.casinoScene[c].items,b);break;case "rightTop":a.casinoScene.createRightTop(ui_config.casinoScene[c].style,
ui_config.casinoScene[c].items,b);break;case "topCenter":a.casinoScene.createTopCenter(ui_config.casinoScene[c].style,ui_config.casinoScene[c].items,b);break;case "bottom":a.casinoScene.createBottom(ui_config.casinoScene[c].style,ui_config.casinoScene[c].items,b);break;default:a.casinoScene.createElement(ui_config.casinoScene[c].name,ui_config.casinoScene[c].style,ui_config.casinoScene[c].items,b)}a.casinoScene.w.dom.appendChild(b);a.windowManager.push(a.casinoScene);a.mainDiv.appendChild(a.casinoScene.w.dom)};
a.casinoScene.createElement=function(b,c,e,f){a.casinoScene[b]=a._ui.makeDom("div",{id:a.casinoScene.suffix+b},c,null);for(c=0;c<e.length;c++)a.casinoScene[b].appendChild(a._ui.makeDom("div",{id:e[c].name,className:e[c].className||"",innerHTML:e[c].innerHTML||""},e[c].style,e[c].events||null));f.appendChild(a.casinoScene[b])};a.casinoScene.createLeftTop=function(b,c,e){for(var f=0;f<c.length;f++)"player-photo"==c[f].name&&(c[f].style.background="url(./res/ui/ci/"+btg.mainPlayer.cId+"/"+btg.mainPlayer.cId+
"_photo.png)"),"player-money"==c[f].name&&(c[f].innerHTML="\u73a9\u5bb6\u91d1\u5e01\uff1a"+btg.mainPlayer.money),"player-stake"==c[f].name&&(c[f].innerHTML="\u8d4c\u6ce8\u91d1\u989d\uff1a"+btg.mainPlayer.money);a.casinoScene.createElement("leftTop",b,c,e)};a.casinoScene.createRightTop=function(b,c,e){a.casinoScene.createElement("rightTop",b,c,e)};a.casinoScene.createTopCenter=function(b,c,e){a.casinoScene.createElement("topCenter",b,c,e)};a.casinoScene.createBottom=function(b,d,e){for(var f=0;f<d.length;f++)"add-stake"==
d[f].name&&(d[f].events={click:function(){}}),"casino-btn"==d[f].name&&(d[f].events={click:function(){new c.ui.dice({id:"dice1",value:"\u9ab0\u5b50",width:256,height:512,spritewidth:128,spriteheight:128,animationspeed:100,x:0,y:0,maxX:400,maxY:300,color:"#333333",position:"absolute",appendTo:"casinoScene_table",hided:!1,disabled:!1,ui:{id:"dice",sx:0,sy:0,hx:0,hy:0,w:128,h:128}})}});a.casinoScene.createElement("bottom",b,d,e)};a.casinoScene.reflowPosition=function(){for(var b=0;b<ui_config.casinoScene.length;b++)ui_config.casinoScene[b].style.hasOwnProperty("top")&&
(a.casinoScene[ui_config.casinoScene[b].name].style.top=parseInt(ui_config.casinoScene[b].style.top)+a.offset.top+"px"),ui_config.casinoScene[b].style.hasOwnProperty("left")&&(a.casinoScene[ui_config.casinoScene[b].name].style.left=parseInt(ui_config.casinoScene[b].style.left)+a.offset.left+"px")}})(window.UI,smartlib);(function(a,c){c.ui.dice=function(a){a=c.interFace({id:"",value:"\u9ab0\u5b50",width:null,height:null,spritewidth:128,spriteheight:128,animationspeed:1E3,spritecount:{x:4,y:2},x:0,y:0,maxX:400,maxY:300,path:[{x:300,y:0}],color:"#333333",bgColor:"",fontSize:"12px",fontWeight:"normal",position:"",appendTo:"",hided:!1,disabled:!1,ui:{id:"",sx:0,sy:0,hx:0,hy:0,w:128,h:128},click:function(){}},a||{});c.ui.core.call(this,a.id,a.x,a.y,a.width,a.height,a.hided);this.disabled=a.disabled;this.ui=a.ui;this.bgUrl=
"";this.type="dice";this.spritewidth=a.spritewidth;this.spriteheight=a.spriteheight;this.animationspeed=a.animationspeed;this.spritecount={x:~~(a.height/a.spriteheight),y:~~(a.width/a.spritewidth)};this.animations=[];this.degree=this.currentIndex=0;this.nextPos=1;this.scale=0.3;this.path=a.path;this.minY=this.minX=0;this.maxX=a.maxX-this.spritewidth;this.maxY=a.maxY-this.spriteheight;for(var d=0;d<this.spritecount.x*this.spritecount.y;d++)this.animations.push({x:~~(-d%this.spritecount.y)*this.spritewidth+
"px",y:~~(-d/this.spritecount.y)*this.spriteheight+"px"});""!=this.ui.id&&(d=me.loader.getImage(this.ui.id),console.dir(d),d&&(this.bgUrl=d.src),d=null);var d={width:this.spritewidth+"px",height:this.spriteheight+"px",display:this.hided?"none":"block"},e={click:a.click};"absolute"==a.position?(d.position="absolute",d.left=this.x+"px",d.top=this.y+"px"):(d.marginLeft=this.x+"px",d.marginTop=this.y+"px");""!=a.bgColor&&(d.backgroundColor=a.bgColor);d.color=a.color;""!=this.bgUrl&&(d.background="url("+
this.bgUrl+") -"+this.ui.sx+"px -"+this.ui.sy+"px",d.border="0px");this.dom=this.makeDom("div",{id:this.id,type:"dice",value:a.value,disabled:this.disabled},d,e);this.dom.that=this;""!=a.appendTo&&this.appendTo(a.appendTo);a=d=e=null;this.animation();return this};c.extend(c.ui.dice,c.ui.core,{animation:function(){var b=this;7<this.currentIndex&&(this.currentIndex=0);360==this.degree&&(this.degree=0);if(this.x>this.path[0].x||100<this.y)this.x=this.minX,this.scale=0.3;this.y=a.Tween.Bounce.easeOut(this.x,
0,100,100);this.dom.style.webkitTransform="translate("+this.x+"px,"+this.y+"px) scale("+this.scale+", "+this.scale+") rotate("+this.degree+"deg)";this.dom.style.backgroundPosition=this.animations[this.currentIndex].x+" "+this.animations[this.currentIndex].y;this.currentIndex++;this.degree+=30;this.x+=10;this.scale+=0.02;this.timerId=setTimeout(function(){b.animation()},this.animationspeed)}})})(UI,smartlib);UI.cellPopup=function(a,c,b,d){var e=a.parentNode||a.parentElement;if(UI[e.id].cellPopup){var f=parseInt(a.style.top)-17+"px";_left=parseInt(a.style.left)+parseInt(a.style.width)+"px";UI[e.id].cellPopup.style.top===f&&UI[e.id].cellPopup.style.left===_left?UI[e.id].cellPopup.style.display="none"===UI[e.id].cellPopup.style.display?"block":"none":UI.animate(UI[e.id].cellPopup,{top:f,left:_left},0,function(){"block"!=this.style.display&&(this.style.display="block");this.text.innerHTML=c&&c()||""})}else UI[e.id].cellPopup=
UI._ui.makeDom("div",{},gridPopup.wraperStyle,null),UI[e.id].cellPopup.style.top=parseInt(a.style.top)-17+"px",UI[e.id].cellPopup.style.left=parseInt(a.style.left)+parseInt(a.style.width)+"px",UI[e.id].cellPopup.text=UI._ui.makeDom("div",{innerHTML:c&&c()||""},gridPopup.textStyle,null),UI[e.id].cellPopup.appendChild(UI[e.id].cellPopup.text),b&&(UI[e.id].cellPopup.btnA=UI._ui.makeDom("div",{innerHTML:b.text||"\u6309\u952e\u6587\u672c"},gridPopup.btnStyle,{mousedown:function(a){UI.stopPropagation(a);
this.style.background="url(./res/ui/btn/popupbox_btn.png) no-repeat"},mouseup:function(a){UI.stopPropagation(a);this.style.background="url(./res/ui/btn/popupbox_btn.png) no-repeat";"function"===typeof b.onClick&&b.onClick.call(UI[e.id].cellPopup.btn)}}),UI[e.id].cellPopup.appendChild(UI[e.id].cellPopup.btnA)),d&&(UI[e.id].cellPopup.btnB=UI._ui.makeDom("div",{innerHTML:d.text||"\u6309\u952e\u6587\u672c"},gridPopup.btnStyle,{mousedown:function(a){UI.stopPropagation(a);this.style.background="url(./res/ui/btn/popupbox_btn.png) no-repeat"},
mouseup:function(a){UI.stopPropagation(a);this.style.background="url(./res/ui/btn/popupbox_btn.png) no-repeat";"function"===typeof d.onClick&&d.onClick.call(UI[e.id].cellPopup.btn)}}),UI[e.id].cellPopup.btnA.style.left="25px",UI[e.id].cellPopup.btnB.style.left="116px",UI[e.id].cellPopup.appendChild(UI[e.id].cellPopup.btnB)),(a.parentNode||a.parentElement).appendChild(UI[e.id].cellPopup)};(function(a,c){a.shopWindow={};a.shopWindow.w={};a.shopWindow.initShopWindow=function(){a.shopWindow.w=new c.ui.baseWindow({title:"\u88c5\u5907\u5546\u5e97",id:"shopWindow",closed:function(b){a.windowManager.pop(a.shopWindow);a.shopWindow.w={};a.cellPopup.call(b,"destory")}});a.shopWindow.activeTab="1";a.shopWindow.tab={};a.shopWindow.items=[];for(var d=shopWindow[0].items.length-1;0<=d;d--)if("tab"===shopWindow[0].items[d].name)for(var e=["1","2","3","4","5"],f=0;5>f;f++)a.shopWindow.tab[e[f]]=a._ui.makeDom("div",
{id:e[f],className:e[f]===a.shopWindow.activeTab?"tab_left_bg_h":"tab_left_bg",innerHTML:e[f]},shopWindow[0].items[d].style,{click:function(b){a.stopPropagation(b);if(this.id===a.shopWindow.activeTab)return!0;a.cellPopup.call(this.parentNode||this.parentElement,"hide");a.shopWindow.tab[a.shopWindow.activeTab].className="tab_left_bg";a.shopWindow.activeTab=this.id;this.className="tab_left_bg_h"}}),a.shopWindow.tab[e[f]].style.top=38+77*f+"px",a.shopWindow.w.dom.appendChild(a.shopWindow.tab[e[f]]);
else if("item"===shopWindow[0].items[d].name){for(var e=null,g=shopWindow[0].items[d],f=0;10>f;f++){e={};e.dom=a._ui.makeDom("div",{className:"item",id:"i"+f},g.style,{});for(var h=g.items.length-1;0<=h;h--)e[g.items[h].name]=a._ui.makeDom("div",{className:g.items[h].className},g.items[h].style),e.dom.appendChild(e[g.items[h].name]);e.dom.style.top=57+77*parseInt(f/2)+"px";e.dom.style.left=f%2?"184px":"22px";a.shopWindow.items.push(e);a.shopWindow.w.dom.appendChild(e.dom)}e=null;a.cellPopup(a.shopWindow.items,
function(){return"\u6d4b\u8bd5\u6587\u672c\u6d4b\u8bd5\u6587\u672c\u6d4b\u8bd5\u6587\u672c\u6d4b\u8bd5\u6587\u672c"},{text:"\u88c5\u5907",onClick:function(b){a.stopPropagation(b);console.log("\u88c5\u5907\u6309\u94ae\u70b9\u51fb")}},{text:"\u5356\u51fa",onClick:function(b){a.stopPropagation(b);console.log("\u5356\u51fa\u6309\u94ae\u70b9\u51fb")}})}else a.shopWindow[shopWindow[0].items[d].name]=a._ui.makeDom("div",{className:shopWindow[0].items[d].className||""},shopWindow[0].items[d].style),a.shopWindow.w.dom.appendChild(a.shopWindow[shopWindow[0].items[d].name]);
a.windowManager.push(a.shopWindow);a.shopWindow.fillData(b);a.shopWindow.w.dom.style.opacity=0;a.mainDiv.appendChild(a.shopWindow.w.dom)};a.shopWindow.fillData=function(b){for(var c=a.shopWindow.items.length-1;0<=c;c--)a.shopWindow.items[c].dom.className+=" "+b[c].class,a.shopWindow.items[c].name.innerHTML=b[c].name,a.shopWindow.items[c].price.innerHTML="$:"+b[c].price};a.shopWindow.showShopWindow=function(){a.shopWindow.w.dom||a.shopWindow.initShopWindow();a.shopWindow.w.dom.style.opacity=1};a.live("#recharge",
"click",function(){a.shopWindow.showShopWindow()});var b=[{"class":"red",name:"\u540d\u5b57",price:999.99},{"class":"blue",name:"\u795e\u9a6c",price:999.99},{"class":"white",name:"\u560e\u7684",price:999.99},{"class":"purple",name:"\u98a0\u5012\u662f\u975e",price:999.99},{"class":"green",name:"\u6c83\u5c14\u6c83\u989d",price:999.99},{"class":"white",name:"\u963f\u8428\u5fb7",price:999.99},{"class":"green",name:"\u745e\u7279\u997f",price:999.99},{"class":"purple",name:"\u963f\u9053\u592b",price:999.99},
{"class":"red",name:"\u6000\u4ec1\u5802",price:999.99},{"class":"green",name:"\u7279\u8ba4\u4e3a",price:999.99}]})(window.UI,smartlib);(function(a,c){a.fightSettleWindow={};a.fightSettleWindow.w={};a.fightSettleWindow.initFightSettleWindow=function(d){var e=document.createDocumentFragment(),f=fightSettleWindow[0].style;f.title=d?"\u6218\u6597\u80dc\u5229":"\u6218\u6597\u5931\u8d25";f.id="fightSettleWindow";f.closed=function(){a.windowManager.pop(a.fightSettleWindow);a.fightSettleWindow.w={}};a.fightSettleWindow.w=new c.ui.baseWindow(f);f=null;a.fightSettleWindow.w.dom.style.top=ui_config.window.top+a.offset.top+"px";a.fightSettleWindow.w.dom.style.left=
(960-parseInt(this.w.dom.style.width))/2+a.offset.left+"px";for(var f=fightSettleWindow[0].items.length-1,g,h;0<=f;f--){g=fightSettleWindow[0].items[f];h=g.style;a.fightSettleWindow[g.name]=[];for(var i=0,j;i<fightSettleWindow[0].items[f].quantity;i++){for(var k in g.differ[i])h[k]=g.differ[i][k];j=a._ui.makeDom("div",{className:g.name},h,null);a.fightSettleWindow[g.name].push(j);e.appendChild(j);j=null}}a.fightSettleWindow.setStyle(d);a.fightSettleWindow.fillData(d,b);a.fightSettleWindow.w.dom.appendChild(e);
e=null;a.windowManager.push(a.fightSettleWindow);a.fightSettleWindow.w.dom.style.opacity=0;a.mainDiv.appendChild(a.fightSettleWindow.w.dom)};a.fightSettleWindow.setStyle=function(b){for(var c=a.fightSettleWindow["fight-tag"].length-1,f=["\u6218\u6597\u8bc4\u7ea7","\u6218\u6597\u5956\u52b1"];0<=c;c--)a.fightSettleWindow["fight-tag"][c].className+=b?" win":" lose",a.fightSettleWindow["fight-tag"][c].innerHTML=f[c];for(c=a.fightSettleWindow["fight-cell"].length-1;0<=c;c--)a.fightSettleWindow["fight-cell"][c].className+=
b?" cell-win":" cell-lose";f=b?["\u91cd\u65b0\u64ad\u653e","\u7ee7\u7eed\u526f\u672c"]:["\u8fd4\u56de\u526f\u672c","\u518d\u6b21\u6218\u6597"];for(c=f.length-1;0<=c;c--)a.fightSettleWindow["frame-btn-alone"][c].innerHTML=f[c];a.bind(a.fightSettleWindow["frame-btn-alone"][0],"click",function(c){a.stopPropagation(c);b?console.log("\u91cd\u65b0\u64ad\u653e"):console.log("\u518d\u6b21\u6218\u6597")});a.bind(a.fightSettleWindow["frame-btn-alone"][1],"click",function(c){a.stopPropagation(c);b?console.log("\u7ee7\u7eed\u526f\u672c"):
console.log("\u8fd4\u56de\u526f\u672c")})};a.fightSettleWindow.fillData=function(b,c){var f,g,h;b?(f=c.rank,g=c.rate[0],h=c.reward[0]):(f=0,g=c.rate[1],h=c.reward[1]);a.fightSettleWindow["fight-purple-txt"][0].innerHTML="EXP\uff1a"+g.exp;a.fightSettleWindow["fight-purple-txt"][1].innerHTML="\u91d1\u5e01\uff1a"+h.gold;a.fightSettleWindow["fight-golden-txt"][0].innerHTML="EXP\uff1a"+g.exp;a.fightSettleWindow["fight-golden-txt"][1].innerHTML="\u91d1\u5e01\uff1a"+h.gold;for(g=0;g<f;g++)a.fightSettleWindow["fight-star"][g].className+=
" shine"};a.fightSettleWindow.show=function(b){a.fightSettleWindow.w.dom||a.fightSettleWindow.initFightSettleWindow(b);a.show(a.fightSettleWindow.w.dom);a.fightSettleWindow.w.dom.style.opacity=1};var b={rank:2,rate:[{exp:5E5,gold:111111},{exp:0,gold:0}],reward:[{exp:34E4,gold:222222},{exp:340,gold:88}]}})(window.UI,smartlib);
