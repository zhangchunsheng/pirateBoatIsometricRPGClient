(function(){CocoonJS=window.CocoonJS?window.CocoonJS:{};CocoonJS.nativeExtensionObjectAvailable="undefined"!==typeof window.ext;CocoonJS.Size={width:0,height:0};CocoonJS.extend=function(a,b){var c=a.prototype,d=function(){};d.prototype=b.prototype;a.prototype=new d;a.superclass=b.prototype;a.prototype.constructor=a;b.prototype.constructor===Object.prototype.constructor&&(b.prototype.constructor=b);for(var e in c)c.hasOwnProperty(e)&&(a.prototype[e]=c[e])};CocoonJS.makeNativeExtensionObjectFunctionCall=
function(a,b,c,d){if(CocoonJS.nativeExtensionObjectAvailable){c=Array.prototype.slice.call(c);c.unshift(b);a=ext[a];a=d=(d?a.makeCallAsync:a.makeCall).apply(a,c);if("string"===typeof d)try{a=JSON.parse(d)}catch(e){}return a}};CocoonJS.getObjectFromPath=function(a,b){for(var c=b.split("."),d=a,e=0,f=c.length;e<f;++e)d[c[e]]=d[c[e]]||void 0,d=d[c[e]];return d};CocoonJS.getKeyForValueInDictionary=function(a,b){var c=null,d;for(d in a)if(a[d]===b){c=d;break}return c};CocoonJS.findStringInStringArrayThatIsIndexOf=
function(a,b,c){for(var d=null,b=c?b:b.toUpperCase(),e=0;null==d&&e<a.length;e++)d=c?a[e]:a[e].toUpperCase(),d=0<=d.indexOf(b)?a[e]:null;return d};CocoonJS.EventHandler=function(a,b,c,d){this.listeners=[];this.listenersOnce=[];this.chainFunction=d;this.addEventListener=function(e){if(d){var f=function(){d.call(this,arguments.callee.sourceListener,Array.prototype.slice.call(arguments))};e.CocoonJSEventHandlerChainFunction=f;f.sourceListener=e;e=f}(f=CocoonJS.getObjectFromPath(CocoonJS,b))&&f.nativeExtensionObjectAvailable?
ext[a].addEventListener(c,e):0>this.listeners.indexOf(e)&&this.listeners.push(e)};this.addEventListenerOnce=function(e){if(d){var f=function(){d(arguments.callee.sourceListener,Array.prototype.slice.call(arguments))};f.sourceListener=e;e=f}CocoonJS.getObjectFromPath(CocoonJS,b).nativeExtensionObjectAvailable?ext[a].addEventListenerOnce(c,e):0>this.listeners.indexOf(e)&&this.listenersOnce.push(e)};this.removeEventListener=function(e){d&&(e=e.CocoonJSEventHandlerChainFunction,delete e.CocoonJSEventHandlerChainFunction);
CocoonJS.getObjectFromPath(CocoonJS,b).nativeExtensionObjectAvailable?ext[a].removeEventListener(c,e):(e=this.listeners.indexOf(e),0<=e&&this.listeners.splice(e,1))};this.notifyEventListeners=function(){var d=CocoonJS.getObjectFromPath(CocoonJS,b);if(d&&d.nativeExtensionObjectAvailable)ext[a].notifyEventListeners(c);else{var f=Array.prototype.slice.call(arguments),g=Array.prototype.slice.call(this.listeners),h=Array.prototype.slice.call(this.listenersOnce),i=this;setTimeout(function(){for(var a=0;a<
g.length;a++)g[a].apply(i,f);for(a=0;a<h.length;a++)h[a].apply(i,f)},0);i.listenersOnce=[]}};return this};CocoonJS.Timer=function(){this.reset();return this};CocoonJS.Timer.prototype={currentTimeInMillis:0,lastTimeInMillis:0,elapsedTimeInMillis:0,elapsedTimeInSeconds:0,accumTimeInMillis:0,reset:function(){this.currentTimeInMillis=this.lastTimeInMillis=(new Date).getTime();this.accumTimeInMillis=this.elapsedTimeInMillis=this.elapsedTimeInSeconds=0},update:function(){this.currentTimeInMillis=(new Date).getTime();
this.elapsedTimeInMillis=this.currentTimeInMillis-this.lastTimeInMillis;this.elapsedTimeInSeconds=this.elapsedTimeInMillis/1E3;this.lastTimeInMillis=this.currentTimeInMillis;this.accumTimeInMillis+=this.elapsedTimeInMillis}};CocoonJS.FPSCounter=function(){this.timer=new CocoonJS.Timer;this.reset();return this};CocoonJS.Timer.prototype={timer:0,fps:0,averageFPS:0,reset:function(){this.timer.reset();this.averageFPS=this.fps=0},update:function(){this.timer.update();this.fps++;1E3<=this.timer.accumTimeInMillis&&
(this.averageFPS=this.fps,this.fps=0,this.timer.reset())}}})();(function(){if("undefined"===typeof window.CocoonJS||null===window.CocoonJS)throw"The CocoonJS object must exist and be valid before creating any extension object.";CocoonJS.App=CocoonJS.App?CocoonJS.App:{};CocoonJS.App.nativeExtensionObjectAvailable=CocoonJS.nativeExtensionObjectAvailable&&"undefined"!==typeof window.ext.IDTK_APP;CocoonJS.App.FPSLayout={TOP_LEFT:"top-left",TOP_RIGHT:"top-right",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right"};CocoonJS.App.KeyboardType={TEXT:"text",NUMBER:"num",
PHONE:"phone",EMAIL:"email",URL:"url"};CocoonJS.App.StorageType={APP_STORAGE:"APP_STORAGE",INTERNAL_STORAGE:"INTERNAL_STORAGE",EXTERNAL_STORAGE:"EXTERNAL_STORAGE",TEMPORARY_STORAGE:"TEMPORARY_STORAGE"};CocoonJS.App.CaptureType={EVERYTHING:0,JUST_COCOONJS_GL_SURFACE:1,JUST_SYSTEM_VIEWS:2};CocoonJS.App.forward=function(a){if(CocoonJS.App.nativeExtensionObjectAvailable)return CocoonJS.makeNativeExtensionObjectFunctionCall("IDTK_APP","forward",arguments);if(!navigator.isCocoonJS)return"CocoonJS_App_ForCocoonJS_WebViewIFrame"==
window.name?window.parent.eval(a):window.frames.CocoonJS_App_ForCocoonJS_WebViewIFrame.window.eval(a)};CocoonJS.App.forwardAsync=function(a,b){if(CocoonJS.App.nativeExtensionObjectAvailable)return"undefined"!==typeof b?ext.IDTK_APP.makeCallAsync("forward",a,b):ext.IDTK_APP.makeCallAsync("forward",a);if(!navigator.isCocoonJS)return"CocoonJS_App_ForCocoonJS_WebViewIFrame"==window.name?window.parent.eval(a):window.parent.frames.CocoonJS_App_ForCocoonJS_WebViewIFrame.window.eval(a)};CocoonJS.App.showTextDialog=
function(a,b,c,d,e,f){if(CocoonJS.App.nativeExtensionObjectAvailable)return CocoonJS.makeNativeExtensionObjectFunctionCall("IDTK_APP","showTextDialog",arguments,!0);if(!navigator.isCocoonJS){b||(b="");c||(c="");var g=prompt(b,c);(g?CocoonJS.App.onTextDialogFinished:CocoonJS.App.onTextDialogCancelled).notifyEventListeners(g)}};CocoonJS.App.showMessageBox=function(a,b,c,d){if(CocoonJS.App.nativeExtensionObjectAvailable)return CocoonJS.makeNativeExtensionObjectFunctionCall("IDTK_APP","showMessageBox",
arguments,!0);navigator.isCocoonJS||(b||(b=""),(confirm(b)?CocoonJS.App.onMessageBoxConfirmed:CocoonJS.App.onMessageBoxDenied).notifyEventListeners())};CocoonJS.App.load=function(a,b){if(CocoonJS.App.nativeExtensionObjectAvailable)return CocoonJS.makeNativeExtensionObjectFunctionCall("IDTK_APP","loadPath",arguments);if(!navigator.isCocoonJS){var c=new XMLHttpRequest;c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status){var b;b=CocoonJS.App.EmulatedWebViewIFrame?"CocoonJS.App.onLoadInCocoonJSSucceed.notifyEventListeners('"+
a+"');":"CocoonJS.App.onLoadInTheWebViewSucceed.notifyEventListeners('"+a+"');";CocoonJS.App.forwardAsync(b);window.location.href=a}else 404===c.status&&(this.onreadystatechange=null,b=CocoonJS.App.EmulatedWebViewIFrame?"CocoonJS.App.onLoadInCocoonJSFailed.notifyEventListeners('"+a+"');":"CocoonJS.App.onLoadInTheWebViewFailed.notifyEventListeners('"+a+"');",CocoonJS.App.forwardAsync(b))};c.open("GET",a,!0);c.send()}};CocoonJS.App.openURL=function(a){if(CocoonJS.App.nativeExtensionObjectAvailable)return CocoonJS.makeNativeExtensionObjectFunctionCall("IDTK_APP",
"openURL",arguments,!0);navigator.isCocoonJS||window.open(a,"_blank")};CocoonJS.App.forceToFinish=function(){if(CocoonJS.App.nativeExtensionObjectAvailable)return CocoonJS.makeNativeExtensionObjectFunctionCall("IDTK_APP","forceToFinish",arguments);navigator.isCocoonJS||window.close()};CocoonJS.App.createScreenCanvas=function(){var a;navigator.isCocoonJS?a=document.createElement("screencanvas"):navigator.isCocoonJS||(a=document.createElement("canvas"),a.width=window.innerWidth,a.height=window.innerHeight);
return a};CocoonJS.App.disableTouchInCocoonJS=function(){CocoonJS.App.nativeExtensionObjectAvailable&&window.ext.IDTK_APP.makeCall("disableTouchLayer","CocoonJSView")};CocoonJS.App.enableTouchInCocoonJS=function(){CocoonJS.App.nativeExtensionObjectAvailable&&window.ext.IDTK_APP.makeCall("enableTouchLayer","CocoonJSView")};CocoonJS.App.disableTouchInTheWebView=function(){CocoonJS.App.nativeExtensionObjectAvailable&&window.ext.IDTK_APP.makeCall("disableTouchLayer","WebView")};CocoonJS.App.enableTouchInTheWebView=
function(){CocoonJS.App.nativeExtensionObjectAvailable&&window.ext.IDTK_APP.makeCall("enableTouchLayer","WebView")};CocoonJS.App.setAccelerometerUpdateIntervalInSeconds=function(a){if(CocoonJS.App.nativeExtensionObjectAvailable)return window.ext.IDTK_APP.makeCall("setAccelerometerUpdateIntervalInSeconds",a)};CocoonJS.App.getAccelerometerUpdateIntervalInSeconds=function(){if(CocoonJS.App.nativeExtensionObjectAvailable)return window.ext.IDTK_APP.makeCall("getAccelerometerUpdateIntervalInSeconds")};
CocoonJS.App.setGyroscopeUpdateIntervalInSeconds=function(a){if(CocoonJS.App.nativeExtensionObjectAvailable)return window.ext.IDTK_APP.makeCall("setGyroscopeUpdateIntervalInSeconds",a)};CocoonJS.App.getGyroscopeUpdateIntervalInSeconds=function(){CocoonJS.App.nativeExtensionObjectAvailable&&window.ext.IDTK_APP.makeCall("getGyroscopeUpdateIntervalInSeconds")};CocoonJS.App.setupOriginProxyType=function(a,b,c,d){if(CocoonJS.App.nativeExtensionObjectAvailable){if(!a)throw"The given typeName must be valid.";
if(!b&&!c&&!d)throw"There is no point on setting up a proxy for no attributes, functions nor eventHandlers.";var b=b?b:[],c=c?c:[],d=d?d:[],e=window,f="CocoonJS.App.setupDestinationProxyType("+JSON.stringify(a)+", "+JSON.stringify(d)+");";CocoonJS.App.forward(f);f=e[a];e[a]=function(){var f=this;this._cocoonjs_proxy_object_data={};var h="CocoonJS.App.newDestinationProxyObject("+JSON.stringify(a)+");";this._cocoonjs_proxy_object_data.id=CocoonJS.App.forward(h);this._cocoonjs_proxy_object_data.eventHandlers=
{};this._cocoonjs_proxy_object_data.typeName=a;this._cocoonjs_proxy_object_data.eventListeners={};e[a]._cocoonjs_proxy_type_data.proxyObjects[this._cocoonjs_proxy_object_data.id]=this;for(h=0;h<b.length;h++)(function(b){f.__defineSetter__(b,function(c){c="CocoonJS.App.setDestinationProxyObjectAttribute("+JSON.stringify(a)+", "+f._cocoonjs_proxy_object_data.id+", "+JSON.stringify(b)+", "+JSON.stringify(c)+");";return CocoonJS.App.forward(c)});f.__defineGetter__(b,function(){var c="CocoonJS.App.getDestinationProxyObjectAttribute("+
JSON.stringify(a)+", "+f._cocoonjs_proxy_object_data.id+", "+JSON.stringify(b)+");";return CocoonJS.App.forward(c)})})(b[h]);for(h=0;h<c.length;h++)(function(b){f[b]=function(){var c=Array.prototype.slice.call(arguments);c.unshift(b);c.unshift(this._cocoonjs_proxy_object_data.id);c.unshift(a);for(var d="CocoonJS.App.callDestinationProxyObjectFunction(",e=0;e<c.length;e++)d+=(1!==e?JSON.stringify(c[e]):c[e])+(e<c.length-1?", ":"");return CocoonJS.App.forward(d+");")}})(c[h]);for(h=0;h<d.length;h++)(function(a){f.__defineSetter__(a,
function(b){f._cocoonjs_proxy_object_data.eventHandlers[a]=b});f.__defineGetter__(a,function(){return f._cocoonjs_proxy_object_data.eventHandlers[a]})})(d[h]);f.addEventListener=function(a,b){var c=!0,d=f._cocoonjs_proxy_object_data.eventListeners[a];if(d)c=0>d.indexOf(b);else{d=[];f._cocoonjs_proxy_object_data.eventListeners[a]=d;var e="CocoonJS.App.addDestinationProxyObjectEventListener("+JSON.stringify(f._cocoonjs_proxy_object_data.typeName)+", "+f._cocoonjs_proxy_object_data.id+", "+JSON.stringify(a)+
");";CocoonJS.App.forward(e)}c&&d.push(b)};f.removeEventListener=function(a,b){var c=f._cocoonjs_proxy_object_data.eventListeners[a];if(c){var d=c.indexOf(b);0<=d&&c.splice(d,1)}};return this};e[a]._cocoonjs_proxy_type_data={originalType:f,proxyObjects:[]};e[a]._cocoonjs_proxy_type_data.deleteProxyObject=function(b){var c=CocoonJS.getKeyForValueInDictionary(this.proxyObjects,b);if(c){var d="CocoonJS.App.deleteDestinationProxyObject("+JSON.stringify(a)+", "+b._cocoonjs_proxy_object_data.id+");";CocoonJS.App.forward(d);
b._cocoonjs_proxy_object_data=null;delete this.proxyObjects[c]}};e[a]._cocoonjs_proxy_type_data.callProxyObjectEventHandler=function(a,b){var c=this.proxyObjects[a],d=c._cocoonjs_proxy_object_data.eventHandlers[b];d&&d({target:c})};e[a]._cocoonjs_proxy_type_data.callProxyObjectEventListeners=function(a,b){for(var c=this.proxyObjects[a],d=c._cocoonjs_proxy_object_data.eventListeners[b].slice(),e=0;e<d.length;e++)d[e]({target:c})}}};CocoonJS.App.takedownOriginProxyType=function(a){if(CocoonJS.App.nativeExtensionObjectAvailable){var b=
window;b[a]&&b[a]._cocoonjs_proxy_type_data&&(b[a]=b[a]._cocoonjs_proxy_type_data.originalType)}};CocoonJS.App.deleteOriginProxyObject=function(a){if(CocoonJS.App.nativeExtensionObjectAvailable){var b=window;a&&a._cocoonjs_proxy_object_data&&b[a._cocoonjs_proxy_object_data.typeName]._cocoonjs_proxy_type_data.deleteProxyObject(a)}};CocoonJS.App.callOriginProxyObjectEventHandler=function(a,b,c){CocoonJS.App.nativeExtensionObjectAvailable&&window[a]._cocoonjs_proxy_type_data.callProxyObjectEventHandler(b,
c)};CocoonJS.App.callOriginProxyObjectEventListeners=function(a,b,c){CocoonJS.App.nativeExtensionObjectAvailable&&window[a]._cocoonjs_proxy_type_data.callProxyObjectEventListeners(b,c)};CocoonJS.App.setupDestinationProxyType=function(a,b){CocoonJS.App.nativeExtensionObjectAvailable&&(window[a]._cocoonjs_proxy_type_data={nextId:0,proxyObjects:{},eventHandlerNames:b})};CocoonJS.App.takedownDestinationProxyType=function(a){if(CocoonJS.App.nativeExtensionObjectAvailable){var b=window;parent[a]&&b[a]._cocoonjs_proxy_type_data&&
delete b[a]._cocoonjs_proxy_type_data}};CocoonJS.App.newDestinationProxyObject=function(a){if(CocoonJS.App.nativeExtensionObjectAvailable){var b=window,c=new b[a];c._cocoonjs_proxy_object_data={};c._cocoonjs_proxy_object_data.typeName=a;var d=b[a]._cocoonjs_proxy_type_data.nextId;b[a]._cocoonjs_proxy_type_data.proxyObjects[d]=c;c._cocoonjs_proxy_object_data.id=d;b[a]._cocoonjs_proxy_type_data.nextId++;for(var e=0;e<b[a]._cocoonjs_proxy_type_data.eventHandlerNames.length;e++)(function(a){c[a]=function(){var b=
"CocoonJS.App.callOriginProxyObjectEventHandler("+JSON.stringify(this._cocoonjs_proxy_object_data.typeName)+", "+this._cocoonjs_proxy_object_data.id+", "+JSON.stringify(a)+");";CocoonJS.App.forward(b)}})(b[a]._cocoonjs_proxy_type_data.eventHandlerNames[e]);c._cocoonjs_proxy_object_data.eventListeners={};return d}};CocoonJS.App.callDestinationProxyObjectFunction=function(a,b,c){if(CocoonJS.App.nativeExtensionObjectAvailable){var d=window,e=Array.prototype.slice.call(arguments);e.splice(0,3);d=d[a]._cocoonjs_proxy_type_data.proxyObjects[b];
return d[c].apply(d,e)}};CocoonJS.App.setDestinationProxyObjectAttribute=function(a,b,c,d){CocoonJS.App.nativeExtensionObjectAvailable&&(window[a]._cocoonjs_proxy_type_data.proxyObjects[b][c]=d)};CocoonJS.App.getDestinationProxyObjectAttribute=function(a,b,c){if(CocoonJS.App.nativeExtensionObjectAvailable)return window[a]._cocoonjs_proxy_type_data.proxyObjects[b][c]};CocoonJS.App.deleteDestinationProxyObject=function(a,b){CocoonJS.App.nativeExtensionObjectAvailable&&delete window[a]._cocoonjs_proxy_type_data.proxyObjects[b]};
CocoonJS.App.addDestinationProxyObjectEventListener=function(a,b,c){CocoonJS.App.nativeExtensionObjectAvailable&&(a=window[a]._cocoonjs_proxy_type_data.proxyObjects[b],b=function(){var a="CocoonJS.App.callOriginProxyObjectEventListeners("+JSON.stringify(this._cocoonjs_proxy_object_data.typeName)+", "+this._cocoonjs_proxy_object_data.id+", "+JSON.stringify(c)+");";CocoonJS.App.forward(a)},a._cocoonjs_proxy_object_data.eventListeners[c]=b,a.addEventListener(c,b))};CocoonJS.App.proxifyXHR=function(){CocoonJS.App.setupOriginProxyType("XMLHttpRequest",
"timeout withCredentials upload status statusText responseType response responseText responseXML readyState".split(" "),"open setRequestHeader send abort getResponseHeader getAllResponseHeaders overrideMimeType".split(" "),"onloadstart onprogress onabort onerror onload ontimeout onloadend onreadystatechange".split(" "))};CocoonJS.App.proxifyAudio=function(){CocoonJS.App.setupOriginProxyType("Audio",["src","loop","volume","preload"],["play","pause","load","canPlayType"],["onended","oncanplay","oncanplaythrough",
"onerror"])};CocoonJS.App.captureScreen=function(a,b,c){if(CocoonJS.App.nativeExtensionObjectAvailable)return window.ext.IDTK_APP.makeCall("captureScreen",a,b,c)};CocoonJS.App.captureScreenAsync=function(a,b,c){CocoonJS.App.nativeExtensionObjectAvailable&&window.ext.IDTK_APP.makeCall("captureScreenAsync",a,b,c)};CocoonJS.App.onTextDialogFinished=new CocoonJS.EventHandler("IDTK_APP","App","ontextdialogfinish");CocoonJS.App.onTextDialogCancelled=new CocoonJS.EventHandler("IDTK_APP","App","ontextdialogcancel");
CocoonJS.App.onMessageBoxConfirmed=new CocoonJS.EventHandler("IDTK_APP","App","onmessageboxconfirmed");CocoonJS.App.onMessageBoxDenied=new CocoonJS.EventHandler("IDTK_APP","App","onmessageboxdenied");CocoonJS.App.onSuspended=new CocoonJS.EventHandler("IDTK_APP","App","onsuspended");CocoonJS.App.onActivated=new CocoonJS.EventHandler("IDTK_APP","App","onactivated");CocoonJS.App.onCaptureScreenSucceeded=new CocoonJS.EventHandler("IDTK_APP","App","onCaptureScreenSucceeded");CocoonJS.App.onCaptureScreenFailed=
new CocoonJS.EventHandler("IDTK_APP","App","onCaptureScreenFailed")})();(function(){if("undefined"===typeof window.CocoonJS||null===window.CocoonJS)throw"The CocoonJS object must exist and be valid before adding more functionalities to an extension.";if("undefined"===typeof window.CocoonJS.App||null===window.CocoonJS.App)throw"The CocoonJS.App object must exist and be valid before adding more functionalities to it.";CocoonJS.App=CocoonJS.App?CocoonJS.App:{};CocoonJS.App.nativeExtensionObjectAvailable||(CocoonJS.App.EmulatedWebView=document.createElement("div"),CocoonJS.App.EmulatedWebView.setAttribute("id",
"CocoonJS_App_ForCocoonJS_WebViewDiv"),CocoonJS.App.EmulatedWebView.style.width=0,CocoonJS.App.EmulatedWebView.style.height=0,CocoonJS.App.EmulatedWebView.style.position="absolute",CocoonJS.App.EmulatedWebView.style.left=0,CocoonJS.App.EmulatedWebView.style.top=0,CocoonJS.App.EmulatedWebView.style.backgroundColor="transparent",CocoonJS.App.EmulatedWebView.style.border="0px solid #000",CocoonJS.App.EmulatedWebViewIFrame=document.createElement("iframe"),CocoonJS.App.EmulatedWebViewIFrame.setAttribute("id",
"CocoonJS_App_ForCocoonJS_WebViewIFrame"),CocoonJS.App.EmulatedWebViewIFrame.setAttribute("name","CocoonJS_App_ForCocoonJS_WebViewIFrame"),CocoonJS.App.EmulatedWebViewIFrame.style.width=0,CocoonJS.App.EmulatedWebViewIFrame.style.height=0,CocoonJS.App.EmulatedWebViewIFrame.frameBorder=0,CocoonJS.App.EmulatedWebViewIFrame.allowtransparency=!0,CocoonJS.App.EmulatedWebView.appendChild(CocoonJS.App.EmulatedWebViewIFrame),document.body.appendChild(CocoonJS.App.EmulatedWebView));CocoonJS.App.pause=function(){if(CocoonJS.App.nativeExtensionObjectAvailable)return CocoonJS.makeNativeExtensionObjectFunctionCall("IDTK_APP",
"pause",arguments)};CocoonJS.App.resume=function(){if(CocoonJS.App.nativeExtensionObjectAvailable)return CocoonJS.makeNativeExtensionObjectFunctionCall("IDTK_APP","resume",arguments)};CocoonJS.App.loadInTheWebView=function(a,b){if(CocoonJS.App.nativeExtensionObjectAvailable){var c="ext.IDTK_APP.makeCall('loadPath'";"undefined"!==typeof a&&(c+=", '"+a+"'","undefined"!==typeof b&&(c+=", '"+b+"'"));return CocoonJS.App.forwardAsync(c+");")}if(!navigator.isCocoonJS){var d=new XMLHttpRequest;d.onreadystatechange=
function(){if(4===d.readyState)if(200===d.status){var b=function(){CocoonJS.App.onLoadInTheWebViewSucceed.notifyEventListeners(a);CocoonJS.App.EmulatedWebViewIFrame.removeEventListener("load",b)};CocoonJS.App.EmulatedWebViewIFrame.addEventListener("load",b);CocoonJS.App.EmulatedWebViewIFrame.contentWindow.location.href=a}else 404===d.status&&(this.onreadystatechange=null,CocoonJS.App.onLoadInTheWebViewFailed.notifyEventListeners(a))};d.open("GET",a,!0);d.send()}};CocoonJS.App.showTheWebView=function(a,
b,c,d){if(CocoonJS.App.nativeExtensionObjectAvailable){var e="ext.IDTK_APP.makeCall('show'";"undefined"!==typeof a&&("undefined"!==typeof b&&"undefined"!==typeof c&&"undefined"!==typeof d)&&(e+=", "+a+", "+b+", "+c+", "+d);return CocoonJS.App.forwardAsync(e+");")}navigator.isCocoonJS||(CocoonJS.App.EmulatedWebViewIFrame.style.width=(c?c:window.innerWidth)+"px",CocoonJS.App.EmulatedWebViewIFrame.style.height=(d?d:window.innerHeight)+"px",CocoonJS.App.EmulatedWebView.style.left=(a?a:0)+"px",CocoonJS.App.EmulatedWebView.style.top=
(b?b:0)+"px",CocoonJS.App.EmulatedWebView.style.width=(c?c:window.innerWidth)+"px",CocoonJS.App.EmulatedWebView.style.height=(d?d:window.innerHeight)+"px",CocoonJS.App.EmulatedWebView.style.display="block")};CocoonJS.App.hideTheWebView=function(){if(CocoonJS.App.nativeExtensionObjectAvailable)return CocoonJS.App.forwardAsync("ext.IDTK_APP.makeCall('hide');");navigator.isCocoonJS||(CocoonJS.App.EmulatedWebView.style.display="none")};CocoonJS.App.markAsMusic=function(a){if(CocoonJS.App.nativeExtensionObjectAvailable)return CocoonJS.makeNativeExtensionObjectFunctionCall("IDTK_APP",
"addForceMusic",arguments)};CocoonJS.App.setAntialias=function(a){if(CocoonJS.App.nativeExtensionObjectAvailable)return CocoonJS.makeNativeExtensionObjectFunctionCall("IDTK_APP","setDefaultAntialias",arguments)};CocoonJS.App.setAppShouldFinishCallback=function(a){navigator.isCocoonJS&&(window.onidtkappfinish=a)};CocoonJS.App.setTextureReduction=function(a,b,c){if(CocoonJS.App.nativeExtensionObjectAvailable)return CocoonJS.makeNativeExtensionObjectFunctionCall("IDTK_APP","setDefaultTextureReducerThreshold",
arguments)};CocoonJS.App.logMemoryInfo=function(){if(CocoonJS.App.nativeExtensionObjectAvailable)return CocoonJS.makeNativeExtensionObjectFunctionCall("IDTK_APP","logMemoryInfo",arguments)};CocoonJS.App.setupWebViewProxyType=function(a,b,c,d){if(CocoonJS.App.nativeExtensionObjectAvailable){if(!a)throw"The given typeName must be valid.";if(!b&&!c&&!d)throw"There is no point on setting up a proxy for no attributes, functions nor eventHandlers.";var b=b?b:[],c=c?c:[],d=d?d:[],e=window,f="CocoonJS.App.setupCocoonJSProxyType("+
JSON.stringify(a)+", "+JSON.stringify(d)+");";CocoonJS.App.forward(f);e[a]=function(){var f=this;this.cocoonjs={};var h="CocoonJS.App.newCocoonJSProxyObject("+JSON.stringify(a)+");";this.cocoonjs.id=CocoonJS.App.forward(h);this.cocoonjs.eventHandlers=[];this.cocoonjs.typeName=a;e[a].cocoonjs.objects.push(this);this.cocoonjs.callCocoonJSProxyObjectFunctionInTheWebview=function(b,c){var d=Array.prototype.slice.call(c);d.unshift(b);d.unshift(this.id);d.unshift(a);for(var e="CocoonJS.App.callCocoonJSProxyObjectFunction(",
f=0;f<d.length;f++)e+=JSON.stringify(d[f])+(f<d.length-1?", ":"");return CocoonJS.App.forward(e+");")};this.cocoonjs.findEventHandler=function(a){for(var b=null,c=0;null==b&&c<this.eventHandlers.length;c++)b=this.eventHandlers[c].eventHandlerName===a?this.eventHandlers[c]:null;return b};for(h=0;h<b.length;h++)(function(b){f.__defineSetter__(b,function(c){c="CocoonJS.App.setCocoonJSProxyObjectAttribute("+JSON.stringify(a)+", "+f.cocoonjs.id+", "+JSON.stringify(b)+"', "+JSON.stringify(c)+");";return CocoonJS.App.forward(c)});
f.__defineGetter__(b,function(){var c="CocoonJS.App.getCocoonJSProxyObjectAttribute("+JSON.stringify(a)+", "+f.cocoonjs.id+", '"+b+"');";return CocoonJS.App.forward(c)})})(b[h]);for(h=0;h<c.length;h++)(function(a){f[a]=function(){return f.cocoonjs.callCocoonJSProxyObjectFunctionInTheWebview(a,arguments)}})(c[h]);for(h=0;h<d.length;h++)(function(a){f.__defineSetter__(a,function(b){var c=f.cocoonjs.findEventHandler(a);c?c.eventHandler=b:f.cocoonjs.eventHandlers.push({eventHandlerName:a,eventHandler:b})});
f.__defineGetter__(a,function(){var b=f.cocoonjs.findEventHandler(a);return b?b.eventHandler:null})})(d[h]);return this};e[a].cocoonjs={objects:[]};e[a].cocoonjs.deleteObject=function(b){var c=this.objects.indexOf(b);this.objects.splice(c,1);c="CocoonJS.App.deleteCocoonJSProxyObject("+JSON.stringify(a)+", "+b.cocoonjs.id+");";CocoonJS.App.forward(c);b.cocoonjs=null};e[a].cocoonjs.findObjectForId=function(a){for(var b=null,c=0;null==b&&c<this.objects.length;c++)b=this.objects[c].cocoonjs.id===a?this.objects[c]:
null;return b};e[a].cocoonjs.callEventHandler=function(a,b){var c=this.findObjectForId(a),d=c.cocoonjs.findEventHandler(b);d&&d.eventHandler({target:c})}}};CocoonJS.App.enableFPSInTheWebView=function(a,b){if(!CocoonJS.App.fpsInTheWebViewEnabled){var a=a?a:CocoonJS.App.FPSLayout.TOP_RIGHT,b=b?b:"white",c="(function(){var COCOONJS_WEBVIEW_EXTENSION_SCRIPT_FILES = ['js/CocoonJSExtensions/CocoonJS.js', 'js/CocoonJSExtensions/CocoonJS_App.js', 'js/CocoonJSExtensions/CocoonJS_App_ForWebView.js'];var loadedScriptCounter = 0;var loadedScriptFunction = function() { loadedScriptCounter++;if (loadedScriptCounter >= COCOONJS_WEBVIEW_EXTENSION_SCRIPT_FILES.length){CocoonJS.App.enableFPS("+
JSON.stringify(a)+", "+JSON.stringify(b)+");}};for (var i = 0; i < COCOONJS_WEBVIEW_EXTENSION_SCRIPT_FILES.length; i++){var s = document.createElement('script');s.onload = loadedScriptFunction;s.src = COCOONJS_WEBVIEW_EXTENSION_SCRIPT_FILES[i];document.body.appendChild(s);}})();";setTimeout(function(){CocoonJS.App.forward(c)},3E3);CocoonJS.App.fpsInTheWebViewEnabled=!0}};CocoonJS.App.disableFPSInTheWebView=function(){};CocoonJS.App.onLoadInTheWebViewSucceed=new CocoonJS.EventHandler("IDTK_APP","App",
"forwardpageload");CocoonJS.App.onLoadInTheWebViewFailed=new CocoonJS.EventHandler("IDTK_APP","App","forwardpagefail")})();/*
 MinPubSub
 a micro publish/subscribe messaging framework
 @see https://github.com/daniellmb/MinPubSub 
 @author Daniel Lamb <daniellmb.com>

 Released under the MIT License
 MelonJS Game Engine
 Copyright (C) 2011 - 2013, Olivier BIOT
 http://www.melonjs.org

 melonJS is licensed under the MIT License.
 http://www.opensource.org/licenses/mit-license.php

 Tween JS
 https://github.com/sole/Tween.js
*/
var me=me||{};
(function(a){function b(){if(!f){if(!c.body)return setTimeout(b,13);c.removeEventListener?c.removeEventListener("DOMContentLoaded",b,!1):a.removeEventListener("load",b,!1);f=!0;for(var d=0;d<g.length;d++)g[d].call(a,[]);g.length=0}}var c=a.document;me={mod:"melonJS",version:"0.9.7",nocache:"",audio:null,video:null,timer:null,input:null,state:null,game:null,entityPool:null,levelDirector:null,TMXParser:null,loadingScreen:null,TMXTileMap:null};me.sys={ua:navigator.userAgent.toLowerCase(),sound:!1,localStorage:"object"==
typeof a.localStorage,gyro:void 0!==a.DeviceMotionEvent,nativeBase64:"function"==typeof a.atob,touch:!1,fps:60,interpolation:!1,scale:null,gravity:void 0,useNativeAnimFrame:!1,cacheImage:!1,dirtyRegion:!1,stopOnAudioError:!0,pauseOnBlur:!0,preRender:!1,checkVersion:function(a,b){for(var b=b||me.version,c=a.split("."),d=b.split("."),e=Math.min(c.length,d.length),f=0,g=0;g<e&&!(f=+c[g]-+d[g]);g++);return f?f:c.length-d.length}};var d=!1,e=!1,f=!1,g=[];a.onReady=function(d){e||(e=!0,"complete"===c.readyState?
b():(c.addEventListener&&c.addEventListener("DOMContentLoaded",b,!1),a.addEventListener("load",b,!1)));f?d.call(a,[]):g.push(function(){return d.call(a,[])});return this};a.onReady(function(){d||(me.utils.setNocache(c.location.href.match(/\?nocache/)||!1),me.audio.detectCapabilities(),me.sys.touch="createTouch"in c||"ontouchstart"in a||navigator.isCocoonJS,me.timer.init(),me.mapReader=new me.TMXMapReader,me.loadingScreen=new me.DefaultLoadingScreen,me.state.init(),me.entityPool.init(),me.levelDirector.reset(),
d=!0)});var h=!1,i=/xyz/.test(function(){})?/\bparent\b/:/.*/;Object.extend=function(a){function b(){!h&&this.init&&this.init.apply(this,arguments)}var c=this.prototype;h=!0;var d=new this;h=!1;for(var e in a)d[e]="function"==typeof a[e]&&"function"==typeof c[e]&&i.test(a[e])?function(a,b){return function(){var d=this.parent;this.parent=c[a];var e=b.apply(this,arguments);this.parent=d;return e}}(e,a[e]):a[e];b.prototype=d;b.constructor=b;b.extend=Object.extend;return b};"function"!==typeof Object.create&&
(Object.create=function(a){function b(){}b.prototype=a;return new b});if(!Function.prototype.bind){var j=function(){};Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError("Function.prototype.bind called on incompatible "+b);var c=Array.prototype.slice.call(arguments,1),d=function(){if(this instanceof d){var e=b.apply(this,c.concat(Array.prototype.slice.call(arguments)));return Object(e)===e?e:this}return b.apply(a,c.concat(Array.prototype.slice.call(arguments)))};
b.prototype&&(j.prototype=b.prototype,d.prototype=new j,j.prototype=null);return d}}"undefined"===typeof Date.now&&(Date.now=function(){return(new Date).getTime()});"undefined"===typeof console&&(console={log:function(){},info:function(){},error:function(){alert(Array.prototype.slice.call(arguments).join(", "))}});Function.prototype.defer=function(){var a=this,b=Array.prototype.slice.call(arguments);return window.setTimeout(function(){return a.apply(a,b)},0.01)};Object.defineProperty||(Object.defineProperty=
function(a,b,c){if(a.__defineGetter__)c.get&&a.__defineGetter__(b,c.get),c.set&&a.__defineSetter__(b,c.set);else throw"melonJS: Object.defineProperty not supported";});String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});String.prototype.isNumeric=function(){return null!=this&&!isNaN(this)&&""!=this.trim()};String.prototype.isBoolean=function(){return null!=this&&("true"==this.trim()||"false"==this.trim())};String.prototype.contains=function(a){return-1<
this.indexOf(a)};String.prototype.toHex=function(){for(var a="",b=0;b<this.length;)a+=this.charCodeAt(b++).toString(16);return a};Number.prototype.clamp=function(a,b){return this<a?a:this>b?b:+this};Number.prototype.random=function(a,b){return~~(Math.random()*(b-a+1))+a};Number.prototype.round=function(){var a=2>arguments.length?this:arguments[0],b=Math.pow(10,arguments[1]||arguments[0]||0);return Math.round(a*b)/b};Number.prototype.toHex=function(){return"0123456789ABCDEF".charAt(this-this%16>>4)+
"0123456789ABCDEF".charAt(this%16)};Number.prototype.sign=function(){return 0>this?-1:0<this?1:0};Number.prototype.degToRad=function(a){return(a||this)/180*Math.PI};Number.prototype.radToDeg=function(a){return(a||this)*(180/Math.PI)};Array.prototype.remove=function(a){a=Array.prototype.indexOf.call(this,a);-1!==a&&Array.prototype.splice.call(this,a,1);return this};Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;d--;c++)a.call(b||this,this[c],c,this)});Object.defineProperty(me,
"initialized",{get:function(){return d}});var k={},n=[],s,l=[],q=0;k.isDirty=!1;k.reset=function(){n.length=0;l.length=0;s=me.game.viewport.getRect();k.makeAllDirty()};k.makeDirty=function(a,b,c){b&&(k.isDirty=!0,me.sys.dirtyRegion&&(c?n.push(c.union(a)):a.getRect&&n.push(a.getRect())));a.inViewport&&l.unshift(a)};k.makeAllDirty=function(){n.length=0;n.push(s);k.isDirty=!0};k.remove=function(a){var b=l.indexOf(a);-1!=b&&(l.splice(b,1),a.inViewport=!1,k.makeDirty(a,!0))};k.getDrawCount=function(){return q};
k.draw=function(a){var b=me.game.viewport.pos.x,c=me.game.viewport.pos.y;a.save();a.translate(-b,-c);for(var b=b-me.game.currentLevel.pos.x,c=c-me.game.currentLevel.pos.y,d=n.length,e;d--,e=n[d];){for(var f=l.length,g;f--,g=l[f];)if(!me.sys.dirtyRegion||!g.isSprite||g.overlaps(e))!0===g.floating&&(a.save(),a.translate(b,c)),g.draw(a,e),!0===g.floating&&a.restore(),q++;me.debug.renderDirty&&e.draw(a,"white")}a.restore()};k.flush=function(){me.sys.dirtyRegion&&(n.length=0);l.length=0;k.isDirty=!1;q=
0};var u=me,m={},w=null,t=[],C=!1,z=null,v=null,E=function(a,b){return b.z-a.z};m.viewport=null;m.HUD=null;m.collisionMap=null;m.currentLevel=null;m.renderer=null;m.NO_OBJECT=0;m.ENEMY_OBJECT=1;m.COLLECTABLE_OBJECT=2;m.ACTION_OBJECT=3;m.onLevelLoaded=null;m.init=function(a,b){C||(a=a||me.video.getWidth(),b=b||me.video.getHeight(),m.viewport=new me.Viewport(0,0,a,b),w=me.video.getSystemContext(),me.event.publish(me.event.GAME_INIT),C=!0)};m.reset=function(){C||m.init();m.removeAll();m.viewport&&m.viewport.reset();
k.reset();w.setTransform(1,0,0,1,0,0);m.currentLevel={pos:{x:0,y:0}}};m.loadTMXLevel=function(a){m.currentLevel=a;m.collisionMap=m.currentLevel.getLayerByName("collision");(!m.collisionMap||!m.collisionMap.isCollisionMap)&&console.error("WARNING : no collision map detected");for(var b=m.currentLevel.getLayers(),c=b.length;c--;)b[c].visible&&m.add(b[c]);m.viewport.setBounds(Math.max(m.currentLevel.realwidth,m.viewport.width),Math.max(m.currentLevel.realheight,m.viewport.height));b=m.currentLevel.getObjectGroups();
for(c=0;c<b.length;c++)if(b[c].visible)for(var d=0;d<b[c].objects.length;d++)m.addEntity(b[c].objects[d],b[c].z);m.currentLevel.pos.x!=m.currentLevel.pos.y&&w.translate(m.currentLevel.pos.x,m.currentLevel.pos.y);m.sort();m.onLevelLoaded&&m.onLevelLoaded.call(m.onLevelLoaded,a.name);me.event.publish(me.event.LEVEL_LOADED,[a.name])};m.add=function(a,b){a.z=b?b:a.z;t.push(a)};m.addEntity=function(a,b){var c=me.entityPool.newInstanceOf(a.name,a.x,a.y,a);c&&m.add(c,b)};m.getEntityByName=function(a){for(var b=
[],a=a.toLowerCase(),c=t.length,d;c--,d=t[c];)d.name&&d.name.toLowerCase()===a&&b.push(d);return b};m.getObjectCount=function(){return t.length};m.getDrawCount=function(){return k.getDrawCount()};m.getEntityByGUID=function(a){for(var b=t.length,c;b--,c=t[b];)if(c.isEntity&&c.GUID==a)return c;return null};m.addHUD=function(a,b,c,d,e){null==m.HUD&&(m.HUD=new me.HUD_Object(a,b,c,d,e),m.add(m.HUD))};m.disableHUD=function(){null!=m.HUD&&(m.remove(m.HUD),m.HUD=null)};m.update=function(){for(var a=null,
b=t.length,c;b--,c=t[b];){var a=me.sys.dirtyRegion&&c.isSprite?c.getRect():null,d=c.update();c.inViewport=c.visible?!c.isSprite||c.floating?!0:m.viewport.isVisible(c):!1;k.makeDirty(c,d,d?a:null)}m.viewport.update(k.isDirty)&&k.makeAllDirty()};m.remove=function(a,b){a.destroy&&a.destroy();k.remove(a);!0===b?(t.remove(a),me.entityPool.freeInstance(a)):(a.visible=!1,z=function(a){t.remove(a);me.entityPool.freeInstance(a);z=null}.defer(a))};m.removeAll=function(){z&&(clearTimeout(z),z=null);v&&(clearTimeout(v),
v=null);for(var a=t.length;a--;)t[a].isPersistent||m.remove(t[a],!0);k.flush()};m.sort=function(a){null===v&&("function"!==typeof a&&(a=E),v=function(a){t.sort(a);v=null;me.game.repaint()}.defer(a))};m.collide=function(a,b){var c,b=!0===b?!0:!1;if(!0===b)var d=[],e=0;for(var f=t.length,g;f--,g=t[f];)if(g.inViewport&&(g.visible&&g.collidable&&g!=a)&&(c=g.collisionBox.collideVsAABB.call(g.collisionBox,a.collisionBox),0!=c.x||0!=c.y)){g.onCollision.call(g,c,a);c.type=g.type;c.obj=g;if(!b)return c;d[e++]=
c}return b?d:null};m.collideType=function(a,b,c){var d,c=!0===c?!0:!1;if(!0===c)var e=[],f=0;for(var g=t.length,j;g--,j=t[g];)if(j.inViewport&&(j.visible&&j.collidable&&j.type===b&&j!=a)&&(d=j.collisionBox.collideVsAABB.call(j.collisionBox,a.collisionBox),0!=d.x||0!=d.y)){j.onCollision.call(j,d,a);d.type=j.type;d.obj=j;if(!c)return d;e[f++]=d}return c?e:null};m.repaint=function(){k.makeAllDirty()};m.draw=function(){k.isDirty&&(k.draw(w),m.viewport.draw(w));k.flush()};u.game=m;me.ScreenObject=Object.extend({inViewport:!1,
visible:!1,addAsObject:!1,isPersistent:!1,z:999,rect:null,init:function(a,b){this.isPersistent=(this.addAsObject=this.visible=!0===a||!1)&&!0===b||!1;this.rect=new me.Rect(new me.Vector2d(0,0),0,0)},reset:function(){me.game.reset();this.onResetEvent.apply(this,arguments);this.addAsObject&&(this.visible=!0,this.rect=me.game.viewport.getRect(),me.game.add(this,this.z));me.game.sort()},getRect:function(){return this.rect},destroy:function(){this.onDestroyEvent.apply(this,arguments)},update:function(){return!1},
onUpdateFrame:function(){me.timer.update();me.game.update();me.game.draw();me.video.blitSurface()},draw:function(){},onResetEvent:function(){},onDestroyEvent:function(){}});for(var u=me,O=function(){if(-1==F&&-1==D){me.timer.reset();if(me.sys.useNativeAnimFrame){D=window.requestAnimationFrame(N);if(-1!=D)return;me.sys.useNativeAnimFrame=!1}F=setInterval(J,~~(1E3/me.sys.fps))}},N=function(){J();-1!=D&&(D=window.requestAnimationFrame(N))},P=function(){-1!=F&&(clearInterval(F),F=-1);-1!=D&&(window.cancelAnimationFrame(D),
D=-1)},Q=function(a){P();A[B]&&(A[B].screen.visible&&me.game.remove.call(me.game,A[B].screen,!0),A[B].screen.destroy());A[a]&&(B=a,A[B].screen.reset.apply(A[B].screen,K),J=A[B].screen.onUpdateFrame.bind(A[B].screen),O(),L&&L(),me.game.repaint())},H=["ms","moz","webkit","o"],G=0;G<H.length&&!window.requestAnimationFrame;++G)window.requestAnimationFrame=window[H[G]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[H[G]+"CancelAnimationFrame"]||window[H[G]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||
(window.requestAnimationFrame=function(){return-1});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(){return-1});var r={},B=-1,F=-1,D=-1,A={},M="",I=0,L=null,K=null,J=null;r.LOADING=0;r.MENU=1;r.READY=2;r.PLAY=3;r.GAMEOVER=4;r.GAME_END=5;r.SCORE=6;r.CREDITS=7;r.SETTINGS=8;r.USER=100;r.onPause=null;r.onResume=null;r.init=function(){r.set(r.LOADING,me.loadingScreen);a.addEventListener("blur",function(){me.sys.pauseOnBlur&&B!=r.LOADING&&r.pause(!0);if(r.onPause)r.onPause();me.event.publish(me.event.STATE_PAUSE)},
!1);a.addEventListener("focus",function(){me.sys.pauseOnBlur&&B!=r.LOADING&&(r.resume(!0),me.game.repaint());if(r.onResume)r.onResume();me.event.publish(me.event.STATE_RESUME)},!1)};r.pause=function(a){P();a&&me.audio.pauseTrack()};r.resume=function(a){O();a&&me.audio.resumeTrack()};r.isRunning=function(){return-1!=F||-1!=D};r.set=function(a,b){A[a]={};A[a].screen=b;A[a].transition=!0};r.current=function(){return A[B].screen};r.transition=function(a,b,c){"fade"==a&&(M=b,I=c)};r.setTransition=function(a,
b){A[a].transition=b};r.change=function(a){K=null;1<arguments.length&&(K=Array.prototype.slice.call(arguments,1));I&&A[a].transition?(L=function(){me.game.viewport.fadeOut(M,I)},me.game.viewport.fadeIn(M,I,function(){Q.defer(a)})):Q.defer(a)};r.isCurrent=function(a){return B==a};u.state=r})(window);
(function(){me.DefaultLoadingScreen=me.ScreenObject.extend({init:function(){this.parent(!0);this.logo1=new me.Font("century gothic",32,"white","middle");this.logo2=new me.Font("century gothic",32,"#89b002","middle");this.logo2.bold();this.invalidate=!1;this.handle=null;this.loadPercent=0},onResetEvent:function(){this.handle=me.event.subscribe(me.event.LOADER_PROGRESS,this.onProgressUpdate.bind(this))},onDestroyEvent:function(){this.logo1=this.logo2=null;this.handle&&(me.event.unsubscribe(this.handle),
this.handle=null)},onProgressUpdate:function(a){this.loadPercent=a;this.invalidate=!0},update:function(){return!0===this.invalidate?(this.invalidate=!1,!0):!1},draw:function(a){var b=this.logo1.measureText(a,"melon").width,c=(me.video.getWidth()-b-this.logo2.measureText(a,"JS").width)/2,d=me.video.getHeight()/2;me.video.clearSurface(a,"black");this.logo1.draw(a,"melon",c,d);this.logo2.draw(a,"JS",c+b,d);d+=this.logo1.measureText(a,"melon").height/2;b=Math.floor(this.loadPercent*me.video.getWidth());
a.strokeStyle="silver";a.strokeRect(0,d,me.video.getWidth(),6);a.fillStyle="#89b002";a.fillRect(2,d+2,b-4,2)}});var a=me,b=function(){h==g?c.onload?(clearTimeout(i),setTimeout(function(){c.onload();me.event.publish(me.event.LOADER_COMPLETE)},300)):console.error("no load callback defined"):i=setTimeout(b,100)},c={},d={},e={},f={},g=0,h=0,i=0;c.onload=void 0;c.onProgress=void 0;c.onResourceLoaded=function(){h++;var a=c.getLoadProgress();if(c.onProgress)c.onProgress(a);me.event.publish(me.event.LOADER_PROGRESS,
[a])};c.onLoadingError=function(a){throw"melonJS: Failed loading resource "+a.src;};c.preload=function(a){for(var d=0;d<a.length;d++)g+=c.load(a[d],c.onResourceLoaded.bind(c),c.onLoadingError.bind(c,a[d]));b()};c.load=function(a,b,c){a.name=a.name.toLowerCase();switch(a.type){case "binary":var g=new XMLHttpRequest;g.open("GET",a.src+me.nocache,!1);g.responseType="arraybuffer";g.onerror=c;g.onload=function(){var c=g.response;if(c){var c=new Uint8Array(c),d=[];f[a.name]=new dataType;for(var e=0;e<c.byteLength;e++)d[e]=
String.fromCharCode(c[e]);f[a.name].data=d.join("");b()}};g.send();return 1;case "image":return d[a.name]=new Image,d[a.name].onload=b,d[a.name].onerror=c,d[a.name].src=a.src+me.nocache,1;case "tmx":case "tsx":var h=new XMLHttpRequest,i=me.utils.getFileExtension(a.src).toLowerCase();h.overrideMimeType&&("json"===i?h.overrideMimeType("application/json"):h.overrideMimeType("text/xml"));h.open("GET",a.src+me.nocache,!0);h.ontimeout=c;h.onreadystatechange=function(){if(4==h.readyState)if(200==h.status||
0==h.status&&h.responseText){var d=null;switch(i){case "xml":case "tmx":d=me.sys.ua.contains("msie")||!h.responseXML?(new DOMParser).parseFromString(h.responseText,"text/xml"):h.responseXML;i="xml";break;case "json":d=JSON.parse(h.responseText);break;default:throw"melonJS: TMX file format "+i+"not supported !";}e[a.name]={data:d,isTMX:"tmx"===a.type,format:i};"tmx"===a.type&&me.levelDirector.addTMXLevel(a.name);b()}else c()};h.send(null);return 1;case "audio":if(me.audio.isAudioEnable())return me.audio.load(a,
b,c),1;break;default:throw"melonJS: me.loader.load : unknown or invalid resource type : "+a.type;}return 0};c.unload=function(a){a.name=a.name.toLowerCase();switch(a.type){case "binary":if(!(a.name in f))return!1;delete f[a.name];return!0;case "image":if(!(a.name in d))return!1;delete d[a.name];return!0;case "tmx":case "tsx":if(!(a.name in e))return!1;delete e[a.name];return!0;case "audio":return me.audio.unload(a.name);default:throw"melonJS: me.loader.unload : unknown or invalid resource type : "+
a.type;}};c.unloadAll=function(){for(var a in f)c.unload(a);for(a in d)c.unload(a);for(a in e)c.unload(a);me.audio.unloadAll()};c.getTMXFormat=function(a){a=a.toLowerCase();return a in e?e[a].format:null};c.getTMX=function(a){a=a.toLowerCase();return a in e?e[a].data:null};c.getBinary=function(a){a=a.toLowerCase();return a in f?f[a]:null};c.getImage=function(a){a=a.toLowerCase();if(a in d){if(!0===me.sys.cacheImage){var b=me.video.createCanvasSurface(d[a].width,d[a].height);b.drawImage(d[a],0,0);
return b.canvas}return d[a]}return null};c.getLoadProgress=function(){return h/g};a.loader=c})(window);
(function(){me.Vector2d=Object.extend({x:0,y:0,init:function(a,b){this.x=a||0;this.y=b||0},set:function(a,b){this.x=a;this.y=b},setZero:function(){this.set(0,0)},setV:function(a){this.x=a.x;this.y=a.y},add:function(a){this.x+=a.x;this.y+=a.y},sub:function(a){this.x-=a.x;this.y-=a.y},scale:function(a){this.x*=a.x;this.y*=a.y},div:function(a){this.x/=a;this.y/=a},abs:function(){0>this.x&&(this.x=-this.x);0>this.y&&(this.y=-this.y)},clamp:function(a,b){return new me.Vector2d(this.x.clamp(a,b),this.y.clamp(a,
b))},clampSelf:function(a,b){this.x=this.x.clamp(a,b);this.y=this.y.clamp(a,b);return this},minV:function(a){this.x=this.x<a.x?this.x:a.x;this.y=this.y<a.y?this.y:a.y},maxV:function(a){this.x=this.x>a.x?this.x:a.x;this.y=this.y>a.y?this.y:a.y},floor:function(){return new me.Vector2d(~~this.x,~~this.y)},floorSelf:function(){this.x=~~this.x;this.y=~~this.y;return this},ceil:function(){return new me.Vector2d(Math.ceil(this.x),Math.ceil(this.y))},ceilSelf:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);
return this},negate:function(){return new me.Vector2d(-this.x,-this.y)},negateSelf:function(){this.x=-this.x;this.y=-this.y;return this},copy:function(a){this.x=a.x;this.y=a.y},equals:function(a){return this.x===a.x&&this.y===a.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){var a=this.length();if(a<Number.MIN_VALUE)return 0;var b=1/a;this.x*=b;this.y*=b;return a},dotProduct:function(a){return this.x*a.x+this.y*a.y},distance:function(a){return Math.sqrt((this.x-
a.x)*(this.x-a.x)+(this.y-a.y)*(this.y-a.y))},angle:function(a){return Math.atan2(a.y-this.y,a.x-this.x)},clone:function(){return new me.Vector2d(this.x,this.y)},toString:function(){return"x:"+this.x+"y:"+this.y}});me.Rect=Object.extend({pos:null,colPos:null,width:0,height:0,hWidth:0,hHeight:0,init:function(a,b,c){this.pos=a;this.colPos=new me.Vector2d;this.width=b;this.height=c;this.hWidth=~~(b/2);this.hHeight=~~(c/2);Object.defineProperty(this,"left",{get:function(){return this.pos.x},configurable:!0});
Object.defineProperty(this,"right",{get:function(){return this.pos.x+this.width},configurable:!0});Object.defineProperty(this,"top",{get:function(){return this.pos.y},configurable:!0});Object.defineProperty(this,"bottom",{get:function(){return this.pos.y+this.height},configurable:!0})},set:function(a,b,c){this.pos=a;this.width=b;this.height=c;this.hWidth=~~(b/2);this.hHeight=~~(c/2)},getRect:function(){return new me.Rect(this.pos.clone(),this.width,this.height)},translate:function(a,b){this.pos.x+=
a;this.pos.y+=b;return this},translateV:function(a){this.pos.add(a);return this},union:function(a){var b=Math.min(this.pos.x,a.pos.x),c=Math.min(this.pos.y,a.pos.y);this.width=Math.ceil(Math.max(this.pos.x+this.width,a.pos.x+a.width)-b);this.height=Math.ceil(Math.max(this.pos.y+this.height,a.pos.y+a.height)-c);this.pos.x=~~b;this.pos.y=~~c;return this},adjustSize:function(a,b,c,d){-1!=a&&(this.colPos.x=a,this.width=b,this.hWidth=~~(this.width/2),this.left!==this.pos.x+this.colPos.x&&Object.defineProperty(this,
"left",{get:function(){return this.pos.x+this.colPos.x},configurable:!0}),this.right!==this.pos.x+this.colPos.x+this.width&&Object.defineProperty(this,"right",{get:function(){return this.pos.x+this.colPos.x+this.width},configurable:!0}));-1!=c&&(this.colPos.y=c,this.height=d,this.hHeight=~~(this.height/2),this.top!==this.pos.y+this.colPos.y&&Object.defineProperty(this,"top",{get:function(){return this.pos.y+this.colPos.y},configurable:!0}),this.bottom!==this.pos.y+this.colPos.y+this.height&&Object.defineProperty(this,
"bottom",{get:function(){return this.pos.y+this.colPos.y+this.height},configurable:!0}))},flipX:function(a){this.colPos.x=a-this.width-this.colPos.x;this.hWidth=~~(this.width/2)},flipY:function(a){this.colPos.y=a-this.height-this.colPos.y;this.hHeight=~~(this.height/2)},equals:function(a){return this.left===a.left&&this.right===a.right&&this.top===a.top&&this.bottom===a.bottom},overlaps:function(a){return this.left<a.right&&a.left<this.right&&this.top<a.bottom&&a.top<this.bottom},within:function(a){return a.left<=
this.left&&a.right>=this.right&&a.top<=this.top&&a.bottom>=this.bottom},contains:function(a){return a.left>=this.left&&a.right<=this.right&&a.top>=this.top&&a.bottom<=this.bottom},containsPoint:function(a){return a.x>=this.left&&a.x<=this.right&&a.y>=this.top&&a.y<=this.bottom},collideVsAABB:function(a){var b=new me.Vector2d(0,0);if(this.overlaps(a)){var c=this.left+this.hWidth-a.left-a.hWidth,d=this.top+this.hHeight-a.top-a.hHeight;b.x=a.hWidth+this.hWidth-(0>c?-c:c);b.y=a.hHeight+this.hHeight-(0>
d?-d:d);b.x<b.y?(b.y=0,b.x=0>c?-b.x:b.x):(b.x=0,b.y=0>d?-b.y:b.y)}return b},draw:function(a,b){a.strokeStyle=b||"red";a.strokeRect(this.left,this.top,this.width,this.height)}})})(window);(function(){me.debug={displayFPS:!1,renderHitBox:!1,renderCollisionMap:!1,renderDirty:!1,renderVelocity:!1}})(window);
(function(){var a=Math.min,b=Math.max;me.Viewport=me.Rect.extend({AXIS:{NONE:0,HORIZONTAL:1,VERTICAL:2,BOTH:3},limits:null,target:null,follow_axis:0,_shake:null,_fadeIn:null,_fadeOut:null,_deadwidth:0,_deadheight:0,_limitwidth:0,_limitheight:0,init:function(a,b,e,f,g,h){this.parent(new me.Vector2d(a,b),e-a,f-b);this.limits=new me.Vector2d(g||this.width,h||this.height);this.target=null;this.follow_axis=this.AXIS.NONE;this._shake={intensity:0,duration:0,axis:this.AXIS.BOTH,onComplete:null};this._fadeOut=
{color:0,alpha:0,duration:0,tween:null};this._fadeIn={color:0,alpha:1,duration:0,tween:null};this.setDeadzone(this.width/6,this.height/6)},_followH:function(c){return c.x-this.pos.x>this._deadwidth?(this.pos.x=~~a(c.x-this._deadwidth,this._limitwidth),!0):c.x-this.pos.x<this.deadzone.x?(this.pos.x=~~b(c.x-this.deadzone.x,0),!0):!1},_followV:function(c){return c.y-this.pos.y>this._deadheight?(this.pos.y=~~a(c.y-this._deadheight,this._limitheight),!0):c.y-this.pos.y<this.deadzone.y?(this.pos.y=~~b(c.y-
this.deadzone.y,0),!0):!1},reset:function(a,b){this.pos.x=a||0;this.pos.y=b||0;this.follow_axis=this.target=null},setDeadzone:function(a,b){this.deadzone=new me.Vector2d(~~((this.width-a)/2),~~((this.height-b)/2-0.25*b));this._deadwidth=this.width-this.deadzone.x;this._deadheight=this.height-this.deadzone.y;this.update(!0)},setBounds:function(a,b){this.limits.set(a,b);this._limitwidth=this.limits.x-this.width;this._limitheight=this.limits.y-this.height},follow:function(a,b){if(a instanceof me.ObjectEntity)this.target=
a.pos;else if(a instanceof me.Vector2d)this.target=a;else throw"melonJS: invalid target for viewport.follow";this.follow_axis=b||this.AXIS.BOTH;this.update(!0)},move:function(a,b){var e=~~(this.pos.y+b);this.pos.x=(~~(this.pos.x+a)).clamp(0,this._limitwidth);this.pos.y=e.clamp(0,this._limitheight)},update:function(a){if(this.target&&a)switch(this.follow_axis){case this.AXIS.HORIZONTAL:a=this._followH(this.target);break;case this.AXIS.VERTICAL:a=this._followV(this.target);break;case this.AXIS.BOTH:a=
this._followH(this.target),a=this._followV(this.target)||a}if(0<this._shake.duration)if(this._shake.duration-=me.timer.tick,0>this._shake.duration){if(this._shake.onComplete)this._shake.onComplete()}else{if(this._shake.axis==this.AXIS.BOTH||this._shake.axis==this.AXIS.HORIZONTAL)a=Math.random()*this._shake.intensity,this.pos.x=this.pos.x+this.width+a<this.limits.x?this.pos.x+~~a:this.pos.x-~~a;if(this._shake.axis==this.AXIS.BOTH||this._shake.axis==this.AXIS.VERTICAL)a=Math.random()*this._shake.intensity,
this.pos.y=this.pos.y+this.height+a<this.limits.y?this.pos.y+~~a:this.pos.y-~~a;a=!0}if(null!=this._fadeIn.tween||null!=this._fadeOut.tween)a=!0;return a},shake:function(a,b,e,f){e=e||this.AXIS.BOTH;e==this.AXIS.BOTH&&(this.width==this.limits.x?e=this.AXIS.VERTICAL:this.height==this.limits.y&&(e=this.AXIS.HORIZONTAL));!(e==this.AXIS.HORIZONTAL&&this.width==this.limits.x)&&!(e==this.AXIS.VERTICAL&&this.height==this.limits.y)&&(this._shake.intensity=a,this._shake.duration=b,this._shake.axis=e,this._shake.onComplete=
f||null)},fadeOut:function(a,b,e){this._fadeOut.color=a;this._fadeOut.duration=b||1E3;this._fadeOut.alpha=1;this._fadeOut.tween=(new me.Tween(this._fadeOut)).to({alpha:0},this._fadeOut.duration).onComplete(e||null);this._fadeOut.tween.start()},fadeIn:function(a,b,e){this._fadeIn.color=a;this._fadeIn.duration=b||1E3;this._fadeIn.alpha=0;this._fadeIn.tween=(new me.Tween(this._fadeIn)).to({alpha:1},this._fadeIn.duration).onComplete(e||null);this._fadeIn.tween.start()},getWidth:function(){return this.width},
getHeight:function(){return this.height},focusOn:function(a){this.pos.x=a.x-0.5*this.width;this.pos.y=a.y-0.5*this.height},isVisible:function(a){return a.overlaps(this)},draw:function(a){this._fadeIn.tween&&(a.globalAlpha=this._fadeIn.alpha,me.video.clearSurface(a,me.utils.HexToRGB(this._fadeIn.color)),a.globalAlpha=1,1==this._fadeIn.alpha&&(this._fadeIn.tween=null));this._fadeOut.tween&&(a.globalAlpha=this._fadeOut.alpha,me.video.clearSurface(a,me.utils.HexToRGB(this._fadeOut.color)),a.globalAlpha=
1,0==this._fadeOut.alpha&&(this._fadeOut.tween=null))}})})(window);
(function(){me.Renderable=me.Rect.extend({isRenderable:!0,floating:!1,init:function(a,b,c){this.parent(a,b,c)},update:function(){return!1},draw:function(a,b){this.parent(a,b)}});me.SpriteObject=me.Renderable.extend({scale:null,scaleFlag:!1,lastflipX:!1,lastflipY:!1,z:0,offset:null,visible:!0,inViewport:!1,angle:0,anchorPoint:null,alpha:1,image:null,flickering:!1,flickerTimer:-1,flickercb:null,flickerState:!1,init:function(a,b,c,d,e){this.isSprite=!0;this.parent(new me.Vector2d(a,b),d||c.width,e||
c.height);this.image=c;this.scale=new me.Vector2d(1,1);this.scaleFlag=this.lastflipX=this.lastflipY=!1;this.offset=new me.Vector2d(0,0);this.anchorPoint=new me.Vector2d(0.5,0.5);this.alpha=1;this.visible=!0;this.flickering=!1},setTransparency:function(a){a="#"==a.charAt(0)?a.substring(1,7):a;this.image=me.video.applyRGBFilter(this.image,"transparent",a.toUpperCase()).canvas},isFlickering:function(){return this.flickering},flicker:function(a,b){this.flickerTimer=a;0>this.flickerTimer?(this.flickering=
!1,this.flickercb=null):this.flickering||(this.flickercb=b,this.flickering=!0)},flipX:function(a){a!=this.lastflipX&&(this.lastflipX=a,this.scale.x=-this.scale.x,this.scaleFlag=1!=this.scale.x||1!=this.scale.y)},flipY:function(a){a!=this.lastflipY&&(this.lastflipY=a,this.scale.y=-this.scale.y,this.scaleFlag=1!=this.scale.x||1!=this.scale.y)},resize:function(a){0<a&&(this.scale.x=0>this.scale.x?-a:a,this.scale.y=0>this.scale.y?-a:a,this.scaleFlag=1!=this.scale.x||1!=this.scale.y)},getOpacity:function(){return this.alpha},
setOpacity:function(a){a&&(this.alpha=a.clamp(0,1))},update:function(){return this.flickering?(this.flickerTimer-=me.timer.tick,0>this.flickerTimer&&(this.flickercb&&this.flickercb(),this.flicker(-1)),!0):!1},draw:function(a){if(this.flickering&&(this.flickerState=!this.flickerState,!this.flickerState))return;a.save();a.globalAlpha=this.alpha;var b=~~this.pos.x,c=~~this.pos.y;if(this.scaleFlag||0!==this.angle){var d=this.width*this.anchorPoint.x,e=this.height*this.anchorPoint.y;a.translate(b+d,c+
e);this.scaleFlag&&a.scale(this.scale.x,this.scale.y);0!==this.angle&&a.rotate(this.angle);b=-d;c=-e}a.drawImage(this.image,this.offset.x,this.offset.y,this.width,this.height,b,c,this.width,this.height);a.restore();me.debug.renderHitBox&&this.parent(a)},destroy:function(){this.onDestroyEvent.apply(this,arguments)},onDestroyEvent:function(){}});me.AnimationSheet=me.SpriteObject.extend({fpscount:0,spacing:0,margin:0,animationpause:!1,animationspeed:0,init:function(a,b,c,d,e,f,g){this.anim=[];this.current=
this.resetAnim=null;this.spacing=f||0;this.margin=g||0;this.parent(a,b,c,d,e,f,g);this.spritecount=new me.Vector2d(~~((this.image.width-this.margin)/(this.width+this.spacing)),~~((this.image.height-this.margin)/(this.height+this.spacing)));1==this.spritecount.x*this.spritecount.y&&(this.setAnimationFrame=function(){});this.animationspeed=me.sys.fps/10;this.addAnimation("default",null);this.setCurrentAnimation("default")},addAnimation:function(a,b,c){this.anim[a]={name:a,frame:[],idx:0,length:0,animationspeed:c||
this.animationspeed};if(null==b)for(var b=[],c=0,d=this.spritecount.x*this.spritecount.y;c<d;c++)b[c]=c;c=0;for(d=b.length;c<d;c++)this.anim[a].frame[c]=new me.Vector2d(this.margin+(this.spacing+this.width)*(b[c]%this.spritecount.x),this.margin+(this.spacing+this.height)*~~(b[c]/this.spritecount.x));this.anim[a].length=this.anim[a].frame.length},setCurrentAnimation:function(a,b){if(this.anim[a])this.current=this.anim[a],this.resetAnim=b||null,this.setAnimationFrame(this.current.idx);else throw"melonJS: animation id '"+
a+"' not defined";},isCurrentAnimation:function(a){return this.current.name==a},setAnimationFrame:function(a){this.current.idx=(a||0)%this.current.length;this.offset=this.current.frame[this.current.idx]},getCurrentAnimationFrame:function(){return this.current.idx},update:function(){return this.visible&&!this.animationpause&&this.fpscount++>this.current.animationspeed?(this.setAnimationFrame(++this.current.idx),this.fpscount=0,0==this.current.idx&&this.resetAnim&&("string"==typeof this.resetAnim?this.setCurrentAnimation(this.resetAnim):
"function"==typeof this.resetAnim&&this.resetAnim()),this.parent()||!0):this.parent()}})})(window);
(function(){me.ObjectSettings={name:null,image:null,transparent_color:null,spritewidth:null,spriteheight:null,type:0,collidable:!1};var a=me,b={},c={};b.init=function(){b.add("me.ObjectEntity",me.ObjectEntity);b.add("me.CollectableEntity",me.CollectableEntity);b.add("me.LevelEntity",me.LevelEntity)};b.add=function(a,b,f){f?c[a.toLowerCase()]={"class":b,pool:[],active:[]}:c[a.toLowerCase()]=b};b.newInstanceOf=function(a){var b="string"===typeof a?a.toLowerCase():void 0;if(b&&c[b]){if(!c[b].pool){var f=
c[b];arguments[0]=f;return new (f.bind.apply(f,arguments))}var g=c[b],f=g["class"];0<g.pool.length?(f=g.pool.pop(),f.init.apply(f,Array.prototype.slice.call(arguments,1))):(arguments[0]=f,f=new (f.bind.apply(f,arguments)),f.className=b);g.active.push(f);return f}if((g=arguments[3])&&g.image)return new me.SpriteObject(g.x,g.y,g.image);b&&console.error("Cannot instantiate entity of type '"+b+"': Class not found!");return null};b.purge=function(){for(className in c)c[className].pool=[]};b.freeInstance=
function(a){var b=a.className;if(b&&c[b]){for(var f=!0,g=0,h=c[b].active.length;g<h;g++)if(c[b].active[g]===a){f=!1;c[b].active.splice(g,1);break}f||c[b].pool.push(a)}};a.entityPool=b;me.ObjectEntity=me.Rect.extend({GUID:null,type:0,collidable:!1,collisionBox:null,renderable:null,z:0,visible:!0,inViewport:!1,floating:!1,init:function(a,b,c){this.parent(new me.Vector2d(a,b),~~c.spritewidth||~~c.width,~~c.spriteheight||~~c.height);c.image&&(a="string"==typeof c.image?me.loader.getImage(c.image):c.image,
this.renderable=new me.AnimationSheet(0,0,a,~~c.spritewidth,~~c.spriteheight,~~c.spacing,~~c.margin),c.transparent_color&&this.renderable.setTransparency(c.transparent_color));this.GUID=me.utils.createGUID();this.name=c.name?c.name.toLowerCase():"";this.vel=new me.Vector2d;this.accel=new me.Vector2d;this.friction=new me.Vector2d;this.maxVel=new me.Vector2d(1E3,1E3);this.gravity=void 0!=me.sys.gravity?me.sys.gravity:0.98;this.alive=this.isEntity=!0;this.falling=!1;this.jumping=!0;this.slopeY=0;this.onladder=
this.onslope=!1;this.collidable=c.collidable||!1;this.type=c.type||0;this.collisionMap=me.game.collisionMap;this.collisionBox=new me.Rect(this.pos,this.width,this.height);this.canBreakTile=!1;this.onTileBreak=null},updateColRect:function(a,b,c,g){this.collisionBox.adjustSize(a,b,c,g)},onCollision:function(){this.collidable&&this.type==me.game.COLLECTABLE_OBJECT&&me.game.remove(this)},setVelocity:function(a,b){this.accel.x=0!=a?a:this.accel.x;this.accel.y=0!=b?b:this.accel.y;this.setMaxVelocity(a,
b)},setMaxVelocity:function(a,b){this.maxVel.x=a;this.maxVel.y=b},setFriction:function(a,b){this.friction.x=a||0;this.friction.y=b||0},flipX:function(a){a!=this.lastflipX&&(this.renderable&&this.renderable.flipX(a),this.collisionBox.flipX(this.width))},flipY:function(a){a!=this.lastflipY&&(this.renderable&&this.renderable.flipY(a),this.collisionBox.flipY(this.height))},doWalk:function(a){this.flipX(a);this.vel.x+=a?-this.accel.x*me.timer.tick:this.accel.x*me.timer.tick},doClimb:function(a){return this.onladder?
(this.vel.y=a?-this.accel.x*me.timer.tick:this.accel.x*me.timer.tick,!0):!1},doJump:function(){return!this.jumping&&!this.falling?(this.vel.y=-this.maxVel.y*me.timer.tick,this.jumping=!0):!1},forceJump:function(){this.jumping=this.falling=!1;this.doJump()},distanceTo:function(a){var b=this.pos.x+this.hWidth-(a.pos.x+a.hWidth),a=this.pos.y+this.hHeight-(a.pos.y+a.hHeight);return Math.sqrt(b*b+a*a)},distanceToPoint:function(a){var b=this.pos.x+this.hWidth-a.x,a=this.pos.y+this.hHeight-a.y;return Math.sqrt(b*
b+a*a)},angleTo:function(a){return Math.atan2(a.pos.y+a.hHeight-(this.pos.y+this.hHeight),a.pos.x+a.hWidth-(this.pos.x+this.hWidth))},angleToPoint:function(a){return Math.atan2(a.y-(this.pos.y+this.hHeight),a.x-(this.pos.x+this.hWidth))},checkSlope:function(a,b){this.pos.y=a.pos.y-this.height;this.slopeY=b?a.height-(this.collisionBox.right+this.vel.x-a.pos.x):this.collisionBox.left+this.vel.x-a.pos.x;this.vel.y=0;this.pos.y+=this.slopeY.clamp(0,a.height)},computeVelocity:function(a){this.gravity&&
(a.y+=!this.onladder?this.gravity*me.timer.tick:0,this.jumping=(this.falling=0<a.y)?!1:this.jumping);this.friction.x&&(a.x=me.utils.applyFriction(a.x,this.friction.x));this.friction.y&&(a.y=me.utils.applyFriction(a.y,this.friction.y));0!=a.y&&(a.y=a.y.clamp(-this.maxVel.y,this.maxVel.y));0!=a.x&&(a.x=a.x.clamp(-this.maxVel.x,this.maxVel.x))},updateMovement:function(){this.computeVelocity(this.vel);var a=this.collisionMap.checkCollision(this.collisionBox,this.vel);this.onslope=a.yprop.isSlope||a.xprop.isSlope;
this.onladder=!1;if(a.y)if(this.onladder=a.yprop.isLadder,0<a.y)if(a.yprop.isSolid||a.yprop.isPlatform&&this.collisionBox.bottom-1<=a.ytile.pos.y)this.pos.y=~~this.pos.y,this.vel.y=this.falling?a.ytile.pos.y-this.collisionBox.bottom:0,this.falling=!1;else if(a.yprop.isSlope&&!this.jumping)this.checkSlope(a.ytile,a.yprop.isLeftSlope),this.falling=!1;else{if(a.yprop.isBreakable)if(this.canBreakTile){if(me.game.currentLevel.clearTile(a.ytile.col,a.ytile.row),this.onTileBreak)this.onTileBreak()}else this.pos.y=
~~this.pos.y,this.vel.y=this.falling?a.ytile.pos.y-this.collisionBox.bottom:0,this.falling=!1}else 0>a.y&&(!a.yprop.isPlatform&&!a.yprop.isLadder)&&(this.falling=!0,this.vel.y=0);if(a.x)if(this.onladder=a.xprop.isLadder,a.xprop.isSlope&&!this.jumping)this.checkSlope(a.xtile,a.xprop.isLeftSlope),this.falling=!1;else if(!a.xprop.isPlatform&&!a.xprop.isLadder)if(a.xprop.isBreakable&&this.canBreakTile){if(me.game.currentLevel.clearTile(a.xtile.col,a.xtile.row),this.onTileBreak)this.onTileBreak()}else this.vel.x=
0;this.pos.add(this.vel);return a},collide:function(a){return me.game.collide(this,a||!1)},collideType:function(a,b){return me.game.collideType(this,a,b||!1)},update:function(){return this.renderable?this.renderable.update():!1},getRect:function(){return this.renderable?this.renderable.getRect().translateV(this.pos):null},draw:function(a){this.renderable&&(a.translate(this.pos.x,this.pos.y),this.renderable.draw(a),a.translate(-this.pos.x,-this.pos.y));if(me.debug.renderHitBox){this.collisionBox.draw(a,
"red");var b=~~(this.pos.x+this.hWidth),c=~~(this.pos.y+this.hHeight);a.lineWidth=1;a.beginPath();a.moveTo(b,c);a.lineTo(b+~~(this.vel.x*this.hWidth),c+~~(this.vel.y*this.hHeight));a.stroke()}},destroy:function(){this.renderable&&(this.renderable.destroy.apply(this.renderable,arguments),this.renderable=null);this.onDestroyEvent.apply(this,arguments);this.collisionBox=this.pos=null},onDestroyEvent:function(){}});me.CollectableEntity=me.ObjectEntity.extend({init:function(a,b,c){this.parent(a,b,c);this.collidable=
!0;this.type=me.game.COLLECTABLE_OBJECT}});me.LevelEntity=me.ObjectEntity.extend({init:function(a,b,c){this.parent(a,b,c);this.nextlevel=c.to;this.fade=c.fade;this.duration=c.duration;this.fading=!1;this.collidable=!0;this.gotolevel=c.to},onFadeComplete:function(){me.levelDirector.loadLevel(this.gotolevel);me.game.viewport.fadeOut(this.fade,this.duration)},goTo:function(a){this.gotolevel=a||this.nextlevel;this.fade&&this.duration?this.fading||(this.fading=!0,me.game.viewport.fadeIn(this.fade,this.duration,
this.onFadeComplete.bind(this))):me.levelDirector.loadLevel(this.gotolevel)},onCollision:function(){this.goTo()}})})(window);
(function(){me.Font=Object.extend({ALIGN:{LEFT:"left",CENTER:"center",RIGHT:"right"},font:null,height:null,color:null,textAlign:null,init:function(a,b,c,d){this.set(a,b,c,d)},bold:function(){this.font="bold "+this.font},italic:function(){this.font="italic "+this.font},set:function(a,b,c,d){for(var a=a.split(","),e=0;e<a.length;e++)a[e]="'"+a[e]+"'";this.height=parseInt(b);"number"===typeof b&&(b=""+b+"px");this.font=b+" "+a.join(",");this.color=c;this.textAlign=d||"left"},getRect:function(){return new me.Rect(new Vector2d(0,
0),0,0)},measureText:function(a,b){a.font=this.font;a.fillStyle=this.color;a.textAlign=this.textAlign;var c=a.measureText(b);c.height=this.height;return c},draw:function(a,b,c,d){a.font=this.font;a.fillStyle=this.color;a.textAlign=this.textAlign;a.fillText(b,~~c,~~d)}});me.BitmapFont=me.Font.extend({size:null,sSize:null,firstChar:32,charCount:0,init:function(a,b,c,d){this.parent(a,null,null);this.size=new me.Vector2d;this.sSize=new me.Vector2d;this.firstChar=d||32;this.loadFontMetrics(a,b);this.textAlign=
this.ALIGN.LEFT;c&&this.resize(c)},loadFontMetrics:function(a,b){this.font=me.loader.getImage(a);this.size.x=b.x||b;this.size.y=b.y||this.font.height;this.sSize.copy(this.size);this.charCount=~~(this.font.width/this.size.x)},set:function(a,b){this.textAlign=a;b&&this.resize(b)},resize:function(a){this.sSize.copy(this.size);this.sSize.x*=a;this.sSize.y*=a},measureText:function(a){return{width:a.length*this.sSize.x,height:this.sSize.y}},draw:function(a,b,c,d){b=new String(b);switch(this.textAlign){case this.ALIGN.RIGHT:c-=
this.measureText(b).width;break;case this.ALIGN.CENTER:c-=0.5*this.measureText(b).width}for(var e=0,f=b.length;e<f;e++){var g=b.charCodeAt(e)-this.firstChar;a.drawImage(this.font,this.size.x*(g%this.charCount),this.size.y*~~(g/this.charCount),this.size.x,this.size.y,~~c,~~d,this.sSize.x,this.sSize.y);c+=this.sSize.x}}})})(window);
(function(){me.GUI_Object=me.SpriteObject.extend({isClickable:!0,updated:!1,init:function(a,b,c){this.parent(a,b,"string"==typeof c.image?me.loader.getImage(c.image):c.image,c.spritewidth,c.spriteheight);this.floating=!0;me.input.registerMouseEvent("mousedown",this,this.clicked.bind(this))},update:function(){return this.updated?(this.updated=!1,!0):!1},clicked:function(){if(this.isClickable)return this.updated=!0,this.onClick()},onClick:function(){return!0},onDestroyEvent:function(){me.input.releaseMouseEvent("mousedown",
this)}})})(window);
(function(){me.HUD_Item=Object.extend({init:function(a,b,c){this.pos=new me.Vector2d(a||0,b||0);this.visible=!0;this.defaultvalue=c||0;this.value=c||0;this.updated=!0},reset:function(){this.set(this.defaultvalue)},set:function(a){this.value=a;return this.updated=!0},update:function(a){return this.set(this.value+a)},draw:function(){}});me.HUD_Object=me.Rect.extend({init:function(a,b,c,d,e){this.parent(new me.Vector2d(a||0,b||0),c||me.video.getWidth(),d||me.video.getHeight());this.bgcolor=e;this.HUDItems=
{};this.HUDobj=[];this.objCount=0;this.HUD_invalidated=this.floating=this.visible=!0;this.HUDCanvas=me.video.createCanvas(this.width,this.height);this.HUDCanvasSurface=this.HUDCanvas.getContext("2d");this.z=999;this.isPersistent=!0},addItem:function(a,b){this.HUDItems[a]=b;this.HUDobj.push(this.HUDItems[a]);this.objCount++;this.HUD_invalidated=!0},removeItem:function(a){this.HUDItems[a]&&(this.HUDobj.splice(this.HUDobj.indexOf(this.HUDItems[a]),1),this.HUDItems[a]=null,this.objCount--,this.HUD_invalidated=
!0)},setItemValue:function(a,b){this.HUDItems[a]&&!0==this.HUDItems[a].set(b)&&(this.HUD_invalidated=!0)},updateItemValue:function(a,b){this.HUDItems[a]&&!0==this.HUDItems[a].update(b)&&(this.HUD_invalidated=!0)},getItemValue:function(a){return this.HUDItems[a]?this.HUDItems[a].value:0},update:function(){return this.HUD_invalidated},reset:function(a){void 0!=a?(this.HUDItems[a]&&this.HUDItems[a].reset(),this.HUD_invalidated=!0):this.resetAll()},resetAll:function(){for(var a=this.objCount,b;a--,b=
this.HUDobj[a];)b.reset();this.HUD_invalidated=!0},getRect:function(){p=this.pos.clone();p.add(me.game.viewport.pos);return new me.Rect(p,this.width,this.height)},draw:function(a){if(this.HUD_invalidated){if(this.bgcolor)me.video.clearSurface(this.HUDCanvasSurface,this.bgcolor);else{var b=this.HUDCanvas.width;this.HUDCanvas.width=0;this.HUDCanvas.width=b}for(var b=this.objCount,c;b--,c=this.HUDobj[b];)c.visible&&(c.draw(this.HUDCanvasSurface,0,0),c.updated&&(c.updated=!1))}a.drawImage(this.HUDCanvas,
this.pos.x,this.pos.y);this.HUD_invalidated=!1}})})(window);
(function(){var a=me,b=function(a,b){if(3<s++){var c="melonJS: failed loading "+a+"."+h;if(!1===me.sys.stopOnAudioError)me.audio.disable(),b&&b(),console.log(c+", disabling audio");else throw c;}else g[a][0].load()},c=function(a,b,c){s=0;if(1<b)for(var d=g[a][0],e=1;e<b;e++)g[a][e]=new Audio(d.src),g[a][e].preload="auto",g[a][e].load();c&&c()},d=function(a,b,c,d){var e;a:{for(var a=a.toLowerCase(),a=g[a],f=0,j;j=a[f++];)if(j.ended||!j.currentTime){j.currentTime=n;e=j;break a}a[0].pause();a[0].currentTime=
n;e=a[0]}e.loop=b||!1;e.volume=d?parseFloat(d).clamp(0,1):l.volume;e.muted=l.muted;e.play();c&&!b&&e.addEventListener("ended",function(a){e.removeEventListener("ended",arguments.callee,!1);c()},!1);return e},e=function(a,b,c){c&&!b&&setTimeout(c,2E3);return null},f={},g={},h=-1,i=null,j=null,k=!0,n=0,s=0,l={volume:1,muted:!1};f.capabilities={mp3:{codec:"audio/mpeg",canPlay:!1,canPlayType:"no"},ogg:{codec:'audio/ogg; codecs="vorbis"',canPlay:!1,canPlayType:"no"},m4a:{codec:'audio/mp4; codecs="mp4a.40.2"',
canPlay:!1,canPlayType:"no"},wav:{codec:'audio/wav; codecs="1"',canPlay:!1,canPlayType:"no"}};f.detectCapabilities=function(){var a=document.createElement("audio");if(a.canPlayType)for(var b in f.capabilities){var c=a.canPlayType(f.capabilities[b].codec);""!==c&&"no"!==c&&(f.capabilities[b].canPlay=!0,f.capabilities[b].canPlayType=c);me.sys.sound|=f.capabilities[b].canPlay}if((-1<me.sys.ua.search("iphone")||-1<me.sys.ua.search("ipod")||-1<me.sys.ua.search("ipad")||-1<me.sys.ua.search("android"))&&
!navigator.isCocoonJS)me.sys.sound=!1};f.init=function(a){if(!me.initialized)throw"melonJS: me.audio.init() called before engine initialization.";var a=new String(a?a:"mp3"),a=a.split(","),b="",c=a.length;if(me.sys.sound)for(var g="",j=0;j<c;j++)if(g=a[j].toLowerCase().trim(),f.capabilities[g]&&f.capabilities[g].canPlay&&(""===b||"probably"===f.capabilities[g].canPlayType))if(b=g,"probably"===f.capabilities[g].canPlayType)break;""===b&&(k=!1);h=b;f.play=f.isAudioEnable()?d:e;return f.isAudioEnable()};
f.isAudioEnable=function(){return k};f.enable=function(){k=me.sys.sound;f.play=k?d:e};f.disable=function(){me.audio.stopTrack();f.play=e;k=!1};f.load=function(a,d,e){if(-1==h)return 0;var f=new Audio(a.src+me.nocache);f.preload="auto";var j=a.channel||1,i="canplaythrough";!0===a.stream&&(j=1,i="canplay");f.addEventListener(i,function(b){this.removeEventListener(i,arguments.callee,!1);c.call(me.audio,a.name,j,d)},!1);f.addEventListener("error",function(){b.call(me.audio,a.name,e)},!1);f.load();g[a.name]=
[f];return 1};f.stop=function(a){if(k)for(var a=g[a.toLowerCase()],b=a.length;b--;)a[b].pause(),a[b].currentTime=n};f.pause=function(a){if(k)for(var a=g[a.toLowerCase()],b=a.length;b--;)a[b].pause()};f.playTrack=function(a,b){j=me.audio.play(a,!0,null,b);i=a.toLowerCase()};f.stopTrack=function(){k&&j&&(j.pause(),j=i=null)};f.setVolume=function(a){a&&(l.volume=parseFloat(a).clamp(0,1))};f.getVolume=function(){return l.volume};f.mute=function(a,b){for(var b=void 0===b?!0:!!b,c=g[a.toLowerCase()],d=
0,e;e=c[d++];)e.muted=b};f.unmute=function(a){f.mute(a,!1)};f.muteAll=function(){l.muted=!0;for(var a in g)f.mute(a,l.muted)};f.unmuteAll=function(){l.muted=!1;for(var a in g)f.mute(a,l.muted)};f.getCurrentTrack=function(){return i};f.pauseTrack=function(){k&&j&&j.pause()};f.resumeTrack=function(){k&&j&&j.play()};f.unload=function(a){a=a.toLowerCase();if(!(a in g))return!1;i===a?f.stopTrack():f.stop(a);delete g[a];return!0};f.unloadAll=function(){for(var a in g)f.unload(a)};a.audio=f})(window);
(function(){var a=me,b={},c=null,d=0,e=0,f=0,g=0,h=0,i=Math.ceil(1E3/me.sys.fps),j=1.25*(1E3/me.sys.fps);b.tick=1;b.fps=0;b.init=function(){c=document.getElementById("framecounter");null!==c&&(me.debug.displayFPS=!0);b.reset()};b.reset=function(){g=f=Date.now();d=e=0};b.getTime=function(){return g};b.update=function(){f=g;g=Date.now();h=g-f;d++;e+=h;0==d%10&&(this.fps=(~~(1E3*d/e)).clamp(0,me.sys.fps),d=e=0);me.debug.displayFPS&&null!==c&&c.replaceChild(document.createTextNode("("+this.fps+"/"+me.sys.fps+
" fps)"),c.firstChild);b.tick=h>j&&me.sys.interpolation?h/i:1};a.timer=b;var a=me,k={},n=null,s=null,l=null,q=null,u=null,m=-1,w=!1,t=0,C=0,z=!1,v=!0;k.init=function(a,b,c,d,e,f){if(!me.initialized)throw"melonJS: me.video.init() called before engine initialization.";w=d||!1;z="auto"===e||!1;v=void 0!==f?f:!0;e="auto"!==e?parseFloat(e||1):1;me.sys.scale=new me.Vector2d(e,e);if(z||1!==e)w=!0;t=b*me.sys.scale.x;C=c*me.sys.scale.y;window.addEventListener("resize",function(a){me.event.publish(me.event.WINDOW_ONRESIZE,
[a])},!1);window.addEventListener("orientationchange",function(a){me.event.publish(me.event.WINDOW_ONRESIZE,[a])},!1);me.event.subscribe(me.event.WINDOW_ONRESIZE,me.video.onresize.bind(me.video));n=k.createCanvas(t,C);a&&(u=document.getElementById(a));u||(u=document.body);u.appendChild(n);if(!n.getContext)return!1;s=n.getContext("2d");w?(l=k.createCanvas(b,c),q=l.getContext("2d")):(l=n,q=s);if(z)me.video.onresize(null);return!0};k.getWrapper=function(){return u};k.getWidth=function(){return l.width};
k.getPos=function(a){for(var a=a||n,b=new me.Vector2d(a.offsetLeft,a.offsetTop);a=a.offsetParent;)b.x+=a.offsetLeft,b.y+=a.offsetTop;return b};k.getHeight=function(){return l.height};k.createCanvas=function(a,b){var c=document.createElement("canvas");c.width=a||l.width;c.height=b||l.height;return c};k.createCanvasSurface=function(a,b){return k.createCanvas(a,b).getContext("2d")};k.getScreenCanvas=function(){return n};k.getScreenContext=function(){return s};k.getSystemCanvas=function(){return l};k.getSystemContext=
function(){return q};k.onresize=function(){if(z){var a=me.video.getScreenCanvas().parentNode,b=a.width||window.innerWidth,a=a.height||window.innerHeight;m&&clearTimeout(m);if(v){var c=me.video.getWidth()/me.video.getHeight(),b=b/a<c?b/me.video.getWidth():a/me.video.getHeight();m=me.video.updateDisplaySize.defer(b,b)}else m=me.video.updateDisplaySize.defer(b/me.video.getWidth(),a/me.video.getHeight())}else me.input.mouse.offset=me.video.getPos()};k.updateDisplaySize=function(a,b){me.sys.scale.set(a,
b);n.width=t=l.width*a;n.height=C=l.height*b;me.input.mouse.offset=me.video.getPos();k.blitSurface();m=-1};k.clearSurface=function(a,b){a.save();a.setTransform(1,0,0,1,0,0);a.fillStyle=b;a.fillRect(0,0,k.getWidth(),k.getHeight());a.restore()};k.scale=function(a,b){a.translate(-(a.canvas.width*b-a.canvas.width>>1),-(a.canvas.height*b-a.canvas.height>>1));a.scale(b,b)};k.setImageSmoothing=function(a){for(var b=["ms","moz","webkit","o"],c=0;c<b.length;++c)void 0!==s[b[c]+"ImageSmoothingEnabled"]&&(s[b[c]+
"ImageSmoothingEnabled"]=a);s.imageSmoothingEnabled=a};k.setAlpha=function(a,b){a.globalCompositeOperation=b?"source-over":"copy"};k.blitSurface=function(){k.blitSurface=w?function(){s.drawImage(l,0,0,l.width,l.height,0,0,t,C)}:function(){};k.blitSurface()};k.applyRGBFilter=function(a,b,c){var d=k.createCanvasSurface(a.width,a.height),a=me.utils.getPixels(a),e=a.data;switch(b){case "b&w":for(var b=0,f=e.length;b<f;b+=4)c=3*e[b]+4*e[b+1]+e[b+2]>>>3,e[b]=c,e[b+1]=c,e[b+2]=c;break;case "brightness":c=
Math.abs(c).clamp(0,1);b=0;for(f=e.length;b<f;b+=4)e[b]*=c,e[b+1]*=c,e[b+2]*=c;break;case "transparent":b=0;for(f=e.length;b<f;b+=4)me.utils.RGBToHex(e[b],e[b+1],e[b+2])===c&&(e[b+3]=0);break;default:return null}d.putImageData(a,0,0);return d};a.video=k})(window);
(function(a){var b=me,c=function(){if(!C){l.touches.push({x:0,y:0});l.mouse.pos=new me.Vector2d(0,0);l.mouse.offset=me.video.getPos();if(me.sys.touch){me.video.getScreenCanvas().addEventListener("touchmove",j,!1);for(var b=2;b<E.length;++b)me.video.getScreenCanvas().addEventListener(E[b],n,!1)}else{me.video.getScreenCanvas().addEventListener("mousemove",j,!1);a.addEventListener("mousewheel",i,!1);for(b=2;b<v.length;++b)me.video.getScreenCanvas().addEventListener(v[b],k,!1)}C=!0}},d=function(a){a.stopPropagation?
a.stopPropagation():a.cancelBubble=!0;a.preventDefault?a.preventDefault():a.returnValue=!1;return!1},e=function(a,b){var c=q[b||a.keyCode||a.which];return c?(w[c]||(u[c]=!0,w[c]=m[c],me.event.publish(me.event.KEYDOWN,[c])),d(a)):!0},f=function(a,b){var c=q[b||a.keyCode||a.which];return c?(u[c]=!1,w[c]=!1,me.event.publish(me.event.KEYUP,[c]),d(a)):!0},g=function(a){var b=!1,c=l.mouse.handlers[a.type];if(c)for(var d=me.game.viewport.pos,e=me.game.currentLevel.pos,f=0,g=l.touches.length;f<g;f++)for(var j=
l.touches[f].x,h=l.touches[f].y,i=c.length,k;i--,k=c[i];){var m=!1===k.floating?{x:j+d.x-e.x,y:h+d.y-e.y}:{x:j,y:h};if((null===k.rect||k.rect.containsPoint(m))&&!1===k.cb(a)){b=!0;break}}return b},h=function(a){l.touches.length=0;if(a.touches)for(var b=l.mouse.offset,c=0,d=a.changedTouches.length;c<d;c++){var e=a.changedTouches[c],f=e.clientX-b.x,g=e.clientY-b.y,j=me.sys.scale;if(1!=j.x||1!=j.y)f/=j.x,g/=j.y;l.touches.push({x:f,y:g,id:e.identifier})}else{var b=l.mouse.offset,f=a.pageX-b.x,g=a.pageY-
b.y,j=me.sys.scale;if(1!=j.x||1!=j.y)f/=j.x,g/=j.y;l.touches.push({x:f,y:g,id:0})}l.mouse.pos.set(l.touches[0].x,l.touches[0].y)},i=function(a){return a.target==me.video.getScreenCanvas()&&g(a)?d(a):!0},j=function(a){h(a);return g(a)?d(a):!0},k=function(a){if(g(a))return d(a);var b=l.mouse.bind[a.button||0];return b?"mousedown"===a.type||"touchstart"===a.type?e(a,b):f(a,b):!0},n=function(a){h(a);return k(a)},s=function(a){l.accel=a.accelerationIncludingGravity},l={},q={},u={},m={},w={},t=!1,C=!1,
z=!1,v="mousewheel mousemove mousedown mouseup click dblclick".split(" "),E=[void 0,"touchmove","touchstart","touchend","tap","dbltap"];l.accel={x:0,y:0,z:0};l.mouse={pos:null,offset:null,LEFT:0,MIDDLE:1,RIGHT:2,bind:[0,0,0],handlers:{}};l.touches=[];l.KEY={LEFT:37,UP:38,RIGHT:39,DOWN:40,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,ESC:27,SPACE:32,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,
P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90};l.isKeyPressed=function(a){return u[a]?(m[a]&&(w[a]=!0,u[a]=!1),!0):!1};l.keyStatus=function(a){return!0===w[a]?!0:u[a]};l.triggerKeyEvent=function(a,b){b?e({},a):f({},a)};l.bindKey=function(b,c,d){t||(a.addEventListener("keydown",e,!1),a.addEventListener("keyup",f,!1),t=!0);q[b]=c;u[c]=!1;m[c]=d?d:!1;w[c]=!1};l.unbindKey=function(a){u[q[a]]=!1;m[q[a]]=!1;q[a]=null};l.bindMouse=function(a,b){c();if(!q[b])throw"melonJS : no action defined for keycode "+
b;l.mouse.bind[a]=b};l.unbindMouse=function(a){l.mouse.bind[a]=null};l.bindTouch=function(a){l.bindMouse(me.input.mouse.LEFT,a)};l.unbindTouch=function(){l.unbindMouse(me.input.mouse.LEFT)};l.registerMouseEvent=function(a,b,d,e){c();me.sys.touch&&-1!==v.indexOf(a)&&(a=E[v.indexOf(a)]);if(a&&(-1!==v.indexOf(a)||-1!==E.indexOf(a))){l.mouse.handlers[a]||(l.mouse.handlers[a]=[]);var f=!0===b.floating?!0:!1;e&&(f=!0===e?!0:!1);l.mouse.handlers[a].push({rect:b||null,cb:d,floating:f})}else throw"melonJS : invalid event type : "+
a;};l.releaseMouseEvent=function(a,b){me.sys.touch&&-1!==v.indexOf(a)&&(a=E[v.indexOf(a)]);if(a&&(-1!==v.indexOf(a)||-1!==E.indexOf(a))){l.mouse.handlers[a]||(l.mouse.handlers[a]=[]);var c=l.mouse.handlers[a];if(c)for(var d=c.length,e;d--,e=c[d];)e.rect===b&&(e.rect=e.cb=e.floating=null,l.mouse.handlers[a].splice(d,1))}else throw"melonJS : invalid event type : "+a;};l.watchAccelerometer=function(){return a.sys.gyro?(z||(a.addEventListener("devicemotion",s,!1),z=!0),!0):!1};l.unwatchAccelerometer=
function(){z&&(a.removeEventListener("devicemotion",s,!1),z=!1)};b.input=l})(window);
(function(a){var b={decode:function(b){b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");if(me.sys.nativeBase64)return a.atob(b);for(var c=[],d,e,f,g,h,i=0;i<b.length;)d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(i++)),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(i++)),g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(i++)),h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(i++)),
d=d<<2|e>>4,e=(e&15)<<4|g>>2,f=(g&3)<<6|h,c.push(String.fromCharCode(d)),64!=g&&c.push(String.fromCharCode(e)),64!=h&&c.push(String.fromCharCode(f));return c=c.join("")}},c=me,d={},e={},f="",g=0,h=/^.*(\\|\/|\:)/,i=/\.[^\.]*$/;d.decodeBase64=function(a){return b.decode(a)};d.decodeBase64AsArray=function(a,c){var c=c||1,d=b.decode(a),e,f,g,h="function"===typeof window.Uint32Array?new Uint32Array(d.length/c):[];e=0;for(g=d.length/c;e<g;e++){h[e]=0;for(f=c-1;0<=f;--f)h[e]+=d.charCodeAt(e*c+f)<<(f<<3)}return h};
d.decodeCSV=function(a,b){for(var a=a.trim().split("\n"),c=[],d=0;d<a.length;d++){entries=a[d].split(",",b);for(var e=0;e<entries.length;e++)c.push(+entries[e])}return c};d.getBasename=function(a){return a.replace(h,"").replace(i,"")};d.getFileExtension=function(a){return a.substring(a.lastIndexOf(".")+1,a.length)};d.setNocache=function(a){me.nocache=a?"?"+parseInt(1E7*Math.random()):""};d.HexToRGB=function(a,b){if("#"!==a.charAt(0))return a;a=a.substring(1,a.length);if(null==e[a]){if(6>a.length)var c=
a.charAt(0)+a.charAt(0),d=a.charAt(1)+a.charAt(1),f=a.charAt(2)+a.charAt(2);else c=a.substring(0,2),d=a.substring(2,4),f=a.substring(4,6);e[a]=parseInt(c,16)+","+parseInt(d,16)+","+parseInt(f,16)}return(b?"rgba(":"rgb(")+e[a]+(b?","+b+")":")")};d.RGBToHex=function(a,b,c){return a.toHex()+b.toHex()+c.toHex()};d.getPixels=function(a){if(a instanceof HTMLImageElement){var b=me.video.createCanvasSurface(a.width,a.height);b.drawImage(a,0,0);return b.getImageData(0,0,a.width,a.height)}return a.getContext("2d").getImageData(0,
0,a.width,a.height)};d.resetGUID=function(a){f=a.toString().toUpperCase().toHex();g=0};d.createGUID=function(){return f+"-"+g++};d.applyFriction=function(a,b){return 0>a+b?a+b*me.timer.tick:0<a-b?a-b*me.timer.tick:0};c.utils=d})(window);
(function(){function a(a){this.defaultvalue=a||0;this.value=a||0;this.updated=!0}a.prototype.reset=function(){this.set(this.defaultvalue)};a.prototype.update=function(a){return this.set(this.value+a)};a.prototype.set=function(a){this.value=a;return this.updated=!0};var b=me,c={},d={},e=[],f=0;c.add=function(b,c){if(b.constructor===Object)for(var i in b){var j=i;d[j]=new a(b[i]);e.push(d[j]);f++}else d[b]=new a(c),e.push(d[b]),f++};c.updateValue=function(a,b){if(a.constructor===Object)for(var c in a)d[c]&&
d[c].update(a[c]);else d[a]&&d[a].update(b)};c.setValue=function(a,b){if(a.constructor===Object)for(var c in a)d[c]&&d[c].set(a[c]);else d[a]&&d[a].set(b)};c.getItemValue=function(a){return d[a]?d[a].value:0};c.reset=function(a){void 0!=a?d[a]&&d[a].reset():c.resetAll()};c.resetAll=function(){for(var a=f,b;a--,b=e[a];)b.reset()};b.gamestat=c})(window);
(function(){me.LevelConstants={COLLISION_MAP:"collision",PARALLAX_MAP:"parallax"};me.TMX_TAG_MAP="map";me.TMX_TAG_NAME="name";me.TMX_TAG_VALUE="value";me.TMX_TAG_VERSION="version";me.TMX_TAG_ORIENTATION="orientation";me.TMX_TAG_WIDTH="width";me.TMX_TAG_HEIGHT="height";me.TMX_TAG_OPACITY="opacity";me.TMX_TAG_TRANS="trans";me.TMX_TAG_TILEWIDTH="tilewidth";me.TMX_TAG_TILEHEIGHT="tileheight";me.TMX_TAG_TILEOFFSET="tileoffset";me.TMX_TAG_FIRSTGID="firstgid";me.TMX_TAG_GID="gid";me.TMX_TAG_TILE="tile";
me.TMX_TAG_ID="id";me.TMX_TAG_DATA="data";me.TMX_TAG_COMPRESSION="compression";me.TMX_TAG_ENCODING="encoding";me.TMX_TAG_ATTR_BASE64="base64";me.TMX_TAG_CSV="csv";me.TMX_TAG_SPACING="spacing";me.TMX_TAG_MARGIN="margin";me.TMX_TAG_PROPERTIES="properties";me.TMX_TAG_PROPERTY="property";me.TMX_TAG_IMAGE="image";me.TMX_TAG_SOURCE="source";me.TMX_TAG_VISIBLE="visible";me.TMX_TAG_TILESET="tileset";me.TMX_TAG_LAYER="layer";me.TMX_TAG_TILE_LAYER="tilelayer";me.TMX_TAG_IMAGE_LAYER="imagelayer";me.TMX_TAG_OBJECTGROUP=
"objectgroup";me.TMX_TAG_OBJECT="object";me.TMX_TAG_X="x";me.TMX_TAG_Y="y";me.TMX_TAG_WIDTH="width";me.TMX_TAG_HEIGHT="height";me.TMX_TAG_POLYGON="polygon";me.TMX_TAG_POLYLINE="polyline";me.TMX_TAG_POINTS="points";me.TMX_BACKGROUND_COLOR="backgroundcolor"})(window);
(function(){me.TMXUtils={applyTMXPropertiesFromXML:function(a,b){var c=b.getElementsByTagName(me.TMX_TAG_PROPERTIES)[0];if(c)for(var c=c.getElementsByTagName(me.TMX_TAG_PROPERTY),d=0;d<c.length;d++){var e=me.mapReader.TMXParser.getStringAttribute(c[d],me.TMX_TAG_NAME),f=me.mapReader.TMXParser.getStringAttribute(c[d],me.TMX_TAG_VALUE);!f||f.isBoolean()?f=f?"true"==f:!0:f.isNumeric()&&(f=Number(f));a[e]=f}},applyTMXPropertiesFromJSON:function(a,b){var c=b[me.TMX_TAG_PROPERTIES];if(c)for(var d in c){var e=
c[d];!e||e.isBoolean()?e=e?"true"==e:!0:e.isNumeric()&&(e=Number(e));a[d]=e}},mergeProperties:function(a,b,c){for(var d in b)if(c||void 0===a[d])a[d]=b[d];return a}}})(window);
(function(){me.TMXOBjectGroup=Object.extend({initFromXML:function(a,b,c,d){this.name=a;this.width=me.mapReader.TMXParser.getIntAttribute(b,me.TMX_TAG_WIDTH);this.height=me.mapReader.TMXParser.getIntAttribute(b,me.TMX_TAG_HEIGHT);this.visible=1==me.mapReader.TMXParser.getIntAttribute(b,me.TMX_TAG_VISIBLE,1);this.z=d;this.objects=[];b.firstChild&&b.firstChild.nextSibling.nodeName===me.TMX_TAG_PROPERTIES&&me.TMXUtils.applyTMXPropertiesFromXML(this,b);a=b.getElementsByTagName(me.TMX_TAG_OBJECT);for(b=
0;b<a.length;b++){var e=new me.TMXOBject;e.initFromXML(a[b],c,d);this.objects.push(e)}},initFromJSON:function(a,b,c,d){var e=this;this.name=a;this.width=b[me.TMX_TAG_WIDTH];this.height=b[me.TMX_TAG_HEIGHT];this.visible=b[me.TMX_TAG_VISIBLE];this.z=d;this.objects=[];me.TMXUtils.applyTMXPropertiesFromJSON(this,b);b.objects.forEach(function(a){var b=new me.TMXOBject;b.initFromJSON(a,c,d);e.objects.push(b)})},reset:function(){this.objects=null},getObjectCount:function(){return this.objects.length},getObjectByIndex:function(a){return this.objects[a]}});
me.TMXOBject=Object.extend({initFromXML:function(a,b,c){this.name=me.mapReader.TMXParser.getStringAttribute(a,me.TMX_TAG_NAME);this.x=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_X);this.y=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_Y);this.z=c;this.width=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_WIDTH,0);this.height=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_HEIGHT,0);if(this.gid=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_GID,null))this.setImage(this.gid,
b);else if(b=a.getElementsByTagName(me.TMX_TAG_POLYGON),this.isPolygon=!0,b.length||(b=a.getElementsByTagName(me.TMX_TAG_POLYLINE),this.isPolygon=!1),b.length){this.points=[];for(var b=me.mapReader.TMXParser.getStringAttribute(b[0],me.TMX_TAG_POINTS).split(" "),c=0,d;c<b.length;c++)d=b[c].split(","),this.points[c]=new me.Vector2d(+d[0],+d[1])}me.TMXUtils.applyTMXPropertiesFromXML(this,a)},initFromJSON:function(a,b,c){this.name=a[me.TMX_TAG_NAME];this.x=parseInt(a[me.TMX_TAG_X]);this.y=parseInt(a[me.TMX_TAG_Y]);
this.z=parseInt(c);this.width=parseInt(a[me.TMX_TAG_WIDTH]||0);this.height=parseInt(a[me.TMX_TAG_HEIGHT]||0);if(this.gid=parseInt(a[me.TMX_TAG_GID])||null)this.setImage(this.gid,b);else if(b=a[me.TMX_TAG_POLYGON],this.isPolygon=void 0!==b,b||(b=a[me.TMX_TAG_POLYLINE],this.isPolygon=!1),b){this.points=[];var d=this,e=0;b.forEach(function(a){d.points[e++]=new me.Vector2d(parseInt(a.x),parseInt(a.y))})}me.TMXUtils.applyTMXPropertiesFromJSON(this,a)},setImage:function(a,b){var c=b.getTilesetByGid(this.gid);
this.width=c.tilewidth;this.height=c.tileheight;this.spritewidth=this.width;this.y-=this.height;var d=new me.Tile(this.x,this.y,c.tilewidth,c.tileheight,this.gid);this.image=c.getTileImage(d)},getObjectPropertyByName:function(a){return this[a]}})})(window);
(function(){me.Tile=me.Rect.extend({tileId:null,init:function(a,b,c,d,e){this.parent(new me.Vector2d(a*c,b*d),c,d);this.col=a;this.row=b;this.tileId=e;this.flipX=0!==(this.tileId&2147483648);this.flipY=0!==(this.tileId&1073741824);this.flipAD=0!==(this.tileId&536870912);this.flipped=this.flipX||this.flipY||this.flipAD;this.tileId&=536870911}});me.TMXTileset=Object.extend({type:{SOLID:"solid",PLATFORM:"platform",L_SLOPE:"lslope",R_SLOPE:"rslope",LADDER:"ladder",BREAKABLE:"breakable"},TileProperties:[],
tileXOffset:[],tileYOffset:[],initFromXML:function(a){this.TileProperties=[];this.tileXOffset=[];this.tileYOffset=[];this.firstgid=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_FIRSTGID);var b=me.mapReader.TMXParser.getStringAttribute(a,me.TMX_TAG_SOURCE);if(b){b=me.utils.getBasename(b);a=me.loader.getTMX(b);if(!a)throw"melonJS:"+b+" TSX tileset not found";me.mapReader.TMXParser.parseFromString(a);a=me.mapReader.TMXParser.getFirstElementByTagName("tileset")}this.name=me.mapReader.TMXParser.getStringAttribute(a,
me.TMX_TAG_NAME);this.tilewidth=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_TILEWIDTH);this.tileheight=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_TILEHEIGHT);this.spacing=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_SPACING,0);this.margin=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_MARGIN,0);this.tileoffset=new me.Vector2d(0,0);b=a.getElementsByTagName(me.TMX_TAG_TILEOFFSET);0<b.length&&(this.tileoffset.x=me.mapReader.TMXParser.getIntAttribute(b[0],me.TMX_TAG_X),this.tileoffset.y=
me.mapReader.TMXParser.getIntAttribute(b[0],me.TMX_TAG_Y));for(var b=a.getElementsByTagName(me.TMX_TAG_TILE),c=0;c<b.length;c++){var d=me.mapReader.TMXParser.getIntAttribute(b[c],me.TMX_TAG_ID)+this.firstgid,e={};me.TMXUtils.applyTMXPropertiesFromXML(e,b[c]);this.setTileProperty(d,e)}(b=(c=a.getElementsByTagName(me.TMX_TAG_IMAGE)[0].getAttribute(me.TMX_TAG_SOURCE))?me.loader.getImage(me.utils.getBasename(c)):null)||console.log("melonJS: '"+c+"' file for tileset '"+this.name+"' not found!");a=a.getElementsByTagName(me.TMX_TAG_IMAGE)[0].getAttribute(me.TMX_TAG_TRANS);
this.initFromImage(b,a)},initFromJSON:function(a){this.TileProperties=[];this.tileXOffset=[];this.tileYOffset=[];this.firstgid=a[me.TMX_TAG_FIRSTGID];var b=a[me.TMX_TAG_SOURCE];if(b&&(b=me.utils.getBasename(b),a=me.loader.getTMX(b),!a))throw"melonJS:"+b+" TSX tileset not found";this.name=a[me.TMX_TAG_NAME];this.tilewidth=parseInt(a[me.TMX_TAG_TILEWIDTH]);this.tileheight=parseInt(a[me.TMX_TAG_TILEHEIGHT]);this.spacing=parseInt(a[me.TMX_TAG_SPACING]||0);this.margin=parseInt(a[me.TMX_TAG_MARGIN]||0);
this.tileoffset=new me.Vector2d(0,0);if(b=a[me.TMX_TAG_TILEOFFSET])this.tileoffset.x=parseInt(b[me.TMX_TAG_X]),this.tileoffset.y=parseInt(b[me.TMX_TAG_Y]);var b=a.tileproperties,c;for(c in b){var d={};me.TMXUtils.mergeProperties(d,b[c]);this.setTileProperty(parseInt(c)+this.firstgid,d)}(b=(c=me.utils.getBasename(a[me.TMX_TAG_IMAGE]))?me.loader.getImage(c):null)||console.log("melonJS: '"+c+"' file for tileset '"+this.name+"' not found!");this.initFromImage(b,a[me.TMX_TAG_TRANS]||null)},initFromImage:function(a,
b){a&&(this.image=a,this.hTileCount=~~((this.image.width-this.margin)/(this.tilewidth+this.spacing)),this.vTileCount=~~((this.image.height-this.margin)/(this.tileheight+this.spacing)));this.lastgid=this.firstgid+(this.hTileCount*this.vTileCount-1||0);null!==b&&this.image&&(this.image=me.video.applyRGBFilter(this.image,"transparent",b.toUpperCase()).canvas)},setTileProperty:function(a,b){b.isSolid=b.type?b.type.toLowerCase()===this.type.SOLID:!1;b.isPlatform=b.type?b.type.toLowerCase()===this.type.PLATFORM:
!1;b.isLeftSlope=b.type?b.type.toLowerCase()===this.type.L_SLOPE:!1;b.isRightSlope=b.type?b.type.toLowerCase()===this.type.R_SLOPE:!1;b.isBreakable=b.type?b.type.toLowerCase()===this.type.BREAKABLE:!1;b.isLadder=b.type?b.type.toLowerCase()===this.type.LADDER:!1;b.isSlope=b.isLeftSlope||b.isRightSlope;b.isCollidable=!!b.type;this.TileProperties[a]=b},contains:function(a){return a>=this.firstgid&&a<=this.lastgid},getTileImage:function(a){var b=me.video.createCanvasSurface(this.tilewidth,this.tileheight);
this.drawTile(b,0,0,a);return b.canvas},getTileProperties:function(a){return this.TileProperties[a]},isTileCollidable:function(a){return this.TileProperties[a].isCollidable},getTileOffsetX:function(a){null==this.tileXOffset[a]&&(this.tileXOffset[a]=this.margin+(this.spacing+this.tilewidth)*(a%this.hTileCount));return this.tileXOffset[a]},getTileOffsetY:function(a){null==this.tileYOffset[a]&&(this.tileYOffset[a]=this.margin+(this.spacing+this.tileheight)*~~(a/this.hTileCount));return this.tileYOffset[a]},
drawTile:function(a,b,c,d){if(d.flipped){var e=1,f=0,g=0,h=1,i=b,j=c,b=c=0;a.save();d.flipAD&&(e=0,g=f=1,h=0,j+=this.tileheight-this.tilewidth);d.flipX&&(e=-e,g=-g,i+=d.flipAD?this.tileheight:this.tilewidth);d.flipY&&(f=-f,h=-h,j+=d.flipAD?this.tilewidth:this.tileheight);a.transform(e,f,g,h,i,j)}e=d.tileId-this.firstgid;a.drawImage(this.image,this.getTileOffsetX(e),this.getTileOffsetY(e),this.tilewidth,this.tileheight,b,c,this.tilewidth,this.tileheight);d.flipped&&a.restore()}});me.TMXTilesetGroup=
Object.extend({init:function(){this.tilesets=[]},add:function(a){this.tilesets.push(a)},getTilesetByIndex:function(a){return this.tilesets[a]},getTilesetByGid:function(a){for(var b=-1,c=0,d=this.tilesets.length;c<d;c++){if(this.tilesets[c].contains(a))return this.tilesets[c];this.tilesets[c].firstgid==this.tilesets[c].lastgid&&a>=this.tilesets[c].firstgid&&(b=c)}if(-1!=b)return this.tilesets[b];throw"no matching tileset found for gid "+a;}})})(window);
(function(){me.TMXOrthogonalRenderer=Object.extend({init:function(a,b,c,d){this.width=a;this.height=b;this.tilewidth=c;this.tileheight=d},canRender:function(a){return"orthogonal"===a.orientation&&this.width===a.width&&this.height===a.height&&this.tilewidth===a.tilewidth&&this.tileheight===a.tileheight},pixelToTileCoords:function(a,b){return new me.Vector2d(a/this.tilewidth,b/this.tileheight)},tileToPixelCoords:function(a,b){return new me.Vector2d(a*this.tilewidth,b*this.tileheight)},drawTile:function(a,
b,c,d,e){e.drawTile(a,e.tileoffset.x+b*this.tilewidth,e.tileoffset.y+(c+1)*this.tileheight-e.tileheight,d)},drawTileLayer:function(a,b,c,d){var e=this.pixelToTileCoords(c.x+d.pos.x,c.y+d.pos.y).floorSelf(),c=this.pixelToTileCoords(c.x+d.pos.x+d.width+this.tilewidth,c.y+d.pos.y+d.height+this.tileheight).ceilSelf();c.x=c.x>this.width?this.width:c.x;c.y=c.y>this.height?this.height:c.y;for(d=e.y;d<c.y;d++)for(var f=e.x;f<c.x;f++){var g=b.layerData[f][d];g&&(b.tileset.contains(g.tileId)||(b.tileset=b.tilesets.getTilesetByGid(g.tileId)),
this.drawTile(a,f,d,g,b.tileset))}}});me.TMXIsometricRenderer=Object.extend({init:function(a,b,c,d){this.width=a;this.height=b;this.tilewidth=c;this.tileheight=d;this.hTilewidth=c/2;this.hTileheight=d/2;this.ratio=this.tilewidth/this.tileheight;this.originX=this.height*this.hTilewidth},canRender:function(a){return"isometric"===a.orientation&&this.width===a.width&&this.height===a.height&&this.tilewidth===a.tilewidth&&this.tileheight===a.tileheight},pixelToTileCoords:function(a,b){a-=this.originX;return new me.Vector2d((b+
a/this.ratio)/this.tileheight,(b-a/this.ratio)/this.tileheight)},tileToPixelCoords:function(a,b){return new me.Vector2d((a-b)*this.hTilewidth+this.originX,(a+b)*this.hTileheight)},drawTile:function(a,b,c,d,e){e.drawTile(a,(this.width-1)*e.tilewidth+(b-c)*e.tilewidth>>1,-e.tilewidth+(b+c)*e.tileheight>>2,d)},drawTileLayer:function(a,b,c,d){var e=b.tileset,f=e.tileoffset,g=this.pixelToTileCoords(c.x+d.pos.x-e.tilewidth,c.y+d.pos.y-e.tileheight).floorSelf(),h=this.pixelToTileCoords(c.x+d.pos.x+d.width+
e.tilewidth,c.y+d.pos.y+d.height+e.tileheight).ceilSelf(),h=this.tileToPixelCoords(h.x,h.y),i=this.tileToPixelCoords(g.x,g.y);i.x-=this.hTilewidth;i.y+=this.tileheight;var j=i.y-d.pos.y+c.y>this.hTileheight,c=d.pos.x+c.x-i.x<this.hTilewidth;j&&(c?(g.x--,i.x-=this.hTilewidth):(g.y--,i.x+=this.hTilewidth),i.y-=this.hTileheight);c^=j;d=g.clone();for(j=i.y;j-this.tileheight<h.y;j+=this.hTileheight){d.setV(g);for(var k=i.x;k<h.x;k+=this.tilewidth){if(0<=d.x&&0<=d.y&&d.x<this.width&&d.y<this.height){var n=
b.layerData[d.x][d.y];n&&(e.contains(n.tileId)||(e=b.tileset=b.tilesets.getTilesetByGid(n.tileId),f=e.tileoffset),e.drawTile(a,f.x+k,f.y+j-e.tileheight,n))}d.x++;d.y--}c?(g.y++,i.x-=this.hTilewidth,c=!1):(g.x++,i.x+=this.hTilewidth,c=!0)}}})})(window);
(function(a,b){me.ColorLayer=Object.extend({init:function(a,b,e){this.name=a;this.color=me.utils.HexToRGB(b);this.z=e;this.visible=!0;this.opacity=1;this.floating=!0},reset:function(){},getOpacity:function(){return this.opacity},setOpacity:function(a){a&&(this.opacity=a.clamp(0,1))},update:function(){return!1},draw:function(a,b){var e=a.globalAlpha;a.globalAlpha=this.opacity;a.fillStyle=this.color;a.fillRect(b.left,b.top,b.width,b.height);a.globalAlpha=e}});me.ImageLayer=Object.extend({ratio:1,init:function(a,
d,e,f,g,h){this.name=a;(this.image=f?me.loader.getImage(me.utils.getBasename(f)):null)||console.log("melonJS: '"+f+"' file for Image Layer '"+this.name+"' not found!");this.imagewidth=this.image.width;this.imageheight=this.image.height;this.z=g;this.ratio=h||1;this.lastpos=b.viewport.pos.clone();this.offset=new me.Vector2d(0,0);this.width=d?Math.min(b.viewport.width,d):b.viewport.width;this.height=e?Math.min(b.viewport.height,e):b.viewport.height;this.visible=!0;this.opacity=1;this.floating=!0;this._repeat=
"repeat";this.repeatY=this.repeatX=!0;Object.defineProperty(this,"repeat",{get:function(){return this._repeat},set:function(a){this._repeat=a;switch(this._repeat){case "no-repeat":this.repeatY=this.repeatX=!1;break;case "repeat-x":this.repeatX=!0;this.repeatY=!1;break;case "repeat-y":this.repeatX=!1;this.repeatY=!0;break;default:this.repeatY=this.repeatX=!0}}})},reset:function(){this.offset=this.viewport=this.lastpos=this.image=null},getOpacity:function(){return this.opacity},setOpacity:function(a){a&&
(this.opacity=a.clamp(0,1))},update:function(){if(0!==this.ratio){var a=b.viewport.pos;if(!this.lastpos.equals(a))return this.offset.x=(this.imagewidth+this.offset.x+(a.x-this.lastpos.x)*this.ratio)%this.imagewidth,this.offset.y=(this.imageheight+this.offset.y+(a.y-this.lastpos.y)*this.ratio)%this.imageheight,this.lastpos.setV(a),!0}return!1},draw:function(a,b){if(1>this.opacity){var e=a.globalAlpha;a.globalAlpha=this.opacity}if(0===this.ratio)j=Math.min(b.width,this.imagewidth),k=Math.min(b.height,
this.imageheight),a.drawImage(this.image,b.left,b.top,j,k,b.left,b.top,j,k);else{var f=~~this.offset.x,g=~~this.offset.y,h=0,i=0,j=Math.min(this.imagewidth-f,this.width),k=Math.min(this.imageheight-g,this.height);do{do a.drawImage(this.image,f,g,j,k,h,i,j,k),g=0,i+=k,k=Math.min(this.imageheight,this.height-i);while(this.repeatY&&i<this.height);h+=j;if(!this.repeatX||h>=this.width)break;f=0;j=Math.min(this.imagewidth,this.width-h);g=~~this.offset.y;i=0;k=Math.min(this.imageheight-~~this.offset.y,this.height)}while(1)}1>
this.opacity&&(a.globalAlpha=e)}});CollisionTiledLayer=Object.extend({init:function(a,b){this.realwidth=a;this.realheight=b;this.isCollisionMap=!0},reset:function(){},checkCollision:function(a,b){var e=0>b.x?a.left+b.x:a.right+b.x,f=0>b.y?a.top+b.y:a.bottom+b.y,g={x:0,y:0,xprop:{},yprop:{}};if(0>=e||e>=this.realwidth)g.x=b.x;if(0>=f||f>=this.realheight)g.y=b.y;return g}});me.TMXLayer=Object.extend({layerData:null,init:function(a,b,e,f,g){this.tilewidth=a;this.tileheight=b;this.orientation=e;this.z=
g;this.tileset=(this.tilesets=f)?this.tilesets.getTilesetByIndex(0):null},initFromXML:function(a){this.name=me.mapReader.TMXParser.getStringAttribute(a,me.TMX_TAG_NAME);this.visible=1==me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_VISIBLE,1);this.opacity=me.mapReader.TMXParser.getFloatAttribute(a,me.TMX_TAG_OPACITY,1).clamp(0,1);this.width=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_WIDTH);this.height=me.mapReader.TMXParser.getIntAttribute(a,me.TMX_TAG_HEIGHT);this.realwidth=this.width*
this.tilewidth;this.realheight=this.height*this.tileheight;me.TMXUtils.applyTMXPropertiesFromXML(this,a);void 0===this.preRender&&(this.preRender=me.sys.preRender);if((this.isCollisionMap=this.name.toLowerCase().contains(me.LevelConstants.COLLISION_MAP))&&!me.debug.renderCollisionMap)this.visible=!1;this.preRender&&(this.layerCanvas=me.video.createCanvas(this.width*this.tilewidth,this.height*this.tileheight),this.layerSurface=this.layerCanvas.getContext("2d"),this.layerSurface.globalAlpha=this.opacity)},
initFromJSON:function(a){this.name=a[me.TMX_TAG_NAME];this.visible=a[me.TMX_TAG_VISIBLE];this.opacity=parseFloat(a[me.TMX_TAG_OPACITY]).clamp(0,1);this.width=parseInt(a[me.TMX_TAG_WIDTH]);this.height=parseInt(a[me.TMX_TAG_HEIGHT]);this.realwidth=this.width*this.tilewidth;this.realheight=this.height*this.tileheight;me.TMXUtils.applyTMXPropertiesFromJSON(this,a);void 0===this.preRender&&(this.preRender=me.sys.preRender);if((this.isCollisionMap=this.name.toLowerCase().contains(me.LevelConstants.COLLISION_MAP))&&
!me.debug.renderCollisionMap)this.visible=!1;this.preRender&&(this.layerCanvas=me.video.createCanvas(this.width*this.tilewidth,this.height*this.tileheight),this.layerSurface=this.layerCanvas.getContext("2d"),this.layerSurface.globalAlpha=this.opacity)},reset:function(){this.preRender&&(this.layerSurface=this.layerCanvas=null);this.tilesets=this.tileset=this.layerData=this.renderer=null},setRenderer:function(a){this.renderer=a},initArray:function(a,b){this.layerData=[];for(var e=0;e<a;e++){this.layerData[e]=
[];for(var f=0;f<b;f++)this.layerData[e][f]=null}},getTileId:function(a,b){var e=this.getTile(a,b);return e?e.tileId:null},getTile:function(a,b){return this.layerData[~~(a/this.tilewidth)][~~(b/this.tileheight)]},setTile:function(a,b,e){this.layerData[a][b]=new me.Tile(a,b,this.tilewidth,this.tileheight,e)},clearTile:function(a,b){this.layerData[a][b]=null;this.visible&&this.preRender&&this.layerSurface.clearRect(a*this.tilewidth,b*this.tileheight,this.tilewidth,this.tileheight)},getOpacity:function(){return this.opacity},
setOpacity:function(a){a&&(this.opacity=a.clamp(0,1),this.preRender&&(this.layerSurface.globalAlpha=this.opacity))},checkCollision:function(a,b){var e=0>b.x?~~(a.left+b.x):Math.ceil(a.right-1+b.x),f=0>b.y?~~(a.top+b.y):Math.ceil(a.bottom-1+b.y),g={x:0,xtile:void 0,xprop:{},y:0,ytile:void 0,yprop:{}};0>=e||e>=this.realwidth?g.x=b.x:0!=b.x&&(g.xtile=this.getTile(e,Math.ceil(a.bottom-1)),g.xtile&&this.tileset.isTileCollidable(g.xtile.tileId)?(g.x=b.x,g.xprop=this.tileset.getTileProperties(g.xtile.tileId)):
(g.xtile=this.getTile(e,~~a.top),g.xtile&&this.tileset.isTileCollidable(g.xtile.tileId)&&(g.x=b.x,g.xprop=this.tileset.getTileProperties(g.xtile.tileId))));0!=b.y&&(g.ytile=this.getTile(0>b.x?~~a.left:Math.ceil(a.right-1),f),g.ytile&&this.tileset.isTileCollidable(g.ytile.tileId)?(g.y=b.y||1,g.yprop=this.tileset.getTileProperties(g.ytile.tileId)):(g.ytile=this.getTile(0>b.x?Math.ceil(a.right-1):~~a.left,f),g.ytile&&this.tileset.isTileCollidable(g.ytile.tileId)&&(g.y=b.y||1,g.yprop=this.tileset.getTileProperties(g.ytile.tileId))));
return g},update:function(){return!1},draw:function(a,d){var e=b.viewport.pos;if(this.preRender){var f=Math.min(d.width,this.realwidth),g=Math.min(d.height,this.realheight);a.drawImage(this.layerCanvas,e.x+d.pos.x,e.y+d.pos.y,f,g,e.x+d.pos.x,e.y+d.pos.y,f,g)}else f=a.globalAlpha,a.globalAlpha=this.opacity,this.renderer.drawTileLayer(a,this,e,d),a.globalAlpha=f}})})(window,me.game);
(function(){me.TMXTileMap=Object.extend({init:function(a,b,c){this.pos=new me.Vector2d(b,c);this.levelId=a;this.z=0;this.name=null;this.height=this.width=0;this.realheight=this.realwidth=-1;this.tileheight=this.tilewidth=0;this.tilesets=null;this.mapLayers=[];this.objectGroups=[];this.initialized=!1;this.orientation=this.version="";this.tilesets=null},reset:function(){if(!0===this.initialized){for(var a=this.mapLayers.length;a--;)this.mapLayers[a].reset(),this.mapLayers[a]=null;for(a=this.objectGroups.length;a--;)this.objectGroups[a].reset(),
this.objectGroups[a]=null;this.tilesets=null;this.mapLayers.length=0;this.objectGroups.length=0;this.pos.set(0,0);this.initialized=!1}},getObjectGroupByName:function(a){for(var b=null,a=a.trim().toLowerCase(),c=this.objectGroups.length;c--;)if(this.objectGroups[c].name.toLowerCase().contains(a)){b=this.objectGroups[c];break}return b},getObjectGroups:function(){return this.objectGroups},getLayers:function(){return this.mapLayers},getLayerByName:function(a){for(var b=null,a=a.trim().toLowerCase(),c=
this.mapLayers.length;c--;)if(this.mapLayers[c].name.toLowerCase().contains(a)){b=this.mapLayers[c];break}a.toLowerCase().contains(me.LevelConstants.COLLISION_MAP)&&null==b&&(b=new CollisionTiledLayer(me.game.currentLevel.realwidth,me.game.currentLevel.realheight));return b},clearTile:function(a,b){for(var c=this.mapLayers.length;c--;)this.mapLayers[c]instanceof me.TMXLayer&&this.mapLayers[c].clearTile(a,b)}})})(window);
(function(){function a(){return{tmxDoc:null,setData:function(a){this.tmxDoc=a},getFirstElementByTagName:function(a){return this.tmxDoc?this.tmxDoc.getElementsByTagName(a)[0]:null},getAllTagElements:function(){return this.tmxDoc?this.tmxDoc.getElementsByTagName("*"):null},getStringAttribute:function(a,b,c){return(a=a.getAttribute(b))?a.trim():c},getIntAttribute:function(a,b,c){return(a=this.getStringAttribute(a,b,c))?parseInt(a):c},getFloatAttribute:function(a,b,c){return(a=this.getStringAttribute(a,
b,c))?parseFloat(a):c},getBooleanAttribute:function(a,b,c){return(a=this.getStringAttribute(a,b,c))?"true"==a:c},free:function(){this.tmxDoc=null}}}me.TMXMapReader=Object.extend({XMLReader:null,JSONReader:null,TMXParser:null,readMap:function(a){if(!a.initialized){"xml"===me.loader.getTMXFormat(a.levelId)?(null===this.XMLReader&&(this.XMLReader=new b),this.TMXParser=this.XMLReader.TMXParser,this.XMLReader.readXMLMap(a,me.loader.getTMX(a.levelId))):(null===this.JSONReader&&(this.JSONReader=new c),this.JSONReader.readJSONMap(a,
me.loader.getTMX(a.levelId)));if(a.realwidth<me.game.viewport.width||a.realheight<me.game.viewport.height){var e=~~((me.game.viewport.width-a.realwidth)/2),f=~~((me.game.viewport.height-a.realheight)/2);a.pos.add({x:0<e?e:0,y:0<f?f:0})}a.initialized=!0}},getNewDefaultRenderer:function(a){switch(a.orientation){case "orthogonal":return new me.TMXOrthogonalRenderer(a.width,a.height,a.tilewidth,a.tileheight);case "isometric":return new me.TMXIsometricRenderer(a.width,a.height,a.tilewidth,a.tileheight);
default:throw"melonJS: "+a.orientation+" type TMX Tile Map not supported!";}},setLayerData:function(a,b,c,g){a.initArray(a.width,a.height);switch(g){case null:switch(c){case null:b=b.getElementsByTagName(me.TMX_TAG_TILE);break;case "json":break;case me.TMX_TAG_CSV:case me.TMX_TAG_ATTR_BASE64:for(var g="",h=0,i=b.childNodes.length;h<i;h++)g+=b.childNodes[h].nodeValue;b=c==me.TMX_TAG_ATTR_BASE64?me.utils.decodeBase64AsArray(g,4):me.utils.decodeCSV(g,a.width);break;default:throw"melonJS: TMX Tile Map "+
c+" encoding not supported!";}break;default:throw"melonJS: "+g+" compressed TMX Tile Map not supported!";}for(h=g=0;h<a.height;h++)for(i=0;i<a.width;i++){var j=null==c?this.TMXParser.getIntAttribute(b[g++],me.TMX_TAG_GID):b[g++];0!==j&&(j=new me.Tile(i,h,a.tilewidth,a.tileheight,j),a.layerData[i][h]=j,a.tileset.contains(j.tileId)||(a.tileset=a.tilesets.getTilesetByGid(j.tileId)),a.visible&&a.preRender&&a.renderer.drawTile(a.layerSurface,i,h,j,a.tileset))}}});var b=me.TMXMapReader.extend({TMXParser:null,
init:function(){this.TMXParser||(this.TMXParser=new a)},readXMLMap:function(a,b){if(!b)throw"melonJS:"+a.levelId+" TMX map not found";var c=0;this.TMXParser.setData(b);for(var g=this.TMXParser.getAllTagElements(),h=0;h<g.length;h++)switch(g.item(h).nodeName){case me.TMX_TAG_MAP:var i=g.item(h);a.version=this.TMXParser.getStringAttribute(i,me.TMX_TAG_VERSION);a.orientation=this.TMXParser.getStringAttribute(i,me.TMX_TAG_ORIENTATION);a.width=this.TMXParser.getIntAttribute(i,me.TMX_TAG_WIDTH);a.height=
this.TMXParser.getIntAttribute(i,me.TMX_TAG_HEIGHT);a.tilewidth=this.TMXParser.getIntAttribute(i,me.TMX_TAG_TILEWIDTH);a.tileheight=this.TMXParser.getIntAttribute(i,me.TMX_TAG_TILEHEIGHT);a.realwidth=a.width*a.tilewidth;a.realheight=a.height*a.tileheight;a.backgroundcolor=this.TMXParser.getStringAttribute(i,me.TMX_BACKGROUND_COLOR);a.z=c++;me.TMXUtils.applyTMXPropertiesFromXML(a,i);a.background_color=a.backgroundcolor?a.backgroundcolor:a.background_color;a.background_color&&a.mapLayers.push(new me.ColorLayer("background_color",
a.background_color,c++));a.background_image&&a.mapLayers.push(new me.ImageLayer("background_image",a.width,a.height,a.background_image,c++));if(null===me.game.renderer||!me.game.renderer.canRender(a))me.game.renderer=this.getNewDefaultRenderer(a);break;case me.TMX_TAG_TILESET:a.tilesets||(a.tilesets=new me.TMXTilesetGroup);a.tilesets.add(this.readTileset(g.item(h)));break;case me.TMX_TAG_IMAGE_LAYER:a.mapLayers.push(this.readImageLayer(a,g.item(h),c++));break;case me.TMX_TAG_LAYER:a.mapLayers.push(this.readLayer(a,
g.item(h),c++));break;case me.TMX_TAG_OBJECTGROUP:a.objectGroups.push(this.readObjectGroup(a,g.item(h),c++))}this.TMXParser.free()},readLayer:function(a,b,c){a=new me.TMXLayer(a.tilewidth,a.tileheight,a.orientation,a.tilesets,c);a.initFromXML(b);var b=b.getElementsByTagName(me.TMX_TAG_DATA)[0],c=this.TMXParser.getStringAttribute(b,me.TMX_TAG_ENCODING,null),g=this.TMXParser.getStringAttribute(b,me.TMX_TAG_COMPRESSION,null);""==c&&(c=null);""==g&&(g=null);a.isCollisionMap||(me.game.renderer.canRender(a)?
a.setRenderer(me.game.renderer):a.setRenderer(me.mapReader.getNewDefaultRenderer(a)));this.setLayerData(a,b,c,g);return a},readImageLayer:function(a,b,c){var g=this.TMXParser.getStringAttribute(b,me.TMX_TAG_NAME),h=this.TMXParser.getIntAttribute(b,me.TMX_TAG_WIDTH),i=this.TMXParser.getIntAttribute(b,me.TMX_TAG_HEIGHT),j=b.getElementsByTagName(me.TMX_TAG_IMAGE)[0].getAttribute(me.TMX_TAG_SOURCE),a=new me.ImageLayer(g,h*a.tilewidth,i*a.tileheight,j,c);a.visible=1==this.TMXParser.getIntAttribute(b,me.TMX_TAG_VISIBLE,
1);a.opacity=this.TMXParser.getFloatAttribute(b,me.TMX_TAG_OPACITY,1);me.TMXUtils.applyTMXPropertiesFromXML(a,b);return a},readTileset:function(a){var b=new me.TMXTileset;b.initFromXML(a);return b},readObjectGroup:function(a,b,c){var g=this.TMXParser.getStringAttribute(b,me.TMX_TAG_NAME),h=new me.TMXOBjectGroup;h.initFromXML(g,b,a.tilesets,c);return h}}),c=me.TMXMapReader.extend({readJSONMap:function(a,b){if(!b)throw"melonJS:"+a.levelId+" TMX map not found";var c=0,g=this;a.version=b[me.TMX_TAG_VERSION];
a.orientation=b[me.TMX_TAG_ORIENTATION];a.width=parseInt(b[me.TMX_TAG_WIDTH]);a.height=parseInt(b[me.TMX_TAG_HEIGHT]);a.tilewidth=parseInt(b[me.TMX_TAG_TILEWIDTH]);a.tileheight=parseInt(b[me.TMX_TAG_TILEHEIGHT]);a.realwidth=a.width*a.tilewidth;a.realheight=a.height*a.tileheight;a.backgroundcolor=b[me.TMX_BACKGROUND_COLOR];a.z=c++;me.TMXUtils.applyTMXPropertiesFromJSON(a,b);a.background_color=a.backgroundcolor?a.backgroundcolor:a.background_color;a.background_color&&a.mapLayers.push(new me.ColorLayer("background_color",
a.background_color,c++));a.background_image&&a.mapLayers.push(new me.ImageLayer("background_image",a.width,a.height,a.background_image,c++));if(null===me.game.renderer||!me.game.renderer.canRender(a))me.game.renderer=this.getNewDefaultRenderer(a);a.tilesets||(a.tilesets=new me.TMXTilesetGroup);b.tilesets.forEach(function(b){a.tilesets.add(g.readTileset(b))});b.layers.forEach(function(b){switch(b.type){case me.TMX_TAG_IMAGE_LAYER:a.mapLayers.push(g.readImageLayer(a,b,c++));break;case me.TMX_TAG_TILE_LAYER:a.mapLayers.push(g.readLayer(a,
b,c++));break;case me.TMX_TAG_OBJECTGROUP:a.objectGroups.push(g.readObjectGroup(a,b,c++))}})},readLayer:function(a,b,c){a=new me.TMXLayer(a.tilewidth,a.tileheight,a.orientation,a.tilesets,c);a.initFromJSON(b);a.isCollisionMap||(me.game.renderer.canRender(a)?a.setRenderer(me.game.renderer):a.setRenderer(me.mapReader.getNewDefaultRenderer(a)));this.setLayerData(a,b[me.TMX_TAG_DATA],"json",null);return a},readImageLayer:function(a,b,c){var g=b[me.TMX_TAG_NAME],h=parseInt(b[me.TMX_TAG_WIDTH]),i=parseInt(b[me.TMX_TAG_HEIGHT]),
a=new me.ImageLayer(g,h*a.tilewidth,i*a.tileheight,b[me.TMX_TAG_IMAGE],c);a.visible=b[me.TMX_TAG_VISIBLE];a.opacity=parseFloat(b[me.TMX_TAG_OPACITY]);me.TMXUtils.applyTMXPropertiesFromJSON(a,b);a.ratio=parseFloat(a.ratio);return a},readTileset:function(a){var b=new me.TMXTileset;b.initFromJSON(a);return b},readObjectGroup:function(a,b,c){var g=new me.TMXOBjectGroup;g.initFromJSON(b[me.TMX_TAG_NAME],b,a.tilesets,c);return g}})})(window);
(function(){var a=me,b={},c={},d=[],e=0;b.reset=function(){};b.addLevel=function(){throw"melonJS: no level loader defined";};b.addTMXLevel=function(a,b){if(null==c[a])c[a]=new me.TMXTileMap(a,0,0),c[a].name=a,d[d.length]=a;else return!1;b&&b();return!0};b.loadLevel=function(a){a=a.toString().toLowerCase();if(void 0===c[a])throw"melonJS: level "+a+" not found";if(c[a]instanceof me.TMXTileMap){var g=me.state.isRunning();g&&me.state.pause();me.game.reset();me.utils.resetGUID(a);c[b.getCurrentLevelId()]&&
c[b.getCurrentLevelId()].reset();me.mapReader.readMap(c[a]);e=d.indexOf(a);me.game.loadTMXLevel(c[a]);g&&me.state.resume()}else throw"melonJS: no level loader defined";return!0};b.getCurrentLevelId=function(){return d[e]};b.reloadLevel=function(){return b.loadLevel(b.getCurrentLevelId())};b.nextLevel=function(){return e+1<d.length?b.loadLevel(d[e+1]):!1};b.previousLevel=function(){return 0<=e-1?b.loadLevel(d[e-1]):!1};b.levelCount=function(){return d.length};a.levelDirector=b})(window);
(function(){me.Tween=function(a){var b={},c={},d={},e=1E3,f=0,g=null,h=0,i=me.Tween.Easing.Linear.EaseNone,j=null,k=null,n=null;this.to=function(b,c){void 0!==c&&(e=c);for(var f in b)null!==a[f]&&(d[f]=b[f]);return this};this.start=function(){me.game.add(this,999);g=me.timer.getTime()+f;h=0;for(var e in d)null!==a[e]&&(b[e]=a[e],c[e]=d[e]-a[e]);return this};this.stop=function(){me.game.remove(this);return this};this.delay=function(a){f=a;return this};me.event.subscribe(me.event.STATE_PAUSE,function(){g&&
(h=me.timer.getTime())});me.event.subscribe(me.event.STATE_RESUME,function(){g&&h&&(g+=me.timer.getTime()-h)});this.easing=function(a){i=a;return this};this.chain=function(a){j=a;return this};this.onUpdate=function(a){k=a;return this};this.onComplete=function(a){n=a;return this};this.update=function(){var d,f,h;f=me.timer.getTime();if(f<g)return!0;if(1<=(f=(f-g)/e))f=1;h=i(f);for(d in c)a[d]=b[d]+c[d]*h;null!==k&&k.call(a,h);return 1===f?(me.game.remove(this),null!==n&&n.call(a),null!==j&&j.start(),
!1):!0};this.destroy=function(){return!0}};me.Tween.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}};me.Tween.Easing.Linear.EaseNone=function(a){return a};me.Tween.Easing.Quadratic.EaseIn=function(a){return a*a};me.Tween.Easing.Quadratic.EaseOut=function(a){return a*(2-a)};me.Tween.Easing.Quadratic.EaseInOut=function(a){return 1>(a*=2)?0.5*a*a:-0.5*(--a*(a-2)-1)};me.Tween.Easing.Cubic.EaseIn=function(a){return a*a*
a};me.Tween.Easing.Cubic.EaseOut=function(a){return--a*a*a+1};me.Tween.Easing.Cubic.EaseInOut=function(a){return 1>(a*=2)?0.5*a*a*a:0.5*((a-=2)*a*a+2)};me.Tween.Easing.Quartic.EaseIn=function(a){return a*a*a*a};me.Tween.Easing.Quartic.EaseOut=function(a){return 1- --a*a*a*a};me.Tween.Easing.Quartic.EaseInOut=function(a){return 1>(a*=2)?0.5*a*a*a*a:-0.5*((a-=2)*a*a*a-2)};me.Tween.Easing.Quintic.EaseIn=function(a){return a*a*a*a*a};me.Tween.Easing.Quintic.EaseOut=function(a){return--a*a*a*a*a+1};me.Tween.Easing.Quintic.EaseInOut=
function(a){return 1>(a*=2)?0.5*a*a*a*a*a:0.5*((a-=2)*a*a*a*a+2)};me.Tween.Easing.Sinusoidal.EaseIn=function(a){return 1-Math.cos(a*Math.PI/2)};me.Tween.Easing.Sinusoidal.EaseOut=function(a){return Math.sin(a*Math.PI/2)};me.Tween.Easing.Sinusoidal.EaseInOut=function(a){return 0.5*(1-Math.cos(Math.PI*a))};me.Tween.Easing.Exponential.EaseIn=function(a){return 0===a?0:Math.pow(1024,a-1)};me.Tween.Easing.Exponential.EaseOut=function(a){return 1===a?1:1-Math.pow(2,-10*a)};me.Tween.Easing.Exponential.EaseInOut=
function(a){return 0===a?0:1===a?1:1>(a*=2)?0.5*Math.pow(1024,a-1):0.5*(-Math.pow(2,-10*(a-1))+2)};me.Tween.Easing.Circular.EaseIn=function(a){return 1-Math.sqrt(1-a*a)};me.Tween.Easing.Circular.EaseOut=function(a){return Math.sqrt(1- --a*a)};me.Tween.Easing.Circular.EaseInOut=function(a){return 1>(a*=2)?-0.5*(Math.sqrt(1-a*a)-1):0.5*(Math.sqrt(1-(a-=2)*a)+1)};me.Tween.Easing.Elastic.EaseIn=function(a){var b,c=0.1;if(0===a)return 0;if(1===a)return 1;!c||1>c?(c=1,b=0.1):b=0.4*Math.asin(1/c)/(2*Math.PI);
return-(c*Math.pow(2,10*(a-=1))*Math.sin((a-b)*2*Math.PI/0.4))};me.Tween.Easing.Elastic.EaseOut=function(a){var b,c=0.1;if(0===a)return 0;if(1===a)return 1;!c||1>c?(c=1,b=0.1):b=0.4*Math.asin(1/c)/(2*Math.PI);return c*Math.pow(2,-10*a)*Math.sin((a-b)*2*Math.PI/0.4)+1};me.Tween.Easing.Elastic.EaseInOut=function(a){var b,c=0.1;if(0===a)return 0;if(1===a)return 1;!c||1>c?(c=1,b=0.1):b=0.4*Math.asin(1/c)/(2*Math.PI);return 1>(a*=2)?-0.5*c*Math.pow(2,10*(a-=1))*Math.sin((a-b)*2*Math.PI/0.4):0.5*c*Math.pow(2,
-10*(a-=1))*Math.sin((a-b)*2*Math.PI/0.4)+1};me.Tween.Easing.Back.EaseIn=function(a){return a*a*(2.70158*a-1.70158)};me.Tween.Easing.Back.EaseOut=function(a){return--a*a*(2.70158*a+1.70158)+1};me.Tween.Easing.Back.EaseInOut=function(a){return 1>(a*=2)?0.5*a*a*(3.5949095*a-2.5949095):0.5*((a-=2)*a*(3.5949095*a+2.5949095)+2)};me.Tween.Easing.Bounce.EaseIn=function(a){return 1-me.Tween.Easing.Bounce.EaseOut(1-a)};me.Tween.Easing.Bounce.EaseOut=function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=
1.5/2.75)*a+0.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+0.9375:7.5625*(a-=2.625/2.75)*a+0.984375};me.Tween.Easing.Bounce.EaseInOut=function(a){return 0.5>a?0.5*me.Tween.Easing.Bounce.EaseIn(2*a):0.5*me.Tween.Easing.Bounce.EaseOut(2*a-1)+0.5}})();
(function(){var a=me,b={},c={};b.STATE_PAUSE="me.state.onPause";b.STATE_RESUME="me.state.onResume";b.GAME_INIT="me.game.onInit";b.LEVEL_LOADED="me.game.onLevelLoaded";b.LOADER_COMPLETE="me.loader.onload";b.LOADER_PROGRESS="me.loader.onProgress";b.KEYDOWN="me.input.keydown";b.KEYUP="me.input.keyup";b.WINDOW_ONRESIZE="window.onresize";b.publish=function(a,b){for(var f=c[a],g=f?f.length:0;g--;)f[g].apply(window,b||[])};b.subscribe=function(a,b){c[a]||(c[a]=[]);c[a].push(b);return[a,b]};b.unsubscribe=
function(a,b){for(var f=c[b?a:a[0]],b=b||a[1],g=f?f.length:0;g--;)f[g]===b&&f.splice(g,1)};a.event=b})();
(function(){var a=me,b={};b.Base=Object.extend({version:void 0,init:function(){}});b.patch=function(a,b,e){void 0!==a.prototype&&(a=a.prototype);if("function"==typeof a[b]){var f=a[b];a[b]=function(){var a=this.parent;this.parent=f;var b=e.apply(this,arguments);this.parent=a;return b}}else console.error(b+" is not an existing function")};b.register=function(a,b){me.plugin[b]&&console.error("plugin "+b+" already registered");if(void 0===a.prototype.version)throw"melonJS: Plugin version not defined !";
if(0<me.sys.checkVersion(a.prototype.version))throw"melonJS: Plugin version mismatch, expected: "+a.prototype.version+", got: "+me.version;var e=[];2<arguments.length&&(e=Array.prototype.slice.call(arguments,1));e[0]=a;me.plugin[b]=new (a.bind.apply(a,e));if(!(me.plugin[b]instanceof me.plugin.Base))throw"melonJS: Plugin should extend the me.plugin.Base Class !";};a.plugin=b})();(function(a){if(!a)throw"Load melongJS first, please.";var b=function(){h==g?c.onload?(clearTimeout(i),setTimeout(function(){c.onload();a.event.publish(a.event.LOADER_COMPLETE)},300)):console.error("no load callback defined"):i=setTimeout(b,100)},c={},d={},e={},f={},g=0,h=0,i=0;c.onload=void 0;c.onProgress=void 0;c.onResourceLoaded=function(){h++;var b=c.getLoadProgress();if(c.onProgress)c.onProgress(b);a.event.publish(a.event.LOADER_PROGRESS,[b])};c.onLoadingError=function(a){throw"melonJS: Failed loading resource "+
a.src;};c.preload=function(a){g+=a.length;a=[].concat(a);console.log("####preload");c.loadNext(a,function(){console.log("resource has loaded",d)});b()};c.loadNext=function(a,b){if(0===a.length)b();else{var d=a.shift(),e=c.onResourceLoaded.bind(c),f=c.onLoadingError.bind(c,d);c.load(d,function(){e();setTimeout(function(){c.loadNext(a,b)},100)},f)}};c.load=function(b,c,g){b.name=b.name.toLowerCase();switch(b.type){case "binary":var h=new XMLHttpRequest;h.open("GET",b.src+a.nocache,!1);h.responseType=
"arraybuffer";h.onerror=g;h.onload=function(){var a=h.response;if(a){var a=new Uint8Array(a),d=[];f[b.name]=new dataType;for(var e=0;e<a.byteLength;e++)d[e]=String.fromCharCode(a[e]);f[b.name].data=d.join("");c()}};h.send();return 1;case "image":return d[b.name]=new Image,d[b.name].onload=function(){c()},d[b.name].onerror=g,d[b.name].src=b.src+a.nocache,1;case "tmx":case "tsx":var i=new XMLHttpRequest,q=a.utils.getFileExtension(b.src).toLowerCase();i.overrideMimeType&&("json"===q?i.overrideMimeType("application/json"):
i.overrideMimeType("text/xml"));i.open("GET",b.src+a.nocache,!0);i.ontimeout=g;i.onreadystatechange=function(){if(4==i.readyState)if(200==i.status||0==i.status&&i.responseText){var d=null;switch(q){case "xml":case "tmx":d=a.sys.ua.contains("msie")||!i.responseXML?(new DOMParser).parseFromString(i.responseText,"text/xml"):i.responseXML;q="xml";break;case "json":d=JSON.parse(i.responseText);break;default:throw"melonJS: TMX file format "+q+"not supported !";}e[b.name]={data:d,isTMX:"tmx"===b.type,format:q};
"tmx"===b.type&&a.levelDirector.addTMXLevel(b.name);c()}else g()};i.send(null);return 1;case "audio":if(a.audio.isAudioEnable())return a.audio.load(b,c,g),1;break;default:throw"melonJS: me.loader.load : unknown or invalid resource type : "+b.type;}return 0};c.unload=function(b){b.name=b.name.toLowerCase();switch(b.type){case "binary":if(!(b.name in f))return!1;delete f[b.name];return!0;case "image":if(!(b.name in d))return!1;delete d[b.name];return!0;case "tmx":case "tsx":if(!(b.name in e))return!1;
delete e[b.name];return!0;case "audio":return a.audio.unload(b.name);default:throw"melonJS: me.loader.unload : unknown or invalid resource type : "+b.type;}};c.unloadArray=function(a){for(var b=0,e=a.length;b<e;b++)c.unload(a[b]);console.log("rest resources: ",d)};c.unloadAll=function(){for(var b in f)c.unload(b);for(b in d)c.unload(b);for(b in e)c.unload(b);a.audio.unloadAll()};c.getTMXFormat=function(a){a=a.toLowerCase();return a in e?e[a].format:null};c.getTMX=function(a){a=a.toLowerCase();return a in
e?e[a].data:null};c.getBinary=function(a){a=a.toLowerCase();return a in f?f[a]:null};c.getImage=function(b){b=b.toLowerCase();if(b in d){if(!0===a.sys.cacheImage){var c=a.video.createCanvasSurface(d[b].width,d[b].height);c.drawImage(d[b],0,0);return c.canvas}c=d[b];if(!(c instanceof Image)){var c=new Image,e=d[b];c.src=e.src;c.width=e.width;c.height=e.height;d[b]=c}return c}throw Error(b+" resource not yet loaded!");};c.getLoadProgress=function(){return h/g};c.getImages=function(){return d};a.loader=
c})(me);(function(a){a.video.createCanvas=function(a,c){var d=document.createElement("canvas");d.width=a||backBufferCanvas.width;d.height=c||backBufferCanvas.height;return d}})(me);(function(){me.ComplexSprite=me.Renderable.extend({fpscount:0,spacing:0,margin:0,animationpause:!1,init:function(a,b,c,d){this.resetAnim=null;this.spriteData=sprite_json[c];this.parent(new me.Vector2d(a,b),this.spriteData.spritewidth,this.spriteData.spriteheight);this.visible=this.isSprite=!0;this.image=me.loader.getImage(c);this.currentAnimation=this.defaultAnimation=d;this.current=this.spriteData[this.currentAnimation];this.current.idx=0;this.current.name=d;this.anchorPoint=new me.Vector2d(0.5,
0.5);this.fpscount=0;this.current.animationspeed=this.animationspeed=3;this.animationListeners={}},addAnimationListener:function(a,b,c){this.animationListeners[a+b]=this.animationListeners[a+b]||{};this.animationListeners[a+b].push(c)},setCurrentAnimation:function(a,b,c){if(this.spriteData[a])this.current=this.spriteData[a],this.current.idx=0,this.current.name=a,this.current.animationspeed=c||this.animationspeed,this.currentAnimation=a,this.resetAnim=b||null,this.setAnimationFrame(this.current.idx);
else throw"wozlla: animationid '"+a+"' not defined";},setAnimationFrame:function(a){this.current.idx=(a||0)%this.current.length},getCurrentAnimationFrame:function(){return this.current.idx},isCurrentAnimation:function(a){return this.current.name==a},fireAnimationChange:function(){var a=this.animationListeners[this.currentAnimation+this.current.idx];if(a)for(var b=0,c=a.length;b<c;b++)a[b]()},update:function(){return this.visible&&!this.animationpause&&this.fpscount++>this.current.animationspeed?(this.fpscount=
0,this.setAnimationFrame(++this.current.idx),this.fireAnimationChange(),0==this.current.idx&&this.resetAnim&&("string"==typeof this.resetAnim?this.setCurrentAnimation(this.resetAnim):"function"==typeof this.resetAnim&&this.resetAnim()),!0):!1},draw:function(a){var b=this.current[this.current.idx];a.save();a.translate(this.pos.x,this.pos.y+0.2*b.h);a.drawImage(this.image,b.x,b.y,b.w,b.h,b.ox,b.oy,b.w,b.h);a.restore()},destroy:function(){this.onDestroyEvent.apply(this,arguments)},onDestroyEvent:function(){}})})();var astar={init:function(a){for(var b=0,c=a.length;b<c;b++)for(var d=0,e=a[b].length;d<e;d++){var f=a[b][d];f.f=0;f.g=0;f.h=0;f.cost=f.type;f.visited=!1;f.closed=!1;f.parent=null}},heap:function(){return new BinaryHeap(function(a){return a.f})},search:function(a,b,c,d,e){astar.init(a);var e=e||astar.manhattan,d=!!d,f=astar.heap();for(f.push(b);0<f.size();){b=f.pop();if(b===c){a=b;for(c=[];a.parent;)c.push(a),a=a.parent;return c.reverse()}b.closed=!0;for(var g=astar.neighbors(a,b,d),h=0,i=g.length;h<
i;h++){var j=g[h];if(!j.closed&&!j.isWall()){var k=b.g+j.cost,n=j.visited;if(!n||k<j.g)j.visited=!0,j.parent=b,j.h=j.h||e(j.pos,c.pos),j.g=k,j.f=j.g+j.h,n?f.rescoreElement(j):f.push(j)}}}return[]},manhattan:function(a,b){var c=Math.abs(b.x-a.x),d=Math.abs(b.y-a.y);return c+d},neighbors:function(a,b,c){var d=[],e=b.x,b=b.y;a[e-1]&&a[e-1][b]&&d.push(a[e-1][b]);a[e+1]&&a[e+1][b]&&d.push(a[e+1][b]);a[e]&&a[e][b-1]&&d.push(a[e][b-1]);a[e]&&a[e][b+1]&&d.push(a[e][b+1]);c&&(a[e-1]&&a[e-1][b-1]&&d.push(a[e-
1][b-1]),a[e+1]&&a[e+1][b-1]&&d.push(a[e+1][b-1]),a[e-1]&&a[e-1][b+1]&&d.push(a[e-1][b+1]),a[e+1]&&a[e+1][b+1]&&d.push(a[e+1][b+1]));return d}};var GraphNodeType={OPEN:1,WALL:0};function Graph(a){for(var b=[],c=0;c<a.length;c++){b[c]=[];for(var d=0,e=a[c];d<e.length;d++)b[c][d]=new GraphNode(c,d,e[d])}this.input=a;this.nodes=b}Graph.prototype.toString=function(){for(var a="\n",b=this.nodes,c,d,e,f,g=0,h=b.length;g<h;g++){c="";d=b[g];e=0;for(f=d.length;e<f;e++)c+=d[e].type+" ";a=a+c+"\n"}return a};function GraphNode(a,b,c){this.data={};this.x=a;this.y=b;this.pos={x:a,y:b};this.type=c}
GraphNode.prototype.toString=function(){return"["+this.x+" "+this.y+"]"};GraphNode.prototype.isWall=function(){return this.type==GraphNodeType.WALL};function BinaryHeap(a){this.content=[];this.scoreFunction=a}
BinaryHeap.prototype={push:function(a){this.content.push(a);this.sinkDown(this.content.length-1)},pop:function(){var a=this.content[0],b=this.content.pop();0<this.content.length&&(this.content[0]=b,this.bubbleUp(0));return a},remove:function(a){var b=this.content.indexOf(a),c=this.content.pop();b!==this.content.length-1&&(this.content[b]=c,this.scoreFunction(c)<this.scoreFunction(a)?this.sinkDown(b):this.bubbleUp(b))},size:function(){return this.content.length},rescoreElement:function(a){this.sinkDown(this.content.indexOf(a))},
sinkDown:function(a){for(var b=this.content[a];0<a;){var c=(a+1>>1)-1,d=this.content[c];if(this.scoreFunction(b)<this.scoreFunction(d))this.content[c]=b,this.content[a]=d,a=c;else break}},bubbleUp:function(a){for(var b=this.content.length,c=this.content[a],d=this.scoreFunction(c);;){var e=a+1<<1,f=e-1,g=null;if(f<b){var h=this.scoreFunction(this.content[f]);h<d&&(g=f)}if(e<b&&this.scoreFunction(this.content[e])<(null===g?d:h))g=e;if(null!==g)this.content[a]=this.content[g],this.content[g]=c,a=g;else break}}};function addPlayer(a){console.log("addPlayer");a.characterId=1;me.ObjectSettings.spritewidth=g_config.character[a.characterId].width;me.ObjectSettings.spriteheight=g_config.character[a.characterId].height;me.ObjectSettings.image="character"+g_config.character[a.characterId].id;btg.otherPlayers[a.id]=new btg.CharacterBase(a.x,a.y,me.ObjectSettings);btg.otherPlayers[a.id].z=btg.map.playerLayerZ;btg.otherPlayers[a.id].renderable.setCurrentAnimation("stand-down");me.game.add(btg.otherPlayers[a.id],btg.map.playerLayerZ);
me.game.sort()}function mouseDown(){}function mouseMove(){var a=me.game.viewport.pos.y+me.input.mouse.pos.y;parseInt(me.game.viewport.pos.x+me.input.mouse.pos.x);parseInt(a);btg.debug&&(1==btg.map.findPathMethod?drawPath():drawPathByIsometric())}
function mouseUp(a,b){console.log("mouseUp");parseInt(a)!=a&&(b=a=null);var c=me.game.viewport.pos.y+(b||me.input.mouse.pos.y),c={x:parseInt(me.game.viewport.pos.x+(a||me.input.mouse.pos.x)),y:parseInt(c)};try{findPath(c)}catch(d){console.log("warn: "+d.message)}return!0}
function findPath(a){console.log("btg.mainPlayer.pos.x"+btg.mainPlayer.pos.x);var b={x:parseInt(btg.mainPlayer.pos.x+btg.mainPlayer.width/2),y:parseInt(btg.mainPlayer.pos.y+100)},a=btg.pathSearcher.searchPixelCoordsPath(b,a);btg.mainPlayer.moveByPath(a);return!0}
function drawPath(){if(btg.debug){var a=getOrthogonalPosition();currentPosition=btg.map.graph.nodes[a.currentPosition.x][a.currentPosition.y];gotoPosition=btg.map.graph.nodes[a.gotoPosition.x][a.gotoPosition.y];a=astar.search(btg.map.graph.nodes,currentPosition,gotoPosition,!0);me.game.HUD.removeItem("rect");me.game.HUD.addItem("rect",new btg.ui.rect(me.input.mouse.pos.x,me.input.mouse.pos.y,94,91,a,1))}}
function drawPathByIsometric(){if(btg.debug){var a={x:me.game.viewport.pos.x+me.input.mouse.pos.x,y:me.game.viewport.pos.y+me.input.mouse.pos.y},b={x:btg.mainPlayer.pos.x+btg.mainPlayer.width/2,y:btg.mainPlayer.pos.y+100},c=g_config.map.level[btg.game.currentLevel].polygonData;if(a=c?btg.navMeshPathSearcher.searchPath(c,b,a):[{x:x,y:y}])a.unshift(b),me.game.HUD.removeItem("path"),me.game.HUD.addItem("path",new btg.ui.path(0,0,a))}}function debug(a){btg.debug&&console.log(a)};var g_config=window.g_config||{};
g_config.character=[{id:0,name:"\u5973\u4e3b\u89d2",width:80,height:114,fWidth:80,fHeight:87,fLWidth:121,fLHeight:113,fRWidth:89,fRHeight:104,standDown:[0,1,2,3,4,5],standLeft:[72,73,74,75,76,77],standUp:[6,7,8,9,10,11],standRight:[78,79,80,81,82,83],standLeftDown:[30,31,32,33,34,35],standLeftUp:[24,25,26,27,28,29],standRightUp:[12,13,14,15,16,17],standRightDown:[18,19,20,21,22,23],down:[42,43,44,45,46,47],left:[90,91,92,93,94,95],up:[36,37,38,39,40,41],right:[84,85,86,87,88,89],leftDown:[66,67,68,
69,70,71],leftUp:[60,61,62,63,64,65],rightUp:[48,49,50,51,52,53],rightDown:[54,55,56,57,58,59],fAttack:[0,1,2,3,4,5,6,7,8,9,10,11],fDeath:[12,13,14,15,16,17,18,19,20,21,22,23],fDefense:[24,25,26,27,28,19,30,31,32,33,34,35],fHit:[36,37,38,39,40,41,42,43,44,45,46,47],fReturn:[48,49,50,51,52,53,54,55,56,57,58,59],fRevival:[60,61,62,63,64,65,66,67,68,69,70,71],fSkill:[72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95],fStand:[96,97,98,99,100,101,102,103,104,105,106,107]},{id:1,name:"\u7537\u4e3b\u89d2",
width:80,height:114,fWidth:80,fHeight:114,fLWidth:173,fLHeight:175,fRWidth:167,fRHeight:175,standDown:[0,1,2,3,4,5],standLeft:[72,73,74,75,76,77],standUp:[6,7,8,9,10,11],standRight:[78,79,80,81,82,83],standLeftDown:[30,31,32,33,34,35],standLeftUp:[24,25,26,27,28,29],standRightUp:[12,13,14,15,16,17],standRightDown:[18,19,20,21,22,23],down:[42,43,44,45,46,47],left:[90,91,92,93,94,95],up:[36,37,38,39,40,41],right:[84,85,86,87,88,89],leftDown:[66,67,68,69,70,71],leftUp:[60,61,62,63,64,65],rightUp:[48,
49,50,51,52,53],rightDown:[54,55,56,57,58,59],fAttack:[0,1,2,3,4,5,6,7,8,9,10],fDeath:[12,13,14,15,16,17,18,19,20,21,22,23],fDefense:[24,25,26,27,28,19,30,31,32,33,34,35],fHit:[36,37,38,39,40,41,42,43,44,45,46,47],fReturn:[48,49,50,51,52,53,54,55,56,57,58,59],fRevival:[60,61,62,63,64,65,66,67,68,69,70,71],fSkill:[72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95],fStand:[96,97,98,99,100,101,102,103,104,105,106,107],frames:{fStand:{num:24},fAttack:{num:24,start:11,finish:16,hit:16},
fReturn:{num:12,start:5,finish:17},fDefense:{num:24,dodge:9},fHit:{num:12,hit:2},fDeath:{num:24,hit:2},fRevival:{num:24},fSkill:{num:48,start:17,finish:30,hit:34,returnStart:34,returnFinish:40}}},{id:2},{id:3},{id:4},{id:5},{id:6},{id:7},{id:8},{id:9},{id:10},{id:11},{id:12},{id:13},{id:14},{id:15},{id:16},{id:17},{id:18},{id:19},{id:20,name:"\u5be8\u4e3b",width:118,height:136,paddingLeft:0,standLeftDown:[0,1,2,3,4,5],shakeLeftDown:[6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],standRightDown:[21,22,
23,24,25,26],shakeRightDown:[27,28,29,30,31,32,33,34,35,36,37,38,39,40,41]},{id:21,name:"\u5c0f\u54e5",width:104,height:140,paddingLeft:-13,standLeftDown:[0,1,2,3,4,5],shakeLeftDown:[6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],standRightDown:[21,22,23,24,25,26],shakeRightDown:[27,28,29,30,31,32,33,34,35,36,37,38,39,40,41]},{id:22,name:"\u9f9f\u4ed9\u4eba",width:80,height:117,paddingLeft:0,standLeftDown:[0,1,2,3,4,5],shakeLeftDown:[6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],standRightDown:[21,22,23,24,
25,26],shakeRightDown:[27,28,29,30,31,32,33,34,35,36,37,38,39,40,41]},{id:23,name:"\u732a",width:200,height:200,fWidth:100,fHeight:120,fLWidth:173,fLHeight:175,fRWidth:200,fRHeight:200,paddingLeft:0}];g_config.character[10101]=g_config.character[20];g_config.character[10102]=g_config.character[21];g_config.character[10201]=g_config.character[22];
g_config.levels={1:{level:1,exp:200},2:{level:2,exp:400},3:{level:3,exp:600},4:{level:4,exp:800},5:{level:5,exp:1E3},6:{level:6,exp:1200},7:{level:7,exp:1400},8:{level:8,exp:1600},9:{level:9,exp:1800},10:{level:10,exp:2E3},11:{level:11,exp:2200},12:{level:12,exp:2400},13:{level:13,exp:2600}};g_config=window.g_config||{};g_config.effects={fire_001:{width:192,height:192},fire_002:{width:192,height:192},skill_001:{width:409,height:409},chest_001:{width:67,height:85}};g_config=window.g_config||{};g_config.seaport={type:{CITY:"seaport0",ID:"seaport1",SEAMARKET:"seaport2",PRAY:"seaport3"}};g_config.taskType=["currentMainTask","currentBranchTask","currentDayTask","currentExerciseTask"];g_config.symbolType={QGOLD:"questionMark-gold",QGRAY:"questionMark-gray",EGOLD:"exclamationMark-gold",EGRAY:"exclamationMark-gray"};g_config=window.g_config||{};g_config.fight={fightState:{stand:"stand",attackGo:"attackGo",attackStop:"attackStop",attackHit:"attackHit",defenseBegin:"defenseBegin",defense:"defense",defenseEnd:"defenseEnd",defenseDodge:"defenseDodge",hitHit:"hitHit",deathHit:"deathHit",skillGo:"skillGo",skillStop:"skillStop",skillHit:"skillHit"},animationsName:{"f-attack":"Attack","f-death":"Death","f-defense":"Defense","f-hit":"Hit","f-return":"Return","f-revival":"Revival","f-skill":"Skill","f-stand":"Stand"}};g_config=window.g_config||{};g_config.formation={bg:{left:0,top:219,width:476,height:350,marginLeft:8,positionWidth:90,positionHeight:60},positions:{mainPlayer:[{x:234,y:167},{x:266,y:39},{x:408,y:114},{x:387,y:246},{x:200,y:304},{x:48,y:218},{x:90,y:87}],enemy:[{x:243,y:167},{x:210,y:39},{x:68,y:114},{x:89,y:246},{x:277,y:304},{x:428,y:218},{x:386,y:87}]}};
g_config.formationSingle={bg:{left:0,top:219,width:476,height:350,marginLeft:8,positionWidth:90,positionHeight:60},positions:{mainPlayer:[{x:285,y:418},{x:421,y:357},{x:460,y:458},{x:316,y:532},{x:147,y:482},{x:121,y:375},{x:257,y:311}],enemy:[{x:685,y:215},{x:547,y:185},{x:565,y:266},{x:712,y:299},{x:830,y:244},{x:795,y:162},{x:655,y:137}]}};g_config=window.g_config||{};
g_config.items={1E3:{itemId:1E3,name:"\u5e78\u8fd0\u6212\u6307",description:"\u5e78\u8fd0\u6212\u6307",itemType:100,attr:[{type:301,value:10},{type:302,value:10}],price:10,quality:1,pileNum:1,useEffectId:1,isBinding:1,canWarehouse:1,canDestroy:1,destroyTime:60,level:1,resId:1,canUse:1,needLevel:1,compose:"",useTip:"ok",needMaterial:""},1001:{itemId:1001,name:"\u5e78\u8fd0\u6000\u8868",description:"\u5e78\u8fd0\u6000\u8868",itemType:200,attr:[{type:301,value:10},{type:302,value:10}],price:10,quality:1,
pileNum:1,useEffectId:1,isBinding:1,canWarehouse:1,canDestroy:1,destroyTime:60,level:1,resId:1,canUse:1,needLevel:1,compose:"",useTip:"ok",needMaterial:""},1002:{itemId:1002,name:"\u5e78\u8fd0\u9879\u94fe",description:"\u5e78\u8fd0\u9879\u94fe",itemType:300,attr:[{type:301,value:10},{type:302,value:10}],price:10,quality:1,pileNum:1,useEffectId:1,isBinding:1,canWarehouse:1,canDestroy:1,destroyTime:60,level:1,resId:1,canUse:1,needLevel:1,compose:"",useTip:"ok",needMaterial:""},1003:{itemId:1003,name:"\u7075\u52a8\u5361\u7247",
description:"\u7075\u52a8\u5361\u7247",itemType:100,price:10,quality:1,pileNum:1,useEffectId:1,isBinding:1,canWarehouse:1,canDestroy:1,destroyTime:60,level:1,resId:1,canUse:1,needLevel:1,compose:"",useTip:"ok",needMaterial:""}};g_config=window.g_config||{};
g_config.map={level:[{id:0,npcs:[10101,10102,10201],fightSceneX:2700,fightSceneY:2E3,pos:{x:3E3,y:1600},mapData:[[0,2,3,4,5,0],[7,8,9,10,11,0],[0,0,15,0,0,0]],lands:{bg:1,landlayer_1:1,landlayer_2:1,landlayer_3:1,landlayer_4:1}},{id:1,npcs:[],fightSceneX:2E3,fightSceneY:2E3,pos:{x:3E3,y:2E3},mapData:[[0,2,3,4,5,6,0,0],[9,10,11,12,13,14,15,16],[17,18,19,20,21,22,23,0],[0,0,27,28,29,0,0,0]],lands:{bg:1,landlayer_1:1,landlayer_2:1,landlayer_3:1,landlayer_4:1,landlayer_5:1}}],idLevel:[{id:0,fightSceneX:2700,
fightSceneY:1E3,pos:{x:400,y:1E3},mapData:[[1,2,3,4,5],[6,7,8,9,10],[11,12,13,14,15]]}],singleScene:{pray:{pos:{x:700,y:900},mapData:[[1,2],[3,4]]},seamarket:{pos:{x:600,y:1600},mapData:[[1,2,3,4],[5,6,7,8],[9,10,11,12]]}},object:{type:{FENCE:"fence",TREASURE:"Treasure",WEAPON:"weapon",EFFECT:"effect"}}};g_config=window.g_config||{};
g_config.pirateBoat=[{id:0,name:"boat1",width:150,height:150,standDown:[0],standLeft:[0],standUp:[0],standRight:[0],standLeftDown:[0],standLeftUp:[0],standRightUp:[0],standRightDown:[0],down:[0],left:[0],up:[0],right:[0],leftDown:[0],leftUp:[0],rightUp:[0],rightDown:[0]},{id:1,name:"boat2",width:150,height:150,standDown:[0]},{id:2,name:"boat2",width:150,height:150,standDown:[0]},{id:3,name:"boat2",width:150,height:150,standDown:[0]},{id:4,name:"boat2",width:150,height:150,standDown:[0]},{id:5,name:"boat2",
width:150,height:150,standDown:[0]},{id:6,name:"boat2",width:150,height:150,standDown:[0]},{id:7},{id:8},{id:9},{id:10},{id:11},{id:12},{id:13},{id:14},{id:15},{id:16},{id:17},{id:18},{id:19},{id:20,name:"boat20",width:150,height:150,standDown:[0]},{id:21},{id:22}];
g_config.pirateBoat[300]={id:300,name:"boat1",width:150,height:150,standDown:[0],standLeft:[0],standUp:[0],standRight:[0],standLeftDown:[0],standLeftUp:[0],standRightUp:[0],standRightDown:[0],down:[0],left:[0],up:[0],right:[0],leftDown:[0],leftUp:[0],rightUp:[0],rightDown:[0]};g_config=window.g_config||{};g_config.skills={};g_config=window.g_config||{};g_config.task={};var g_resources=[{name:"cc_bg",type:"image",src:"res/ui/layout/cc/bg.png"},{name:"play",type:"image",src:"res/ui/layout/cc/play.png"},{name:"play_h",type:"image",src:"res/ui/layout/cc/play_h.png"},{name:"boy",type:"image",src:"res/ui/layout/cc/boy.png"},{name:"girl",type:"image",src:"res/ui/layout/cc/girl.png"},{name:"clouds1",type:"image",src:"res/ui/layout/cc/clouds1.png"},{name:"clouds2",type:"image",src:"res/ui/layout/cc/clouds2.png"},{name:"stage",type:"image",src:"res/ui/layout/cc/stage.png"},
{name:"chooseCharacter",type:"image",src:"res/e/special_003.png"},{name:"map0",type:"tmx",src:"res/w/c/0/map.json"},{name:"map1",type:"tmx",src:"res/w/c/1/map.json"},{name:"id0",type:"tmx",src:"res/w/id/0/id0.json"},{name:"water",type:"image",src:"res/w/t/water.png",save:1},{name:"land",type:"image",src:"res/w/t/land.png",save:1},{name:"land2",type:"image",src:"res/w/t/land2.png",save:1},{name:"tiled_collision",type:"image",src:"res/w/t/tiled_collision.png",save:1},{name:"dbwj1",type:"image",src:"res/w/o/dbwj1.png",
save:1},{name:"dbwj2",type:"image",src:"res/w/o/dbwj2.png",save:1},{name:"dbwj3",type:"image",src:"res/w/o/dbwj3.png"},{name:"dbwj4",type:"image",src:"res/w/o/dbwj4.png"},{name:"house1",type:"image",src:"res/w/o/house1.png"},{name:"house2",type:"image",src:"res/w/o/house2.png"},{name:"house3",type:"image",src:"res/w/o/house3.png"},{name:"house4",type:"image",src:"res/w/o/house4.png"},{name:"house5",type:"image",src:"res/w/o/house5.png"},{name:"mountain1",type:"image",src:"res/w/o/mountain1.png"},
{name:"mountain2",type:"image",src:"res/w/o/mountain2.png"},{name:"mountain3",type:"image",src:"res/w/o/mountain3.png"},{name:"mountain",type:"image",src:"res/w/o/mountain.png",save:1},{name:"shu1",type:"image",src:"res/w/o/shu1.png"},{name:"smithy",type:"image",src:"res/w/o/smithy.png"},{name:"teahouse",type:"image",src:"res/w/o/teahouse.png"},{name:"shop",type:"image",src:"res/w/o/shop.png"},{name:"house6",type:"image",src:"res/w/o/house6.png"},{name:"house7",type:"image",src:"res/w/o/house7.png"},
{name:"house8",type:"image",src:"res/w/o/house8.png"},{name:"louti2",type:"image",src:"res/w/o/louti2.png"},{name:"louti3",type:"image",src:"res/w/o/louti3.png"},{name:"bridge",type:"image",src:"res/w/o/bridge.png"},{name:"bridge1",type:"image",src:"res/w/o/bridge1.png"},{name:"boat1",type:"image",src:"res/w/o/boat1.png"},{name:"id_items1",type:"image",src:"res/w/o/id_items1.png"},{name:"character0",type:"image",src:"res/c/0/0.png"},{name:"character0_f_l",type:"image",src:"res/c/0/0_f_l.png"},{name:"character0_f_r",
type:"image",src:"res/c/0/0_f_r.png"},{name:"c0_f_l",type:"image",src:"res/c/0/c0_f_l.png"},{name:"c0_f_r",type:"image",src:"res/c/0/c0_f_r.png"},{name:"character1",type:"image",src:"res/c/1/1.png"},{name:"character1_f_l",type:"image",src:"res/c/1/1_f_l.png"},{name:"c1_f_l",type:"image",src:"res/c/1/c1_f_l.png"},{name:"c1_f_r",type:"image",src:"res/c/1/c1_f_r.png"},{name:"character1_f_r",type:"image",src:"res/c/1/1_f_r.png"},{name:"character20",type:"image",src:"res/c/20/20.png"},{name:"character21",
type:"image",src:"res/c/21/21.png"},{name:"character22",type:"image",src:"res/c/22/22.png"},{name:"symbol",type:"image",src:"res/c/symbol.png"},{name:"pirateBoat0",type:"image",src:"res/p/0/0.png"},{name:"pirateBoat1",type:"image",src:"res/p/1/1.png"},{name:"pirateBoat2",type:"image",src:"res/p/2/2.png"},{name:"pirateBoat3",type:"image",src:"res/p/3/3.png"},{name:"pirateBoat4",type:"image",src:"res/p/4/4.png"},{name:"pirateBoat5",type:"image",src:"res/p/5/5.png"},{name:"pirateBoat6",type:"image",
src:"res/p/6/6.png"},{name:"pirateBoat300",type:"image",src:"res/p/300/300.png"},{name:"logo",type:"image",src:"res/ui/ci/0/0_bust.png"},{name:"seaport_000",type:"image",src:"res/e/seaport_000.png"},{name:"seaport_001",type:"image",src:"res/e/seaport_001.png"},{name:"fire_001",type:"image",src:"res/e/fire_001.png"},{name:"click_000",type:"image",src:"res/e/click_000.png"},{name:"click_001",type:"image",src:"res/e/click_001.png"},{name:"0_buff",type:"image",src:"res/ui/ci/0/0_buff.png"},{name:"fi_anger_center",
type:"image",src:"res/ui/layout/f/fi_anger_center.png"},{name:"fi_anger_left",type:"image",src:"res/ui/layout/f/fi_anger_left.png"},{name:"fi_anger_right",type:"image",src:"res/ui/layout/f/fi_anger_right.png"},{name:"fi_life_bg",type:"image",src:"res/ui/layout/f/fi_life_bg.png"},{name:"fi_life_center",type:"image",src:"res/ui/layout/f/fi_life_center.png"},{name:"fi_life_left",type:"image",src:"res/ui/layout/f/fi_life_left.png"},{name:"fi_life_right",type:"image",src:"res/ui/layout/f/fi_life_right.png"},
{name:"fi_magic_bg",type:"image",src:"res/ui/layout/f/fi_magic_bg.png"}];(function(){for(var a=1,b=0;b<g_config.map.idLevel.length;b++)if(a=1,g_config.map.idLevel[b].mapData)for(var c=0;c<g_config.map.idLevel[b].mapData.length;c++)for(var d=0;d<g_config.map.idLevel[b].mapData[c].length;d++)0!=g_config.map.idLevel[b].mapData[c][d]&&g_resources.push({name:"id"+b+"_"+a,type:"image",src:"res/w/id/"+b+"/"+a+".png"}),a++})();var btg=function(){return{isCocoonJS:navigator.isCocoonJS?2:0,map:{tileWidth:45,tileHeight:44,collision_tilewidth:40,collision_tileheight:40,tiled:{row:0,col:0},scale:2,isometricToOrthogonalGrid:[],orthogonalToIsometricGrid:{},orthogonalGrid:[],isometricGridXY:[],orthogonalGridXY:[],isometricGridMatrix:{},orthogonalGridMatrix:{},isometric_tilewidth:48,isometric_tileheight:48,tileset_width:94,tileset_height:91,tileset_sidelength:Math.round(Math.sqrt(Math.pow(94,2)+Math.pow(91,2))),diamondwidth:0,diamondheight:0,
playerLayerZ:0,fightLayerZ:100,graph:null,isometricGraph:null,findPathMethod:2,bg_layer:null,style:"isometric"},character:{cId:0},model:{},mainPlayer:{},otherPlayers:{},screen:{width:960,height:640,maxWindowWidthSize:960,scale:1,double_buffer:!1},canvas:{width:960,height:640},game:{currentLevel:0,currentIdLevel:null,currentScene:"city",currentMap:{seaport:[]},currentTask:"currentMainTask",isFight:!1,font:{fontName:"\u5fae\u8f6f\u96c5\u9ed1 bold",fontSize:"14",fontColor:"yellow",defaultFont:new me.Font("\u5fae\u8f6f\u96c5\u9ed1 bold",
14,"yellow")},status:{music:"on",sound:"on"},debugFight:!1},debug:!1,debugGrid:!1,os:"iPhone",canTouch:!0}}();window.btg=btg||{};
(function(a){a.map.getIsometricTileId=function(b,c){var d=me.game.currentLevel.width,e=me.game.currentLevel.height,f=a.map.tileWidth*d,g=a.map.tileHeight*e,h=0,i=0,h=0>=c?0:c>=g-a.map.tileHeight?e:Math.floor(c/a.map.tileHeight),i=0>=b?0:b>=f-a.map.tileWidth?d:Math.floor(b/a.map.tileWidth);return{row:h,col:i}};a.map.getOrthogonalPosition=function(a,c){var d=0,e=0,d=2*me.game.currentLevel.width,e=2*me.game.currentLevel.height,f=me.game.currentLevel.realwidth,g=me.game.currentLevel.realheight,d=c>=a?
f/2+(c-a)*Math.round(f/d):f/2-(a-c)*Math.round(f/d),e=c<=e/2-a?g/2-(e/2-a-c)*Math.round(g/e):g/2+(c-(e/2-a))*Math.round(g/e);return{x:d-me.game.currentLevel.tilewidth/2,y:e+me.game.currentLevel.tileheight/2}};a.map.initOrthogonalGrid=function(){for(var b=me.game.currentLevel.height*a.map.scale,c=me.game.currentLevel.width*a.map.scale,d=0;d<b;d+=1){a.map.orthogonalGrid[d]=[];for(var e=0;e<c;e+=1)a.map.orthogonalGrid[d][e]=1}};a.map.getGraphInfo=function(){var b=me.game.currentLevel.getLayerByName("collision");
debug(b);if(b.layerData){a.map.initOrthogonalGrid();for(var c=b.height,d=b.width,e=me.game.currentLevel.tilesets,f=null,g=null,h=0;h<c;h+=1)for(var i=0;i<d;i+=1)f=a.map.convertToPixel(i,h),g=b.getTile(f.x,f.y),null!=g&&(debug("i:"+h+" j:"+i),f=e.getTilesetByGid(g.tileId),"no"==f.TileProperties[g.tileId].canwalk&&(a.map.orthogonalGrid[h][i]=0));debug(a.map.orthogonalGrid);return new Graph(a.map.orthogonalGrid)}alert("no LAYER COL")};a.map.getGraphInOrthogonal=function(){a.map.orthogonalGrid=tile_collisions["map"+
a.game.currentLevel];return new Graph(a.map.orthogonalGrid)};a.map.convertToPixel=function(a,c){a=Math.floor(a*me.game.currentLevel.tilewidth);c=Math.floor(c*me.game.currentLevel.tileheight);return{x:a,y:c}};a.map.getTilePixel=function(b,c){return a.map.bg_layer.renderer.tileToPixelCoords(b,c).floorSelf()};a.map.getTileCoords=function(b,c){return a.map.bg_layer.renderer.pixelToTileCoords(b,c).floorSelf()};a.map.getPlayerLayerZ=function(){for(var a=0,c=me.game.currentLevel.objectGroups,d=0;d<=c.length;d++)if("player"==
c[d].name){a=c[d].z;break}return a}})(btg);
(function(a){a.calculateScreen=function(){if("pc"==a.os)a.canvas.width=a.screen.maxWindowWidthSize,a.canvas.height=a.screen.height;else{a.screen.maxWindowWidthSize=a.screen.width;var b=window.innerHeight;a.canvas.width=window.innerWidth-20;a.canvas.height=b;400>b&&(a.canvas.height=400);b>a.screen.height&&(a.canvas.height=a.screen.height);a.canvas.width>a.screen.maxWindowWidthSize&&(a.canvas.width=a.screen.maxWindowWidthSize);a.screen.scale=a.canvas.height/a.screen.height;1>a.screen.scale&&(a.screen.double_buffer=
!0)}}})(btg);(function(a){a.getCenterX=function(a){return(me.game.viewport.getWidth()-a.width)/2};a.getCenterY=function(a){return(me.game.viewport.getHeight()-a.height)/2};a.getScreenXY=function(a){return{x:a.x-me.game.viewport.pos.x,y:a.y-me.game.viewport.pos.y}};a.getScreenRect=function(){return new me.Rect(new me.Vector2d(0,0),me.video.getWidth(),me.video.getHeight())}})(btg);
(function(a){a.drawStokeFont=function(b,c,d,e,f,g){a.game.font.defaultFont.measureText(b,c);b.font="\u5fae\u8f6f\u96c5\u9ed1 bold 14px";b.textAlign=g;b.lineWidth=2;b.strokeStyle="#000000";var h=0,h="undefined"==typeof g||"left"==g?0:"center"==g?f.width/2:f.width;b.strokeText(c,d+h,e-10);b.fillStyle=a.game.font.fontColor;b.fillText(c,d+h,e-10)};a.drawFont=function(b,c,d,e,f,g){var h=a.game.font.defaultFont.measureText(b,c),i=0,i="undefined"==typeof g||"left"==g?0:"center"==g?f.width/2-h.width/2:f.width-
h.width;a.game.font.defaultFont.draw(b,c,d+i,e-10)}})(btg);(function(a){a.createCharacter=function(b){for(var c in b)a.character[c]=b[c]}})(btg);
(function(a){a.game.loadLevel=function(b){b=b.levelId;a.map.style="isometric";a.game.currentMap.seaport=[];me.levelDirector.loadLevel("map"+b);for(var c=g_config.map.level[b].mapData,d=g_config.map.level[b].lands,e=[],f=me.game.currentLevel.mapLayers,g=0;g<f.length;g++)d[f[g].name]&&e.push(f[g]);c&&(c=new a.CanvasImageLayer("bg",me.game.currentLevel.realwidth,me.game.currentLevel.realheight,1024,1024,c,2,e),me.game.add(c,c.z));(c=g_config.map.level[b].polygonData)&&a.debug&&me.game.add(new a.ui.polygonShape(0,
0,null,c),300);c=a.getScreenRect();seaking.registerEvent(c);a.mainPlayer=new a.PlayerEntity(g_config.map.level[a.game.currentLevel].pos.x,g_config.map.level[a.game.currentLevel].pos.y,me.ObjectSettings,a.character.cId);for(var h in a.character)a.mainPlayer[h]=a.character[h];a.game.completeId&&(a.mainPlayer.currentMainTask.status=4,a.eventManager.fireEvent("setUserInfo",a.mainPlayer),a.changeNpcSymbal(),a.game.completeId=!1);a.eventManager.fireEvent("mainScene.show");a.eventManager.fireEvent("level.load",
{level:b});me.game.add(a.mainPlayer,a.map.playerLayerZ);me.game.sort();a.map.bg_layer=me.game.currentLevel.getLayerByName("bg");console.log(a.map.findPathMethod);1==a.map.findPathMethod?a.map.graph=a.map.getGraphInOrthogonal():2==a.map.findPathMethod&&(a.map.graph=a.map.getGraphInfo())};a.game.loadIdLevel=function(b){console.log(b.mapData);var c=b.levelId;a.map.style="orthogonal";a.game.currentMap.seaport=[];me.levelDirector.loadLevel("id"+c);a.map.playerLayerZ=3;var d=[];if(g_config.map.idLevel[c].mapData){for(var e=
0;e<g_config.map.idLevel[c].mapData.length;e++){d[e]=[];for(var f=0;f<g_config.map.idLevel[c].mapData[e].length;f++)d[e][f]=g_config.map.idLevel[c].mapData[e][f]?"id"+c+"_"+g_config.map.idLevel[c].mapData[e][f]:"map_blank"}e=new a.MultipleImageLayer("bg",me.game.currentLevel.realwidth,me.game.currentLevel.realheight,1024,1024,d,2);me.game.add(e,e.z)}e=a.getScreenRect();seaking.registerEvent(e);a.mainPlayer=new a.PlayerEntity(g_config.map.idLevel[a.game.currentIdLevel].pos.x,g_config.map.idLevel[a.game.currentIdLevel].pos.y,
me.ObjectSettings,a.character.cId,!0,0);for(var g in a.character)a.mainPlayer[g]=a.character[g];a.eventManager.fireEvent("mainScene.show");me.game.add(a.mainPlayer,a.map.playerLayerZ);a.mainPlayer.pirateBoat=new a.PirateBoat(g_config.map.idLevel[a.game.currentIdLevel].pos.x,g_config.map.idLevel[a.game.currentIdLevel].pos.y,me.ObjectSettings,!1,a.character.cId,a.mainPlayer.mainBoatId);a.mainPlayer.pirateBoat.z=a.map.playerLayerZ;a.mainPlayer.pirateBoat.renderable.setCurrentAnimation("standDown");a.mainPlayer.boatMode=
!0;g=g=g=null;console.log(b.mapData.enemyData);for(e=0;e<b.mapData.enemyData.length;e++)"boat"==b.mapData.enemyData[e].type?b.mapData.enemyData[e].disable||(g=me.entityPool.newInstanceOf("EnemyBoat",b.mapData.enemyData[e].x,b.mapData.enemyData[e].y,b.mapData.enemyData[e]),me.game.add(g,a.map.playerLayerZ)):"fence"==b.mapData.enemyData[e].type&&(b.mapData.enemyData[e].fence.disable||(g=me.entityPool.newInstanceOf("FenceEntity",b.mapData.enemyData[e].fence.x,b.mapData.enemyData[e].fence.y,b.mapData.enemyData[e]),
me.game.add(g,a.map.playerLayerZ)),b.mapData.enemyData[e].fence.treasure.disable||(g=me.entityPool.newInstanceOf("TreasureEntity",b.mapData.enemyData[e].fence.treasure.x,b.mapData.enemyData[e].fence.treasure.y,b.mapData.enemyData[e]),me.game.add(g,a.map.playerLayerZ)));me.game.sort();a.map.bg_layer=me.game.currentLevel.getLayerByName("bg");1==a.map.findPathMethod?a.map.graph=a.map.getGraphInOrthogonal():2==a.map.findPathMethod&&(a.map.graph=a.map.getGraphInfo())};a.game.loadSingleScene=function(b){b=
b.sceneId.split("_");b=b[2];a.map.style="orthogonal";a.game.currentMap.seaport=[];me.levelDirector.loadLevel(b);var c=[];if(g_config.map.singleScene[b].mapData){for(var d=0;d<g_config.map.singleScene[b].mapData.length;d++){c[d]=[];for(var e=0;e<g_config.map.singleScene[b].mapData[d].length;e++)c[d][e]=g_config.map.singleScene[b].mapData[d][e]?b+"_"+g_config.map.singleScene[b].mapData[d][e]:"map_blank"}console.log(c);c=new a.MultipleImageLayer("bg",me.game.currentLevel.realwidth,me.game.currentLevel.realheight,
1024,1024,c,2);me.game.add(c,c.z)}c=a.getScreenRect();seaking.registerEvent(c);a.mainPlayer=new a.PlayerEntity(g_config.map.singleScene[b].pos.x,g_config.map.singleScene[b].pos.y,me.ObjectSettings,a.character.cId,!1,0);for(var f in a.character)a.mainPlayer[f]=a.character[f];a.eventManager.fireEvent("mainScene.show");me.game.add(a.mainPlayer,3);me.game.sort();a.map.bg_layer=me.game.currentLevel.getLayerByName("bg");1==a.map.findPathMethod?a.map.graph=a.map.getGraphInOrthogonal():2==a.map.findPathMethod&&
(a.map.graph=a.map.getGraphInfo())}})(btg);(function(a){var b=navigator.userAgent;a.os="pc";a.canTouch=!1;0<b.indexOf("iPhone")?(a.os="iPhone",a.canTouch=!0):0<b.indexOf("iPod")?(a.os="iPod",a.canTouch=!0):0<b.indexOf("iPad")?(a.os="iPad",a.canTouch=!0):0<b.indexOf("Android")&&(a.os="Android",a.canTouch=!0)})(btg);
(function(a){a.addNpc=function(){};a.getNpc=function(a){for(var c=me.game.getEntityByName("NpcEntity"),d=0;d<c.length;d++)if(c[d].npcId==a)return c[d]};a.findNpc=function(a){for(var c=me.game.getEntityByName("NpcEntity"),d=null,e=0;e<c.length;e++)if(c[e].npcId==a){d=new me.Vector2d(c[e].pos.x+c[e].width/2,c[e].pos.y+c[e].height);break}findPath(d)};a.changeNpcSymbal=function(b){b||(b=a.character.currentMainTask.questNpcId);a.getNpc(b).symbol.changeAnimation(g_config.symbolType.QGOLD)}})(btg);
(function(a){a.openMusic=function(){a.game.status.music="on";me.audio.play("audio_03_01",!0)};a.closeMusic=function(){a.game.status.music="off";me.audio.stop("audio_03_01")};a.openSound=function(){a.game.status.sound="on"};a.closeSound=function(){a.game.status.sound="off"}})(btg);
(function(a){a.point=function(){2==arguments.length?(this.x=arguments[0],this.y=arguments[1]):this.y=this.x=0};a.getLineFunc=function(a,c,d,e,f){var g=0,h=0,i=d-a,g=0==i?0:(e-c)/i,h=c-g*a,a=Math.round((d-a)/f);0==g&&0==i&&(a=Math.round((e-c)/f));return{a:g,b:h,step:a}};a.getLinePoint=function(b,c,d,e,f){var e=a.getLineFunc(b,c,d,e,f),g=[],h=null;debug("num:"+f);for(var i=0;i<f;i++)h=new a.point,0==e.a&&0==d-b?(h.x=b,h.y=c+e.step*(i+1)):(h.x=b+e.step*(i+1),h.y=e.a*h.x+e.b),g.push(h);debug(g);return g};
a.random=function(a,c){return Math.floor(Math.random()*(c+1-a))+a}})(btg);(function(a){a.getLinePoint(2924,1012,2924,1056,20)})(btg);(function(){var a={},b=function(b,d){var e,f,g,h=a[b];if(h){g=h.length;for(e=0;e<g;e++)f={type:b,data:d},h[e](f)}};btg=btg||{};btg.eventManager={addListener:function(b,d){(a[b]=a[b]||[]).push(d)},removeListener:function(b,d){var e,f=a[b],g=f.length,h;if(!f)throw Error("Illegal eventType : "+b);for(e=0;e<g;e++)if(d===f[e]){h=e;break}h&&f.splice(h,1)},fireEvent:function(a,d){b.apply(btg.eventManager,arguments);if(window.CocoonJS)try{var e='btg.eventManager._fireEvent("'+a+'", '+JSON.stringify(d)+");";
console.log("fireEvent type="+a);CocoonJS.App.forwardAsync(e)}catch(f){console.log(f,f.stack)}},_fireEvent:b}})();btg.eventManager.addListener("startup",function(){console.log("startup");btg.eventManager.addListener("socket.connected",function(){me.sys.fps=60;console.log("socket connected1");seaking.onload()});btg.initSocket()});
window.CocoonJS&&(CocoonJS.App.onLoadInTheWebViewSucceed.addEventListener(function(){console.log("onLoadInTheWebViewSucceed");CocoonJS.App.showTheWebView();try{document.getElementById("CocoonJS_App_ForCocoonJS_WebViewDiv").style.display="none"}catch(a){}}),CocoonJS.App.onLoadInTheWebViewFailed.addEventListener(function(){console.log("onLoadInTheWebViewFailed")}),CocoonJS.App.loadInTheWebView("ui.html"),btg.isCocoonJS&&btg.eventManager.addListener("screen.touchend",function(a){mouseUp(a.data.clientX*
btg.screen.width/a.data.docW,a.data.clientY*btg.screen.height/a.data.docH)}));btg.eventManager.addListener("getTaskInfo",function(){btg.game_socket.getCurrentTaskInfo()});btg.eventManager.addListener("updateMoneyAndExp",function(a){btg.game_socket.updateMoneyAndExp(a.data.money,a.data.getExp)});btg.eventManager.addListener("updatePackageInfo",function(a){btg.game_socket.updatePackageInfo(a.data.action,a.data.itemId,a.data.itemNum)});btg.eventManager.addListener("getUserInduInfo",function(a){btg.game_socket.getUserInduInfo(a.data.induId)});
btg.eventManager.addListener("goToIdScene",function(a){btg.eventManager.fireEvent("loading.hide");btg.sceneManager.gotoScene("scene_level_id0",a.data)});btg.eventManager.addListener("updateUserInduInfo",function(a){btg.game_socket.updateUserInduInfo(a.data.action,a.data.induId,a.data.indexId)});btg.eventManager.addListener("updateIdScene",function(){btg.eventManager.fireEvent("loading.hide")});btg.eventManager.addListener("getPackageInfo",function(){btg.game_socket.getPackageInfo()});
btg.eventManager.addListener("music.toggle",function(){"on"==btg.game.status.music?(btg.eventManager.fireEvent("music.off"),btg.closeMusic()):(btg.eventManager.fireEvent("music.on"),btg.openMusic())});btg.eventManager.addListener("sound.toggle",function(){"on"==btg.game.status.sound?(btg.eventManager.fireEvent("sound.off"),btg.closeSound()):(btg.eventManager.fireEvent("sound.on"),btg.openSound())});
btg.eventManager.addListener("acceptTask",function(a){btg.findNpc(a.data.npcId);btg.mainPlayer.isTalkToNpc=!0});btg.eventManager.addListener("commitTask",function(){});btg.eventManager.addListener("goToFight",function(){btg.mainPlayer.goToFight()});btg.eventManager.addListener("goToInstanceDungeon",function(){btg.mainPlayer.goToInstanceDungeon()});btg.eventManager.addListener("createBoatFight",function(){btg.mainPlayer.createBoatFight()});btg.eventManager.addListener("quitBoatFight",function(){btg.mainPlayer.quitBoatFight()});
btg.eventManager.addListener("createCharacterFight",function(){btg.mainPlayer.createCharacterFight()});btg.eventManager.addListener("quitCharacterFight",function(){btg.mainPlayer.quitCharacterFight()});btg.eventManager.addListener("talk.sendMessage",function(a){"talkToWorld"==a.data.type&&btg.talkToWorld(a.data.message)});
btg.eventManager.addListener("quitFight",function(a){"quitBoatFight"==a.data.action?btg.mainPlayer.quitBoatFight():(btg.game_socket.updateMoneyAndExp(a.data.money,a.data.getExp),btg.mainPlayer.quitCharacterFight())});window.game_resources=window.game_resources||{};
window.game_resources.commons=[{name:"map1",type:"tmx",src:"res/w/c/1/map.json"},{name:"map0",type:"tmx",src:"res/w/c/0/map.json"},{name:"id0",type:"tmx",src:"res/w/id/0/id0.json"},{name:"loading_screen_bg",type:"image",src:"res/c/loading_bg.png",save:1},{name:"loading_progress",type:"image",src:"res/c/loading_progress.png",save:1},{name:"tiled_collision",type:"image",src:"res/w/t/tiled_collision.png",save:1},{name:"character0",type:"image",src:"res/c/0/0.png"},{name:"character1",type:"image",src:"res/c/1/1.png"},
{name:"character10101",type:"image",src:"res/c/10101/10101.png"},{name:"character10102",type:"image",src:"res/c/10102/10102.png"},{name:"character10201",type:"image",src:"res/c/10201/10201.png"},{name:"symbol",type:"image",src:"res/c/symbol.png"},{name:"shadow",type:"image",src:"res/c/shadow.png"},{name:"pirateBoat0",type:"image",src:"res/p/0/0.png"},{name:"pirateBoat1",type:"image",src:"res/p/1/1.png"},{name:"pirateBoat2",type:"image",src:"res/p/2/2.png"},{name:"pirateBoat3",type:"image",src:"res/p/3/3.png"},
{name:"pirateBoat4",type:"image",src:"res/p/4/4.png"},{name:"pirateBoat5",type:"image",src:"res/p/5/5.png"},{name:"pirateBoat6",type:"image",src:"res/p/6/6.png"},{name:"pirateBoat300",type:"image",src:"res/p/300/300.png"},{name:"seaport_000",type:"image",src:"res/e/seaport_000.png"},{name:"seaport_001",type:"image",src:"res/e/seaport_001.png"},{name:"audio_03_01",type:"audio",src:"res/bgm/03_01.mp3",stream:!0,channel:1}];window.game_resources=window.game_resources||{};
window.game_resources.scene_character_choose=[{name:"cc_bg",type:"image",src:"res/ui/layout/cc/bg.png",save:1},{name:"play",type:"image",src:"res/ui/layout/cc/play.png",save:1},{name:"play_h",type:"image",src:"res/ui/layout/cc/play_h.png",save:1},{name:"boy",type:"image",src:"res/ui/layout/cc/boy.png",save:1},{name:"girl",type:"image",src:"res/ui/layout/cc/girl.png",save:1},{name:"clouds1",type:"image",src:"res/ui/layout/cc/clouds1.png",save:1},{name:"clouds2",type:"image",src:"res/ui/layout/cc/clouds2.png",
save:1},{name:"stage",type:"image",src:"res/ui/layout/cc/stage.png",save:1},{name:"chooseCharacter",type:"image",src:"res/e/special_003.png",save:1}];window.game_resources=window.game_resources||{};
window.game_resources.scene_level_0=[{name:"water",type:"image",src:"res/w/t/water.png",save:1},{name:"land",type:"image",src:"res/w/t/land.png",save:1},{name:"land2",type:"image",src:"res/w/t/land2.png",save:1},{name:"dbwj1",type:"image",src:"res/w/o/dbwj1.png",save:1},{name:"dbwj2",type:"image",src:"res/w/o/dbwj2.png",save:1},{name:"dbwj3",type:"image",src:"res/w/o/dbwj3.png"},{name:"dbwj4",type:"image",src:"res/w/o/dbwj4.png"},{name:"house1",type:"image",src:"res/w/o/house1.png"},{name:"house2",
type:"image",src:"res/w/o/house2.png"},{name:"house3",type:"image",src:"res/w/o/house3.png"},{name:"house4",type:"image",src:"res/w/o/house4.png"},{name:"house5",type:"image",src:"res/w/o/house5.png"},{name:"mountain1",type:"image",src:"res/w/o/mountain1.png"},{name:"mountain2",type:"image",src:"res/w/o/mountain2.png"},{name:"mountain3",type:"image",src:"res/w/o/mountain3.png"},{name:"mountain",type:"image",src:"res/w/o/mountain.png",save:1},{name:"shu1",type:"image",src:"res/w/o/shu1.png"},{name:"smithy",
type:"image",src:"res/w/o/smithy.png"},{name:"teahouse",type:"image",src:"res/w/o/teahouse.png"},{name:"shop",type:"image",src:"res/w/o/shop.png"},{name:"house6",type:"image",src:"res/w/o/house6.png"},{name:"house7",type:"image",src:"res/w/o/house7.png"},{name:"house8",type:"image",src:"res/w/o/house8.png"},{name:"louti2",type:"image",src:"res/w/o/louti2.png"},{name:"louti3",type:"image",src:"res/w/o/louti3.png"},{name:"bridge",type:"image",src:"res/w/o/bridge.png"},{name:"bridge1",type:"image",src:"res/w/o/bridge1.png"},
{name:"boat1",type:"image",src:"res/w/o/boat1.png"}];window.game_resources=window.game_resources||{};
window.game_resources.scene_level_1=[{name:"water",type:"image",src:"res/w/t/water.png",save:1},{name:"land",type:"image",src:"res/w/t/land.png",save:1},{name:"land2",type:"image",src:"res/w/t/land2.png",save:1},{name:"dbwj1",type:"image",src:"res/w/o/dbwj1.png",save:1},{name:"dbwj2",type:"image",src:"res/w/o/dbwj2.png",save:1},{name:"dbwj3",type:"image",src:"res/w/o/dbwj3.png"},{name:"dbwj4",type:"image",src:"res/w/o/dbwj4.png"},{name:"house1",type:"image",src:"res/w/o/house1.png"},{name:"house2",
type:"image",src:"res/w/o/house2.png"},{name:"house3",type:"image",src:"res/w/o/house3.png"},{name:"house4",type:"image",src:"res/w/o/house4.png"},{name:"house5",type:"image",src:"res/w/o/house5.png"},{name:"mountain1",type:"image",src:"res/w/o/mountain1.png"},{name:"mountain2",type:"image",src:"res/w/o/mountain2.png"},{name:"mountain3",type:"image",src:"res/w/o/mountain3.png"},{name:"mountain",type:"image",src:"res/w/o/mountain.png",save:1},{name:"shu1",type:"image",src:"res/w/o/shu1.png"},{name:"smithy",
type:"image",src:"res/w/o/smithy.png"},{name:"teahouse",type:"image",src:"res/w/o/teahouse.png"},{name:"shop",type:"image",src:"res/w/o/shop.png"},{name:"house6",type:"image",src:"res/w/o/house6.png"},{name:"house7",type:"image",src:"res/w/o/house7.png"},{name:"house8",type:"image",src:"res/w/o/house8.png"},{name:"louti2",type:"image",src:"res/w/o/louti2.png",save:1},{name:"louti3",type:"image",src:"res/w/o/louti3.png",save:1},{name:"bridge",type:"image",src:"res/w/o/bridge.png",save:1},{name:"bridge1",
type:"image",src:"res/w/o/bridge1.png",save:1},{name:"boat1",type:"image",src:"res/w/o/boat1.png"},{name:"id_items1",type:"image",src:"res/w/o/id_items1.png"}];window.game_resources=window.game_resources||{};
window.game_resources.scene_level_id0=[{name:"id_items1",type:"image",src:"res/w/o/id_items1.png"},{name:"0_buff",type:"image",src:"res/ui/ci/0/0_buff.png"},{name:"fi_anger_center",type:"image",src:"res/ui/layout/f/fi_anger_center.png"},{name:"fi_anger_left",type:"image",src:"res/ui/layout/f/fi_anger_left.png"},{name:"fi_anger_right",type:"image",src:"res/ui/layout/f/fi_anger_right.png"},{name:"fi_life_bg",type:"image",src:"res/ui/layout/f/fi_life_bg.png"},{name:"fi_life_center",type:"image",src:"res/ui/layout/f/fi_life_center.png"},
{name:"fi_life_left",type:"image",src:"res/ui/layout/f/fi_life_left.png"},{name:"fi_life_right",type:"image",src:"res/ui/layout/f/fi_life_right.png"},{name:"fi_magic_bg",type:"image",src:"res/ui/layout/f/fi_magic_bg.png"},{name:"fightScene",type:"image",src:"res/w/f/0.png"},{name:"c1_f_r",type:"image",src:"res/c/1/c1_f_r.png"},{name:"c1_f_l",type:"image",src:"res/c/1/c1_f_l.png"},{name:"skill_001",type:"image",src:"res/e/skill_001.png"},{name:"diamond_01",type:"image",src:"res/w/f/diamond_01.png"},
{name:"attack",type:"audio",src:"res/sounds/attack.wav"},{name:"1000",type:"image",src:"res/ui/icon/1000.png"},{name:"chest_001",type:"image",src:"res/e/chest_001.png"},{name:"c23_f_r",type:"image",src:"res/c/23/c23_f_r.png"}];
(function(){for(var a=1,b=0;b<g_config.map.idLevel.length;b++)if(a=1,g_config.map.idLevel[b].mapData)for(var c=0;c<g_config.map.idLevel[b].mapData.length;c++)for(var d=0;d<g_config.map.idLevel[b].mapData[c].length;d++)0!=g_config.map.idLevel[b].mapData[c][d]&&game_resources.scene_level_id0.push({name:"id"+b+"_"+a,type:"image",src:"res/w/id/"+b+"/"+a+".png"}),a++})();window.game_resources=window.game_resources||{};window.game_resources.scene_level_pray=[{name:"pray",type:"tmx",src:"res/w/pray/map.json"}];(function(){var a=1;if(g_config.map.singleScene.pray.mapData)for(var b=0;b<g_config.map.singleScene.pray.mapData.length;b++)for(var c=0;c<g_config.map.singleScene.pray.mapData[b].length;c++)0!=g_config.map.singleScene.pray.mapData[b][c]&&game_resources.scene_level_pray.push({name:"pray_"+a,type:"image",src:"res/w/pray/"+a+".png"}),a++})();window.game_resources=window.game_resources||{};window.game_resources.scene_level_seamarket=[{name:"seamarket",type:"tmx",src:"res/w/seamarket/map.json"}];
(function(){var a=1;if(g_config.map.singleScene.seamarket.mapData)for(var b=0;b<g_config.map.singleScene.seamarket.mapData.length;b++)for(var c=0;c<g_config.map.singleScene.seamarket.mapData[b].length;c++)0!=g_config.map.singleScene.seamarket.mapData[b][c]&&game_resources.scene_level_seamarket.push({name:"seamarket_"+a,type:"image",src:"res/w/seamarket/"+a+".png"}),a++})();window.sprite_json=window.sprite_json||{};
sprite_json.c1_f_l={spriteheight:170,Stand:[{w:41,sh:170,ox:64,y:209,h:93,sw:170,x:205,oy:52},{w:40,sh:170,ox:66,y:209,h:93,sw:170,x:246,oy:52},{w:40,sh:170,ox:67,y:92,h:92,sw:170,x:367,oy:53},{w:42,sh:170,ox:67,y:0,h:92,sw:170,x:367,oy:53},{w:44,sh:170,ox:67,y:302,h:91,sw:170,x:205,oy:54},{w:45,sh:170,ox:67,y:302,h:90,sw:170,x:296,oy:55},{w:45,sh:170,ox:67,y:302,h:90,sw:170,x:341,oy:55},{w:44,sh:170,ox:67,y:0,h:90,sw:170,x:409,oy:55},{w:45,sh:170,ox:65,y:302,h:91,sw:170,x:116,oy:54},{w:46,sh:170,
ox:62,y:184,h:92,sw:170,x:307,oy:53},{w:45,sh:170,ox:61,y:0,h:93,sw:170,x:221,oy:52},{w:43,sh:170,ox:63,y:93,h:93,sw:170,x:221,oy:52}],Hit:[{w:41,sh:170,ox:64,y:209,h:93,sw:170,x:82,oy:52},{w:48,sh:170,ox:58,y:169,h:83,sw:170,x:519,oy:57},{w:67,sh:170,ox:33,y:565,h:74,sw:170,x:460,oy:70},{w:70,sh:170,ox:30,y:565,h:73,sw:170,x:527,oy:74},{w:71,sh:170,ox:29,y:565,h:74,sw:170,x:389,oy:73},{w:70,sh:170,ox:30,y:565,h:75,sw:170,x:246,oy:72},{w:66,sh:170,ox:34,y:565,h:78,sw:170,x:0,oy:69},{w:58,sh:170,ox:42,
y:0,h:81,sw:170,x:570,oy:66},{w:58,sh:170,ox:41,y:481,h:84,sw:170,x:151,oy:63},{w:64,sh:170,ox:40,y:393,h:85,sw:170,x:426,oy:59},{w:60,sh:170,ox:45,y:393,h:86,sw:170,x:308,oy:55},{w:51,sh:170,ox:55,y:302,h:91,sw:170,x:65,oy:52}],Death:[{w:41,sh:170,ox:64,y:93,h:93,sw:170,x:266,oy:52},{w:67,sh:170,ox:33,y:643,h:66,sw:170,x:311,oy:70},{w:75,sh:170,ox:25,y:711,h:56,sw:170,x:60,oy:75},{w:82,sh:170,ox:12,y:353,h:70,sw:170,x:690,oy:73},{w:86,sh:170,ox:1,y:213,h:70,sw:170,x:690,oy:80},{w:76,sh:170,ox:1,
y:643,h:65,sw:170,x:378,oy:80},{w:81,sh:170,ox:1,y:643,h:64,sw:170,x:454,oy:84},{w:84,sh:170,ox:5,y:643,h:61,sw:170,x:602,oy:87},{w:83,sh:170,ox:8,y:711,h:46,sw:170,x:135,oy:103},{w:83,sh:170,ox:8,y:711,h:42,sw:170,x:302,oy:107},{w:83,sh:170,ox:8,y:711,h:40,sw:170,x:469,oy:109},{w:83,sh:170,ox:8,y:711,h:40,sw:170,x:552,oy:109}],spritewidth:170,Defense:[{w:41,sh:170,ox:64,y:209,h:93,sw:170,x:0,oy:52},{w:51,sh:170,ox:55,y:92,h:92,sw:170,x:307,oy:49},{w:64,sh:170,ox:44,y:266,h:88,sw:170,x:453,oy:46},
{w:66,sh:170,ox:47,y:178,h:88,sw:170,x:453,oy:55},{w:70,sh:170,ox:43,y:561,h:68,sw:170,x:690,oy:93},{w:70,sh:170,ox:43,y:565,h:68,sw:170,x:597,oy:93},{w:70,sh:170,ox:43,y:643,h:68,sw:170,x:0,oy:93},{w:67,sh:170,ox:45,y:71,h:71,sw:170,x:690,oy:88},{w:53,sh:170,ox:57,y:80,h:78,sw:170,x:628,oy:71},{w:46,sh:170,ox:62,y:85,h:84,sw:170,x:519,oy:62},{w:44,sh:170,ox:63,y:302,h:91,sw:170,x:161,oy:54},{w:41,sh:170,ox:64,y:209,h:93,sw:170,x:41,oy:52}],Attack:[{w:41,sh:170,ox:64,y:0,h:93,sw:170,x:266,oy:52},
{w:53,sh:170,ox:57,y:393,h:87,sw:170,x:176,oy:58},{w:54,sh:170,ox:58,y:383,h:73,sw:170,x:628,oy:72},{w:62,sh:170,ox:50,y:0,h:80,sw:170,x:628,oy:66},{w:79,sh:170,ox:32,y:393,h:86,sw:170,x:229,oy:60},{w:72,sh:170,ox:40,y:393,h:87,sw:170,x:104,oy:59},{w:82,sh:170,ox:51,y:283,h:70,sw:170,x:690,oy:65},{w:103,sh:170,ox:55,y:0,h:71,sw:170,x:690,oy:59},{w:99,sh:170,ox:57,y:565,h:77,sw:170,x:66,oy:57},{w:66,sh:170,ox:52,y:0,h:89,sw:170,x:453,oy:55},{w:65,sh:170,ox:29,y:302,h:91,sw:170,x:0,oy:59},{w:49,sh:170,
ox:54,y:109,h:93,sw:170,x:138,oy:53}],Skill:[{w:44,sh:170,ox:63,y:109,h:94,sw:170,x:94,oy:51},{w:43,sh:170,ox:57,y:162,h:81,sw:170,x:570,oy:63},{w:62,sh:170,ox:39,y:456,h:66,sw:170,x:628,oy:76},{w:47,sh:170,ox:51,y:142,h:71,sw:170,x:690,oy:71},{w:53,sh:170,ox:49,y:235,h:75,sw:170,x:628,oy:72},{w:55,sh:170,ox:54,y:142,h:70,sw:170,x:737,oy:75},{w:58,sh:170,ox:51,y:243,h:63,sw:170,x:570,oy:79},{w:60,sh:170,ox:49,y:711,h:59,sw:170,x:0,oy:82},{w:67,sh:170,ox:42,y:643,h:62,sw:170,x:535,oy:81},{w:84,sh:170,
ox:42,y:643,h:67,sw:170,x:227,oy:65},{w:84,sh:170,ox:41,y:711,h:40,sw:170,x:385,oy:67},{w:81,sh:170,ox:40,y:423,h:69,sw:170,x:690,oy:54},{w:57,sh:170,ox:55,y:306,h:57,sw:170,x:570,oy:52},{w:74,sh:170,ox:56,y:643,h:61,sw:170,x:686,oy:48},{w:65,sh:170,ox:53,y:492,h:69,sw:170,x:690,oy:44},{w:58,sh:170,ox:43,y:310,h:73,sw:170,x:628,oy:47},{w:66,sh:170,ox:33,y:643,h:68,sw:170,x:70,oy:47},{w:91,sh:170,ox:22,y:643,h:67,sw:170,x:136,oy:44},{w:44,sh:170,ox:48,y:363,h:53,sw:170,x:570,oy:54},{w:60,sh:170,ox:27,
y:0,h:92,sw:170,x:307,oy:47},{w:66,sh:170,ox:17,y:481,h:83,sw:170,x:333,oy:63},{w:56,sh:170,ox:15,y:81,h:81,sw:170,x:570,oy:65},{w:57,sh:170,ox:24,y:481,h:84,sw:170,x:209,oy:59},{w:58,sh:170,ox:50,y:393,h:86,sw:170,x:368,oy:47}],Return:[{w:41,sh:170,ox:64,y:209,h:93,sw:170,x:123,oy:52},{w:47,sh:170,ox:67,y:302,h:90,sw:170,x:249,oy:55},{w:51,sh:170,ox:67,y:0,h:85,sw:170,x:519,oy:60},{w:49,sh:170,ox:67,y:393,h:88,sw:170,x:55,oy:57},{w:45,sh:170,ox:68,y:109,h:94,sw:170,x:49,oy:51},{w:55,sh:170,ox:56,
y:393,h:88,sw:170,x:0,oy:47},{w:66,sh:170,ox:43,y:481,h:84,sw:170,x:85,oy:47},{w:67,sh:170,ox:41,y:481,h:82,sw:170,x:399,oy:48},{w:68,sh:170,ox:39,y:481,h:81,sw:170,x:466,oy:49},{w:67,sh:170,ox:39,y:481,h:83,sw:170,x:266,oy:51},{w:59,sh:170,ox:47,y:89,h:89,sw:170,x:453,oy:52},{w:41,sh:170,ox:64,y:209,h:93,sw:170,x:164,oy:52}],Revival:[{w:83,sh:170,ox:8,y:711,h:40,sw:170,x:635,oy:109},{w:82,sh:170,ox:9,y:0,h:35,sw:170,x:793,oy:110},{w:49,sh:170,ox:57,y:109,h:100,sw:170,x:0,oy:44},{w:84,sh:170,ox:6,
y:711,h:45,sw:170,x:218,oy:96},{w:73,sh:170,ox:16,y:565,h:74,sw:170,x:316,oy:67},{w:62,sh:170,ox:23,y:158,h:77,sw:170,x:628,oy:59},{w:81,sh:170,ox:13,y:565,h:75,sw:170,x:165,oy:46},{w:85,sh:170,ox:24,y:481,h:84,sw:170,x:0,oy:30},{w:66,sh:170,ox:41,y:0,h:108,sw:170,x:58,oy:7},{w:48,sh:170,ox:41,y:0,h:101,sw:170,x:173,oy:6},{w:49,sh:170,ox:41,y:0,h:102,sw:170,x:124,oy:3},{w:58,sh:170,ox:42,y:0,h:109,sw:170,x:0,oy:13}]};window.sprite_json=window.sprite_json||{};
sprite_json.c1_f_r={spriteheight:170,Stand:[{w:39,sh:170,ox:61,y:188,h:94,sw:170,x:376,oy:51},{w:38,sh:170,ox:60,y:298,h:94,sw:170,x:0,oy:51},{w:37,sh:170,ox:60,y:298,h:94,sw:170,x:38,oy:52},{w:36,sh:170,ox:60,y:298,h:93,sw:170,x:366,oy:53},{w:37,sh:170,ox:60,y:273,h:91,sw:170,x:460,oy:55},{w:37,sh:170,ox:61,y:392,h:91,sw:170,x:0,oy:56},{w:38,sh:170,ox:61,y:182,h:91,sw:170,x:460,oy:56},{w:41,sh:170,ox:60,y:276,h:92,sw:170,x:415,oy:55},{w:43,sh:170,ox:60,y:92,h:92,sw:170,x:415,oy:54},{w:45,sh:170,
ox:60,y:204,h:94,sw:170,x:113,oy:52},{w:44,sh:170,ox:61,y:95,h:95,sw:170,x:273,oy:51},{w:40,sh:170,ox:61,y:204,h:94,sw:170,x:238,oy:51}],Death:[{w:40,sh:170,ox:60,y:204,h:94,sw:170,x:158,oy:51},{w:47,sh:170,ox:64,y:343,h:83,sw:170,x:525,oy:54},{w:56,sh:170,ox:64,y:189,h:59,sw:170,x:684,oy:62},{w:77,sh:170,ox:67,y:637,h:45,sw:170,x:514,oy:73},{w:52,sh:170,ox:72,y:259,h:45,sw:170,x:630,oy:78},{w:52,sh:170,ox:75,y:304,h:45,sw:170,x:630,oy:76},{w:63,sh:170,ox:73,y:586,h:50,sw:170,x:684,oy:74},{w:83,sh:170,
ox:71,y:637,h:47,sw:170,x:372,oy:86},{w:96,sh:170,ox:71,y:687,h:35,sw:170,x:282,oy:100},{w:96,sh:170,ox:71,y:637,h:38,sw:170,x:591,oy:101},{w:94,sh:170,ox:71,y:687,h:38,sw:170,x:0,oy:101},{w:94,sh:170,ox:71,y:687,h:38,sw:170,x:94,oy:101}],Hit:[{w:39,sh:170,ox:61,y:188,h:94,sw:170,x:337,oy:51},{w:41,sh:170,ox:58,y:106,h:97,sw:170,x:50,oy:48},{w:48,sh:170,ox:64,y:392,h:90,sw:170,x:158,oy:55},{w:56,sh:170,ox:66,y:392,h:86,sw:170,x:438,oy:59},{w:54,sh:170,ox:67,y:0,h:86,sw:170,x:525,oy:59},{w:45,sh:170,
ox:70,y:392,h:87,sw:170,x:393,oy:58},{w:45,sh:170,ox:65,y:0,h:92,sw:170,x:415,oy:53},{w:54,sh:170,ox:62,y:204,h:94,sw:170,x:59,oy:51},{w:56,sh:170,ox:60,y:298,h:93,sw:170,x:75,oy:52},{w:52,sh:170,ox:60,y:298,h:93,sw:170,x:131,oy:52},{w:44,sh:170,ox:61,y:298,h:93,sw:170,x:322,oy:52},{w:39,sh:170,ox:61,y:0,h:94,sw:170,x:376,oy:51}],spritewidth:170,Attack:[{w:39,sh:170,ox:61,y:204,h:94,sw:170,x:278,oy:51},{w:50,sh:170,ox:60,y:86,h:86,sw:170,x:525,oy:55},{w:57,sh:170,ox:58,y:566,h:71,sw:170,x:0,oy:62},
{w:51,sh:170,ox:58,y:75,h:67,sw:170,x:630,oy:61},{w:56,sh:170,ox:57,y:566,h:65,sw:170,x:597,oy:63},{w:56,sh:170,ox:58,y:566,h:66,sw:170,x:470,oy:61},{w:70,sh:170,ox:33,y:566,h:70,sw:170,x:167,oy:57},{w:92,sh:170,ox:12,y:637,h:47,sw:170,x:280,oy:85},{w:88,sh:170,ox:16,y:637,h:50,sw:170,x:0,oy:80},{w:61,sh:170,ox:47,y:483,h:79,sw:170,x:350,oy:61},{w:61,sh:170,ox:62,y:392,h:90,sw:170,x:37,oy:55},{w:47,sh:170,ox:61,y:298,h:93,sw:170,x:183,oy:52}],Defense:[{w:39,sh:170,ox:61,y:0,h:94,sw:170,x:337,oy:51},
{w:46,sh:170,ox:60,y:298,h:93,sw:170,x:230,oy:48},{w:60,sh:170,ox:56,y:392,h:90,sw:170,x:98,oy:45},{w:55,sh:170,ox:53,y:392,h:89,sw:170,x:245,oy:54},{w:55,sh:170,ox:53,y:483,h:80,sw:170,x:188,oy:80},{w:55,sh:170,ox:53,y:566,h:71,sw:170,x:57,oy:89},{w:55,sh:170,ox:53,y:566,h:71,sw:170,x:112,oy:89},{w:54,sh:170,ox:54,y:0,h:75,sw:170,x:630,oy:86},{w:51,sh:170,ox:60,y:258,h:85,sw:170,x:525,oy:76},{w:46,sh:170,ox:62,y:298,h:93,sw:170,x:276,oy:65},{w:47,sh:170,ox:61,y:96,h:96,sw:170,x:207,oy:55},{w:39,
sh:170,ox:61,y:94,h:94,sw:170,x:337,oy:51}],Skill:[{w:40,sh:170,ox:60,y:106,h:95,sw:170,x:158,oy:51},{w:41,sh:170,ox:61,y:184,h:92,sw:170,x:415,oy:53},{w:51,sh:170,ox:68,y:0,h:76,sw:170,x:579,oy:67},{w:50,sh:170,ox:67,y:209,h:50,sw:170,x:630,oy:80},{w:54,sh:170,ox:65,y:307,h:58,sw:170,x:684,oy:77},{w:56,sh:170,ox:58,y:479,h:56,sw:170,x:684,oy:78},{w:55,sh:170,ox:58,y:637,h:50,sw:170,x:88,oy:84},{w:57,sh:170,ox:58,y:637,h:48,sw:170,x:223,oy:86},{w:59,sh:170,ox:56,y:637,h:46,sw:170,x:455,oy:85},{w:81,
sh:170,ox:34,y:687,h:35,sw:170,x:378,oy:84},{w:77,sh:170,ox:38,y:0,h:64,sw:170,x:684,oy:71},{w:69,sh:170,ox:46,y:483,h:79,sw:170,x:281,oy:41},{w:54,sh:170,ox:54,y:64,h:63,sw:170,x:684,oy:46},{w:81,sh:170,ox:34,y:566,h:67,sw:170,x:317,oy:46},{w:71,sh:170,ox:50,y:566,h:65,sw:170,x:526,oy:47},{w:62,sh:170,ox:67,y:422,h:57,sw:170,x:684,oy:47},{w:64,sh:170,ox:67,y:365,h:57,sw:170,x:684,oy:43},{w:80,sh:170,ox:55,y:566,h:68,sw:170,x:237,oy:39},{w:41,sh:170,ox:75,y:248,h:59,sw:170,x:684,oy:42},{w:38,sh:170,
ox:80,y:483,h:80,sw:170,x:243,oy:35},{w:40,sh:170,ox:86,y:142,h:67,sw:170,x:630,oy:55},{w:42,sh:170,ox:92,y:535,h:51,sw:170,x:684,oy:71},{w:40,sh:170,ox:86,y:127,h:62,sw:170,x:684,oy:60},{w:50,sh:170,ox:62,y:483,h:77,sw:170,x:411,oy:51}],Return:[{w:39,sh:170,ox:61,y:94,h:94,sw:170,x:376,oy:51},{w:40,sh:170,ox:56,y:91,h:91,sw:170,x:460,oy:54},{w:41,sh:170,ox:54,y:172,h:86,sw:170,x:525,oy:59},{w:41,sh:170,ox:54,y:392,h:88,sw:170,x:352,oy:55},{w:39,sh:170,ox:56,y:392,h:90,sw:170,x:206,oy:48},{w:52,sh:170,
ox:59,y:392,h:88,sw:170,x:300,oy:45},{w:65,sh:170,ox:60,y:0,h:91,sw:170,x:460,oy:45},{w:64,sh:170,ox:62,y:0,h:95,sw:170,x:273,oy:46},{w:66,sh:170,ox:61,y:0,h:96,sw:170,x:207,oy:48},{w:67,sh:170,ox:58,y:106,h:96,sw:170,x:91,oy:49},{w:59,sh:170,ox:59,y:204,h:94,sw:170,x:0,oy:51},{w:40,sh:170,ox:61,y:204,h:94,sw:170,x:198,oy:51}],Revival:[{w:94,sh:170,ox:71,y:687,h:38,sw:170,x:188,oy:101},{w:80,sh:170,ox:71,y:637,h:48,sw:170,x:143,oy:90},{w:72,sh:170,ox:72,y:566,h:66,sw:170,x:398,oy:71},{w:69,sh:170,
ox:75,y:483,h:76,sw:170,x:461,oy:59},{w:67,sh:170,ox:76,y:483,h:80,sw:170,x:121,oy:48},{w:64,sh:170,ox:63,y:483,h:83,sw:170,x:0,oy:34},{w:57,sh:170,ox:55,y:483,h:81,sw:170,x:64,oy:28},{w:54,sh:170,ox:65,y:0,h:102,sw:170,x:57,oy:6},{w:50,sh:170,ox:73,y:106,h:98,sw:170,x:0,oy:6},{w:50,sh:170,ox:73,y:0,h:99,sw:170,x:157,oy:3},{w:57,sh:170,ox:66,y:0,h:106,sw:170,x:0,oy:13},{w:46,sh:170,ox:60,y:0,h:100,sw:170,x:111,oy:43}]};window.sprite_json=window.sprite_json||{};
sprite_json.c23_f_r={Stand:[{w:108,sh:200,ox:41,y:602,h:105,sw:200,x:216,oy:57},{w:110,sh:200,ox:40,y:707,h:104,sw:200,x:116,oy:58},{w:100,sh:200,ox:45,y:106,h:104,sw:200,x:615,oy:58},{w:106,sh:200,ox:42,y:210,h:105,sw:200,x:721,oy:57},{w:114,sh:200,ox:38,y:707,h:103,sw:200,x:521,oy:59},{w:117,sh:200,ox:36,y:707,h:102,sw:200,x:635,oy:60},{w:116,sh:200,ox:36,y:204,h:100,sw:200,x:828,oy:62},{w:113,sh:200,ox:38,y:304,h:100,sw:200,x:828,oy:62},{w:108,sh:200,ox:42,y:404,h:100,sw:200,x:828,oy:62},{w:103,
sh:200,ox:45,y:102,h:102,sw:200,x:828,oy:61},{w:99,sh:200,ox:46,y:210,h:104,sw:200,x:615,oy:60},{w:97,sh:200,ox:47,y:315,h:105,sw:200,x:721,oy:59}],Death:[{w:107,sh:200,ox:42,y:602,h:105,sw:200,x:324,oy:57},{w:119,sh:200,ox:48,y:262,h:118,sw:200,x:0,oy:44},{w:121,sh:200,ox:61,y:811,h:76,sw:200,x:117,oy:102},{w:121,sh:200,ox:61,y:811,h:76,sw:200,x:238,oy:102},{w:108,sh:200,ox:65,y:380,h:110,sw:200,x:244,oy:49},{w:110,sh:200,ox:59,y:679,h:79,sw:200,x:828,oy:62},{w:69,sh:200,ox:87,y:630,h:72,sw:200,
x:721,oy:68},{w:71,sh:200,ox:89,y:493,h:70,sw:200,x:544,oy:77},{w:87,sh:200,ox:76,y:811,h:60,sw:200,x:591,oy:95},{w:94,sh:200,ox:71,y:522,h:79,sw:200,x:615,oy:89},{w:112,sh:200,ox:70,y:811,h:69,sw:200,x:479,oy:102},{w:120,sh:200,ox:62,y:811,h:74,sw:200,x:359,oy:102}],Hit:[{w:107,sh:200,ox:42,y:0,h:105,sw:200,x:721,oy:57},{w:113,sh:200,ox:39,y:380,h:110,sw:200,x:131,oy:52},{w:110,sh:200,ox:40,y:493,h:107,sw:200,x:326,oy:55},{w:107,sh:200,ox:42,y:105,h:105,sw:200,x:721,oy:57},{w:117,sh:200,ox:41,y:262,
h:116,sw:200,x:234,oy:46},{w:104,sh:200,ox:56,y:0,h:119,sw:200,x:327,oy:43},{w:93,sh:200,ox:67,y:135,h:116,sw:200,x:232,oy:46},{w:97,sh:200,ox:63,y:119,h:118,sw:200,x:327,oy:44},{w:106,sh:200,ox:54,y:135,h:119,sw:200,x:126,oy:43},{w:115,sh:200,ox:44,y:262,h:118,sw:200,x:119,oy:44},{w:116,sh:200,ox:40,y:0,h:114,sw:200,x:431,oy:48},{w:114,sh:200,ox:39,y:228,h:111,sw:200,x:431,oy:51}],spritewidth:200,spriteheight:200,Attack:[{w:108,sh:200,ox:41,y:493,h:106,sw:200,x:436,oy:56},{w:116,sh:200,ox:48,y:707,
h:104,sw:200,x:0,oy:56},{w:110,sh:200,ox:23,y:599,h:80,sw:200,x:828,oy:90},{w:119,sh:200,ox:29,y:811,h:58,sw:200,x:798,oy:91},{w:109,sh:200,ox:68,y:707,h:104,sw:200,x:226,oy:54},{w:106,sh:200,ox:68,y:0,h:106,sw:200,x:615,oy:52},{w:95,sh:200,ox:68,y:420,h:105,sw:200,x:721,oy:53},{w:92,sh:200,ox:68,y:525,h:105,sw:200,x:721,oy:53},{w:93,sh:200,ox:68,y:314,h:104,sw:200,x:615,oy:54},{w:93,sh:200,ox:68,y:418,h:104,sw:200,x:615,oy:54},{w:93,sh:200,ox:68,y:707,h:104,sw:200,x:335,oy:54},{w:93,sh:200,ox:68,
y:707,h:104,sw:200,x:428,oy:54}],Defense:[{w:107,sh:200,ox:42,y:602,h:105,sw:200,x:431,oy:57},{w:87,sh:200,ox:43,y:380,h:110,sw:200,x:352,oy:54},{w:98,sh:200,ox:41,y:493,h:108,sw:200,x:143,oy:56},{w:107,sh:200,ox:41,y:602,h:105,sw:200,x:538,oy:57},{w:70,sh:200,ox:56,y:493,h:109,sw:200,x:73,oy:53},{w:66,sh:200,ox:60,y:220,h:110,sw:200,x:547,oy:52},{w:65,sh:200,ox:61,y:262,h:111,sw:200,x:351,oy:51},{w:68,sh:200,ox:58,y:0,h:110,sw:200,x:547,oy:52},{w:68,sh:200,ox:58,y:110,h:110,sw:200,x:547,oy:52},{w:70,
sh:200,ox:56,y:380,h:110,sw:200,x:439,oy:52},{w:73,sh:200,ox:53,y:493,h:109,sw:200,x:0,oy:53},{w:85,sh:200,ox:44,y:493,h:108,sw:200,x:241,oy:54}],Return:[{w:120,sh:200,ox:28,y:811,h:59,sw:200,x:678,oy:90},{w:126,sh:200,ox:29,y:135,h:127,sw:200,x:0,oy:33},{w:131,sh:200,ox:30,y:380,h:113,sw:200,x:0,oy:49},{w:108,sh:200,ox:41,y:602,h:105,sw:200,x:0,oy:57},{w:116,sh:200,ox:40,y:504,h:95,sw:200,x:828,oy:68},{w:108,sh:200,ox:41,y:602,h:105,sw:200,x:108,oy:57},{w:116,sh:200,ox:38,y:0,h:102,sw:200,x:828,
oy:60},{w:117,sh:200,ox:38,y:811,h:99,sw:200,x:0,oy:63},{w:113,sh:200,ox:42,y:114,h:114,sw:200,x:431,oy:48},{w:102,sh:200,ox:48,y:0,h:133,sw:200,x:225,oy:23},{w:94,sh:200,ox:51,y:0,h:135,sw:200,x:0,oy:11},{w:131,sh:200,ox:31,y:0,h:133,sw:200,x:94,oy:18}],Revival:[{w:108,sh:200,ox:41,y:493,h:106,sw:200,x:436,oy:56},{w:116,sh:200,ox:48,y:707,h:104,sw:200,x:0,oy:56},{w:110,sh:200,ox:23,y:599,h:80,sw:200,x:828,oy:90},{w:119,sh:200,ox:29,y:811,h:58,sw:200,x:798,oy:91},{w:109,sh:200,ox:68,y:707,h:104,sw:200,
x:226,oy:54},{w:106,sh:200,ox:68,y:0,h:106,sw:200,x:615,oy:52},{w:95,sh:200,ox:68,y:420,h:105,sw:200,x:721,oy:53},{w:92,sh:200,ox:68,y:525,h:105,sw:200,x:721,oy:53},{w:93,sh:200,ox:68,y:314,h:104,sw:200,x:615,oy:54},{w:93,sh:200,ox:68,y:418,h:104,sw:200,x:615,oy:54},{w:93,sh:200,ox:68,y:707,h:104,sw:200,x:335,oy:54},{w:93,sh:200,ox:68,y:707,h:104,sw:200,x:428,oy:54}],Skill:[{w:108,sh:200,ox:41,y:493,h:106,sw:200,x:436,oy:56},{w:116,sh:200,ox:48,y:707,h:104,sw:200,x:0,oy:56},{w:110,sh:200,ox:23,y:599,
h:80,sw:200,x:828,oy:90},{w:119,sh:200,ox:29,y:811,h:58,sw:200,x:798,oy:91},{w:109,sh:200,ox:68,y:707,h:104,sw:200,x:226,oy:54},{w:106,sh:200,ox:68,y:0,h:106,sw:200,x:615,oy:52},{w:95,sh:200,ox:68,y:420,h:105,sw:200,x:721,oy:53},{w:92,sh:200,ox:68,y:525,h:105,sw:200,x:721,oy:53},{w:93,sh:200,ox:68,y:314,h:104,sw:200,x:615,oy:54},{w:93,sh:200,ox:68,y:418,h:104,sw:200,x:615,oy:54},{w:93,sh:200,ox:68,y:707,h:104,sw:200,x:335,oy:54},{w:93,sh:200,ox:68,y:707,h:104,sw:200,x:428,oy:54}]};(function(a){var b=btg.sceneManager=new function(){function a(b){btg.eventManager.fireEvent("scene.enter",{name:b.name});b.load(function(){b.onEnter(function(){d=b})})}var c={},d=null;this.registerScene=function(a){if(c[a.sceneId])throw'scene id "'+a.sceneId+'" has been registered';this.scene=a;c[a.sceneId]=a};this.registerScenes=function(a){for(var c=0,d=a.length;c<d;c++)b.registerScene(a[c])};this.unregisterScene=function(a){var b=c[a];if(!b)throw"scene id="+a+" not found";b.destroy();delete c[a]};
this.gotoScene=function(b,e){console.log("gotoScene");var k=c[b];if(!k)throw"scene id="+b+" not found";e&&(k.mapData=e);if(d)d.onExit(function(){d.unload(function(){a(k)})});else a(k)};this.getSceneId=function(){return d.sceneId}},c=a.HUD_Item.extend({init:function(){this.parent();this.name="loadingProgress";this.image=a.loader.getImage("loading_progress");this.pos.x=182;this.pos.y=458},draw:function(a){a.drawImage(this.image,0,0,this.image.width*this.value,this.image.height,this.pos.x,this.pos.y,
this.image.width*this.value,this.image.height)},setValue:function(b){a.game.HUD.setItemValue(this.name,b)}}),d=a.HUD_Item.extend({init:function(b){this.parent();this.name="loading_background";this.image=a.loader.getImage(b)},draw:function(a){a.drawImage(this.image,this.pos.x,this.pos.y)}});a.ScreenObject.extend({});var e=a.ScreenObject.extend({init:function(){this.parent(!0);this.background=new d("loading_screen_bg");this.loadingProgress=new c},onResetEvent:function(){this.loadingProgress.reset();
a.game.HUD.addItem(this.loadingProgress.name,this.loadingProgress);a.game.HUD.addItem(this.background.name,this.background);a.game.sort();console.log("loading screen show")},onDestroyEvent:function(){console.log("loading screen destroy")},hide:function(){console.log("loading screen destroy");a.game.HUD.removeItem(this.background.name);a.game.HUD.removeItem(this.loadingProgress.name)}});e.getInstance=function(){e.instance||(e.instance=new e);return e.instance};btg.Scene=Object.extend({init:function(a){this.sceneId=
a.sceneId;this.loadingScreen=a.loadingScreen||e.getInstance();this.initState()},initState:function(){this.state=a.state.USER++;a.state.set(this.state,this.loadingScreen)},destroy:function(){},gotoScene:function(a){b.gotoScene(a)},onEnter:function(a){a&&a()},onExit:function(a){a&&a()},load:function(a){this.showLoadingScreen();this.loadResources(a)},unload:function(a){this.unloadResources(a)},loadResources:function(b){var c=this;a.loader.onload=function(){b&&b()};if(game_resources[this.sceneId]){var d=
a.event.subscribe(a.event.LOADER_PROGRESS,function(b){c.loadingScreen.loadingProgress.setValue(b);1===b&&a.event.unsubscribe(d)});console.log("loading ["+this.sceneId+"] resources");a.loader.preload(game_resources[this.sceneId])}else console.log("["+this.sceneId+"] resources is empty"),a.loader.onload()},unloadResources:function(b){console.log("unload ["+this.sceneId+"] resources");a.loader.unloadArray(game_resources[this.sceneId]);setTimeout(function(){b&&b()},80)},showLoadingScreen:function(){a.state.change(this.state)},
hideLoadingProgress:function(){this.loadingScreen.hide()}});btg.LevelScene=btg.Scene.extend({init:function(a){this.parent(a);this.levelId=a.levelId;this.isIdLevel=a.isIdLevel;this.isSingleScene=a.isSingleScene;this.orientation=a.orientation},load:function(b){_this=this;this.parent(function(){var c=a.event.subscribe(a.event.LEVEL_LOADED,function(){a.event.unsubscribe(c);_this.loadingScreen.hide()});_this.loadLevel(b)})},loadLevel:function(a){this.isIdLevel?(btg.game.currentIdLevel=this.levelId,btg.game.loadIdLevel(this)):
this.isSingleScene?btg.game.loadSingleScene(this):(btg.game.currentLevel=this.levelId,btg.game.loadLevel(this));a&&a()}});btg.IdLevelScene=btg.LevelScene.extend({init:function(a){a.isIdLevel=1;this.parent(a)},onExit:function(a){btg.game.completeId=!0;this.parent(a)}})})(me);(function(){btg.CharacterChooseScene=btg.Scene.extend({init:function(){this.parent({sceneId:"scene_character_choose"});this.zIndex=1;this.startScene=[{name:"cc_bg",x:0,y:0,visible:!0},{name:"boy",x:246,y:106,visible:!0},{name:"boy_stage",x:200,y:261,visible:!0},{name:"girl",x:577,y:113,visible:!0},{name:"girl_stage",x:526,y:261,flip:!0,visible:!0},{name:"play",x:359,y:414,visible:!0}];this.startScene.items={};for(var a=0;a<this.startScene.length;a++)this.startScene.items[this.startScene[a].name]=
{x:this.startScene[a].x,y:this.startScene[a].y};this.cloudType={1:{width:452,height:276},2:{width:350,height:202}};this.clouds=[{type:1,x:100,y:100},{type:2,x:300,y:300},{type:1,x:400,y:400}]},onEnter:function(){var a=this;a.hideLoadingProgress();me.game.add(new btg.ui.BackGround("cc_bg"),this.zIndex++);for(var b=0;b<this.clouds.length;b++){this.clouds[b].sprite=new me.SpriteObject(this.clouds[b].x,this.clouds[b].y,me.loader.getImage("clouds"+this.clouds[b].type));var c=b;this.clouds[c].tween=(new me.Tween(this.clouds[c].sprite.pos)).to({x:-100},
2E4).onComplete(this.tweenbw.bind(this,c)).start();me.game.add(this.clouds[b].sprite,this.zIndex)}this.zIndex++;this.boyStage=new me.SpriteObject(this.startScene.items.boy_stage.x,this.startScene.items.boy_stage.y,me.loader.getImage("stage"));this.girlStage=new me.SpriteObject(this.startScene.items.girl_stage.x,this.startScene.items.girl_stage.y,me.loader.getImage("stage"));this.girlStage.flipX();me.game.add(this.boyStage,this.zIndex);me.game.add(this.girlStage,this.zIndex);this.zIndex++;this.boy=
new btg.ui.Character(this.startScene.items.boy.x,this.startScene.items.boy.y,"boy",{x:-10,y:10});this.girl=new btg.ui.Character(this.startScene.items.girl.x,this.startScene.items.girl.y,"girl",{x:10,y:10});me.game.add(this.boy,this.zIndex);me.game.add(this.girl,this.zIndex);me.gamestat.add("chooseCharacter","");this.zIndex++;me.game.add(new btg.ui.Button(this.startScene.items.play.x,this.startScene.items.play.y,"play",{click:function(){btg.game.debugFight?a.gotoScene("scene_level_id0"):a.gotoScene("scene_level_0")}}),
this.zIndex++);me.game.sort();console.log("enter scene "+this.sceneId);this.parent.apply(this,arguments)},onExit:function(a){me.game.viewport.fadeIn("#000000",1E3,function(){me.game.reset();seaking.init();a&&a()})},tweenbw:function(a){this.clouds[a].sprite.pos.x=1E3;this.clouds[a].tween.to({x:-1E3},2E4).onComplete(this.tweenbw.bind(this,a)).start()},tweenff:function(a){this.clouds[a].tween.to({x:0},2E4).onComplete(this.tweenbw.bind(this,a)).start()}})})();(function(a){a.game_socket={host:"project.wozlla.com",port:7002,connect:null};a.talk_socket={host:"project.wozlla.com",port:7002,connect:null};a.uc_socket={host:"project.wozlla.com",port:7002,connect:null};a.socket={host:"project.wozlla.com",port:8002,timer:null,loaded:!1,status:{OK:200}};a.position_timer=null;a.initSocket=function(){try{a.eventManager.fireEvent("socket.loading","\u6b63\u5728\u52a0\u8f7d\u8d44\u6e90...");var b=document.getElementsByTagName("head"),c=document.createElement("script");
c.id="socket";c.type="text/javascript";c.src="http://"+a.socket.host+":"+a.socket.port+"/socket.io/socket.io.js";"socket"==b[0].children[b[0].children.length-1].id&&b[0].removeChild(b[0].lastChild);b[0].appendChild(c);a.socket.timer=setTimeout(a.socket.load,3E3);c.onload=function(){a.socket.loaded=!0;clearTimeout(a.socket.timer);a.eventManager.fireEvent("socket.connecting");a.game_socket.connect=io.connect("http://"+a.game_socket.host+":"+a.game_socket.port+"");a.talk_socket.connect=io.connect("http://"+
a.talk_socket.host+":"+a.talk_socket.port+"");a.game_socket.bind();a.talk_socket.bind();window.UI&&window.UI.dev?(UI.init(!0),UI.loading(a.game_socket.getCharacterInfo,ui_resources.mainScene,!0)):a.game_socket.getCharacterInfo();a.eventManager.fireEvent("socket.loading","\u6b63\u5728\u83b7\u53d6\u7528\u6237\u4fe1\u606f...")}}catch(d){console.log(d,d.stack),a.eventManager.fireEvent("socket.disconnect")}};a.socket.load=function(){a.eventManager.fireEvent("socket.reconnecting","\u6b63\u5728\u8fde\u63a5\u670d\u52a1\u5668...")};
a.createMainPlayer=function(){};a.socket.bind=function(){a.socket.connect.on("connect",function(){console.log("socket connect")});a.socket.connect.on("serverList",function(a){console.log(a)})};a.uc_socket.bind=function(){a.uc_socket.connect.on("connect",function(){console.log("uc_socket connect")});a.uc_socket.connect.on("1002",function(a){console.log(a);"200"==a.status&&(localStorage.setItem("registerType",a.registerType),localStorage.setItem("loginName",a.loginName),localStorage.setItem("userId",
a.userId),localStorage.setItem("sessionId",a.sessionId))});a.uc_socket.connect.on("1004",function(a){console.log(a);"200"==a.status&&(localStorage.setItem("registerType",a.registerType),localStorage.setItem("loginName",a.loginName),localStorage.setItem("userId",a.userId),localStorage.setItem("sessionId",a.sessionId))});a.uc_socket.connect.on("1006",function(a){console.log(a);"200"==a.status&&(localStorage.setItem("registerType",a.registerType),localStorage.setItem("loginName",a.loginName),localStorage.setItem("userId",
a.userId),localStorage.setItem("sessionId",a.sessionId))});a.uc_socket.connect.on("1602",function(b){"200"==b.status&&a.eventManager.fireEvent("talk.addMessage",b)})};a.game_socket.bind=function(){a.game_socket.connect.on("connect",function(){console.log("connect")});a.game_socket.connect.on("players",function(b){function c(){a.game_socket.connect.emit("move",a.mainPlayer.pos);a.position_timer=setTimeout(c,200)}console.log("players: "+b);b.forEach(addPlayer);a.position_timer=setTimeout(c,200)});a.game_socket.connect.on("moved",
function(b){var c=a.otherPlayers[b.id];c&&(c.destinationX=b.x,c.destinationY=b.y)});a.game_socket.connect.on("connected",function(a){console.log("connected: "+a);addPlayer(a)});a.game_socket.connect.on("disconnected",function(b){console.log("disconnected: "+b);me.game.remove(a.otherPlayers[b.id]);delete a.otherPlayers[b.id]});a.game_socket.connect.on("1008",function(a){console.log(a)});a.game_socket.connect.on("1010",function(b){console.log(b);a.character={id:0,cId:0,level:1,nickname:"\u6c34\u795e",
maxEnergy:0,energy:0,getEnergySpeed:0,speed:0,lucky:0,life:100,powerful:0,attack:0,skillHurt:0,weaponDef:0,fireDef:0,crit:0,parry:0,hit:0,dodge:0,currentExp:100,needExp:100,photo:"./res/ui/ci/0/0_photo.png",money:0,gameCurrency:0};if(b.status==a.socket.status.OK){for(var c in b)"status"!=c&&(a.character[c]=b[c]);a.character[c].photo="./res/ui/ci/"+a.character[c].cId+"/"+a.character[c].cId+"_photo.png"}a.eventManager.fireEvent("setUserInfo",a.character);a.eventManager.fireEvent("socket.connected");
window.UI&&window.UI.dev&&UI.initMainScene();console.log(JSON.stringify(a.character));console.log(a.character)});a.game_socket.connect.on("1016",function(b){console.log(b);b.status==a.socket.status.OK&&a.eventManager.fireEvent("mainScene.updateMoneyAndExp",b)});a.game_socket.connect.on("1302",function(b){console.log(b);b.status==a.socket.status.OK&&a.eventManager.fireEvent("taskWindow.fillData",b.taskInfo)});a.game_socket.connect.on("1102",function(b){console.log(b);b.status==a.socket.status.OK&&
a.eventManager.fireEvent("goToIdScene",b.induInfo)});a.game_socket.connect.on("1104",function(b){console.log(b);b.status==a.socket.status.OK&&a.eventManager.fireEvent("updateIdScene",b.induInfo)});a.game_socket.connect.on("1012",function(b){console.log(b);b.status==a.socket.status.OK&&a.eventManager.fireEvent("packageWindow.fillData",b.packageInfo)});a.game_socket.connect.on("1014",function(a){console.log(a)})};a.talk_socket.bind=function(){a.talk_socket.connect.on("1602",function(b){"200"==b.status&&
a.eventManager.fireEvent("talk.addMessage",b)});a.talk_socket.connect.on("1606",function(b){"200"==b.status&&a.eventManager.fireEvent("broadcast",b.message)})};a.talkToWorld=function(b){var c=a.uc_socket.getUserInfo();c.message=b;c.lang="zh_CN";a.eventManager.fireEvent("talk.addMessage",c);a.talk_socket.connect.emit("1601",c)};a.socket.getServerList=function(){socket.emit("getServerList")};a.uc_socket.register=function(b,c){var d={registerType:1,loginName:b,password:hex_md5(c)};console.log(d);a.uc_socket.emit("1001",
d)};a.uc_socket.login=function(b,c){var d={registerType:1,loginName:b,password:hex_md5(c)};console.log(d);a.uc_socket.emit("1003",d)};a.uc_socket.loginBySessionId=function(){var a={registerType:1,loginName:"wozlla",userId:100001,sessionId:"29197A14BA49DDFCDA3C48559E413ADF"};console.log(a);uc_socket.emit("1005",a)};a.uc_socket.getUserInfo=function(){return{registerType:1,loginName:"wozlla",userId:100001,sessionId:"29197A14BA49DDFCDA3C48559E413ADF",serverId:1,lang:"zh_CN"}};a.game_socket.createCharacter=
function(){var b=a.uc_socket.getUserInfo();b.characterId=1;b.sex=1;b.nickName="";console.log(b);a.game_socket.connect.emit("1007",b)};a.game_socket.getCharacterInfo=function(){var b=a.uc_socket.getUserInfo();console.log("user info: ",b);a.game_socket.connect.emit("1009",b)};a.game_socket.updateMoneyAndExp=function(b,c){var d=a.uc_socket.getUserInfo();d.money=b;d.experience=c;a.eventManager.fireEvent("socket.loading","\u6b63\u5728\u66f4\u65b0\u7528\u6237\u91d1\u5e01\u548c\u7ecf\u9a8c\u6570\u636e...");
a.game_socket.connect.emit("1015",d)};a.game_socket.getCurrentTaskInfo=function(){var b=a.uc_socket.getUserInfo();b.type=2;console.log(b);a.eventManager.fireEvent("socket.loading","\u6b63\u5728\u83b7\u53d6\u4efb\u52a1\u4fe1\u606f...");a.game_socket.connect.emit("1301",b)};a.game_socket.getTaskInfo=function(b){var c=a.uc_socket.getUserInfo();c.type=1;c.taskId=b;a.eventManager.fireEvent("socket.loading","\u6b63\u5728\u83b7\u53d6\u4efb\u52a1\u4fe1\u606f...");a.game_socket.connect.emit("1301",c)};a.game_socket.getUserInduInfo=
function(b){var c=a.uc_socket.getUserInfo();c.induId=b;a.eventManager.fireEvent("socket.loading","\u6b63\u5728\u83b7\u53d6\u526f\u672c\u6570\u636e...");a.game_socket.connect.emit("1101",c)};a.game_socket.updateUserInduInfo=function(b,c,d){b=a.uc_socket.getUserInfo();b.action="del";b.induId=c;b.indexId=d;a.eventManager.fireEvent("socket.loading","\u6b63\u5728\u66f4\u65b0\u526f\u672c\u6570\u636e...");a.game_socket.connect.emit("1103",b)};a.game_socket.getPackageInfo=function(){var b=a.uc_socket.getUserInfo();
a.eventManager.fireEvent("socket.loading","\u6b63\u5728\u83b7\u53d6\u80cc\u5305\u6570\u636e...");a.game_socket.connect.emit("1011",b)};a.game_socket.updatePackageInfo=function(b,c,d){var e=a.uc_socket.getUserInfo();e.action=b;e.itemId=c;e.itemNum=d;a.eventManager.fireEvent("socket.loading","\u6b63\u5728\u66f4\u65b0\u80cc\u5305\u6570\u636e...");a.game_socket.connect.emit("1013",e)};a.game_socket.broadcast=function(b){var c=a.uc_socket.getUserInfo();c.message=b;a.game_socket.connect.emit("1605",c)}})(btg);(function(){var a=new function(){var a=0,b=this;this.graphWeightCache={};this.searchTileCoordsPath=function(e,f,g){var g=g||me.game.currentLevel.getLayerByName("collision"),h=g.$_graph_hash;h||(h=g.$_graph_hash="graph"+a++);var i=null,i=b.graphWeightCache[h];if(!i){for(var j=g.layerData,i=[],k=j.length,n=j[0].length,s=0;s<k;s++){for(var l=[],q=0;q<n;q++)for(var u=j[s][q]?0:1,m=0;1>m;m++)l.push(u);for(q=0;1>q;q++)i.push(l)}i=new Graph(i);this.graphWeightCache[h]=i}g=b.getRenderer(g);j=g.pixelToTileCoords(e.x,
e.y).ceilSelf();h=g.pixelToTileCoords(f.x,f.y).ceilSelf();j=i.nodes[j.x][j.y];h=i.nodes[h.x][h.y];h.isWall()&&(h=this.searchClosestMovableTileCoords(e,f,i,g));return astar.search(i.nodes,j,h,!0)};this.searchClosestMovableTileCoords=function(a,b,c,d){for(var i=0<b.x-a.x?10:-10,j=10*Math.abs((b.y-a.y)/(b.x-a.x)),j=0<b.y-a.y?j:-j;;)if(b.x-=i,b.y-=j,a=d.pixelToTileCoords(b.x,b.y).ceilSelf(),a=c.nodes[a.x][a.y],!a.isWall())return a;return null};this.searchPixelCoordsPath=function(a,c,g){for(var a=b.searchTileCoordsPath(a,
c,g),g=b.getRenderer(g),c=[],h=0,i=a.length;h<i;h++){var j=g.tileToPixelCoords(a[h].x,a[h].y).ceilSelf();c.push(j)}return c};this.getRenderer=function(a){var a=a||me.game.currentLevel.getLayerByName("collision"),b=a.extension_renderer;if(!b){switch(a.orientation){case "orthogonal":b=new me.TMXOrthogonalRenderer(a.width,a.height,a.tilewidth,a.tileheight);break;case "isometric":b=new me.TMXIsometricRenderer(1*a.width,1*a.height,a.tilewidth/1,a.tileheight/1);break;default:throw"melonJS: "+this.orientation+
" type TMX Tile Map not supported!";}a.extension_renderer=b}return b}},b=new function(){var a=0,b={};this.searchPath=function(e,f,g){var h,i,j,k,n,s,l=e._navMeshKey=e._navMeshKey||"nav_mesh_"+a++,q=[],u=[];h=b[l];if(!h){j=e.length;for(h=0;h<j;h++){n=e[h];k=[];s=n.length;for(i=0;i<s;i++)k.push(new navmesh.Vector2f(n[i][0],n[i][1]));u.push(new navmesh.Polygon(k.length,k))}h=(new navmesh.Delaunay).createDelaunay(u);b[l]=h}for(i=0;i<h.length;i++)e=h[i],e=new navmesh.Cell(e.getVertex(0),e.getVertex(1),
e.getVertex(2)),e.index=i,q.push(e);for(h=0;h<q.length;h++){e=q[h];for(i=0;i<q.length;i++)l=q[i],e!=l&&e.checkAndLink(l)}(f=(new navmesh.NavMesh(q)).findPath(f,g))&&f.shift();return f}};btg.pathSearcher=a;btg.navMeshPathSearcher=b})();btg=btg||{};
(function(a){a.DefaultLoadingScreen=me.DefaultLoadingScreen.extend({init:function(){this.parent(!0);this.logo1.set("century gothic",32,"yellow","middle");this.logo2.set("century gothic",32,"red","middle")},draw:function(a){var c=this.logo1.measureText(a,"wozlla").width,d=(a.canvas.width-c-this.logo2.measureText(a,"Game").width)/2,e=a.canvas.height/2;me.video.clearSurface(a,"black");this.logo1.draw(a,"wozlla",d,e);this.logo2.draw(a,"Game",d+c,e);e+=this.logo1.measureText(a,"wozlla").height/2;c=Math.floor(this.loadPercent*
a.canvas.width);a.strokeStyle="silver";a.strokeRect(0,e,a.canvas.width,6);a.fillStyle="#89b002";a.fillRect(2,e+2,c-4,2)}})})(btg);btg=btg||{};
(function(a){a.StartScreen=me.ScreenObject.extend({startScene:[],clouds:[],init:function(){this.zIndex=1;this.startScene=[{name:"cc_bg",x:0,y:0,visible:!0},{name:"boy",x:246,y:106,visible:!0},{name:"boy_stage",x:200,y:261,visible:!0},{name:"girl",x:577,y:113,visible:!0},{name:"girl_stage",x:526,y:261,flip:!0,visible:!0},{name:"play",x:359,y:414,visible:!0}];this.startScene.items={};for(var a=0;a<this.startScene.length;a++)this.startScene.items[this.startScene[a].name]={x:this.startScene[a].x,y:this.startScene[a].y};
this.cloudType={1:{width:452,height:276},2:{width:350,height:202}};this.clouds=[{type:1,x:100,y:100},{type:2,x:300,y:300},{type:1,x:400,y:400}];this.parent(!0);me.video.clearSurface(me.video.getSystemContext(),"black")},update:function(){},onResetEvent:function(){me.game.add(new a.ui.BackGround("cc_bg"),this.zIndex++);for(var b=0;b<this.clouds.length;b++){this.clouds[b].sprite=new me.SpriteObject(this.clouds[b].x,this.clouds[b].y,me.loader.getImage("clouds"+this.clouds[b].type));var c=b;this.clouds[c].tween=
(new me.Tween(this.clouds[c].sprite.pos)).to({x:-100},2E4).onComplete(this.tweenbw.bind(this,c)).start();me.game.add(this.clouds[b].sprite,this.zIndex)}this.zIndex++;this.boyStage=new me.SpriteObject(this.startScene.items.boy_stage.x,this.startScene.items.boy_stage.y,me.loader.getImage("stage"));this.girlStage=new me.SpriteObject(this.startScene.items.girl_stage.x,this.startScene.items.girl_stage.y,me.loader.getImage("stage"));this.girlStage.flipX();me.game.add(this.boyStage,this.zIndex);me.game.add(this.girlStage,
this.zIndex);this.zIndex++;this.boy=new a.ui.Character(this.startScene.items.boy.x,this.startScene.items.boy.y,"boy",{x:-10,y:10});this.girl=new a.ui.Character(this.startScene.items.girl.x,this.startScene.items.girl.y,"girl",{x:10,y:10});me.game.add(this.boy,this.zIndex);me.game.add(this.girl,this.zIndex);me.gamestat.add("chooseCharacter","");this.zIndex++;me.game.add(new a.ui.Button(this.startScene.items.play.x,this.startScene.items.play.y,"play",{click:function(){me.game.viewport.fadeIn("#000000",
1E3,function(){seaking.initLevel()})}}),this.zIndex++)},tweenbw:function(a){this.clouds[a].sprite.pos.x=1E3;this.clouds[a].tween.to({x:-1E3},2E4).onComplete(this.tweenbw.bind(this,a)).start()},tweenff:function(a){this.clouds[a].tween.to({x:0},2E4).onComplete(this.tweenbw.bind(this,a)).start()},onDestroyEvent:function(){console.log("onDestory")},handleEvent:function(){},draw:function(){},_draw:function(a){a.save();for(var c=0;c<this.startScene.length;c++)this.startScene[c].visible&&a.drawImage(this.startScene[c].image,
this.startScene[c].x,this.startScene[c].y);a.restore()}});a.PlayScreen=me.ScreenObject.extend({currentLevel:0,init:function(){this.parent(!0)},onResetEvent:function(){},onUpdateFrame:function(){me.input.isKeyPressed("left")?me.game.viewport.move(-(me.game.currentLevel.tilewidth/2),0):me.input.isKeyPressed("right")&&me.game.viewport.move(me.game.currentLevel.tilewidth/2,0);me.input.isKeyPressed("up")?me.game.viewport.move(0,-(me.game.currentLevel.tileheight/2)):me.input.isKeyPressed("down")&&me.game.viewport.move(0,
me.game.currentLevel.tileheight/2);this.parent(this)},onDestroyEvent:function(){me.game.disableHUD();me.audio.stopTrack()},draw:function(a){this.parent(a)}});a.FightScreen=me.ScreenObject.extend({init:function(){},onResetEvent:function(){a.game.isFight=!0;a.game.loadLevel(a.game.currentLevel)},onDestroyEvent:function(){me.game.disableHUD();me.audio.stopTrack()},draw:function(){}});a.InstanceDungeonScreen=me.ScreenObject.extend({init:function(){},onResetEvent:function(){a.game.currentScene="id";a.game.loadIdLevel(a.game.currentIdLevel)},
onDestroyEvent:function(){me.game.disableHUD();me.audio.stopTrack()},draw:function(){}})})(btg);var seaking={onload:function(){btg.calculateScreen();me.video.init("jsapp",btg.screen.width,btg.screen.height)?(me.sys.useNativeAnimFrame=!0,me.sys.gravity=0,me.audio.init("mp3"),seaking.init(),console.log("load commons resources"),me.loader.onload=function(){console.log("onload");var a=new btg.CharacterChooseScene;btg.sceneManager.registerScene(a);btg.sceneManager.registerScene(new btg.LevelScene({sceneId:"scene_level_0",loadingScreen:null,levelId:0}));btg.sceneManager.registerScene(new btg.LevelScene({sceneId:"scene_level_1",
loadingScreen:null,levelId:1}));btg.sceneManager.registerScene(new btg.IdLevelScene({sceneId:"scene_level_id0",loadingScreen:null,levelId:0,orientation:"orthogonal"}));btg.sceneManager.registerScene(new btg.LevelScene({sceneId:"scene_level_pray",loadingScreen:null,isSingleScene:1,orientation:"orthogonal"}));btg.sceneManager.registerScene(new btg.LevelScene({sceneId:"scene_level_seamarket",loadingScreen:null,isSingleScene:1,orientation:"orthogonal"}));btg.sceneManager.gotoScene(a.sceneId);me.audio.play("audio_03_01",
!0)},me.loader.preload(game_resources.commons)):alert("Sorry but your browser does not support html 5 canvas.")},init:function(){me.entityPool.add("mainPlayer",btg.PlayerEntity);me.entityPool.add("NpcEntity",btg.NpcEntity);me.entityPool.add("Seaport",btg.Seaport);me.entityPool.add("EnemyBoat",btg.EnemyBoat);me.entityPool.add("FenceEntity",btg.FenceEntity);me.entityPool.add("TreasureEntity",btg.TreasureEntity);me.game.addHUD(0,0,me.video.getWidth(),me.video.getHeight());me.debug.renderHitBox=btg.debug;
me.debug.renderCollisionMap=btg.debug},registerEvent:function(a){btg.isCocoonJS||(me.input.registerMouseEvent("mousedown",a,mouseDown,!0),me.input.registerMouseEvent("mousemove",a,mouseMove,!0),me.input.registerMouseEvent("mouseup",a,mouseUp,!0),me.input.bindKey(me.input.KEY.LEFT,"left"),me.input.bindKey(me.input.KEY.RIGHT,"right"),me.input.bindKey(me.input.KEY.UP,"up"),me.input.bindKey(me.input.KEY.DOWN,"down"))},unregisterEvent:function(a){btg.isCocoonJS||(me.input.releaseMouseEvent("mousedown",
a),me.input.releaseMouseEvent("mousemove",a),me.input.releaseMouseEvent("mouseup",a),me.input.mouse.handlers={})},showMainSceneUI:function(){btg.canvas=UI.getDom("#jsapp > canvas");UI.init(!0);UI.loading(UI.initMainScene,ui_resources.mainScene)},gotoPreviousLevel:function(){me.game.reset();btg.game.currentLevel--;btg.game.loadLevel(btg.game.currentLevel)},gotoNextLevel:function(){me.game.reset();btg.game.currentLevel++;btg.game.loadLevel(btg.game.currentLevel)},gotoLevel:function(a){me.game.reset();
btg.game.currentLevel=a;btg.game.loadLevel(btg.game.currentLevel)},gotoIdLevel:function(a){me.game.reset();btg.game.currentIdLevel=a;btg.game.loadIdLevel(btg.game.currentIdLevel)},reset:function(){me.game.reset();me.levelDirector.loadLevel("map"+btg.game.currentLevel);null==btg.map.graph&&(me.game.sort(),btg.map.graph=btg.map.getGraph())},onUpdateFrame:function(){me.game.update();me.game.draw()},onDestroyEvent:function(){me.game.disableHUD();me.audio.stopTrack()}};(function(a){a.CharacterBase=me.ObjectEntity.extend({isMe:!1,pirateBoatId:0,boatMode:!1,isTalkToNpc:!1,isTalking:!1,isFight:!1,visible:!0,alive:!0,currentScene:"city",pirateBoat:null,pirateBoats:[],mainBoatId:0,fight:null,formation:null,_scale:0.5,gotoEffect:null,id:0,cId:0,level:1,nickname:"\u6c34\u795e",maxEnergy:0,energy:0,getEnergySpeed:0,speed:0,lucky:0,life:100,powerful:0,attack:0,skillHurt:0,weaponDef:0,fireDef:0,crit:0,parry:0,hit:0,dodge:0,currentExp:100,needExp:100,money:100,gameCurrency:100,
currentLife:100,currentAnger:0,buff:[],partner:[],weapon:null,focus:null,_self:null,shadowImg:null,path:null,linePoint:[],currentPos:null,nextPos:null,_updated:!1,x:0,y:0,direction:"down",animation:"down",init:function(a,c,d){this.shadowImg=me.loader.getImage("shadow");this.parent(a,c,d);this.setVelocity(10,10);this.setFriction(0.1,0.1);this.updateColRect(18,46,-1,0);this.photo="./res/ui/ci/"+this.cId+"/"+this.cId+"_photo.png";this.waitTime=55E3;this.gravity=this.timer=0;this.firstUpdates=2;this.animation=
this.direction="down";this.destinationX=a;this.destinationY=c;this.cos225=Math.cos(45*Math.PI/360);this.animationspeed=3;this.motionState="stop";this.moveSpeed=4;this.pathChanged=!1;this.allDirVec={up:{x:0,y:-1},down:{x:0,y:1},right:{x:1,y:0},left:{x:-1,y:0},rightdown:{x:1,y:1},leftup:{x:-1,y:-1},rightup:{x:1,y:-1},leftdown:{x:-1,y:1}};this.__defineGetter__("curX",function(){return this.pos.x+this.width/2});this.__defineGetter__("curY",function(){return this.pos.y+this.height});this.boatMode?(this.renderable.resize(this._scale),
this.initBoatAnimation(a,c,d),this.addLifeProgress(),this.marginTop=this.hHeight/2):this.initAnimation(a,c,d)},initAnimation:function(){var a=this.cId;this.animationspeed=3;this.renderable.addAnimation("stand-down",g_config.character[a].standDown);this.renderable.addAnimation("stand-left",g_config.character[a].standLeft);this.renderable.addAnimation("stand-up",g_config.character[a].standUp);this.renderable.addAnimation("stand-right",g_config.character[a].standRight);this.renderable.addAnimation("stand-leftdown",
g_config.character[a].standLeftDown);this.renderable.addAnimation("stand-leftup",g_config.character[a].standLeftUp);this.renderable.addAnimation("stand-rightup",g_config.character[a].standRightUp);this.renderable.addAnimation("stand-rightdown",g_config.character[a].standRightDown);this.renderable.addAnimation("down",g_config.character[a].down);this.renderable.addAnimation("left",g_config.character[a].left);this.renderable.addAnimation("up",g_config.character[a].up);this.renderable.addAnimation("right",
g_config.character[a].right);this.renderable.addAnimation("leftdown",g_config.character[a].leftDown);this.renderable.addAnimation("leftup",g_config.character[a].leftUp);this.renderable.addAnimation("rightup",g_config.character[a].rightUp);this.renderable.addAnimation("rightdown",g_config.character[a].rightDown)},initBoatAnimation:function(){var a=this.mainBoatId;this.animationspeed=3;this.renderable.addAnimation("stand-down",g_config.pirateBoat[a].standDown);this.renderable.addAnimation("stand-left",
g_config.pirateBoat[a].standLeft);this.renderable.addAnimation("stand-up",g_config.pirateBoat[a].standUp);this.renderable.addAnimation("stand-right",g_config.pirateBoat[a].standRight);this.renderable.addAnimation("stand-leftdown",g_config.pirateBoat[a].standLeftDown);this.renderable.addAnimation("stand-leftup",g_config.pirateBoat[a].standLeftUp);this.renderable.addAnimation("stand-rightup",g_config.pirateBoat[a].standRightUp);this.renderable.addAnimation("stand-rightdown",g_config.pirateBoat[a].standRightDown);
this.renderable.addAnimation("down",g_config.pirateBoat[a].down);this.renderable.addAnimation("left",g_config.pirateBoat[a].left);this.renderable.addAnimation("up",g_config.pirateBoat[a].up);this.renderable.addAnimation("right",g_config.pirateBoat[a].right);this.renderable.addAnimation("leftdown",g_config.pirateBoat[a].leftDown);this.renderable.addAnimation("leftup",g_config.pirateBoat[a].leftUp);this.renderable.addAnimation("rightup",g_config.pirateBoat[a].rightUp);this.renderable.addAnimation("rightdown",
g_config.pirateBoat[a].rightDown)},moveByPath:function(a){this.path=a||[];this.pathChanged=!0},update:function(b){if(this!==a.mainPlayer)return this.parent(this),!0;this.updateInCity(b);(this._updated||b)&&this.parent(this);return this._updated},updateInCity:function(){if(this.pathChanged)if(this.pathChanged=!1,this.nextPos=this.path.shift()){this.nextPos.x-=this.width/2;this.nextPos.y-=100;this.accel.set(this.nextPos.x-this.pos.x,this.nextPos.y-this.pos.y);this.accel.normalize();this.motionState=
"run";for(var b in this.allDirVec){var c=this.accel.x,d=this.accel.y,e=this.allDirVec[b].x,f=this.allDirVec[b].y,c=(c*e+d*f)/(Math.sqrt(c*c+d*d)*Math.sqrt(e*e+f*f));if(1>=c&&c>=this.cos225){this.direction=b;break}}}else this.motionState="stop";"run"===this.motionState?(this.vel.set(this.moveSpeed*this.accel.x*me.sys.fps/me.timer.fps,this.moveSpeed*this.accel.y*me.sys.fps/me.timer.fps),a.game.isFight||this.follow(),this.renderable.setCurrentAnimation(this.direction)):(this.isTalkToNpc&&!this.isTalking&&
(a.eventManager.fireEvent("showDialogue",a.mainPlayer.currentMainTask.taskTalk),this.isTalking=!0),this.vel.set(0,0),this.renderable.setCurrentAnimation("stand-"+this.direction),this._updated=!0);"run"===this.motionState&&(this.pos.add(this.vel),0>=(new me.Vector2d(this.nextPos.x-this.pos.x,this.nextPos.y-this.pos.y)).dotProduct(this.accel)&&(this.pathChanged=!0,0===this.path.length&&this.pos.set(this.nextPos.x,this.nextPos.y)))},follow:function(){me.game.viewport.reset(this.pos.x-me.video.getWidth()/
2+this.width/2,this.pos.y-me.video.getHeight()/2+this.height/2)},setBoatMode:function(){this.renderable.image=me.loader.getImage("pirateBoat0");this.renderable.spritewidth=g_config.pirateBoat[0].width;this.renderable.spriteheight=g_config.pirateBoat[0].height;this.renderable.resize(0.5);this.boatMode=!0},addLifeProgress:function(){this.lifeProgress=new a.ProgressEntity(this,me.ObjectSettings,"life");me.game.add(this.lifeProgress,this.z+10)},draw:function(a){me.game.viewport.overlaps(this)&&(this.drawCharactorName(a,
"\u6c34\u795e"),this.parent(a))},drawCharactorName:function(b,c){var d=this.pos;this.boatMode&&(d=new me.Vector2d(this.pos.x,this.pos.y+this.marginTop));a.drawStokeFont(b,c,d.x,d.y,this,"center")},_draw:function(a){if(this.flickering&&(this.flickerState=!this.flickerState,!this.flickerState))return;var c=~~(this.pos.x-this.vp.pos.x),d=~~(this.pos.y-this.vp.pos.y);if(this.scaleFlag||0!==this.angle){a.save();var e=this.width*this.anchorPoint.x,f=this.height*this.anchorPoint.y;a.translate(c+e,d+f);this.scaleFlag&&
a.scale(this.scale.x,this.scale.y);0!==this.angle&&a.rotate(this.angle);c=-e;d=-f}a.drawImage(this.image,this.offset.x,this.offset.y,this.width,this.height,c,d,this.width,this.height);a.drawImage(this.shadowImg,this.offset.x,this.offset.y,this.width,this.height,c,d,this.width,this.height);(this.scaleFlag||0!==this.angle)&&a.restore();me.debug.renderHitBox&&(this.parent(a,"blue"),this.collisionBox.draw(a,"red"))}})})(btg);(function(a){a.PlayerEntity=a.CharacterBase.extend({init:function(b,c,d,e,f,g){this.isMe=!0;this.cId=e;this.enemy=null;f?(this.boatMode=f,this.mainBoatId=g,d.image="pirateBoat"+this.mainBoatId,this.boatImg=me.loader.getImage(d.image),d.spritewidth=this.boatImg.width,d.spriteheight=this.boatImg.height):(this.boatMode=!1,d.image="character"+this.cId,d.spritewidth=g_config.character[a.character.cId].width,d.spriteheight=g_config.character[a.character.cId].height);this.parent(b,c-d.spriteheight/2,d);
this.follow();f||a.createMainPlayer(this)},update:function(){this.navigatorMap();if(this.boatMode&&"orthogonal"==a.map.style&&!this.doingGoToFight){var b=me.game.collide(this);b&&(b.obj.type==me.game.ENEMY_OBJECT||b.obj.type==g_config.map.object.type.FENCE?(this.enemy=b.obj,this.goToFight()):b.obj.type==g_config.seaport.type.CITY&&this.goToCity(a.game.currentMap.seaport[c].levelId))}this.parent(this);for(var c=0;c<a.game.currentMap.seaport.length;c++)if(this===a.mainPlayer&&a.game.currentMap.seaport[c].overlaps(this)){if(a.game.currentMap.seaport[c].type==
g_config.seaport.type.CITY)return this.goToCity(a.game.currentMap.seaport[c].levelId),!1;if(a.game.currentMap.seaport[c].type==g_config.seaport.type.SEAMARKET)return this.goToSeamarket(),!1;if(a.game.currentMap.seaport[c].type==g_config.seaport.type.PRAY)return this.goToPrayScene(),!1}},navigatorMap:function(){me.input.isKeyPressed("left")?me.game.viewport.move(-60,0):me.input.isKeyPressed("right")&&me.game.viewport.move(60,0);me.input.isKeyPressed("up")?me.game.viewport.move(0,-60):me.input.isKeyPressed("down")&&
me.game.viewport.move(0,60)},goToCity:function(b){this.doingGotoCity||(this.doingGotoCity=!0,seaking.unregisterEvent(a.getScreenRect()),a.sceneManager.gotoScene("scene_level_"+b))},goToInstanceDungeon:function(){this.doingGoToId||(this.doingGoToId=!0,seaking.unregisterEvent(a.getScreenRect()),a.eventManager.fireEvent("getUserInduInfo",{induId:10101}))},goToSeamarket:function(){this.goToScene("scene_level_seamarket")},goToPrayScene:function(){this.goToScene("scene_level_pray")},goToScene:function(b){this.isGoToScene||
(this.isGoToScene=!0,seaking.unregisterEvent(a.getScreenRect()),a.sceneManager.gotoScene(b))},goToFight:function(){var b=this;this.doingGoToFight=!0;seaking.unregisterEvent(a.getScreenRect());a.game.isFight||(seaking.unregisterEvent(a.getScreenRect()),a.eventManager.fireEvent("mainScene.hide"),a.game.boatMode=!1,a.game.isFight=!0,me.game.viewport.fadeIn("#000000",1E3,function(){a.mainPlayer.fight||(me.game.viewport.reset(g_config.map.idLevel[a.game.currentIdLevel].fightSceneX,g_config.map.idLevel[a.game.currentIdLevel].fightSceneY),
a.enemy=new a.EnemyEntity(b.pos.x,b.pos.y,me.ObjectSettings,0),a.eventManager.fireEvent("showFightScene","createCharacterFight"))}))},createBoatFight:function(){a.eventManager.fireEvent("fightScene.show");a.mainPlayer.fight=new a.Fight(a.mainPlayer,a.enemy)},createCharacterFight:function(){a.eventManager.fireEvent("fightScene.show");a.mainPlayer.fight=new a.Fight(a.mainPlayer,a.enemy)},quitBoatFight:function(){var b=this;b.visible=!0;seaking.registerEvent(a.getScreenRect());a.game.isFight&&(a.eventManager.fireEvent("fightScene.hide"),
a.game.boatMode=!0,a.game.isFight=!1,me.game.viewport.fadeIn("#000000",1E3,function(){a.mainPlayer.fight&&(b.enemy.removeAll(),b.follow(),a.eventManager.fireEvent("mainScene.show"),a.mainPlayer.fight.removeAll(),a.mainPlayer.fight=null)}))},quitCharacterFight:function(){var b=this;b.visible=!0;seaking.registerEvent(a.getScreenRect());a.game.isFight&&(a.eventManager.fireEvent("fightScene.hide"),a.game.boatMode=!0,a.game.isFight=!1,me.game.viewport.fadeIn("#000000",1E3,function(){if(a.mainPlayer.fight){if(b.enemy.type==
g_config.map.object.type.FENCE&&b.enemy.hasTreasure){for(var c=b.enemy.treasureId,d=me.game.getEntityByName("TreasureEntity"),e=null,f=0;f<d.length;f++)if(d[f].id==c){e=d[f];break}me.input.registerMouseEvent("mouseup",e,e.mouseUp.bind(e))}a.eventManager.fireEvent("updateUserInduInfo",{action:"del",induId:10101,indexId:b.enemy.indexId});b.enemy.removeAll(function(){b.follow();a.eventManager.fireEvent("mainScene.show");a.mainPlayer.fight.removeAll();b.doingGoToFight=!1;a.mainPlayer.fight=null})}}))}})})(btg);(function(a){a.BoatBase=me.ObjectEntity.extend({cId:0,boatId:0,isFight:!1,visible:!0,alive:!0,formationPosition:0,font:null,lifeProgress:null,angerProgress:null,layer:0,boatImg:null,context:null,effect:null,x:0,y:0,shakeCount:0,shakeTween:[],fontName:"\u5fae\u8f6f\u96c5\u9ed1 bold",fontSize:14,fontColor:"white",effectName:"",_scale:0.5,marginTop:0,boatName:"\u9690\u5f62\u6218\u8230",boatLevel:0,currentLife:100,life:100,maxAnger:150,fullAnger:100,currentAnger:0,attack:100,attackType:1,skillHurt:100,
skillHurtType:1,weaponDef:1,fireDef:1,actionSpeed:1,crit:1,parray:1,hit:1,dodge:1,buff:null,fightData:null,init:function(a,c,d){"undefined"==typeof this.boatId&&(this.boatId=0);d.image="pirateBoat"+this.boatId;this.boatImg=me.loader.getImage(d.image);d.spritewidth=this.boatImg.width;d.spriteheight=this.boatImg.height;a-=this.boatImg.width/4;this.parent(a,c,d);this.renderable.resize(this._scale);this.marginTop=this.hHeight/2;this.setVelocity(0,0);this.x=a;this.y=c;this.setFriction(0.1,0.1);this.initAnimation(a,
c,d);this.isFight?(this.addLifeProgress(),this.addAngerProgress()):(this.addLifeProgress(),this.alive=this.visible=!0,this.setVelocity(6,6),this.collidable=!0,this.startX=a,this.endX=a+200,this.pos.x=a+d.width-d.spritewidth,this.walkLeft=!0)},initAnimation:function(){this.renderable.animationspeed=me.sys.fps/10;this.renderable.addAnimation("standDown",g_config.pirateBoat[this.boatId].standDown)},update:function(a){if(this.isFight)return((updated=this.updateMovement())||a)&&this.parent(this),updated;
if(!this.visible)return!1;this.alive?(this.walkLeft&&this.pos.x<=this.startX?this.walkLeft=!1:!this.walkLeft&&this.pos.x>=this.endX&&(this.walkLeft=!0),this.flipX(this.walkLeft),this.vel.x+=this.walkLeft?-this.accel.x*me.timer.tick:this.accel.x*me.timer.tick):this.vel.x=0;this.updateMovement();if(0!=this.vel.x||0!=this.vel.y)return this.parent(this),!0},onCollision:function(){},gotoPlace:function(){},updateShake:function(){6<=this.shakeCount?(this.pos.x=this.x,this.pos.y=this.y,this.shakeCount=0):
(x=Number.prototype.random(this.pos.x-10,this.pos.x+10),y=Number.prototype.random(this.pos.y-10,this.pos.y+10),this.pos.x=x,this.pos.y=y,this.shakeCount++)},addBoatName:function(b,c){var d=a.game.font.defaultFont.measureText(b,c),d=new me.Vector2d(this.pos.x+this.hWidth-d.width/2,this.pos.y+this.marginTop-d.height);a.drawStokeFont(b,c,d.x,d.y)},addEffectName:function(a,c,d,e){e&&(this.fontName=e);this.fontSize=a;this.fontColor=c;this.effectName=d},addLifeProgress:function(){this.lifeProgress=new a.ProgressEntity(this,
me.ObjectSettings,"life");me.game.add(this.lifeProgress,this.layer+10)},addLife:function(a){this.currentLife+=a;this.currentLife>=this.life&&(this.currentLife=this.life)},subLife:function(a){this.currentLife-=a;0>=this.currentLife&&(this.currentLife=0)},addAngerProgress:function(){this.angerProgress=new a.ProgressEntity(this,me.ObjectSettings,"anger");me.game.add(this.angerProgress,this.layer+10)},addAnger:function(a){this.currentAnger+=a;this.currentAnger>=this.maxAnger&&(this.currentAnger=this.maxAnger)},
subAnger:function(a){this.currentAnger-=a;0>=this.currentAnger&&(this.currentAnger=0)},updateProgress:function(a,c){"life"==a?this.currentLife+=c:this.currentAnger+=c},addEffect:function(b){this.effect=new a.Effect(this,b,me.ObjectSettings);me.game.add(this.effect,this.layer+20)},addBuff:function(){this.buff=new a.Buff(this,me.ObjectSettings);me.game.add(this.buff,this.layer);this.buff.alpha=1;var b=(new me.Tween(this.buff)).to({alpha:0},1E3).onComplete(function(){});b.chain((new me.Tween(this.buff)).to({alpha:1},
1E3).onComplete(function(){}).chain(b));b.start();me.game.sort()},shakeBoat:function(){for(var a=this.pos.x,c=this.pos.y,d=0;10>d;d++)9==d?(a=this.x,c=this.y):(a=Number.prototype.random(this.pos.x-10,this.pos.x+10),c=Number.prototype.random(this.pos.y-10,this.pos.y+10)),this.shakeTween[d]=(new me.Tween(this.pos)).to({x:a,y:c},100),0<d&&this.shakeTween[d-1].chain(this.shakeTween[d]);this.shakeTween[0].start()},fight:function(){},removeAll:function(a){me.game.remove(this.lifeProgress,!0);this.angerProgress&&
me.game.remove(this.angerProgress,!0);me.game.remove(this,!0);a.call(this)},draw:function(b){this.addBoatName(b,this.boatName);""!=this.effectName&&(this.font||(this.font=new a.Font(b,this)),this.font.drawFont(b));this.parent(b)}})})(btg);(function(a){a.PirateBoat=a.BoatBase.extend({init:function(a,c,d,e,f,g,h,i){this.isFight=e?e:!1;this.cId=f;this.boatId=g;this.formationPosition=h;this.layer=i;this.parent(a,c,d);me.game.viewport.follow(this.pos,me.game.viewport.AXIS.BOTH)},update:function(){this.parent(this)},goToCity:function(){if(this.pos.y>me.game.currentLevel.realheight-200)return this.setVelocity(0,0),(new me.Tween(this.pos)).to({x:this.pos.x-60},1E3).onComplete(function(){loading.info.style.display="block";me.game.viewport.fadeIn("#000000",
1E3,function(){seaking.gotoLevel(2)})}).start(),!1}})})(btg);(function(a){a.NpcEntity=me.ObjectEntity.extend({init:function(b,c,d){this.isNpc=!0;this.type="task";this.symbol=null;this.symbolName="";this.isHidden=!0;this.count=0;this.direction="leftdown";this.npcId=d.imageId;d.image="character"+this.npcId;d.spritewidth=g_config.character[this.npcId].width;d.spriteheight=g_config.character[this.npcId].height;b=a.map.getIsometricTileId(b,c);b=a.map.getOrthogonalPosition(b.row,b.col);b.x-=d.spritewidth/2;b.y-=d.spriteheight/2;for(this.showname=g_config.character[this.npcId].name;0<
g_config.taskType.length;){a.character[g_config.taskType[0]].questNpcId==this.npcId&&(this.isHidden=!1,0==a.character[g_config.taskType[0]].status?this.symbolName=g_config.symbolType.EGOLD:1==a.character[g_config.taskType[0]].status?this.symbolName=g_config.symbolType.EGOLD:2==a.character[g_config.taskType[0]].status?this.symbolName=g_config.symbolType.QGOLD:4==a.character[g_config.taskType[0]].status&&(this.symbolName=g_config.symbolType.EGRAY));break}this.paddingLeft=g_config.character[this.npcId].paddingLeft;
this.isHidden=!1;this.parent(b.x,b.y,d);this.initAnimation();""!=this.symbolName&&this.addSymbol(d);10101==this.npcId&&(this.direction="rightdown");this.renderable.setCurrentAnimation("stand-"+this.direction);me.input.registerMouseEvent("mousedown",this,this.mouseDown.bind(this))},initAnimation:function(){this.renderable.addAnimation("stand-leftdown",g_config.character[this.npcId].standLeftDown);this.renderable.addAnimation("shake-leftdown",g_config.character[this.npcId].shakeLeftDown);this.renderable.addAnimation("stand-rightdown",
g_config.character[this.npcId].standRightDown);this.renderable.addAnimation("shake-rightdown",g_config.character[this.npcId].shakeRightDown)},update:function(){if(!this.overlaps(me.game.viewport))return!1;this.renderable.isCurrentAnimation("stand-"+this.direction)?this.visible&&(!this.animationpause&&this.renderable.fpscount>this.renderable.current.animationspeed)&&this.renderable.current.idx==this.renderable.current.length-1&&(6==this.count&&(this.renderable.setCurrentAnimation("shake-"+this.direction),
this.count=this.renderable.current.idx=0),this.count++):this.renderable.current.idx==this.renderable.current.length-1&&(this.renderable.setCurrentAnimation("stand-"+this.direction),this.renderable.current.idx=0);return this.parent(this)},drawName:function(b,c){a.drawStokeFont(b,c,this.pos.x,this.pos.y,this,"center")},draw:function(a){this.isHidden||(this.drawName(a,this.showname),this.parent(a))},addSymbol:function(b){this.symbol=new a.NpcSymbolEntity(this);me.game.add(this.symbol,b.z);me.game.sort()},
drawSymbol:function(a){a.drawImage(this.symbolImg,this.pos.x,this.pos.y)},mouseDown:function(){if(a.mainPlayer.isTalking)return!1;this.mDown=!0;a.eventManager.fireEvent("showDialogue",a.mainPlayer.currentMainTask.taskTalk);a.mainPlayer.isTalking=!0;return!1}});a.NpcSymbolEntity=me.ObjectEntity.extend({init:function(a){this.symbol=a.symbolName;this.isHidden=a.isHidden;this.tweenUp=this.tweenDown=null;this.num=-4;settings={image:"symbol",spritewidth:49,spriteheight:68};this.x=a.pos.x+a.width/2-settings.spritewidth/
2-9+a.paddingLeft;this.y=a.pos.y-settings.spriteheight;this.parent(this.x,this.y,settings);this.initAnimation();this.renderable.setCurrentAnimation(this.symbol)},initAnimation:function(){this.renderable.addAnimation("exclamationMark-gold",[0]);this.renderable.addAnimation("exclamationMark-gray",[1]);this.renderable.addAnimation("questionMark-gold",[2]);this.renderable.addAnimation("questionMark-gray",[3])},changeAnimation:function(a){this.renderable.setCurrentAnimation(a)},move:function(){this.tweenDown=
(new me.Tween(this.pos)).to({y:this.pos.y-10},1E3).onComplete(function(){});this.tweenUp=(new me.Tween(this.pos)).to({y:this.pos.y+10},1E3).onComplete(function(){});this.tweenDown.chain(this.tweenUp.chain(this.tweenDown));this.tweenDown.start()},update:function(){if(!this.overlaps(me.game.viewport))return!1;if(this.visible&&(!this.animationpause&&this.renderable.fpscount>this.renderable.current.animationspeed)&&(this.pos.y+=this.num,this.pos.y<=this.y-10||this.pos.y>=this.y+10))this.num=-this.num;
return this.parent(this)},draw:function(a){this.isHidden||this.parent(a)}})})(btg);(function(a){a.EnemyEntity=a.CharacterBase.extend({cId:0,init:function(a,c,d,e){this.cId=e;this.visible=!1;d.image="character"+e;d.spritewidth=g_config.pirateBoat[this.cId].width;d.spriteheight=g_config.pirateBoat[this.cId].height;this.parent(a,c,d);this.type=me.game.ENEMY_OBJECT},update:function(){this.parent(this)}})})(btg);(function(a){a.EnemyBoat=a.BoatBase.extend({boatId:0,init:function(a,c,d,e,f,g,h,i){d.width=80;d.height=64;(this.isFight=e?e:!1)?(this.cId=f,this.boatId=g,this.formationPosition=h,this.layer=i):(this.boatId=d.bId,this.indexId=d.indexId,this.isFight=e);this.parent(a,c,d);this.type=me.game.ENEMY_OBJECT},update:function(){this.parent(this)}})})(btg);(function(a){a.Formation=Object.extend({cId:0,formation_bg:null,type:{left:"mainPlayer",right:"enemy"},x:0,y:0,position:"left",formationBG:null,boats:{},buff:null,fightSceneX:0,fightSceneY:0,singleBg:!1,init:function(b,c,d,e){this.singleBg=!0;e&&(this.type=e);this.position=b;this.singleBg?(this.formation_singlebg=me.loader.getImage("fightScene"),this.x=c,this.y=d):(this.formation_bg=me.loader.getImage("fi_magic_bg"),this.x="left"==b?c:c+this.formation_bg.width+g_config.formation.bg.marginLeft,this.y=
d+g_config.formation.bg.top);this.boats={};this.partners={};this.fightSceneX=g_config.map.idLevel[a.game.currentIdLevel].fightSceneX;this.fightSceneY=g_config.map.idLevel[a.game.currentIdLevel].fightSceneY;me.game.add(this,999)},createFormation:function(a,c){this.singleBg||this.createBackground(c);"left"==this.position?(this.singleBg&&this.createSingleBackground(),this.addPlayerPartner(a)):this.addEnemyPartner(a)},createBoatFormation:function(a){"left"==this.position?this.addPirateBoat(a):this.addEnemyBoat(a)},
createBackground:function(){this.formationBG=new me.SpriteObject(this.x,this.y,this.formation_bg,this.formation_bg.width,this.formation_bg.height);"left"==this.position&&this.formationBG.flipX(!0);me.game.add(this.formationBG,a.map.fightLayerZ)},createSingleBackground:function(){this.formationBG=new me.SpriteObject(this.x,this.y,this.formation_singlebg,this.formation_singlebg.width,this.formation_singlebg.height);me.game.add(this.formationBG,a.map.fightLayerZ)},removeAll:function(){"left"==this.position?
(this.removeSingleBackground(),this.removePlayerPartner()):this.removeEnemyPartner();me.game.remove(this)},removeSingleBackground:function(){me.game.remove(this.formationBG)},addPlayerPartner:function(b){var c=null,c=0,d;d=this.singleBg?g_config.formationSingle.positions:g_config.formation.positions;for(var e=0;e<d.mainPlayer.length;e++)"object"==typeof b[e]&&(c=1,c=new a.PlayerPartnerEntity(this.getCharacterX("mainPlayer",e,c),this.getCharacterY("mainPlayer",e,c),me.ObjectSettings,c,e,a.map.fightLayerZ),
this.partners["p"+e]=c,me.game.add(c,a.map.fightLayerZ+10))},removePlayerPartner:function(){for(var a in this.partners)this.partners[a].removeAll()},addPirateBoat:function(b){for(var c=null,d=c=0;d<g_config.formation.positions.mainPlayer.length;d++)"object"==typeof b[d]&&(c=b[d].pId,c=new a.PirateBoat(this.getBoatX("mainPlayer",d,c),this.getBoatY("mainPlayer",d,c),me.ObjectSettings,!0,a.mainPlayer.cId,c,d,a.map.fightLayerZ),c.flipX(!0),this.boats["p"+d]=c,me.game.add(c,a.map.fightLayerZ+10))},addEnemyPartner:function(){for(var b=
null,c=b=0;3>c;c++)b=23,b=new a.EnemyPartnerEntity(this.getCharacterX("enemy",c,b),this.getCharacterY("enemy",c,b),me.ObjectSettings,b,c,a.map.fightLayerZ),this.partners["p"+c]=b,me.game.add(b,a.map.fightLayerZ+10)},removeEnemyPartner:function(){for(var a in this.partners)this.partners[a].removeAll()},addEnemyBoat:function(){for(var b=null,c=0;3>c;c++)cId=0,pId=c,b=new a.EnemyBoat(this.getBoatX("enemy",c,pId),this.getBoatY("enemy",c,pId),me.ObjectSettings,!0,cId,pId,c,a.map.fightLayerZ),this.boats["p"+
c]=b,me.game.add(b,a.map.fightLayerZ+10)},getBoatX:function(a,c,d){return this.formationBG.pos.x+g_config.formation.positions[a][c].x-g_config.pirateBoat[d].width/2},getBoatY:function(a,c,d){return this.formationBG.pos.y+g_config.formation.positions[a][c].y-g_config.pirateBoat[d].height},getCharacterX:function(a,c,d){return this.singleBg?this.x+g_config.formationSingle.positions[a][c].x-g_config.character[d].fWidth:this.formationBG.pos.x+g_config.formation.positions[a][c].x-g_config.character[d].fWidth/
2},getCharacterY:function(a,c,d){return this.singleBg?this.y+g_config.formationSingle.positions[a][c].y-g_config.character[d].fHeight-(g_config.character[d].fHeight-80):this.formationBG.pos.y+g_config.formation.positions[a][c].y-g_config.character[d].fHeight},registerEvent:function(){},update:function(){},draw:function(){}})})(btg);(function(a){a.Fight=me.ObjectEntity.extend({player:null,enemy:null,fightSceneX:0,fightSceneY:0,player_formation:null,enemy_formation:null,init:function(b,c){this.player=b;this.enemy=c;this.fightSceneX=g_config.map.idLevel[a.game.currentIdLevel].fightSceneX;this.fightSceneY=g_config.map.idLevel[a.game.currentIdLevel].fightSceneY;this.fpscount=0;this.animationspeed=6;this.animationpause=!1;this.currentFight=null;this.attackSide="left";this.defenseSide="right";this.currentRoundIndex=this.rightRound=
this.leftRound=0;this.fightData=[{attackSide:"left",attackData:{fId:0,action:"common",skill:""},defenseData:{fId:0,action:"hit",reduceBlood:50,addAnger:10}},{attackSide:"right",attackData:{fId:1,action:"common",skill:""},defenseData:{fId:1,action:"dodge",reduceBlood:0,addAnger:0}},{attackSide:"left",attackData:{fId:2,action:"skill",skill:"",hasBuff:!0},defenseData:{fId:2,action:"hit",reduceBlood:50,addAnger:10}},{attackSide:"right",attackData:{fId:0,action:"common",skill:""},defenseData:{fId:0,action:"hit",
reduceBlood:10,addAnger:10}},{attackSide:"left",attackData:{fId:1,action:"common",skill:""},defenseData:{fId:1,action:"hit",reduceBlood:50,addAnger:10}},{attackSide:"right",attackData:{fId:2,action:"common",skill:""},defenseData:{fId:2,action:"hit",reduceBlood:10,addAnger:10}},{attackSide:"left",attackData:{fId:0,action:"common",skill:""},defenseData:{fId:0,action:"hit",reduceBlood:50,addAnger:10}},{attackSide:"right",attackData:{fId:1,action:"common",skill:""},defenseData:{fId:1,action:"hit",reduceBlood:10,
addAnger:10}},{attackSide:"left",attackData:{fId:2,action:"common",skill:""},defenseData:{fId:2,action:"hit",reduceBlood:50,addAnger:10}}];this.createFormation(!1);this.beginFight=!0;me.game.add(this,999)},createFormation:function(b){var c;b?c=b=0:(b=me.game.viewport.pos.x,c=me.game.viewport.pos.y);this.player_formation=new a.Formation("left",b,c);this.player_formation.createFormation(this.player.formation);this.enemy_formation=new a.Formation("right",b,c);this.enemy_formation.createFormation(this.enemy);
me.game.sort();me.game.viewport.reset(this.fightSceneX,this.fightSceneY)},setCurrentFight:function(){this.currentFight=this.fightData.shift();"left"==this.currentFight.attackSide?(this.attackSide=this.player_formation,this.defenseSide=this.enemy_formation,this.attackEntity=this.attackSide.partners["p"+this.currentFight.attackData.fId],this.defenseEntity=this.defenseSide.partners["p"+this.currentFight.defenseData.fId],this.leftRound++,a.eventManager.fireEvent("fightScene.updateLeftRound",this.leftRound)):
(this.attackSide=this.enemy_formation,this.defenseSide=this.player_formation,this.attackEntity=this.attackSide.partners["p"+this.currentFight.attackData.fId],this.defenseEntity=this.defenseSide.partners["p"+this.currentFight.defenseData.fId],this.rightRound++,a.eventManager.fireEvent("fightScene.updateRightRound",this.rightRound))},update:function(){if(!a.game.isFight)return!1;if(null==this.fightData||0==this.fightData.length)return a.eventManager.fireEvent("fight.fightSettle",{star:2,items:{fightLevel:{exp:10,
money:1E3},fightReward:{exp:10,money:1E3}}}),!1;if(this.visible&&!this.animationpause&&this.fpscount++>this.animationspeed)return this.fpscount=0,this.beginFight||this.attackEntity.isFightEnd&&this.defenseEntity.isFightEnd?(this.setCurrentFight(),this.attackEntity.beginFight(this.currentFight,this.defenseEntity),this.beginFight=!1,!0):!1},updateBoat:function(){this.attackSide.boats["p"+this.currentFight.attackData.fId].addEffectName(20,"blue","\u653b\u51fb+20");this.attackSide.boats["p"+this.currentFight.attackData.fId].addBuff();
this.defenseSide.boats["p"+this.currentFight.defenseData.fId].subLife(20);this.defenseSide.boats["p"+this.currentFight.defenseData.fId].addEffectName(20,"red","\u547d\u4e2d-10");this.defenseSide.boats["p"+this.currentFight.defenseData.fId].addAnger(10);this.defenseSide.boats["p"+this.currentFight.defenseData.fId].shakeBoat();this.defenseSide.boats["p"+this.currentFight.defenseData.fId].addEffect("fire_001")},removeAll:function(){this.player_formation.removeAll();this.enemy_formation.removeAll();me.game.remove(this)},
draw:function(){},fight:function(){}})})(btg);(function(a){a.ProgressEntity=me.ObjectEntity.extend({currentPosition:100,type:"life",bgImgName:"fi_life_bg",bgImg:null,leftImg:null,rightImg:null,centerImg:null,prefix:"fi_",suffix_left:"_left",suffix_center:"_center",suffix_right:"_right",x:0,y:0,anchor:0,paddingTop:3,paddingLeft:3,paddingRight:7,beginX:0,beginY:0,length:0,updated:!0,entity:null,percent:0,init:function(a,c,d){this.type=d;this.bgImg=me.loader.getImage(this.bgImgName);c.image=this.bgImgName;c.spritewidth=this.bgImg.width;c.spriteheight=
this.bgImg.height;this.leftImg=me.loader.getImage(this.prefix+this.type+this.suffix_left);this.rightImg=me.loader.getImage(this.prefix+this.type+this.suffix_right);this.centerImg=me.loader.getImage(this.prefix+this.type+this.suffix_center);this.x=a.pos.x+a.hWidth;this.x-=this.bgImg.width/2;this.y=a.pos.y+a.marginTop;this.length=this.bgImg.width-2*this.leftImg.width-2*this.paddingLeft;"anger"==this.type&&(this.y+=this.bgImg.height);this.beginX=this.x+this.paddingLeft;this.beginY=this.y+this.paddingTop;
this.entity=a;this.animationspeed=me.sys.fps/1},update:function(){"life"==this.type?this.percent=this.entity.currentLife/this.entity.life:(this.percent=this.entity.currentAnger/this.entity.fullAnger,1<=this.percent&&(this.percent=1));this.x=this.entity.pos.x+this.entity.hWidth;this.y=this.entity.pos.y+this.entity.marginTop;this.x-=this.bgImg.width/2;"anger"==this.type&&(this.y+=this.bgImg.height);this.beginX=this.x+this.paddingLeft;this.beginY=this.y+this.paddingTop},draw:function(a){this.updated&&
(a.save(),this.drawBackground(a),0!=this.percent&&(this.drawLeft(a),this.drawCenter(a),this.drawRight(a)),a.restore())},drawBackground:function(a){a.drawImage(this.bgImg,this.x,this.y)},drawLeft:function(a){a.drawImage(this.leftImg,this.beginX,this.beginY)},drawCenter:function(a){a.drawImage(this.centerImg,0,0,this.centerImg.width,this.centerImg.height,this.beginX+this.leftImg.width,this.beginY,this.length*this.percent,this.centerImg.height)},drawRight:function(a){a.drawImage(this.rightImg,this.beginX+
this.leftImg.width+this.length*this.percent,this.beginY)}})})(btg);(function(a){a.Buff=me.ObjectEntity.extend({cId:0,boatId:0,buffImg:null,buffImgName:null,suffix:"_buff",init:function(a,c){x=a.pos.x+a.hWidth;y=a.pos.y+a.marginTop;a.cId=0;this.buffImgName=a.cId+this.suffix;this.buffImg=me.loader.getImage(this.buffImgName);x-=2*this.buffImg.width;c.image=this.buffImgName;c.spritewidth=this.buffImg.width;c.spriteheight=this.buffImg.height;this.cId=a.cId;this.boatId=a.boatId;this.parent(x,y,c)},update:function(){this.parent(this)},draw:function(a){var c=a.globalAlpha;
a.globalAlpha=this.alpha;this.parent(a);a.globalAlpha=c}})})(btg);(function(a){a.MultipleImageLayer=Object.extend({ratio:1,init:function(a,c,d,e,f,g,h){this.name=a;this.images=[];for(a=0;a<g.length;a++)for(var i=0;i<g[a].length;i++)if(g[a][i]){var j="string"===typeof g[a][i]?me.loader.getImage(g[a][i]):g[a][i];this.images.push({rect:{top:a*e,left:i*f,right:i*e+e,bottom:a*f+f},image:j})}0===this.images.length&&console.log("melonJS: can't read images in MultipleImageLayer");this.imagewidth=e;this.imageheight=f;this.z=h;this.ratio=1;this.lastpos=me.game.viewport.pos.clone();
this.offset=new me.Vector2d(0,0);this.width=c?Math.min(me.game.viewport.width,c):me.game.viewport.width;this.height=d?Math.min(me.game.viewport.height,d):me.game.viewport.height;this.visible=!0;this.opacity=1},reset:function(){this.offset=this.viewport=this.lastpos=this.image=null},getOpacity:function(){return this.opacity},setOpacity:function(a){a&&(this.opacity=a.clamp(0,1))},update:function(){if(0!==this.ratio){var a=me.game.viewport.pos;if(!this.lastpos.equals(a))return this.offset=a.clone(),
this.lastpos.setV(a),!0}return!1},draw:function(a){var c=this.images;if(1>this.opacity){var d=a.globalAlpha;a.globalAlpha=this.opacity}for(var e=0,f=c.length;e<f;e++){var g=c[e].rect;c[e].image&&me.game.viewport.overlaps(g)&&a.drawImage(c[e].image,g.left,g.top)}1>this.opacity&&(a.globalAlpha=d)}})})(btg);(function(){for(var a=[],b={},c=0;4>c;c++){var d=document.createElement("canvas");d.width=1024;d.height=1024;a.push(d)}btg.CanvasImageLayer=btg.MultipleImageLayer.extend({init:function(c,d,g,h,i,j,k,n){this.parent(c,d,g,h,i,j,k);this.landLayers=n;for(c=0;c<this.images.length;c++)this.images[c].key=this.images[c].image;for(var s in b)b[s]&&a.push(b[s]);b={}},draw:function(c){for(var d=this.images,g=this.landLayers,h=0,i=d.length;h<i;h++){var j=d[h].rect,k=d[h].key,n=b[k];if(me.game.viewport.overlaps(j)){if(!n){n=
a.shift();n.width=0;n.width=1024;b[k]=n;k=n.getContext("2d");k.save();k.translate(-j.left,-j.top);for(var s=0;s<g.length;s++){var l=g[s],q=k.globalAlpha;k.globalAlpha=l.opacity;l.renderer.drawTileLayer(k,l,{x:j.left,y:j.top},{pos:{x:0,y:0},width:1024,height:1024});l.visible=!1;c.globalAlpha=q}k.restore()}c.drawImage(n,j.left,j.top)}else n&&(a.push(n),b[k]=!1)}}})})();(function(a){a.Seaport=me.ObjectEntity.extend({id:1,newAngle:0,imgName:"seaport_001",img:null,init:function(b,c,d){this.img=me.loader.getImage(this.imgName);d.image?b={x:b,y:c}:(d.image=this.imgName,d.spritewidth=169,d.spriteheight=109,"isometric"==a.map.style?(b=a.map.getIsometricTileId(b,c),b=a.map.getOrthogonalPosition(b.row,b.col)):b={x:b,y:c});this.parent(b.x,b.y,d);this.type="seaport"+d.type;this.levelId=d.levelId;a.map.playerLayerZ=d.z;this.initAnimation();a.game.currentMap.seaport.push(this)},
initAnimation:function(){this.setVelocity(1,1);this.renderable.addAnimation("seaport",[0,1,2,3,4,5,6,7]);this.renderable.setCurrentAnimation("seaport")},onCollision:function(){this.collidable=!1},update:function(){this.newAngle+=20;360<this.newAngle&&(this.newAngle=0);this.parent(this);return!0},drawParticle:function(){}})})(btg);
function particle(){var a={};this.speed={x:-2.5+5*Math.random(),y:-15+10*Math.random()};this.location=a.x&&a.y?{x:a.x,y:a.y}:{x:me.video.getWidth()/2,y:me.video.getHeight()/2};this.radius=10+20*Math.random();this.remaining_life=this.life=20+10*Math.random();this.r=Math.round(255*Math.random());this.g=Math.round(255*Math.random());this.b=Math.round(255*Math.random())};(function(a){a.Effect=me.ObjectEntity.extend({id:0,effectName:"fire_001",effectImg:null,entity:null,init:function(a,c,d){x=a.pos.x+a.hWidth;y=a.pos.y+a.marginTop;this.effectName=c;d.image=this.effectName;d.spritewidth=g_config.effects[this.effectName].width;d.spriteheight=g_config.effects[this.effectName].height;x-=d.spritewidth/2;this.entity=a;this.parent(x,y,d);this.type=g_config.map.object.type.EFFECT;this.initAnimation(x,y,d)},initAnimation:function(){this.setVelocity(1,1);this.renderable.setCurrentAnimation("default")},
onCollision:function(){this.collidable=!1},update:function(){this.renderable.current.idx==this.renderable.current.length-1&&me.game.remove(this);this.parent(this);return!0},destroy:function(){}})})(btg);(function(a){a.Font=Object.extend({id:0,type:1,fontName:"\u5fae\u8f6f\u96c5\u9ed1 bold",fontSize:"14",fontColor:"white",font:null,fontImgName:"",fontImg:null,text:"",x:0,y:0,alpha:1,container:null,init:function(a,c){this.fontName=c.fontName;this.fontSize=c.fontSize;this.fontColor=c.fontColor;this.font=new me.Font(this.fontName,this.fontSize,this.fontColor);var d=this.font.measureText(a,c.effectName),d=new me.Vector2d(c.pos.x+c.hWidth-d.width/2,c.pos.y);this.x=d.x;this.y=d.y;this.container=c;this.text=
c.effectName;(new me.Tween(this)).to({y:this.y-50,alpha:0},3E3).onComplete(function(){c.effectName=""}).start()},measureText:function(){},update:function(){},draw:function(a){this.drawFont(a)},drawFont:function(a){a.globalAlpha=this.alpha;this.font.draw(a,this.text,this.x,this.y);a.globalAlpha=1}})})(btg);(function(a){a.Click=me.ObjectEntity.extend({id:0,init:function(a,c,d,e){x=c.x;y=c.y;e?this.effectName=e.image:(this.effectName="click_000",e={},e.image=this.effectName,e.spritewidth=64,e.spriteheight=128);(this.canWalk=d)?(y-=e.spriteheight-40,x-=e.spritewidth/2):(x-=e.spritewidth/2,y+=e.spriteheight/2);this.parent(x,y,e);this.initAnimation(x,y,e)},initAnimation:function(){this.animationspeed=1},onCollision:function(){this.collidable=!1},update:function(){if(this.current.idx==this.spritecount.x-
1)return me.game.remove(this),me.game.sort(),!1;this.parent(this);return!0}})})(btg);btg.ui=btg.ui||{};
(function(a){a.BackGround=me.SpriteObject.extend({init:function(a){this.image=me.loader.getImage(a);y=x=0;this.parent(x,y,this.image)},draw:function(a){me.video.clearSurface(a,"black");this.parent(a)}});a.Button=me.SpriteObject.extend({init:function(a,c,d,e){this.imageName=d;for(var f in e)this[f]=e[f];this.image=me.loader.getImage(this.imageName);this.parent(a,c,this.image);me.input.registerMouseEvent("mousedown",this,this._mousedown.bind(this));me.input.registerMouseEvent("mouseup",this,this._mouseup.bind(this))},
_click:function(){return this.click?(this.click(),!0):!1},_mousedown:function(){this.image=me.loader.getImage(this.imageName+"_h");me.game.sort()},_mousemove:function(){},_mouseup:function(a){this.image=me.loader.getImage(this.imageName);me.game.sort();this._click(a);return!1}});a.Character=me.AnimationSheet.extend({init:function(a,c,d,e,f){this.imageName=d;for(var g in f)this[g]=f[g];this.image=me.loader.getImage(this.imageName);this.cId="boy"==this.imageName?1:0;this.x=a;this.y=c;this.selectOffset=
e;"boy"==this.imageName?(this.parent(a-30,c-50,this.image,182,302),this.initAnimation(),this.setCurrentAnimation("standDown")):this.parent(a,c,this.image);me.input.registerMouseEvent("mousedown",this,this._mousedown.bind(this));me.input.registerMouseEvent("mouseup",this,this._mouseup.bind(this))},initAnimation:function(){this.addAnimation("standDown",[0,1,2,3,4,5,6,7,8,9,10,11])},_click:function(){return this.click?(this.click(),!0):!1},_mousedown:function(){},_mousemove:function(){},_mouseup:function(a){if(""==
me.gamestat.getItemValue("chooseCharacter")||me.gamestat.getItemValue("chooseCharacter").imageName!=this.imageName)this.pos.x+=this.selectOffset.x,this.pos.y+=this.selectOffset.y,""!=me.gamestat.getItemValue("chooseCharacter")&&(me.gamestat.getItemValue("chooseCharacter").pos.x=me.gamestat.getItemValue("chooseCharacter").x,me.gamestat.getItemValue("chooseCharacter").pos.y=me.gamestat.getItemValue("chooseCharacter").y),btg.character.cId=this.cId,me.gamestat.setValue("chooseCharacter",this);this._click(a);
return!1}});a.MoveableEntity=me.AnimationSheet.extend({init:function(a,c,d,e,f){"string"==typeof d&&(d=me.loader.getImage(d));this.parent(a,c,d,e,f);me.input.registerMouseEvent("mousedown",this,this.mouseDown.bind(this));me.input.registerMouseEvent("mouseup",this,this.mouseUp.bind(this));me.input.registerMouseEvent("mousemove",null,this.mouseMove.bind(this))},mouseUp:function(){this.mDown=!1;me.sys.touch&&this.mouseout()},mouseDown:function(){this.mDown=!0;me.sys.touch&&(mX=me.input.mouse.pos.x,mY=
me.input.mouse.pos.y);this.v=new me.Vector2d(mX-this.left,mY-this.top);return!1},mouseMove:function(){mX=me.input.mouse.pos.x;mY=me.input.mouse.pos.y;return this.mDown?(this.pos.x=mX-this.v.x,this.pos.y=mY-this.v.y,!1):!0}});a.mainScene=me.HUD_Item.extend({leftTop:null,leftBottom:null,rightTop:null,init:function(a,c){this.parent(a,c);this.leftTop=[];this.leftBottom=[];this.rightTop=[]},draw:function(){}});a.path=me.HUD_Item.extend({init:function(a,c,d){this.parent(a,c);this.x=a;this.y=c;this.path=
[].concat(d)},draw:function(a){var c=me.game.viewport.pos,d=this.path;a.save();a.beginPath();a.lineWidth=4;a.strokeStyle="red";a.moveTo(d[0].x-c.x,d[0].y-c.y);for(var e=1;e<d.length;e++)a.lineTo(d[e].x-c.x,d[e].y-c.y);a.stroke();a.restore()}});a.polygonShape=me.ObjectEntity.extend({init:function(a,c,d,e){this.polygonV=e},update:function(){return!0},draw:function(){}});a.rect=me.HUD_Item.extend({init:function(a,c,d,e,f,g){this.parent(a,c);this.x=a;this.y=c;this.width=d;this.height=e;this.sideLength=
Math.round(Math.sqrt(Math.pow(this.width,2)+Math.pow(this.height,2)));this.path=f;this.type=g},draw:function(a){this.drawPath(a)},drawPath:function(a){a.save();a.translate(this.x,this.y);a.fillStyle="black";a.fillText("orthogonal x:"+(me.game.viewport.pos.x+this.x)+" y:"+(me.game.viewport.pos.y+this.y),-43,0);var c=0,c=me.game.viewport.pos.x+this.x-me.game.currentLevel.realwidth/2;a.fillText("isometric x:"+c+" y:"+(me.game.viewport.pos.y+this.y-me.game.currentLevel.tileheight/2),-43,10);a.fillText("ort_tiled x:"+
Math.floor((me.game.viewport.pos.y+this.y)/me.game.currentLevel.tileheight)+" y:"+Math.floor((me.game.viewport.pos.x+this.x)/me.game.currentLevel.tilewidth),-43,20);a.fillText("iso_tiled x:"+Math.floor((me.game.viewport.pos.y+this.y-me.game.currentLevel.tileheight/2)/(me.game.currentLevel.tileheight/2))+" y:"+Math.floor(c/(me.game.currentLevel.tilewidth/2)),-43,30);a.fillStyle="green";a.globalAlpha=0.6;a.scale(1,0.5);a.rotate(45*Math.PI/180);a.fillRect(0,0,this.sideLength/2,this.sideLength/2);a.globalAlpha=
0.2;a.fillStyle="yellow";a.restore();a.save();if(0<this.path.length){var c=null,d=btg.mainPlayer.pos.x-me.game.viewport.pos.x+btg.mainPlayer.width/2,e=btg.mainPlayer.pos.y-me.game.viewport.pos.y+btg.mainPlayer.height;a.translate(d,e);a.beginPath();a.strokeStyle="#000000";a.arc(0,0,5,0,2*Math.PI);for(var f=0;f<this.path.length;f++)c=1==this.type?convertToOrthogonalPixel(this.path[f].pos.x,this.path[f].pos.y,1):btg.map.isometricGridXY[this.path[f].pos.x][this.path[f].pos.y].orthogonal,a.lineTo(c.x-
20-me.game.viewport.pos.x+btg.mainPlayer.width/2-d,c.y+20-me.game.viewport.pos.y+btg.mainPlayer.height-e),a.arc(c.x-20-me.game.viewport.pos.x+btg.mainPlayer.width/2-d,c.y+20-me.game.viewport.pos.y+btg.mainPlayer.height-e,5,0,2*Math.PI);a.stroke()}a.restore()}});a.loading=me.HUD_Item.extend({allcount:0,count:0,init:function(){this.leftImg;this.loadingImg;this.rightImg},draw:function(){}})})(btg.ui);(function(a){a.FenceEntity=me.ObjectEntity.extend({init:function(a,c,d){d.image="id_items1";d.spritewidth=334;d.spriteheight=272;var e=me.game.currentLevel.realheight;this.position="top";c-=d.spriteheight;c>e/2?(this.position="bottom",a-=60,c+=100):c+=70;this.parent(a,c,d);this.type=g_config.map.object.type.FENCE;if(this.hasTreasure=!d.fence.treasure.disable)this.treasureId=d.indexId;this.indexId=d.indexId;this.name="FenceEntity";this.collidable=!0;this.initAnimation();this.renderable.setCurrentAnimation(this.position+
"Fence")},initAnimation:function(){this.renderable.addAnimation("topFence",[0]);this.renderable.addAnimation("bottomFence",[1])},onCollision:function(){},update:function(){this.parent(this);return!0},draw:function(a){this.parent(a)},removeAll:function(a){me.game.remove(this,!0);a.call(this)}})})(btg);(function(a){a.TreasureEntity=me.ObjectEntity.extend({showItemId:0,items:[],name:"chest_001",init:function(a,c,d){d.image=this.name;d.spritewidth=g_config.effects[this.name].width;d.spriteheight=g_config.effects[this.name].height;this.parent(a,c,d);this.type=g_config.map.object.type.TREASURE;this.id=d.indexId;this.name="TreasureEntity";this.initAnimation();this.opened?this.renderable.setCurrentAnimation("opened"):this.renderable.setCurrentAnimation("close")},initAnimation:function(){this.renderable.addAnimation("close",
[0]);this.renderable.addAnimation("opened",[3])},mouseDown:function(){this.open()},mouseUp:function(){this.open();return!1},open:function(){this.renderable.setCurrentAnimation("opened");var b=new a.TreasureItemEntity(this,me.ObjectSettings);me.game.add(b,this.z);me.game.sort()},update:function(){this.parent(this)},draw:function(a){this.parent(a)}});a.TreasureItemEntity=me.ObjectEntity.extend({showItemId:0,items:[],treasure:null,itemName:"1000",_scale:0.5,init:function(a,c){this.treasure=a;var d=me.loader.getImage(this.itemName);
c.image=this.itemName;c.spritewidth=d.width;c.spriteheight=d.height;this.x=a.pos.x-a.width/2;this.y=a.pos.y-a.height;this.parent(this.x,a.pos.y,c);this.renderable.resize(this._scale);this.initAnimation()},initAnimation:function(){},update:function(){this.pos.y>this.y&&(this.pos.y-=20);this.parent(this)},draw:function(a){this.parent(a)}})})(btg);(function(a){a.CharacterPartnerBase=me.ObjectEntity.extend({isMe:!1,isFight:!0,isFightEnd:!1,visible:!0,alive:!0,fight:null,formation:null,id:0,cId:0,level:1,nickname:"\u6c34\u795e",maxEnergy:0,energy:0,getEnergySpeed:0,speed:0,lucky:0,life:100,powerful:0,attack:0,skillHurt:0,weaponDef:0,fireDef:0,crit:0,parry:0,hit:0,dodge:0,currentExp:100,needExp:100,money:100,gameCurrency:100,fightState:g_config.fight.fightState.stand,attackRange:100,skillRange:100,distanceEnemy:100,buff:[],fontName:"\u5fae\u8f6f\u96c5\u9ed1 bold",
fontSize:14,fontColor:"white",effectName:"",currentLife:100,currentAnger:0,animationFrame:[],fightData:null,animationsName:{"f-attack":"Attack","f-death":"Death","f-defense":"Defense","f-hit":"Hit","f-return":"Return","f-revival":"Revival","f-skill":"Skill","f-stand":"Stand"},_self:null,shadowImg:null,_updated:!1,x:0,y:0,direction:"L",init:function(a,c,d){this.shadowImg=me.loader.getImage("shadow");this.parent(a,c,d);this.setVelocity(10,10);this.setFriction(0.1,0.1);this.marginTop=this.hHeight/2;
this.updateColRect(18,46,-1,0);this.photo="./res/ui/ci/"+this.cId+"/"+this.cId+"_photo.png";this.waitTime=55E3;this.gravity=this.timer=0;this.direction="L";this.action="stand";this.moveSpeed=10;this.fps=24;this.frames=g_config.character[this.cId].frames;this.points=[];this.originalPos=new me.Vector2d(a,c);this.__defineGetter__("curX",function(){return this.pos.x+this.width/2});this.__defineGetter__("curY",function(){return this.pos.y+this.height});for(var e=0;e<this.renderable.spritecount.x*this.renderable.spritecount.y;e++)this.animationFrame[e]=
e;this.initAnimation(a,c,d);this.addLifeProgress(100);this.addAngerProgress()},initAnimation:function(){var a=this.cId;this.renderable.animationspeed=6;this.renderable.addAnimation(this.animationsName["f-attack"],g_config.character[a].fAttack);this.renderable.addAnimation(this.animationsName["f-death"],g_config.character[a].fDeath);this.renderable.addAnimation(this.animationsName["f-defense"],g_config.character[a].fDefense);this.renderable.addAnimation(this.animationsName["f-hit"],g_config.character[a].fHit);
this.renderable.addAnimation(this.animationsName["f-return"],g_config.character[a].fReturn);this.renderable.addAnimation(this.animationsName["f-revival"],g_config.character[a].fRevival);this.renderable.addAnimation(this.animationsName["f-skill"],g_config.character[a].fSkill);this.renderable.addAnimation(this.animationsName["f-stand"],g_config.character[a].fStand)},initFight:function(){this.fightState=g_config.fight.fightState.attackGo;this.enemy.fightState=g_config.fight.fightState.defenseBegin;this.isFightEnd=
!1;this.enemy.isFightEnd=!1},update:function(){if(!this.enemy)return this.parent(this);if(0>=this.currentLife){if(this.renderable.current.idx==this.renderable.current.length-1)return!1;this.parent(this);return!0}this._updated=!0;this.isAttack&&(this.renderable.isCurrentAnimation(this.animationsName["f-attack"])&&7==this.renderable.current.idx&&(this._updated=this.isAttack=!1,this.accel.set(this.nextPos.x-this.pos.x,this.nextPos.y-this.pos.y),this.accel.normalize(),this.action="doAttack"),this.renderable.isCurrentAnimation(this.animationsName["f-skill"])&&
16==this.renderable.current.idx&&(this._updated=this.isAttack=!1,this.accel.set(this.nextPos.x-this.pos.x,this.nextPos.y-this.pos.y),this.accel.normalize(),this.action="doAttack"));this.isReturn&&(this.renderable.isCurrentAnimation(this.animationsName["f-return"])&&7==this.renderable.current.idx)&&(this.accel.set(this.nextPos.x-this.pos.x,this.nextPos.y-this.pos.y),this.accel.normalize(),this.action="doReturn");if("doAttack"==this.action||"doReturn"==this.action){this.vel.set(this.moveSpeed*this.accel.x*
me.sys.fps/me.timer.fps,this.moveSpeed*this.accel.y*me.sys.fps/me.timer.fps);this.pos.add(this.vel);var a=(new me.Vector2d(this.nextPos.x-this.pos.x,this.nextPos.y-this.pos.y)).dotProduct(this.accel);10>=a&&this.enemy.fightState==g_config.fight.fightState.defenseBegin&&(this.enemy.fightState=g_config.fight.fightState.defense,this.enemy.defense());0>=a&&(this.accel.set(0,0),this.action="doStand",this.fightState==g_config.fight.fightState.attackGo?(this.fightState=g_config.fight.fightState.attackHit,
this.enemy.fightState=g_config.fight.fightState.defenseEnd,this.addEffect("skill_001"),this.Return()):this.fightState==g_config.fight.fightState.skillGo?(this.fightState=g_config.fight.fightState.skillHit,this.enemy.fightState=g_config.fight.fightState.defenseEnd,this.addEffect("skill_001"),this.Return()):this.isReturn=!1);this._updated=!1}this._updated&&this.updateAnimation();return this._updated},updateAnimation:function(){this.renderable.visible&&(!this.renderable.animationpause&&this.renderable.fpscount++>
this.renderable.current.animationspeed)&&(this.renderable.setAnimationFrame(++this.renderable.current.idx),this.renderable.fpscount=0,0==this.renderable.current.idx&&this.renderable.resetAnim&&("string"==typeof this.renderable.resetAnim?this.renderable.setCurrentAnimation(this.resetAnim):"function"==typeof this.renderable.resetAnim&&this.renderable.resetAnim()));return!0},goToPosition:function(a){this.distanceEnemy=this.pos.distance(a);this.nextPos="partner"==this.type?{x:a.x-(g_config.character[this.cId].fHeight-
80),y:a.y+(g_config.character[this.cId].fHeight-80)}:{x:a.x+(g_config.character[this.cId].fHeight-80),y:a.y-(g_config.character[this.cId].fHeight-80)}},goToOriginalPostion:function(){this.nextPos=this.originalPos},setEnemy:function(a){this.enemy=a;this.initFight()},beginFight:function(a,c){this.enemy=c;this.fightData=a;this.fightData.attackData.hasBuff&&this.addBuff();this.enemy.fightData=a;this.initFight();this.attack()},attack:function(){if("common"==this.fightData.attackData.action)this.attackInCommon();
else if("skill"==this.fightData.attackData.action)this.attackWithSkill();else throw"\u6218\u6597\u6570\u636e\u6709\u8bef";},attackInCommon:function(){this.isAttack=!0;this.fightState=g_config.fight.fightState.attackGo;this.goToPosition(this.enemy.pos);this.renderable.setCurrentAnimation(this.animationsName["f-attack"])},attackWithSkill:function(){this.isAttack=!0;this.fightState=g_config.fight.fightState.skillGo;this.goToPosition(this.enemy.pos);this.renderable.setCurrentAnimation(this.animationsName["f-skill"])},
death:function(){this.isFightEnd=!0;this.renderable.setCurrentAnimation(this.animationsName["f-death"])},defense:function(){this.fightState=g_config.fight.fightState.defenseBegin;if("hit"==this.fightData.defenseData.action)this.hit();else if("dodge"==this.fightData.defenseData.action)this.dodge();else throw"\u6218\u6597\u6570\u636e\u6709\u8bef";},hit:function(){this.fightState=g_config.fight.fightState.hitHit;this.hurted("f-hit")},hurted:function(a){var c=this;this.subLife(this.fightData.defenseData.reduceBlood);
this.addAnger(this.fightData.defenseData.addAnger);this.addEffectName(20,"red","\u51cf\u8840 -"+this.fightData.defenseData.reduceBlood);0>=this.currentLife?this.death():this.renderable.setCurrentAnimation(this.animationsName[a],function(){c.stand()})},dodge:function(){var a=this;this.fightState=g_config.fight.fightState.defenseDodge;this.addEffectName(20,"red","\u95ea\u907f");this.renderable.setCurrentAnimation(this.animationsName["f-defense"],function(){a.stand()})},Return:function(){console.log("Return");
var a=this;this.isReturn=!0;this.renderable.setCurrentAnimation(this.animationsName["f-return"],function(){a.stand()});this.goToOriginalPostion()},revival:function(){this.renderable.setCurrentAnimation(this.animationsName["f-revival"])},stand:function(){this.isFightEnd=!0;this.renderable.setCurrentAnimation(this.animationsName["f-stand"])},addLifeProgress:function(){this.lifeProgress=new a.ProgressEntity(this,me.ObjectSettings,"life");me.game.add(this.lifeProgress,this.layer+10)},addLife:function(a){this.currentLife+=
a;this.currentLife>=this.life&&(this.currentLife=this.life)},subLife:function(a){this.currentLife-=a;0>=this.currentLife&&(this.currentLife=0)},addAngerProgress:function(){this.angerProgress=new a.ProgressEntity(this,me.ObjectSettings,"anger");me.game.add(this.angerProgress,this.layer+10)},addAnger:function(a){this.currentAnger+=a;this.currentAnger>=this.maxAnger&&(this.currentAnger=this.maxAnger)},subAnger:function(a){this.currentAnger-=a;0>=this.currentAnger&&(this.currentAnger=0)},updateProgress:function(a,
c){"life"==a?this.currentLife+=c:this.currentAnger+=c},addEffectName:function(a,c,d,e){e&&(this.fontName=e);this.fontSize=a;this.fontColor=c;this.effectName=d},addEffect:function(b){"on"==a.game.status.sound&&me.audio.play("attack",!1);this.effect=new a.Effect(this,b,me.ObjectSettings);me.game.add(this.effect,this.layer+20);me.game.sort()},addBuff:function(){this.buff=new a.Buff(this,me.ObjectSettings);me.game.add(this.buff,this.layer);this.buff.alpha=1;var b=(new me.Tween(this.buff)).to({alpha:0},
1E3).onComplete(function(){});b.chain((new me.Tween(this.buff)).to({alpha:1},1E3).onComplete(function(){}).chain(b));b.start();me.game.sort()},removeAll:function(){me.game.remove(this.lifeProgress,!0);me.game.remove(this.angerProgress,!0);this.effect&&me.game.remove(this.effect,!0);this.buff&&me.game.remove(this.buff,!0);me.game.remove(this,!0)},draw:function(b){me.game.viewport.overlaps(this)&&(this.drawCharactorName(b,"\u6c34\u795e"),""!=this.effectName&&(this.font||(this.font=new a.Font(b,this)),
this.font.drawFont(b)),this.parent(b))},drawCharactorName:function(b,c){a.drawStokeFont(b,c,this.pos.x,this.pos.y+30,this,"center")}})})(btg);(function(a){a.PlayerPartnerEntity=a.CharacterPartnerBase.extend({init:function(a,c,d,e,f,g){this.isMe=!0;this.cId=e;this.formationPosition=f;this.layer=g;this.parent(a,c,d);this.renderable=new me.ComplexSprite(0,0,"c"+this.cId+"_f_l","Stand");this.type="partner"},update:function(){return this.parent(this)}})})(btg);(function(a){a.EnemyPartnerEntity=a.CharacterPartnerBase.extend({cId:0,init:function(a,c,d,e,f,g){this.cId=e;this.visible=!0;this.formationPosition=f;this.layer=g;this.parent(a,c,d);this.renderable=new me.ComplexSprite(0,0,"c"+this.cId+"_f_r","Stand");this.type=me.game.ENEMY_OBJECT},update:function(){return this.parent(this)}})})(btg);(function(a){a.WeaponEntity=me.ObjectEntity.extend({id:0,name:"weapon_00",init:function(a,c,d){d.image=this.name;d.spritewidth=g_config.effects[this.name].width;d.spriteheight=g_config.effects[this.name].height;this.parent(a,c,d);this.type=g_config.map.object.type.WEAPON;this.id=d.id;this.initAnimation()},initAnimation:function(){},update:function(){this.parent(this)},draw:function(a){this.parent(a)}})})(btg);
